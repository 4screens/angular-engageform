/*
 4screens-engageform v0.1.6
 (c) 2014 Nopattern sp. z o.o.
 License: proprietary
*/
"use strict";angular.module("4screens.engageform",["4screens.common","4screens.settings","LocalStorageModule","youtube-embed","djds4rce.angular-socialshare","ngMessages"]).config(["localStorageServiceProvider",function(e){e.prefix="4screens.engageform"}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/main.html",'<link rel="stylesheet" type="text/css" data-ng-href="{{ customThemeCssFile || staticThemeCssFile }}" data-ng-if="!!customThemeCssFile || !!staticThemeCssFile"><div id="four-screens-application" class="{{screenType}}"><div class="theme-background-image-file-wrapper theme-background-brightness theme-background-color"><picture data-ng-if="quiz.theme.backgroundImageFile" class="position-{{quiz.theme.backgroundImagePosition}}"><source media="(min-width: 1021px)" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"><source media="(min-width: 769px)" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 1020, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1020, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1020, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"><source media="(min-width: 481px)" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 768, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 768, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 768, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"><source media="(min-width: 0px)" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 480, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 480, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 480, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"><img data-ng-src="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.0\', quiz.theme.backgroundImageBlur ) }}" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"></picture></div><div class="four-screens__embed-container theme-main-font" data-ng-class="wayAnimateClass"><div data-ng-repeat="question in questions | questionsFilter" class="questionnaire animate-if" data-ng-if="$index == currentQuestion.index()"><div class="question-content-wrapper question-content-wrapper--{{question.type}}" higher-than-window><div class="four-screens__content wrapper" data-ng-class="{ \'content__type--forms\': question.type == \'forms\', \'content__type--multi-choice\': question.type == \'multiChoice\', \'content__type--picture-choice\': question.type == \'pictureChoice\', \'content__type--rate-it\': question.type == \'rateIt\', \'content__type--start-page\': question.type == \'startPage\', \'content__type--end-page\': question.type == \'endPage\' }" data-ng-include="\'views/engageform/question-\' + question.type + \'.html\'"></div></div></div></div><div class="message-box message-box__require theme-button-color theme-question-color" data-ng-class="{\'is-active\': !!requiredMessage }">{{requiredMessage}}</div><div class="four-screens__footer" data-ng-if="questions[currentQuestion.index()].type !== \'startPage\' && questions[currentQuestion.index()].type !== \'endPage\'"><div class="progress"><span class="progress__bar"><span class="progress__bar--line theme-button-color" data-ng-class="{\'progress__bar--full-size\': progressBarWidth() === 100 }" data-ng-style="{\'width\': progressBarWidth()+\'%\'}"></span></span></div><a title="4Screens" href="http://4screens.net/" class="four-screens__footer-logo" target="_blank">4Screens</a> <button class="progress__btn progress__btn--prev fa-stack fa-lg" data-ng-show="hasPrev()" data-ng-click="prev()"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-angle-left"></i></button> <button class="progress__btn progress__btn--next fa-stack fa-lg" data-ng-show="pagination.curr() < pagination.last" data-ng-click="next($event)"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-angle-right"></i></button> <button class="progress__btn progress__btn--submit theme-button-color theme-question-color" data-ng-show="pagination.curr() == pagination.last" data-ng-click="submitQuiz($event)"><span>submit</span></button></div></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-endPage.html",'<div class="scored theme-question-color" data-ng-if="quiz.type === \'score\'">You scored <span class="scored-text"><span class="scored-text-fill" data-ng-style="{height: ( 100 - scoredPoints ) + \'%\'}">{{scoredPoints || 0}}</span>{{ (scoredPoints || 0) + \'%\'}}</span></div><h2 class="theme-question-color text-center" data-ng-bind-html="question.text | nl2br" data-ng-if="!!question.text"></h2><div class="main-content-description theme-question-color text-center" data-ng-if="!!question.description"><p>{{question.description}}</p></div><picture class="main-media-image" data-ng-if="!!currentQuestion.mainMedia() && !!mainMediaImg()" data-ng-class="{\'no-transform\': !question.imageData, \'transform\': question.imageData}" data-ng-style="{\'padding-bottom\': mainMediaImg().paddingBottom + \'%\'}"><img data-ng-style="{ \'width\': mainMediaImg().width + \'%\', \'left\' : (question.imageData.left > 0 ? question.imageData.left : 0) + \'%\', \'top\' : (question.imageData.top > 0 ? question.imageData.top : 0) + \'%\' }" data-ng-src="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}" data-ng-srcset="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"></picture><div class="text-center main-footer" data-ng-if="question.coverPage.link"><a class="btn btn--round-corner btn--normal theme-button-color theme-question-color" rel="nofollow" target="_blank" title="{{question.coverPage.buttonText}}" data-ng-href="{{question.coverPage.link}}">{{question.coverPage.buttonText || "Thank You"}}</a></div><div class="text-center main-footer" data-ng-if="!question.coverPage.link"><span class="btn btn--round-corner btn--normal theme-button-color theme-question-color" title="{{question.coverPage.buttonText}}">{{question.coverPage.buttonText || "Thank You" }}</span></div><div data-ng-if="question.coverPage.showSocialShares" data-ng-include="\'views/engageform/social-share.html\'"></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-forms.html",'<h2 class="theme-question-color text-left" data-ng-bind-html="question.text | nl2br" data-ng-if="!!question.text"></h2><picture class="main-media-image" data-ng-if="!!currentQuestion.mainMedia() && !!mainMediaImg()" data-ng-class="{\'no-transform\': !question.imageData, \'transform\': question.imageData}" data-ng-style="{\'padding-bottom\': mainMediaImg().paddingBottom + \'%\'}"><img data-ng-style="{ \'width\': mainMediaImg().width + \'%\', \'left\' : (question.imageData.left > 0 ? question.imageData.left : 0) + \'%\', \'top\' : (question.imageData.top > 0 ? question.imageData.top : 0) + \'%\' }" data-ng-src="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}" data-ng-srcset="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"></picture><form action name="form" class="form" formnovalidate><fieldset><div class="form__field" data-ng-repeat="input in question.forms.inputs"><label for="{{input._id}}" data-ng-bind="input.label"></label> <input type="email" validate-full-email placeholder="{{input.label}}" name="{{input._id}}" data-ng-if="input.type==\'email\'" data-ng-model="questionAnswer.status[input._id]" formnovalidate ng-required="currentQuestion.requiredAnswer()"> <input type="text" placeholder="{{input.label}}" name="{{input._id}}" data-ng-if="input.type==\'text\'" data-ng-model="questionAnswer.status[input._id]" formnovalidate ng-required="currentQuestion.requiredAnswer()"> <input type="tel" placeholder="{{input.label}}" name="{{input._id}}" data-ng-if="input.type==\'phone\'" data-ng-model="questionAnswer.status[input._id]" formnovalidate ng-required="currentQuestion.requiredAnswer()"> <input type="url" placeholder="{{input.label}}" name="{{input._id}}" data-ng-if="input.type==\'url\'" data-ng-model="questionAnswer.status[input._id]" formnovalidate ng-required="currentQuestion.requiredAnswer()"> <textarea name="{{input._id}}" id cols="30" rows="10" data-ng-if="input.type==\'textarea\'" placeholder="{{input.label}}" data-ng-model="questionAnswer.status[input._id]" formnovalidate ng-required="currentQuestion.requiredAnswer()"></textarea><div data-ng-messages="form[input._id].$error" class="message text-right" data-ng-class="{\'is-active\': !!form[input._id].$error.fullEmail || !!form[input._id].$error.url}"><div data-ng-message="fullEmail">Your field has an invalid email address</div><div data-ng-message="email">Your field has an invalid email address</div><div data-ng-message="number">Only numbers</div><div data-ng-message="url">Your field has a invalid url address</div></div></div><input type="text" class="hidden" name="form" data-ng-model="questionAnswer.form" data-ng-init="questionAnswer.form=form"></fieldset><div class="hint"><i class="fa fa-info-circle"></i>&nbsp;<span>Type your answer above. Press next to continue.</span></div></form>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-multiChoice.html","<h2 class=\"theme-question-color text-left\" data-ng-bind-html=\"question.text | nl2br\" data-ng-if=\"!!question.text\"></h2><div class=\"header__wrapper\" data-ng-if=\"!!currentQuestion.mainMedia() && !!mainMediaImg()\"><picture class=\"main-media-image\" data-ng-class=\"{'no-transform': !question.imageData, 'transform': question.imageData}\" data-ng-style=\"{'padding-bottom': mainMediaImg().paddingBottom + '%'}\"><img data-ng-style=\"{ 'width': mainMediaImg().width + '%', 'left' : (question.imageData.left > 0 ? question.imageData.left : 0) + '%', 'top' : (question.imageData.top > 0 ? question.imageData.top : 0) + '%' }\" data-ng-src=\"{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, '1.0' ) }}\" data-ng-srcset=\"{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, '1.0' ) }}, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, '1.5' ) }} 1.5x, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, '2.0' ) }} 2.0x\"></picture></div><div data-ng-click=\"sendAnswer( answer._id )\" data-ng-repeat=\"answer in question.answers\" class=\"questionnaire__answer\" data-ng-class=\"{'theme-button-color questionnaire__answer--selected': questionAnswer.selected === answer._id, 'theme-answer-background-color theme-answer-border-color': questionAnswer.selected !== answer._id, 'questionnaire__answer--notcorrect': !!questionAnswer.selected && questionAnswer.selected !== answer._id }\"><div class=\"answer__bar\" ng-style=\"{'width': formatAnswers(questionAnswer.stats[answer._id])+'%'}\" data-ng-class=\"{'theme-answer-select-background-result-color': questionAnswer.selected === answer._id, 'theme-answer-background-result-color': questionAnswer.selected !== answer._id }\" data-ng-if=\"question.settings.showAnswers && question.settings.showAnswers !== false\"></div><label data-ng-class=\"{ 'theme-question-color': questionAnswer.selected === answer._id, 'theme-answer-color': questionAnswer.selected !== answer._id }\">{{answer.text}} <span class=\"theme-question-result-color-text ng-animate\"><span data-ng-if=\"question.settings.showAnswers && questionAnswer.selected\">{{ formatAnswers(questionAnswer.stats[answer._id]) | number:1 }} %</span> <i class=\"fa\" data-ng-if=\"question.settings.showCorrectAnswer && questionAnswer.selected === answer._id\" data-ng-class=\"{'fa-check': questionAnswer.correct === answer._id, 'fa-times': questionAnswer.correct !== answer._id }\"></i> <span></span></span></label></div>")}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-pictureChoice.html","<h2 class=\"theme-question-color text-left\" data-ng-bind-html=\"question.text | nl2br\" data-ng-if=\"!!question.text\"></h2><div class=\"header__wrapper\" data-ng-if=\"!!currentQuestion.mainMedia() && !!mainMediaImg()\"><picture class=\"main-media-image\" data-ng-class=\"{'no-transform': !question.imageData, 'transform': question.imageData}\" data-ng-style=\"{'padding-bottom': mainMediaImg().paddingBottom + '%'}\"><img data-ng-style=\"{ 'width': mainMediaImg().width + '%', 'left' : (question.imageData.left > 0 ? question.imageData.left : 0) + '%', 'top' : (question.imageData.top > 0 ? question.imageData.top : 0) + '%' }\" data-ng-src=\"{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, '1.0' ) }}\" data-ng-srcset=\"{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, '1.0' ) }}, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, '1.5' ) }} 1.5x, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, '2.0' ) }} 2.0x\"></picture></div><div class=\"list\"><div data-ng-repeat=\"answer in question.answers\" class=\"questionnaire__answer questionnaire__answer--picture-choice\" data-ng-class=\"{'questionnaire__answer--selected': questionAnswer.selected === answer._id, 'questionnaire__answer--notcorrect': !!questionAnswer.selected && questionAnswer.selected !== answer._id }\" data-ng-click=\"sendAnswer( answer._id )\"><figure data-ng-class=\"{ 'theme-button-color questionnaire__answer--selected': questionAnswer.selected === answer._id, 'theme-answer-background-color theme-answer-border-color': questionAnswer.selected !== answer._id, 'questionnaire__answer--notcorrect': !!questionAnswer.selected && questionAnswer.selected !== answer._id }\"><div class=\"image-wrapper\"><picture class=\"thumb-media-image\"><img style=\"display: block; position: absolute;\" data-ng-style=\"{ 'width': answer.imagedata.width + '%', 'left': answer.imagedata.left + '%', 'top': answer.imagedata.top + '%' }\" data-ng-src=\"{{ getImgUrl( currentQuestion.answerMedia( answer.imageFile ), 300, '1.0' ) }}\" data-ng-srcset=\"{{ getImgUrl( currentQuestion.answerMedia( answer.imageFile ), 300, '1.0' ) }}, {{ getImgUrl( currentQuestion.answerMedia( answer.imageFile ), 300, '1.5' ) }} 1.5x, {{ getImgUrl( currentQuestion.answerMedia( answer.imageFile ), 300, '2.0' ) }} 2.0x\"></picture><div class=\"answer__bar\" data-ng-class=\"{'theme-answer-select-background-result-color': questionAnswer.selected === answer._id, 'theme-answer-background-result-color': questionAnswer.selected !== answer._id }\" ng-style=\"{ '-moz-transform': formatAnswersTransform(questionAnswer.stats[answer._id], true), '-webkit-transform': formatAnswersTransform(questionAnswer.stats[answer._id], true), '-o-transform': formatAnswersTransform(questionAnswer.stats[answer._id], true), '-ms-transform': formatAnswersTransform(questionAnswer.stats[answer._id], true), 'transform': formatAnswersTransform(questionAnswer.stats[answer._id], true), }\" data-ng-if=\"question.settings.showAnswers && question.settings.showAnswers !== false && !!questionAnswer.stats\"></div></div><figcaption data-ng-class=\"{ 'theme-question-color': questionAnswer.selected === answer._id, 'theme-answer-color': questionAnswer.selected !== answer._id }\">{{ answer.text }}</figcaption><div class=\"results\" data-ng-class=\"{ 'theme-question-color': questionAnswer.selected === answer._id, 'theme-answer-color': questionAnswer.selected !== answer._id}\"><span class=\"results__precent\" data-ng-if=\"question.settings.showAnswers && question.settings.showAnswers !== false && questionAnswer.selected\">{{ !!questionAnswer.stats[answer._id] ? (100 * questionAnswer.stats[answer._id]) : 0 | number:1 }}<span class=\"precent\">%</span></span> <span class=\"results__triangle\" data-ng-if=\"question.settings.showCorrectAnswer && question.settings.showCorrectAnswer !== false && questionAnswer.selected === answer._id\" data-ng-class=\"{'is-correct': !!question.settings.showCorrectAnswer && !!questionAnswer.status[ answer._id ].correct, 'is-incorrect': !questionAnswer.status[ answer._id ].correct }\"><i class=\"fa\" data-ng-class=\"{'fa-check': questionAnswer.status[ answer._id ].correct, 'fa-times': !questionAnswer.status[ answer._id ].correct }\"></i></span></div></figure></div></div>")}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-rateIt.html",'<h2 class="theme-question-color text-left" data-ng-bind-html="question.text | nl2br" data-ng-if="!!question.text"></h2><picture class="main-media-image" data-ng-if="!!currentQuestion.mainMedia() && !!mainMediaImg()" data-ng-class="{\'no-transform\': !question.imageData, \'transform\': question.imageData}" data-ng-style="{\'padding-bottom\': mainMediaImg().paddingBottom + \'%\'}"><img data-ng-style="{ \'width\': mainMediaImg().width + \'%\', \'left\' : (question.imageData.left > 0 ? question.imageData.left : 0) + \'%\', \'top\' : (question.imageData.top > 0 ? question.imageData.top : 0) + \'%\' }" data-ng-src="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}" data-ng-srcset="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"></picture><div class="list list__rating list__rating--{{question.rateIt.rateType || \'star\'}}" data-ng-init="AA = makeTimes(question.rateIt.maxRateItValue || 5)"><span data-ng-click="sendAnswer(AA.length - $index, $event)" class="theme-answer-color" data-ng-class="{\'item__selected\': questionAnswer.selected >= AA.length - $index}" data-ng-repeat="r in AA" data-ng-if="question.rateIt.rateType !== \'number\'"><i class="fa"></i> <span class="number">{{AA.length - $index}}</span></span> <span data-ng-click="sendAnswer(AA.length - $index, $event)" class="theme-answer-color" data-ng-class="{\'item__selected\': questionAnswer.selected == AA.length - $index}" data-ng-repeat="r in AA" data-ng-if="question.rateIt.rateType === \'number\'"><i class="fa"></i> <span class="number">{{AA.length - $index}}</span></span></div><div class="footer-rating"><div class="cell"><div class="rating__label theme-question-color text-left"><span>{{question.rateIt.minLabel}}</span></div></div><div class="cell"><div class="rating__results theme-question-color"><span data-ng-if="questionAnswer.average">Average: {{ questionAnswer.average | number:1 }}</span></div></div><div class="cell"><div class="rating__label theme-question-color text-right"><span>{{question.rateIt.maxLabel}}</span></div></div></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-startPage.html","<h2 class=\"theme-question-color text-center\" data-ng-bind-html=\"question.text | nl2br\" data-ng-if=\"!!question.text\"></h2><div class=\"main-content-description theme-question-color text-center\" data-ng-if=\"!!question.description\"><p>{{question.description}}</p></div><picture class=\"main-media-image\" data-ng-if=\"!!currentQuestion.mainMedia() && !!mainMediaImg()\" data-ng-class=\"{'no-transform': !question.imageData, 'transform': question.imageData}\" data-ng-style=\"{'padding-bottom': mainMediaImg().paddingBottom + '%'}\"><img data-ng-style=\"{ 'width': mainMediaImg().width + '%', 'left' : (question.imageData.left > 0 ? question.imageData.left : 0) + '%', 'top' : (question.imageData.top > 0 ? question.imageData.top : 0) + '%' }\" data-ng-src=\"{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, '1.0' ) }}\" data-ng-srcset=\"{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, '1.0' ) }}, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, '1.5' ) }} 1.5x, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, '2.0' ) }} 2.0x\"></picture><div class=\"quiz-icon quiz-icon-big\" data-ng-if=\"!currentQuestion.mainMedia() && currentQuestion.settings('showMainMedia')\"><i class=\"fa theme-question-color\" data-ng-class=\"{ 'fa-bar-chart': quiz.type === 'poll', 'fa-edit': quiz.type === 'survey', 'fa-trophy': quiz.type === 'score', 'fa-group': quiz.type === 'outcome' }\"></i></div><div class=\"text-center main-footer\"><button class=\"btn btn--round-corner btn--normal theme-button-color theme-question-color\" data-ng-show=\"hasNext()\" data-ng-click=\"next($event)\">{{question.coverPage.buttonText || \"Let's get started\"}}</button> <button class=\"btn btn--round-corner btn--normal theme-button-color theme-question-color\" data-ng-show=\"!hasNext()\">{{question.coverPage.buttonText || \"Let's get started\"}}</button></div>")}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/social-share.html",'<section class="social-shares--icons"><a class="social-shares--icons__fb" data-ng-click="socialShare().facebook.share()"><i class="fa fa-facebook"></i></a><a class="social-shares--icons__twitter" href="https://twitter.com/intent/tweet?text={{ socialShare().link + \' \' + socialShare().title + \' \' + socialShare().description }}"><i class="fa fa-twitter"></i></a><a class="social-shares--icons__linkedin" data-ng-click="socialShare().linkedin.share()"><i class="fa fa-linkedin"></i></a></section>')}]),angular.module("4screens.engageform").controller("engageformDefaultCtrl",["CONFIG","EngageformBackendService","CloudinaryService","$scope","$routeParams","$timeout","$window","$http","$q","previewMode","summaryMode",function(e,t,n,s,a,i,r,o,u,c,d){function l(){s.screenType=r.innerHeight>r.innerWidth?"narrow":"wide"}function g(){s.$$phase||s.$apply(l)}function m(e){var n;e.data.length&&(e.origin.indexOf("facebook")||e.origin.indexOf("twitter")||(n=JSON.parse(e.data),c?s.$apply(function(){t.setUserResults(n)}):d&&s.$apply(function(){t.setAnswersResults(n)})))}function f(e,t,n){var s=Math.min(t/e.maxWidth,1),a=Math.min(n/e.maxHeight,1),i=Math.max(e.minFontSize,Math.min(s,a));angular.element(r.document.querySelector("html")).css("font-size",Math.floor(1e3*i)/10+"%")}function h(e){return s.getUser().uid?t.quiz.submit(e).then(function(e){s.pickCorrectEndPage(e),_.where(s.questions,{type:"endPage"}).length?s.next(null,!0):s.requiredMessage="Thank you!"}).catch(function(e){s.requiredMessage=e.data.msg||"Unexpected error"}):(s.requiredMessage="You need to answer at least one question to finish quiz",!1)}function p(e,t){var n=[];for(var a in e)e.hasOwnProperty(a)&&n.push({_id:a,value:e[a]});if(n.length)return s.sendAnswer(n,t,!0);if(s.pagination.curr()>=s.pagination.last){var i=u.defer();return i.resolve(),i.promise}s.next(null,!0)}var w,q=a.engageFormId;s.pagination={curr:function(){},last:0},t.quiz.get(q).then(function(e){s.quiz=e,s.staticThemeCssFile=t.quiz.getStaticThemeCssFile(),t.questions.get().then(function(e){s.wayAnimateClass="way-animation__next",s.questions=_.sortBy(e,"position"),d&&_.map(s.questions,function(e){return e.settings&&"undefined"!=typeof e.settings.showAnswers&&(e.settings.showAnswers=!0),"undefined"!=typeof e.requiredAnswer&&(e.requiredAnswer=!1),e}),s.endPages=_.groupBy(s.questions,{type:"endPage"}).true||[],s.startPages=_.groupBy(s.questions,{type:"startPage"}).true||[],s.normalQuestions=_.groupBy(s.questions,function(e){return"endPage"!==e.type&&"startPage"!==e.type}).true||[],s.questions=s.startPages.length?new Array(s.startPages[0]):[],s.questions=s.questions.concat(s.normalQuestions),s.normalQuestions.length<1&&("poll"!==s.quiz.type&&"survey"!==s.quiz.type||1!==s.endPages.length||s.questions.push(s.endPages[0])),s.normalQuestionsAmmount=s.normalQuestions.length,s.pagination={curr:function(){return s.currentQuestion.index()+(s.startPages.length?0:1)},last:s.normalQuestions.length},t.questions.sync(s.questions,s.currentQuestion.index()),s.sentAnswer(),s.socialShare().init()})}),r.addEventListener("message",m,!1),s.makeTimes=function(e){for(var t=[],n=0;e>n;n++)t.push(n);return t},s.scaleEmbedCfg={minFontSize:.7,maxWidth:680,maxHeight:880},angular.element(r).bind("resize",function(){g(),f(s.scaleEmbedCfg,r.innerWidth,r.innerHeight)}),l(),f(s.scaleEmbedCfg,r.innerWidth,r.innerHeight),s.getBgImgUrl=function(t,s,a,i){return n.getImgUrl(e.backend.domain.replace(":subdomain","")+"/uploads/"+t,s,a,i)},s.getImgUrl=function(e,t,s,a){return n.getImgUrl(e,t,s,a)},s.getMainImgUrl=function(t,a,i){var r=s.questions[s.currentQuestion.index()].imageData,o=parseInt(e.backend.mainImageContainerBaseWidth,10)||540;return r?n.getMainImgUrl(t,a*(r.width/100||1),a,Math.round(r.containerHeight*(a/o)),Math.round(a/o*Math.round(o*r.left*-1/100)||0),Math.round(a/o*Math.round(r.containerHeight*r.top*-1/100)||0)):n.getImgUrl(t,a,i)},s.mainMediaImg=function(){var t,n=s.questions[s.currentQuestion.index()].imageData,a=parseInt(e.backend.mainImageContainerBaseWidth,10)||540;return s.questions[s.currentQuestion.index()].imageData?(t=n.width<100?n.left+n.width>100?100-n.left:n.width+Math.min(n.left,0):100,{width:t,paddingBottom:Math.round(n.containerHeight/a*100),src:s.questions[s.currentQuestion.index()].imageFile}):null},s.sentAnswer=function(){s.questionAnswer=t.question.sentAnswer()||{},s.questionAnswer.status=s.questionAnswer.status||{},_.forEach(s.currentQuestion.answers(),function(e){s.questionAnswer.status[e._id]={},e._id===s.questionAnswer.selected&&(s.questionAnswer.status[e._id].selected=!0),s.questionAnswer.correct&&(e._id===s.questionAnswer.correct?s.questionAnswer.status[e._id].correct=!0:e._id===s.questionAnswer.selected&&(s.questionAnswer.status[e._id].wrong=!0))})},s.sendAnswer=function(e,n,a){return n&&(n.stopPropagation(),n.preventDefault()),d?!1:t.question.sendAnswer(e).then(function(){s.questionAnswer&&!s.questionAnswer.form&&s.sentAnswer(),!s.currentQuestion.settings("showAnswers")&&!s.currentQuestion.settings("showCorrectAnswer")&&s.hasNext()&&!w&&s.pagination.curr()<s.pagination.last&&(w=i(function(){"undefinded"==typeof a?s.next():s.next(null,!0),w=null},200))})},s.checkUser=function(){return t.user.check()},s.getUser=function(){return t.user.get()},s.pickCorrectEndPage=function(e){var n;switch(s.wayAnimateClass="",s.quiz.type){case"score":e.hasOwnProperty("totalScore")&&s.endPages.length&&(n=_.filter(s.endPages,function(t){return t.coverPage&&t.coverPage.scoreRange&&t.coverPage.scoreRange.min<=e.totalScore/e.maxScore*100&&t.coverPage.scoreRange.max>=e.totalScore/e.maxScore*100?t:void 0}),n.length&&(s.questions.push(n[0]),s.showScore(Math.ceil(e.totalScore/e.maxScore*100))));break;case"outcome":e.hasOwnProperty("outcome")&&s.endPages.length&&(n=_.filter(s.endPages,function(t){return t.coverPage&&t.coverPage.outcome&&t.coverPage.outcome===e.outcome?t:void 0}),n.length&&s.questions.push(n[0]));break;default:s.endPages.length&&s.questions.push(s.endPages[0])}t.questions.sync(s.questions,s.currentQuestion.index()),s.wayAnimateClass="way-animation__next"},s.checkUser(),s.submitQuiz=function(e){return d?!1:(s.requiredMessage="",(!s.requiredMessage||s.requiredMessage&&s.requiredMessage.length<1)&&(s.requiredMessage="","forms"===s.questions[s.currentQuestion.index()].type?(s.questionAnswer.selected=!0,p(s.questionAnswer.status,e).then(function(){h(q)})):h(q)),void 0)},s.showScore=function(e){s.scoredPoints=e},s.formatAnswers=function(e){return e?100*e:0},s.formatAnswersTransform=function(e){var t=e?100*e:0;return"translate(-50%,"+(100-t)+"%)"},s.prev=function(){t.navigation.prev(),s.sentAnswer(),s.wayAnimateClass="way-animation__prev"},s.hasPrev=function(){return t.navigation.hasPrev()},s.next=function(e,n){"startPage"===s.questions[s.currentQuestion.index()].type||"undefined"!=typeof n?(t.navigation.next(),s.wayAnimateClass="way-animation__next",s.requiredMessage="",s.sentAnswer()):c||d?(t.navigation.next(),s.sentAnswer(),s.wayAnimateClass="way-animation__next"):!s.questionAnswer.form&&(s.currentQuestion.requiredAnswer()&&s.questionAnswer.selected||!s.currentQuestion.requiredAnswer())?(t.navigation.next(),s.sentAnswer(),s.wayAnimateClass="way-animation__next",s.requiredMessage=""):s.questionAnswer&&s.questionAnswer.form&&s.questionAnswer.form.$valid?(s.questionAnswer.selected=!0,p(s.questionAnswer.status,e)):s.requiredMessage="Answer is required to proceed to next question"},s.hasNext=function(){return t.navigation.hasNext()},s.currentQuestion={index:t.question.index,settings:t.question.settings,mainMedia:t.question.mainMedia,answers:t.question.answers,inputs:t.question.inputs,answerMedia:t.question.answerMedia,requiredAnswer:t.question.requiredAnswer},s.progressBarWidth=function(){return s.pagination.curr()/s.pagination.last*100},s.socialShare=function(){var t=s.questions[s.currentQuestion.index()],n={enabled:t.coverPage.showSocialShares?!0:!1,title:s.quiz.settings.share&&s.quiz.settings.share.title||("startPage"===s.questions[0].type&&s.questions[0].title?s.questions[0].title:"ShareTitle"),description:s.quiz.settings.share&&s.quiz.settings.share.description||("startPage"===s.questions[0].type&&s.questions[0].description?s.questions[0].description:"ShareDescription"),imageUrl:s.quiz.settings.share&&s.quiz.settings.share.imageUrl||("startPage"===s.questions[0].type&&s.questions[0].imageFile?s.questions[0].imageFile:""),link:s.quiz.settings.share&&s.quiz.settings.share.link||r.location.href,href:r.location.href,init:function(){"object"==typeof window.twttr?window.twttr.events.bind("tweet",function(){o.get(e.backend.answers.domain+e.backend.share.other.replace(":service","twitter").replace(":quizId",t.quizId)).then(function(e){console.log(e)}).catch(function(e){console.log(e)})}):console.error("Twitter api is not included")}};return n.facebook={share:function(){window.open(e.backend.answers.domain+e.backend.share.facebook+"?quizId="+t.quizId+"&description="+n.description+"&name="+n.title,"_blank","toolbar=no,scrollbars=no,resizable=yes,width=460,height=280")}},n.linkedin={share:function(){window.open("https://www.linkedin.com/shareArticle?mini=true&url="+n.link+"&title="+n.title+"&summary"+n.description,"_blank","toolbar=no,scrollbars=no,resizable=yes,width=550,height=500")}},n}}]),angular.module("4screens.engageform").directive("engageformSwiperDirective",["$timeout",function(e){return{restrict:"C",link:function(t){var n,s={slideElement:"article",slidesPerView:1,pagination:".pagination-swiper",calculateHeight:!0,roundLengths:!0,resizeReInit:!0};e(function(){e(function(){e(function(){e(function(){n=new Swiper(".engageform-swiper-directive",s),t.swipeNext=n.swipeNext,t.swipePrev=n.swipePrev})})})})}}}]),angular.module("4screens.engageform").directive("higherThanWindow",["$document","$window","$timeout",function(e,t,n){var s=angular.element(e.find("body").eq(0));return{link:function(e,a){function i(){e.$applyAsync(function(){var e=a[0].clientHeight;a[0].clientHeight>t.innerHeight?s.addClass("higher-than-window"):s.removeClass("higher-than-window"),t.parent.postMessage(e,"*"),n(function(){e!==a[0].clientHeight&&i()},50)})}i()}}}]),angular.module("4screens.engageform").filter("nl2br",["$sce",function(e){return function(t){return e.trustAsHtml((t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2"))}}]),angular.module("4screens.engageform").filter("questionsFilter",function(){return function(e){var t=e;
return angular.forEach(t,function(e,n){"startPage"===e.type&&0!==n&&t.unshift(t.splice(n,1)[0])}),t}}),angular.module("4screens.engageform").factory("EngageformBackendService",["CONFIG","CommonLocalStorageService","SettingsEngageformService","$q","$filter",function(e,t,n,s,a){function i(){return g.mainMedia=g.mainMedia||{},void 0!==g.mainMedia[d[l]._id]?g.mainMedia[d[l]._id]:(d[l].settings=d[l].settings||{},d[l].settings.showMainMedia?d[l].imageFile?(g.mainMedia[d[l]._id]={$key:d[l]._id,src:"http"!==d[l].imageFile.slice(0,4)?e.backend.domain.replace(":subdomain","")+e.backend.imagesUrl+"/"+d[l].imageFile:d[l].imageFile},g.mainMedia[d[l]._id]):(g.mainMedia[d[l]._id]=null,g.mainMedia[d[l]._id]):(g.mainMedia[d[l]._id]=null,g.mainMedia[d[l]._id]))}function r(e){var t;return t=_.findIndex(f,function(t){return t.stats.questionId===e}),0>t?void 0:f[t]}function o(e){var t=m.questions&&m.questions[e]?m.questions[e]:m[e],n=d[l],s=null;if("undefined"==typeof t)return s;switch(n.type){case"multiChoice":t.selectedAnswerId&&(s={selected:t.selectedAnswerId});break;case"pictureChoice":t.selectedAnswerId&&(s={selected:t.selectedAnswerId});break;case"rateIt":t.rateItValue&&(s={selected:t.rateItValue});break;case"forms":if(t.inputs.length){s={status:{}};for(var a in t.inputs)s.status[t.inputs[a]._id]=t.inputs[a].value}}return s}var u,c,d=[],l=0,g={},m=null,f=null,h="ui",p="uig",w="qsa_",q=(new Date).getTime();return g[h]=t.get(h),g[p]=t.get(p),{setUserResults:function(e){m=e?e:null,e&&e.userIdent&&(g[h]=e.userIdent,t.set(h,g[h]))},setAnswersResults:function(e){f=e?e:null},quiz:{get:function(e){return n.get(e).then(function(e){return u=e,e})},getStaticThemeCssFile:function(){return u.theme=u.theme||{},u.theme.customThemeCssFile?e.backend.domain.replace(":subdomain","")+"/uploads/"+u.theme.customThemeCssFile+"?"+q:null},submit:function(e){return n.submitQuiz(e,g[h],g[p]).then(function(e){return t.clearAll(),t.set(p,g[p]),g={},g[p]=t.get(p),m&&(e.outcome=m.outcome,e.totalScore=m.totalScore,e.maxScore=m.maxScore),e})}},question:{index:function(){return l},settings:function(e){return d[l].settings=d[l].settings||{},!!d[l].settings[e]},mainMedia:function(){return i()},inputs:function(){return d[l].forms=d[l].forms||{},d[l].forms.inputs},answers:function(){return d[l].answers},requiredAnswer:function(){return d[l].requiredAnswer},answerMedia:function(t){return"http"!==t.slice(0,4)?e.backend.domain.replace(":subdomain","")+e.backend.imagesUrl+"/"+t:t},sentAnswer:function(){var e,n=d[l]._id;if(m)e=o(n);else if(f)e=r(n);else{var s=w+n;e=t.get(s)}return e?e:null},sendAnswer:function(e){var a,i={};return i.quizQuestionId=d[l]._id,!u.settings.allowAnswerChange&&t.get(w+i.quizQuestionId)?(a=s.defer(),a.resolve(),a.promise):("rateIt"===d[l].type&&(i.rateItValue=parseInt(e)),["pictureChoice","multiChoice"].indexOf(d[l].type)>-1&&(i.selectedAnswerId=e),"forms"===d[l].type&&(i.inputs=e),g[h]&&(i.userIdent=g[h]),n.sendAnswer(i).then(function(e){if(g[h]=e.userIdent,t.set(h,g[h]),"rateIt"===d[l].type)t.set(w+i.quizQuestionId,{selected:e.selectedValue,average:e.avgRateItValue});else if(["pictureChoice","multiChoice"].indexOf(d[l].type)>-1)t.set(w+i.quizQuestionId,{selected:e.selectedAnswerId,correct:e.correctAnswerId,stats:e.stats});else if("forms"===d[l].type){var n={};_.forEach(i.inputs,function(e){n[e._id]=e.value}),t.set(w+i.quizQuestionId,{status:n})}return e}))}},questions:{get:function(){return n.getQuestions(u._id).then(function(e){return d=a("questionsFilter")(_.sortBy(e,"position")),c=d.length-(_.where(d,{type:"startPage"}).length||0)-(_.where(d,{type:"endPage"}).length||0),e})},sync:function(e,t){d=e,l=t}},navigation:{prev:function(){this.hasPrev()&&l--},hasPrev:function(){return l>0},next:function(){this.hasNext()&&l++},hasNext:function(){return l<d.length-1}},user:{check:function(){g[p]||n.getGlobalUserIndent().then(function(e){return g[p]=e,t.set(p,g[p]),g[p]})},get:function(){return{uid:g[h],guid:g[p]}}}}}]),angular.module("4screens.engageform").factory("CloudinaryService",["CONFIG",function(e){var t=e.backend.cloudinaryUrl||"http://res.cloudinary.com/test4screens/image/fetch/";return{getImgUrl:function(e,n,s,a){var a="undefined"!=typeof a&&"0"!==a?",e_blur:"+100*parseInt(a,10)+"/":"/",s=",dpr_"+s;return t+"w_"+parseInt(n,10)+",c_limit"+s+a+e},getMainImgUrl:function(e,n,s,a,i,r){return t+"w_"+parseInt(n,10)+"/w_"+s+",h_"+a+",x_"+i+",y_"+r+",c_crop/"+e}}}]);
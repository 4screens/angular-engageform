/*
 4screens-engageform v0.1.1
 (c) 2014 Nopattern sp. z o.o.
 License: proprietary
*/
"use strict";angular.module("4screens.engageform",["4screens.common","4screens.settings","LocalStorageModule","youtube-embed"]).config(["localStorageServiceProvider",function(e){e.prefix="4screens.engageform"}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/main.html",'<link rel="stylesheet" type="text/css" data-ng-href="{{ customThemeCssFile || staticThemeCssFile }}" data-ng-if="!!customThemeCssFile || !!staticThemeCssFile"><div id="four-screens-application"><div class="theme-background-image-file  theme-background-color"></div><div class="four-screens__embed-container theme-main-font"><div ng-repeat="question in questions" class=" questionnaire animate-if"><div class="four-screens__content wrapper" data-ng-include="\'views/engageform/question-\' + question.type + \'.html\'" data-ng-if="$index == currentQuestion.index()"></div></div><div class="four-screens__footer"><div class="progress" data-ng-if="currentQuestion.index() > -1"><span class="progress__bar"><span class="progress__bar--line theme-button-color" ng-class="{\'progress__bar--full-size\': (((currentQuestion.index() + 1)  / questions.length )*100) == 100 }" style="width: {{( (currentQuestion.index() + 1)  / questions.length )*100 | number:0 }}%"></span><div class="progress__numbering">({{ currentQuestion.index() + 1 }} z {{ questions.length }})</div></span></div><button class="progress__btn progress__btn--prev theme-button-color theme-question-color" data-ng-show="hasPrev()" data-ng-click="prev()"><span>&laquo; PREV</span></button> <button class="progress__btn progress__btn--next theme-button-color theme-question-color" data-ng-show="hasNext()" data-ng-click="next()"><span>NEXT &raquo;</span></button></div></div></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-infoPage.html",'<div class="swiper"><a class="swiper swiper-arrow swiper-arrow__left" data-ng-click="swipePrev()"></a> <a class="swiper swiper-arrow swiper-arrow__right" data-ng-click="swipeNext()"></a><div class="swiper-container engageform-swiper-directive"><div class="swiper-wrapper"><article class="swiper-slide" data-ng-repeat="page in question.infoPages"><h2 class="theme-question-color">{{ page.title }}</h2><figure><div class="wrapper ir-16-10" data-ng-if="!!page.imageFile || !!page.youTubeId"><img data-ng-if="!!page.imageFile" data-ng-src="{{ currentQuestion.answerMedia( page.imageFile ) }}" data-ng-click="goto( page.url )"><div data-ng-if="!!page.youTubeId" data-youtube-video data-video-id="page.youTubeId"></div></div></figure><p class="swiper-slide__description theme-answer-color theme-answer-background-color" data-ng-if="!!page.description" data-ng-bind="page.description" data-ng-click="goto( page.url )"></p></article></div></div><div class="pagination-swiper"></div></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-multiChoice.html",'<h2 class="theme-question-color">{{ question.text }}</h2><img data-ng-if="!!currentQuestion.mainMedia()" data-ng-src="{{ currentQuestion.mainMedia().src }}"><div data-ng-click="sendAnswer( answer._id )" data-ng-repeat="answer in question.answers" class="questionnaire__answer" data-ng-class="{\'questionnaire__answer--correct\': questionAnswer.status[ answer._id ].correct, \'questionnaire__answer--wrong\': questionAnswer.status[ answer._id ].wrong, \'questionnaire__answer--selected\': questionAnswer.status[ answer._id ].selected }"><label>{{answer.text}} <span data-ng-if="!!questionAnswer.stats">{{ !!questionAnswer.stats[answer._id] ? (100 * questionAnswer.stats[answer._id]) : 0 | number:1 }} % <span></span></span></label> <span class="questionnaire__precent-bar theme-progress-background-color" data-ng-if="!!questionAnswer.stats" style="width:{{!!questionAnswer.stats[answer._id] ? (100 * questionAnswer.stats[answer._id]) : 0 | number:0}}%"></span></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-pictureChoice.html",'<h2 class="theme-question-color">{{ question.text }}</h2><img data-ng-if="!!currentQuestion.mainMedia()" data-ng-src="{{ currentQuestion.mainMedia().src }}"><div ng-repeat="answer in question.answers" class="questionnaire__answer questionnaire__answer--picture-choise" data-ng-class="{\'questionnaire__answer--correct\': answer._id==questionAnswer.correct, \'questionnaire__answer--wrong\': questionAnswer.selected==answer._id && !!questionAnswer.correct, \'questionnaire__answer--selected\': questionAnswer.selected==answer._id && !questionAnswer.correct}" data-ng-click="sendAnswer( answer._id )"><figure><div class="wrapper ir"><img data-ng-src="{{ currentQuestion.answerMedia( answer.imageFile ) }}"></div><figcaption>{{ answer.text }}</figcaption><div class="results" ng-if="!!questionAnswer && !!questionAnswer.stats"><span>{{ !!questionAnswer.stats[answer._id] ? (100 * questionAnswer.stats[answer._id]) : 0 | number:1 }}<span class="precent">%</span> <span></span></span></div></figure></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-rateIt.html",'<h2 class="theme-question-color">{{ question.text }}</h2><img data-ng-if="!!currentQuestion.mainMedia()" data-ng-src="{{ currentQuestion.mainMedia().src }}"><div class="list list__rating list_rating--stars"><span ng-click="sendAnswer(5, $event)" ng-class="{\'item__selected\': questionAnswer.selected >= 5}"><i class="fa"></i></span> <span ng-click="sendAnswer(4, $event)" ng-class="{\'item__selected\': questionAnswer.selected >= 4}"><i class="fa"></i></span> <span ng-click="sendAnswer(3, $event)" ng-class="{\'item__selected\': questionAnswer.selected >= 3}"><i class="fa"></i></span> <span ng-click="sendAnswer(2, $event)" ng-class="{\'item__selected\': questionAnswer.selected >= 2}"><i class="fa"></i></span> <span ng-click="sendAnswer(1, $event)" ng-class="{\'item__selected\': questionAnswer.selected >= 1}"><i class="fa"></i></span></div><div class="rating__results theme-question-color" data-ng-if="questionAnswer.average"><span>Åšrednia: {{ questionAnswer.average | number:1 }}</span></div>')}]),angular.module("4screens.engageform").controller("engageformDefaultCtrl",["CONFIG","EngageformBackendService","$scope","$routeParams",function(e,n,s,t){n.quiz.get(t.engageFormId).then(function(e){s.quiz=e,s.staticThemeCssFile=n.quiz.getStaticThemeCssFile(),n.questions.get().then(function(e){s.questions=e,s.sentAnswer()})}),s.sentAnswer=function(){s.questionAnswer=n.question.sentAnswer()||{},s.questionAnswer.status={},_.forEach(s.currentQuestion.answers(),function(e){s.questionAnswer.status[e._id]={},e._id===s.questionAnswer.selected&&(s.questionAnswer.status[e._id].selected=!0),s.questionAnswer.correct&&(e._id===s.questionAnswer.correct?s.questionAnswer.status[e._id].correct=!0:e._id===s.questionAnswer.selected&&(s.questionAnswer.status[e._id].wrong=!0))})},s.sendAnswer=function(e,t){t&&(t.stopPropagation(),t.preventDefault()),n.question.sendAnswer(e).then(function(){s.sentAnswer()})},s.prev=function(){n.navigation.prev(),s.sentAnswer()},s.hasPrev=function(){return n.navigation.hasPrev()},s.next=function(){n.navigation.next(),s.sentAnswer()},s.hasNext=function(){return n.navigation.hasNext()},s.currentQuestion={index:n.question.index,settings:n.question.settings,mainMedia:n.question.mainMedia,answers:n.question.answers,answerMedia:n.question.answerMedia}}]),angular.module("4screens.engageform").directive("engageformSwiperDirective",["$timeout","$window",function(e,n){return{restrict:"C",link:function(s){var t,i={slideElement:"article",slidesPerView:1,pagination:".pagination-swiper",calculateHeight:!0,roundLengths:!0,resizeReInit:!0};e(function(){e(function(){e(function(){e(function(){t=new Swiper(".engageform-swiper-directive",i),s.swipeNext=t.swipeNext,s.swipePrev=t.swipePrev,s.goto=function(e){e&&n.open(e)}})})})})}}}]),angular.module("4screens.engageform").factory("EngageformBackendService",["CONFIG","CommonLocalStorageService","SettingsEngageformService","$q",function(e,n,s,t){function i(){return u.mainMedia=u.mainMedia||{},void 0!==u.mainMedia[r[o]._id]?u.mainMedia[r[o]._id]:(r[o].settings=r[o].settings||{},r[o].settings.showMainMedia?r[o].imageFile?(u.mainMedia[r[o]._id]={$key:r[o]._id,src:e.backend.domain.replace(":subdomain","")+e.backend.imagesUrl+"/"+r[o].imageFile},u.mainMedia[r[o]._id]):(u.mainMedia[r[o]._id]=null,u.mainMedia[r[o]._id]):(u.mainMedia[r[o]._id]=null,u.mainMedia[r[o]._id]))}var a,r,o=0,u={},c="ui",d="qsa_";return u[c]=n.get(c),{quiz:{get:function(e){return s.get(e).then(function(e){return a=e,e})},getStaticThemeCssFile:function(){return a.theme=a.theme||{},a.theme.customThemeCssFile?e.backend.domain.replace(":subdomain","")+"/uploads/"+a.theme.customThemeCssFile:null}},question:{index:function(){return o},settings:function(e){return r[o].settings=r[o].settings||{},!!r[o].settings[e]},mainMedia:function(){return i()},answers:function(){return r[o].answers},answerMedia:function(n){return e.backend.domain.replace(":subdomain","")+e.backend.imagesUrl+"/"+n},sentAnswer:function(){var e,s=d+r[o]._id;return e=n.get(s),e?e:null},sendAnswer:function(e){var i,a={};return a.quizQuestionId=r[o]._id,n.get(d+a.quizQuestionId)?(i=t.defer(),i.resolve(),i.promise):("rateIt"===r[o].type&&(a.rateItValue=parseInt(e)),["pictureChoice","multiChoice"].indexOf(r[o].type)>-1&&(a.selectedAnswerId=e),u[c]&&(a.userIdent=u[c]),s.sendAnswer(a).then(function(e){return u[c]=e.userIdent,n.set(c,u[c]),"rateIt"===r[o].type?n.set(d+a.quizQuestionId,{selected:e.selectedValue,average:e.avgRateItValue}):["pictureChoice","multiChoice"].indexOf(r[o].type)>-1&&n.set(d+a.quizQuestionId,{selected:e.selectedAnswerId,correct:e.correctAnswerId,stats:e.stats}),e}))}},questions:{get:function(){return s.getQuestions(a._id).then(function(e){return r=e,e})}},navigation:{prev:function(){o-1>=0&&o--},hasPrev:function(){return!0},next:function(){o+1<=r.length-1&&o++},hasNext:function(){return!0}}}}]);
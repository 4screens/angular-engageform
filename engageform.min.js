/*
 4screens-engageform v0.1.6
 (c) 2014 Nopattern sp. z o.o.
 License: proprietary
*/
"use strict";angular.module("4screens.engageform",["4screens.common","4screens.settings","LocalStorageModule","youtube-embed","ngMessages"]).config(["localStorageServiceProvider",function(e){e.prefix="4screens.engageform"}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/main.html",'<link rel="stylesheet" type="text/css" data-ng-href="{{ customThemeCssFile || staticThemeCssFile }}" data-ng-if="!!customThemeCssFile || !!staticThemeCssFile"><div id="four-screens-application" class="{{screenType}}"><div class="theme-background-image-file-wrapper theme-background-brightness theme-background-color"><picture data-ng-if="quiz.theme.backgroundImageFile" class="position-{{quiz.theme.backgroundImagePosition}}"><source media="(min-width: 1021px)" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"><source media="(min-width: 769px)" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 1020, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1020, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1020, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"><source media="(min-width: 481px)" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 768, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 768, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 768, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"><source media="(min-width: 0px)" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 480, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 480, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 480, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"><img data-ng-src="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.0\', quiz.theme.backgroundImageBlur ) }}" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"></picture></div><div class="four-screens__embed-container theme-main-font" data-ng-class="wayAnimateClass"><div data-ng-repeat="question in questions | questionsFilter" class="questionnaire animate-if" data-ng-if="$index == currentQuestion.index()"><div class="question-content-wrapper question-content-wrapper--{{question.type}}"><div class="four-screens__content wrapper" data-ng-class="{ \'content__type--forms\': question.type == \'forms\', \'content__type--info-page\': question.type == \'infoPage\' , \'content__type--multi-choice\': question.type == \'multiChoice\', \'content__type--picture-choice\': question.type == \'pictureChoice\', \'content__type--rate-it\': question.type == \'rateIt\', \'content__type--start-page\': question.type == \'startPage\', \'content__type--end-page\': question.type == \'endPage\' }" data-ng-include="\'views/engageform/question-\' + question.type + \'.html\'"></div></div></div><div class="message-box message-box__require theme-button-color theme-question-color" data-ng-class="{\'is-active\': !!requiredMessage }">{{requiredMessage}}</div></div><div class="four-screens__footer" data-ng-if="questions[currentQuestion.index()].type !== \'startPage\' && questions[currentQuestion.index()].type !== \'endPage\'"><div class="progress" data-ng-if="currentQuestion.index() > -1"><span class="progress__bar"><span class="progress__bar--line theme-button-color" data-ng-class="{\'progress__bar--full-size\': ((currentQuestion.index() / normalQuestionsAmmount )*100) == 100 }" style="width: {{( currentQuestion.index() / normalQuestionsAmmount )*100 | number:0 }}%"></span></span></div><div class="progress__numbering">({{ currentQuestion.index() }} of {{ normalQuestionsAmmount }})</div><a title="4Screens" href="http://4screens.net/" class="four-screens__footer-logo" target="_blank">4Screens</a> <button class="progress__btn progress__btn--prev" data-ng-show="hasPrev()" data-ng-click="prev()"><span><i class="fa fa-chevron-left"></i></span></button> <button class="progress__btn progress__btn--next theme-button-color theme-question-color" data-ng-show="hasNext() && currentQuestion.index() < normalQuestionsAmmount" data-ng-click="next($event)"><span>NEXT <i class="fa fa-chevron-right"></i></span></button> <button class="progress__btn progress__btn--next theme-button-color theme-question-color" data-ng-show="currentQuestion.index() === normalQuestionsAmmount" data-ng-click="submitQuiz()"><span>SUBMIT</span></button></div></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-endPage.html",'<h2 class="theme-question-color text-center" data-ng-bind-html="question.text | nl2br" data-ng-if="!!question.text"></h2><div class="main-content-description theme-question-color text-center" data-ng-if="!!question.description"><p>{{question.description}}</p></div><picture class="main-media-image" data-ng-if="!!currentQuestion.mainMedia() && !!mainMediaImg()" data-ng-class="{\'no-transform\': !question.imageData, \'transform\': question.imageData}" data-ng-style="{\'padding-bottom\': mainMediaImg().paddingBottom + \'%\'}"><img data-ng-style="{ \'width\': mainMediaImg().width + \'%\', \'left\' : (question.imageData.left > 0 ? question.imageData.left : 0) + \'%\', \'top\' : (question.imageData.top > 0 ? question.imageData.top : 0) + \'%\' }" data-ng-src="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}" data-ng-srcset="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"></picture><div class="text-center main-footer"><a class="btn btn--round-corner btn--normal theme-button-color theme-question-color" rel="nofollow" target="_blank" title="{{question.coverPage.buttonText}}" data-ng-href="{{question.coverPage.link}}">{{question.coverPage.buttonText}}</a></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-forms.html",'<h2 class="theme-question-color text-left" data-ng-bind-html="question.text | nl2br" data-ng-if="!!question.text"></h2><picture class="main-media-image" data-ng-if="!!currentQuestion.mainMedia() && !!mainMediaImg()" data-ng-class="{\'no-transform\': !question.imageData, \'transform\': question.imageData}" data-ng-style="{\'padding-bottom\': mainMediaImg().paddingBottom + \'%\'}"><img data-ng-style="{ \'width\': mainMediaImg().width + \'%\', \'left\' : (question.imageData.left > 0 ? question.imageData.left : 0) + \'%\', \'top\' : (question.imageData.top > 0 ? question.imageData.top : 0) + \'%\' }" data-ng-src="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}" data-ng-srcset="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"></picture><form action name="form" class="form" formnovalidate=""><fieldset><div class="form__field" data-ng-repeat="input in question.forms.inputs"><label for="{{input._id}}" data-ng-bind="input.label"></label> <input type="email" placeholder="{{input.label}}" name="{{input._id}}" data-ng-if="input.type==\'email\'" data-ng-model="questionAnswer.status[input._id]" formnovalidate="" ng-required="!!currentQuestion.requiredAnswer"> <input type="text" placeholder="{{input.label}}" name="{{input._id}}" data-ng-if="input.type==\'text\'" data-ng-model="questionAnswer.status[input._id]" formnovalidate="" ng-required="!!currentQuestion.requiredAnswer"> <input type="tel" placeholder="{{input.label}}" name="{{input._id}}" data-ng-if="input.type==\'phone\'" data-ng-model="questionAnswer.status[input._id]" formnovalidate="" ng-required="!!currentQuestion.requiredAnswer"> <input type="url" placeholder="{{input.label}}" name="{{input._id}}" data-ng-if="input.type==\'url\'" data-ng-model="questionAnswer.status[input._id]" formnovalidate="" ng-required="!!currentQuestion.requiredAnswer"> <textarea name="{{input._id}}" id cols="30" rows="10" data-ng-if="input.type==\'textarea\'" placeholder="{{input.label}}" data-ng-model="questionAnswer.status[input._id]" formnovalidate="" ng-required="!!currentQuestion.requiredAnswer"></textarea><div data-ng-messages="form[input._id].$error" data-ng-messages-multiple class="message text-right" data-ng-class="{\'is-active\': !!form[input._id].$error.email || !!form[input._id].$error.url}"><div data-ng-message="email">Your field has an invalid email address</div><div data-ng-message="number">Only numbers</div><div data-ng-message="url">Your field has a invalid url address</div></div></div><input type="text" class="hidden" name="form" data-ng-model="questionAnswer.form" data-ng-init="questionAnswer.form=form"></fieldset><div class="hint"><i class="fa fa-info-circle"></i>&nbsp;<span>Type your answer above. Press next to continue.</span></div></form>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-infoPage.html",'<div class="swiper"><a class="swiper swiper-arrow swiper-arrow__left" data-ng-click="swipePrev()"></a> <a class="swiper swiper-arrow swiper-arrow__right" data-ng-click="swipeNext()"></a><div class="swiper-container engageform-swiper-directive"><div class="swiper-wrapper"><article class="swiper-slide" data-ng-repeat="page in question.infoPages"><a data-ng-href="{{ page.url }}" target="_blank" data-ng-class="{\'disabled\': !page.url}"><h2 class="theme-question-color" data-ng-bind-html="page.title | nl2br"></h2><figure><div class="wrapper ir-16-10" data-ng-if="(!!page.imageFile && !!mainMediaImg()) || !!page.youTubeId"><picture class="main-media-image" data-ng-class="{\'no-transform\': !question.imageData, \'transform\': question.imageData}" data-ng-style="{\'padding-bottom\': mainMediaImg().paddingBottom + \'%\'}" data-ng-if="!!page.imageFile && !!mainMediaImg()"><img data-ng-style="{ \'width\': mainMediaImg().width + \'%\', \'left\' : (question.imageData.left > 0 ? question.imageData.left : 0) + \'%\', \'top\' : (question.imageData.top > 0 ? question.imageData.top : 0) + \'%\' }" data-ng-src="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}" data-ng-srcset="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"></picture><div data-ng-if="!!page.youTubeId" data-youtube-video data-video-id="page.youTubeId"></div></div></figure><p class="swiper-slide__description theme-answer-color theme-answer-background-color" data-ng-if="!!page.description" data-ng-bind-html="page.description | nl2br"></p></a></article></div></div><div class="pagination-swiper"></div></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-multiChoice.html",'<h2 class="theme-question-color text-left" data-ng-bind-html="question.text | nl2br" data-ng-if="!!question.text"></h2><div class="header__wrapper" data-ng-if="!!currentQuestion.mainMedia() && !!mainMediaImg()"><picture class="main-media-image" data-ng-class="{\'no-transform\': !question.imageData, \'transform\': question.imageData}" data-ng-style="{\'padding-bottom\': mainMediaImg().paddingBottom + \'%\'}"><img data-ng-style="{ \'width\': mainMediaImg().width + \'%\', \'left\' : (question.imageData.left > 0 ? question.imageData.left : 0) + \'%\', \'top\' : (question.imageData.top > 0 ? question.imageData.top : 0) + \'%\' }" data-ng-src="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}" data-ng-srcset="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"></picture></div><div data-ng-click="sendAnswer( answer._id )" data-ng-repeat="answer in question.answers" class="questionnaire__answer" data-ng-class="{ \'theme-button-color questionnaire__answer--selected\': questionAnswer.selected === answer._id, \'theme-answer-background-color theme-answer-border-color\': questionAnswer.selected !== answer._id, \'questionnaire__answer--notcorrect\': !!questionAnswer.selected && questionAnswer.selected !== answer._id }"><div class="answer__bar" style="width:{{ !!questionAnswer.stats[answer._id] ? (100 * questionAnswer.stats[answer._id]) : 0 | number:1 }}%" data-ng-class="{\'theme-answer-select-background-result-color\': questionAnswer.selected === answer._id, \'theme-answer-background-result-color\': questionAnswer.selected !== answer._id }"></div><label data-ng-class="{ \'theme-question-color\': questionAnswer.selected === answer._id, \'theme-answer-color\': questionAnswer.selected !== answer._id }">{{answer.text}} <span data-ng-if="!!questionAnswer.stats" class="theme-question-result-color-text ng-animate">{{ formatAnswers(questionAnswer.stats[answer._id]) | number:1 }} % <i class="fa" data-ng-if="!!question.settings.showCorrectAnswer && question.settings.showCorrectAnswer != false" data-ng-class="{\'fa-check\': !!question.settings.showCorrectAnswer && !!questionAnswer.status[ answer._id ].correct, \'fa-times\': !questionAnswer.status[ answer._id ].correct }"></i> <span></span></span></label></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-pictureChoice.html",'<h2 class="theme-question-color text-left" data-ng-bind-html="question.text | nl2br" data-ng-if="!!question.text"></h2><div class="header__wrapper" data-ng-if="!!currentQuestion.mainMedia() && !!mainMediaImg()"><picture class="main-media-image" data-ng-class="{\'no-transform\': !question.imageData, \'transform\': question.imageData}" data-ng-style="{\'padding-bottom\': mainMediaImg().paddingBottom + \'%\'}"><img data-ng-style="{ \'width\': mainMediaImg().width + \'%\', \'left\' : (question.imageData.left > 0 ? question.imageData.left : 0) + \'%\', \'top\' : (question.imageData.top > 0 ? question.imageData.top : 0) + \'%\' }" data-ng-src="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}" data-ng-srcset="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"></picture></div><div class="list"><div data-ng-repeat="answer in question.answers" class="questionnaire__answer questionnaire__answer--picture-choice" data-ng-class="{\'questionnaire__answer--selected\': questionAnswer.selected === answer._id, \'questionnaire__answer--notcorrect\': !!questionAnswer.selected && questionAnswer.selected !== answer._id }" data-ng-click="sendAnswer( answer._id )"><figure data-ng-class="{ \'theme-button-color questionnaire__answer--selected\': questionAnswer.selected === answer._id, \'theme-answer-background-color theme-answer-border-color\': questionAnswer.selected !== answer._id, \'questionnaire__answer--notcorrect\': !!questionAnswer.selected && questionAnswer.selected !== answer._id }"><div class="wrapper ir"><picture class="thumb-media-image"><img data-ng-src="{{ getImgUrl( currentQuestion.answerMedia( answer.imageFile ), 300, \'1.0\' ) }}" data-ng-srcset="{{ getImgUrl( currentQuestion.answerMedia( answer.imageFile ), 300, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.answerMedia( answer.imageFile ), 300, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.answerMedia( answer.imageFile ), 300, \'2.0\' ) }} 2.0x"></picture><div class="answer__bar" data-ng-class="{\'theme-answer-select-background-result-color\': questionAnswer.selected === answer._id, \'theme-answer-background-result-color\': questionAnswer.selected !== answer._id }" style="-moz-transform: translate(-50%, {{100 - formatAnswers(questionAnswer.stats[answer._id]) | number:1}}% ); -webkit-transform: translate(-50%, {{100 - formatAnswers(questionAnswer.stats[answer._id]) | number:1}}%); -o-transform: translate(-50%, {{100 - formatAnswers(questionAnswer.stats[answer._id]) | number:1}}%); -ms-transform: translate(-50%, {{100 - formatAnswers(questionAnswer.stats[answer._id]) | number:1}}%); transform: translate(-50%, {{100 - formatAnswers(questionAnswer.stats[answer._id]) | number:1}}%);"></div></div><figcaption data-ng-class="{ \'theme-question-color\': questionAnswer.selected === answer._id, \'theme-answer-color\': questionAnswer.selected !== answer._id }">{{ answer.text }}</figcaption><div class="results" data-ng-if="!!questionAnswer && !!questionAnswer.stats" data-ng-class="{ \'theme-question-color\': questionAnswer.selected === answer._id, \'theme-answer-color\': questionAnswer.selected !== answer._id }"><span class="results__precent">{{ !!questionAnswer.stats[answer._id] ? (100 * questionAnswer.stats[answer._id]) : 0 | number:1 }}<span class="precent">%</span></span> <span class="results__triangle" data-ng-if="!!question.settings.showCorrectAnswer && question.settings.showCorrectAnswer != false" data-ng-class="{\'is-correct\': !!question.settings.showCorrectAnswer && !!questionAnswer.status[ answer._id ].correct, \'is-incorrect\': !questionAnswer.status[ answer._id ].correct }"><i class="fa" data-ng-class="{\'fa-check\': !!question.settings.showCorrectAnswer && !!questionAnswer.status[ answer._id ].correct, \'fa-times\': !questionAnswer.status[ answer._id ].correct }"></i></span></div></figure></div></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-rateIt.html",'<h2 class="theme-question-color text-left" data-ng-bind-html="question.text | nl2br" data-ng-if="!!question.text"></h2><picture class="main-media-image" data-ng-if="!!currentQuestion.mainMedia() && !!mainMediaImg()" data-ng-class="{\'no-transform\': !question.imageData, \'transform\': question.imageData}" data-ng-style="{\'padding-bottom\': mainMediaImg().paddingBottom + \'%\'}"><img data-ng-style="{ \'width\': mainMediaImg().width + \'%\', \'left\' : (question.imageData.left > 0 ? question.imageData.left : 0) + \'%\', \'top\' : (question.imageData.top > 0 ? question.imageData.top : 0) + \'%\' }" data-ng-src="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}" data-ng-srcset="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"></picture><div class="list list__rating list__rating--{{question.rateIt.rateType || \'star\'}}" data-ng-init="AA = makeTimes(question.rateIt.maxRateItValue || 5)"><span data-ng-click="sendAnswer(AA.length - $index, $event)" class="theme-answer-color" data-ng-class="{\'item__selected\': questionAnswer.selected >= AA.length - $index}" data-ng-repeat="r in AA" data-ng-if="question.rateIt.rateType !== \'number\'"><i class="fa"></i> <span class="number">{{AA.length - $index}}</span></span> <span data-ng-click="sendAnswer(AA.length - $index, $event)" class="theme-answer-color" data-ng-class="{\'item__selected\': questionAnswer.selected == AA.length - $index}" data-ng-repeat="r in AA" data-ng-if="question.rateIt.rateType === \'number\'"><i class="fa"></i> <span class="number">{{AA.length - $index}}</span></span></div><div class="footer-rating"><div class="cell"><div class="rating__label theme-question-color text-left"><span>{{question.rateIt.minLabel}}</span></div></div><div class="cell"><div class="rating__results theme-question-color"><span data-ng-if="questionAnswer.average">Average: {{ questionAnswer.average | number:1 }}</span></div></div><div class="cell"><div class="rating__label theme-question-color text-right"><span>{{question.rateIt.maxLabel}}</span></div></div></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-startPage.html",'<h2 class="theme-question-color text-center" data-ng-bind-html="question.text | nl2br" data-ng-if="!!question.text"></h2><div class="main-content-description theme-question-color text-center" data-ng-if="!!question.description"><p>{{question.description}}</p></div><picture class="main-media-image" data-ng-if="!!currentQuestion.mainMedia() && !!mainMediaImg()" data-ng-class="{\'no-transform\': !question.imageData, \'transform\': question.imageData}" data-ng-style="{\'padding-bottom\': mainMediaImg().paddingBottom + \'%\'}"><img data-ng-style="{ \'width\': mainMediaImg().width + \'%\', \'left\' : (question.imageData.left > 0 ? question.imageData.left : 0) + \'%\', \'top\' : (question.imageData.top > 0 ? question.imageData.top : 0) + \'%\' }" data-ng-src="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}" data-ng-srcset="{{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getMainImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"></picture><div class="text-center main-footer"><button class="btn btn--round-corner btn--normal theme-button-color theme-question-color" data-ng-show="hasNext()" data-ng-click="next($event)">{{question.coverPage.buttonText || "Let\'s get started"}}</button></div>')}]),angular.module("4screens.engageform").controller("engageformDefaultCtrl",["CONFIG","EngageformBackendService","CloudinaryService","$scope","$routeParams","$timeout","$window","previewMode",function(e,t,n,a,i,s,r,o){function u(){a.screenType=r.innerHeight>r.innerWidth?"narrow":"wide"}function d(){a.$$phase||a.$apply(u)}function g(e,t,n){var a=Math.min(t/e.maxWidth,1),i=Math.min(n/e.maxHeight,1),s=Math.max(e.minFontSize,Math.min(a,i));angular.element(r.document.querySelector("html")).css("font-size",Math.floor(1e3*s)/10+"%")}function c(e,t){var n=[];for(var i in e)e.hasOwnProperty(i)&&n.push({_id:i,value:e[i]});n.length&&a.sendAnswer(n,t)}var m,l=i.engageFormId;t.quiz.get(l).then(function(e){a.quiz=e,a.staticThemeCssFile=t.quiz.getStaticThemeCssFile(),t.questions.get().then(function(e){a.wayAnimateClass="way-animation__next",a.questions=_.sortBy(e,"position"),a.sentAnswer(),a.normalQuestionsAmmount=a.questions.length-(_.where(a.questions,{type:"startPage"}).length||0)-(_.where(a.questions,{type:"endPage"}).length||0)})}),a.makeTimes=function(e){for(var t=[],n=0;e>n;n++)t.push(n);return t},a.scaleEmbedCfg={minFontSize:.7,maxWidth:680,maxHeight:880},angular.element(r).bind("resize",function(){d(),g(a.scaleEmbedCfg,r.innerWidth,r.innerHeight)}),u(),g(a.scaleEmbedCfg,r.innerWidth,r.innerHeight),a.getBgImgUrl=function(t,a,i,s){return n.getImgUrl(e.backend.domain.replace(":subdomain","")+"/uploads/"+t,a,i,s)},a.getImgUrl=function(e,t,a,i){return n.getImgUrl(e,t,a,i)},a.getMainImgUrl=function(t,i,s){var r=a.questions[a.currentQuestion.index()].imageData,o=parseInt(e.backend.mainImageContainerBaseWidth,10)||540;return r?n.getMainImgUrl(t,i*(r.width/100||1),i,Math.round(r.containerHeight*(i/o)),Math.round(i/o*Math.round(o*r.left*-1/100)||0),Math.round(i/o*Math.round(r.containerHeight*r.top*-1/100)||0)):n.getImgUrl(t,i,s)},a.mainMediaImg=function(){var t,n=a.questions[a.currentQuestion.index()].imageData,i=parseInt(e.backend.mainImageContainerBaseWidth,10)||540;return a.questions[a.currentQuestion.index()].imageData?(t=n.width<100?n.left+n.width>100?100-n.left:n.width+Math.min(n.left,0):100,{width:t,paddingBottom:Math.round(n.containerHeight/i*100)}):null},a.sentAnswer=function(){a.questionAnswer=t.question.sentAnswer()||{},a.questionAnswer.status=a.questionAnswer.status||{},_.forEach(a.currentQuestion.answers(),function(e){a.questionAnswer.status[e._id]={},e._id===a.questionAnswer.selected&&(a.questionAnswer.status[e._id].selected=!0),a.questionAnswer.correct&&(e._id===a.questionAnswer.correct?a.questionAnswer.status[e._id].correct=!0:e._id===a.questionAnswer.selected&&(a.questionAnswer.status[e._id].wrong=!0))})},a.sendAnswer=function(e,n){n&&(n.stopPropagation(),n.preventDefault()),t.question.sendAnswer(e).then(function(){a.questionAnswer&&!a.questionAnswer.form&&a.sentAnswer(),a.hasNext()&&!m&&(m=s(function(){a.next(),m=null},800))})},a.submitQuiz=function(){return t.quiz.submit(l).then(function(){a.next()}).catch(function(e){a.requiredMessage=e.data.msg||"Unexpected error"})},a.formatAnswers=function(e){return e?100*e:0},a.prev=function(){t.navigation.prev(),a.sentAnswer(),a.wayAnimateClass="way-animation__prev"},a.hasPrev=function(){return t.navigation.hasPrev()},a.next=function(e){a.currentQuestion.requiredAnswer()&&!o?a.questionAnswer.selected?(t.navigation.next(),a.sentAnswer(),a.wayAnimateClass="way-animation__next",a.requiredMessage=""):a.questionAnswer&&a.questionAnswer.form&&a.questionAnswer.form.$valid?(a.questionAnswer.selected=!0,c(a.questionAnswer.status,e)):a.requiredMessage="Answer is required to proceed to next question":(t.navigation.next(),a.sentAnswer(),a.wayAnimateClass="way-animation__next")},a.hasNext=function(){return t.navigation.hasNext()},a.currentQuestion={index:t.question.index,settings:t.question.settings,mainMedia:t.question.mainMedia,answers:t.question.answers,inputs:t.question.inputs,answerMedia:t.question.answerMedia,requiredAnswer:t.question.requiredAnswer}}]),angular.module("4screens.engageform").directive("engageformSwiperDirective",["$timeout",function(e){return{restrict:"C",link:function(t){var n,a={slideElement:"article",slidesPerView:1,pagination:".pagination-swiper",calculateHeight:!0,roundLengths:!0,resizeReInit:!0};e(function(){e(function(){e(function(){e(function(){n=new Swiper(".engageform-swiper-directive",a),t.swipeNext=n.swipeNext,t.swipePrev=n.swipePrev})})})})}}}]),angular.module("4screens.engageform").filter("nl2br",["$sce",function(e){return function(t){return e.trustAsHtml((t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2"))}}]),angular.module("4screens.engageform").filter("questionsFilter",function(){return function(e){var t=e;return angular.forEach(t,function(e,n){"startPage"===e.type&&0!==n&&t.unshift(t.splice(n,1)[0])}),t}}),angular.module("4screens.engageform").factory("EngageformBackendService",["CONFIG","CommonLocalStorageService","SettingsEngageformService","$q","$filter",function(e,t,n,a,i){function s(){return g.mainMedia=g.mainMedia||{},void 0!==g.mainMedia[u[d]._id]?g.mainMedia[u[d]._id]:(u[d].settings=u[d].settings||{},u[d].settings.showMainMedia?u[d].imageFile?(g.mainMedia[u[d]._id]={$key:u[d]._id,src:"http"!==u[d].imageFile.slice(0,4)?e.backend.domain.replace(":subdomain","")+e.backend.imagesUrl+"/"+u[d].imageFile:u[d].imageFile},g.mainMedia[u[d]._id]):(g.mainMedia[u[d]._id]=null,g.mainMedia[u[d]._id]):(g.mainMedia[u[d]._id]=null,g.mainMedia[u[d]._id]))}var r,o,u=[],d=0,g={},c="ui",m="qsa_",l=(new Date).getTime();return g[c]=t.get(c),{quiz:{get:function(e){return n.get(e).then(function(e){return r=e,e})},getStaticThemeCssFile:function(){return r.theme=r.theme||{},r.theme.customThemeCssFile?e.backend.domain.replace(":subdomain","")+"/uploads/"+r.theme.customThemeCssFile+"?"+l:null},submit:function(e){return n.submitQuiz(e,g[c])}},question:{index:function(){return d},settings:function(e){return u[d].settings=u[d].settings||{},!!u[d].settings[e]},mainMedia:function(){return s()},inputs:function(){return u[d].forms=u[d].forms||{},u[d].forms.inputs},answers:function(){return u[d].answers},requiredAnswer:function(){return u[d].requiredAnswer},answerMedia:function(t){return e.backend.domain.replace(":subdomain","")+e.backend.imagesUrl+"/"+t},sentAnswer:function(){var e,n=m+u[d]._id;return e=t.get(n),e?e:null},sendAnswer:function(e){var i,s={};return s.quizQuestionId=u[d]._id,!r.settings.allowAnswerChange&&t.get(m+s.quizQuestionId)?(i=a.defer(),i.resolve(),i.promise):("rateIt"===u[d].type&&(s.rateItValue=parseInt(e)),["pictureChoice","multiChoice"].indexOf(u[d].type)>-1&&(s.selectedAnswerId=e),"forms"===u[d].type&&(s.inputs=e),g[c]&&(s.userIdent=g[c]),n.sendAnswer(s).then(function(e){if(g[c]=e.userIdent,t.set(c,g[c]),"rateIt"===u[d].type)t.set(m+s.quizQuestionId,{selected:e.selectedValue,average:e.avgRateItValue});else if(["pictureChoice","multiChoice"].indexOf(u[d].type)>-1)t.set(m+s.quizQuestionId,{selected:e.selectedAnswerId,correct:e.correctAnswerId,stats:e.stats});else if("forms"===u[d].type){var n={};_.forEach(s.inputs,function(e){n[e._id]=e.value}),t.set(m+s.quizQuestionId,{status:n})}return e}))}},questions:{get:function(){return n.getQuestions(r._id).then(function(e){return u=i("questionsFilter")(_.sortBy(e,"position")),o=u.length-(_.where(u,{type:"startPage"}).length||0)-(_.where(u,{type:"endPage"}).length||0),e})}},navigation:{prev:function(){this.hasPrev()&&d--},hasPrev:function(){return d>0},next:function(){this.hasNext()&&d++},hasNext:function(){return o>d}}}}]),angular.module("4screens.engageform").factory("CloudinaryService",["CONFIG",function(e){var t=e.backend.cloudinaryUrl||"http://res.cloudinary.com/test4screens/image/fetch/";return{getImgUrl:function(e,n,a,i){var i="undefined"!=typeof i&&"0"!==i?",e_blur:"+100*parseInt(i,10)+"/":"/",a=",dpr_"+a;return t+"w_"+parseInt(n,10)+",c_limit"+a+i+e},getMainImgUrl:function(e,n,a,i,s,r){return t+"w_"+parseInt(n,10)+"/w_"+a+",h_"+i+",x_"+s+",y_"+r+",c_crop/"+e}}}]);
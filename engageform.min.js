/*
 4screens-engageform v0.1.1
 (c) 2014 Nopattern sp. z o.o.
 License: proprietary
*/
"use strict";angular.module("4screens.engageform",["4screens.common","4screens.settings","LocalStorageModule","youtube-embed","ngMessages"]).config(["localStorageServiceProvider",function(e){e.prefix="4screens.engageform"}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/main.html",'<link rel="stylesheet" type="text/css" data-ng-href="{{ customThemeCssFile || staticThemeCssFile }}" data-ng-if="!!customThemeCssFile || !!staticThemeCssFile"><div id="four-screens-application" class="{{screenType}}"><div class="theme-background-image-file-wrapper theme-background-brightness theme-background-color"><picture data-ng-if="quiz.theme.backgroundImageFile" class="position-{{quiz.theme.backgroundImagePosition}}"><source media="(min-width: 1021px)" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"><source media="(min-width: 769px)" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 1020, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1020, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1020, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"><source media="(min-width: 481px)" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 768, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 768, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 768, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"><source media="(min-width: 0px)" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 480, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 480, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 480, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"><img data-ng-src="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.0\', quiz.theme.backgroundImageBlur ) }}" data-ng-srcset="{{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.0\', quiz.theme.backgroundImageBlur ) }}, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'1.5\', quiz.theme.backgroundImageBlur ) }} 1.5x, {{ getBgImgUrl( quiz.theme.backgroundImageFile, 1920, \'2.0\', quiz.theme.backgroundImageBlur ) }} 2.0x"></picture></div><div class="four-screens__embed-container theme-main-font" data-ng-class="wayAnimateClass"><div ng-repeat="question in questions" class="questionnaire animate-if" data-ng-if="$index == currentQuestion.index()"><div class="four-screens__content wrapper" data-ng-class="{\'content__type--forms\': question.type == \'forms\', \'content__type--info-page\': question.type == \'infoPage\' , \'content__type--multi-choice\': question.type == \'multiChoice\', \'content__type--picture-choise\': question.type == \'pictureChoice\' , \'content__type--rate-it\': question.type == \'rateIt\' }" data-ng-include="\'views/engageform/question-\' + question.type + \'.html\'"></div></div><div class="four-screens__footer"><div class="progress" data-ng-if="currentQuestion.index() > -1"><span class="progress__bar"><span class="progress__bar--line theme-button-color" ng-class="{\'progress__bar--full-size\': (((currentQuestion.index() + 1) / questions.length )*100) == 100 }" style="width: {{( (currentQuestion.index() + 1) / questions.length )*100 | number:0 }}%"></span></span></div><div class="progress__numbering">({{ currentQuestion.index() + 1 }} of {{ questions.length }})</div><a title="4Screens" href="http://4screens.net/" class="four-screens__footer-logo" target="_blank">4Screens</a> <button class="progress__btn progress__btn--prev" data-ng-show="hasPrev()" data-ng-hide="!quiz.settings.allowQuestionNavigation" data-ng-click="prev()"><span><i class="fa fa-chevron-left"></i></span></button> <button class="progress__btn progress__btn--next theme-button-color theme-question-color" data-ng-show="hasNext()" data-ng-click="next()"><span>NEXT <i class="fa fa-chevron-right"></i></span></button></div></div></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-forms.html",'<h2 class="theme-question-color" data-ng-bind-html="question.text | nl2br" data-ng-if="!!question.text"></h2><picture data-ng-if="!!currentQuestion.mainMedia()" class="main-media-image"><source media="(min-width: 481px)" data-ng-srcset="{{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"><source media="(min-width: 0px)" data-ng-srcset="{{ getImgUrl( currentQuestion.mainMedia().src, 480, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.mainMedia().src, 480, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.mainMedia().src, 480, \'2.0\' ) }} 2.0x"><img data-ng-src="{{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}" data-ng-srcset="{{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"></picture><form action name="form" class="form"><fieldset><div class="form__field" data-ng-repeat="input in question.forms.inputs"><label for="{{input._id}}" data-ng-bind="input.label"></label> <input type="email" placeholder="{{input.label}}" name="{{input._id}}" data-ng-if="input.type==\'email\'" data-ng-model="currentQuestion.inputs()[input._id]" required> <input type="text" placeholder="{{input.label}}" name="{{input._id}}" data-ng-if="input.type==\'text\'" data-ng-model="currentQuestion.inputs()[input._id]"> <input type="text" placeholder="{{input.label}}" name="{{input._id}}" data-ng-if="input.type==\'phone\'" data-ng-model="currentQuestion.inputs()[input._id]"> <input type="url" placeholder="{{input.label}}" name="{{input._id}}" data-ng-if="input.type==\'url\'" data-ng-model="currentQuestion.inputs()[input._id]"> <textarea name="{{input._id}}" id cols="30" rows="10" data-ng-if="input.type==\'textarea\'" placeholder="{{input.label}}" ng-model="currentQuestion.inputs()[input._id]" required></textarea><div ng-messages="form[input._id].$error" ng-messages-multiple class="message theme-question-color text-right"><div ng-message="required">This field is required</div><div ng-message="email">Your field has an invalid email address</div><div ng-message="number">Only numbers</div><div ng-message="url">Your field has a invalid url address</div></div></div></fieldset><div class="hint"><i class="fa fa-info-circle"></i>&nbsp;<span>Type your answer above. Press next to continue.</span></div></form>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-infoPage.html",'<div class="swiper"><a class="swiper swiper-arrow swiper-arrow__left" data-ng-click="swipePrev()"></a> <a class="swiper swiper-arrow swiper-arrow__right" data-ng-click="swipeNext()"></a><div class="swiper-container engageform-swiper-directive"><div class="swiper-wrapper"><article class="swiper-slide" data-ng-repeat="page in question.infoPages"><a data-ng-href="{{ page.url }}" target="_blank" data-ng-class="{\'disabled\': !page.url}"><h2 class="theme-question-color" data-ng-bind-html="page.title | nl2br"></h2><figure><div class="wrapper ir-16-10" data-ng-if="!!page.imageFile || !!page.youTubeId"><picture data-ng-if="!!page.imageFile" class="main-media-image"><source media="(min-width: 481px)" data-ng-srcset="{{ getImgUrl( currentQuestion.answerMedia( page.imageFile ), 680, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.answerMedia( page.imageFile ), 680, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.answerMedia( page.imageFile ), 680, \'2.0\' ) }} 2.0x"><source media="(min-width: 0px)" data-ng-srcset="{{ getImgUrl( currentQuestion.answerMedia( page.imageFile ), 480, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.answerMedia( page.imageFile ), 480, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.answerMedia( page.imageFile ), 480, \'2.0\' ) }} 2.0x"><img data-ng-src="{{ getImgUrl( currentQuestion.answerMedia( page.imageFile ), 680, \'1.0\' ) }}" data-ng-srcset="{{ getImgUrl( currentQuestion.answerMedia( page.imageFile ), 680, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.answerMedia( page.imageFile ), 680, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.answerMedia( page.imageFile ), 680, \'2.0\' ) }} 2.0x"></picture><div data-ng-if="!!page.youTubeId" data-youtube-video data-video-id="page.youTubeId"></div></div></figure><p class="swiper-slide__description theme-answer-color theme-answer-background-color" data-ng-if="!!page.description" data-ng-bind-html="page.description | nl2br"></p></a></article></div></div><div class="pagination-swiper"></div></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-multiChoice.html",'<h2 class="theme-question-color" data-ng-bind-html="question.text | nl2br" data-ng-if="!!question.text"></h2><div class="header__wrapper ir-169" data-ng-if="!!currentQuestion.mainMedia()"><picture class="main-media-image"><source media="(min-width: 481px)" data-ng-srcset="{{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"><source media="(min-width: 0px)" data-ng-srcset="{{ getImgUrl( currentQuestion.mainMedia().src, 480, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.mainMedia().src, 480, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.mainMedia().src, 480, \'2.0\' ) }} 2.0x"><img data-ng-src="{{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}" data-ng-srcset="{{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"></picture></div><div data-ng-click="sendAnswer( answer._id )" data-ng-repeat="answer in question.answers" class="questionnaire__answer" data-ng-class="{ \'theme-button-color questionnaire__answer--selected\': questionAnswer.selected === answer._id, \'theme-answer-background-color theme-answer-border-color\': questionAnswer.selected !== answer._id, \'questionnaire__answer--notcorrect\': !!questionAnswer.selected && questionAnswer.selected !== answer._id }"><div class="answer__bar" style="width:{{ !!questionAnswer.stats[answer._id] ? (100 * questionAnswer.stats[answer._id]) : 0 | number:1 }}%" data-ng-class="{\'theme-answer-select-background-result-color\': questionAnswer.selected === answer._id, \'theme-answer-background-result-color\': questionAnswer.selected !== answer._id }"></div><label data-ng-class="{ \'theme-question-color\': questionAnswer.selected === answer._id, \'theme-answer-color\': questionAnswer.selected !== answer._id }">{{answer.text}} <span data-ng-if="!!questionAnswer.stats" class="theme-question-result-color-text ng-animate">{{ formatAnswers(questionAnswer.stats[answer._id]) | number:1 }} % <i class="fa" data-ng-if="!!question.settings.showCorrectAnswer && question.settings.showCorrectAnswer != false" data-ng-class="{\'fa-check\': !!question.settings.showCorrectAnswer && !!questionAnswer.status[ answer._id ].correct, \'fa-times\': !questionAnswer.status[ answer._id ].correct }"></i> <span></span></span></label></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-pictureChoice.html",'<h2 class="theme-question-color" data-ng-bind-html="question.text | nl2br" data-ng-if="!!question.text"></h2><div class="header__wrapper ir-169" data-ng-if="!!currentQuestion.mainMedia()"><picture class="main-media-image"><source media="(min-width: 481px)" data-ng-srcset="{{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"><source media="(min-width: 0px)" data-ng-srcset="{{ getImgUrl( currentQuestion.mainMedia().src, 480, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.mainMedia().src, 480, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.mainMedia().src, 480, \'2.0\' ) }} 2.0x"><img data-ng-src="{{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}" data-ng-srcset="{{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"></picture></div><div class="list"><div ng-repeat="answer in question.answers" class="questionnaire__answer questionnaire__answer--picture-choise" data-ng-class="{\'questionnaire__answer--selected\': questionAnswer.selected === answer._id, \'questionnaire__answer--notcorrect\': !!questionAnswer.selected && questionAnswer.selected !== answer._id }" data-ng-click="sendAnswer( answer._id )"><figure data-ng-class="{ \'theme-button-color questionnaire__answer--selected\': questionAnswer.selected === answer._id, \'theme-answer-background-color theme-answer-border-color\': questionAnswer.selected !== answer._id, \'questionnaire__answer--notcorrect\': !!questionAnswer.selected && questionAnswer.selected !== answer._id }"><div class="wrapper ir"><picture class="thumb-media-image"><img data-ng-src="{{ getImgUrl( currentQuestion.answerMedia( answer.imageFile ), 300, \'1.0\' ) }}" data-ng-srcset="{{ getImgUrl( currentQuestion.answerMedia( answer.imageFile ), 300, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.answerMedia( answer.imageFile ), 300, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.answerMedia( answer.imageFile ), 300, \'2.0\' ) }} 2.0x"></picture><div class="answer__bar" data-ng-class="{\'theme-answer-select-background-result-color\': questionAnswer.selected === answer._id, \'theme-answer-background-result-color\': questionAnswer.selected !== answer._id }" style="-moz-transform: translate(50%, {{100 - formatAnswers(questionAnswer.stats[answer._id]) | number:1}}% ); -webkit-transform: translate(50%, {{100 - formatAnswers(questionAnswer.stats[answer._id]) | number:1}}%); -o-transform: translate(50%, {{100 - formatAnswers(questionAnswer.stats[answer._id]) | number:1}}%); -ms-transform: translate(50%, {{100 - formatAnswers(questionAnswer.stats[answer._id]) | number:1}}%); transform: translate(50%, {{100 - formatAnswers(questionAnswer.stats[answer._id]) | number:1}}%);"></div></div><figcaption data-ng-class="{ \'theme-question-color\': questionAnswer.selected === answer._id, \'theme-answer-color\': questionAnswer.selected !== answer._id }">{{ answer.text }}</figcaption><div class="results" ng-if="!!questionAnswer && !!questionAnswer.stats" data-ng-class="{ \'theme-question-color\': questionAnswer.selected === answer._id, \'theme-answer-color\': questionAnswer.selected !== answer._id }"><span>{{ !!questionAnswer.stats[answer._id] ? (100 * questionAnswer.stats[answer._id]) : 0 | number:1 }}<span class="precent">%</span></span> <i class="fa" data-ng-if="!!question.settings.showCorrectAnswer && question.settings.showCorrectAnswer != false" data-ng-class="{\'fa-check\': !!question.settings.showCorrectAnswer && !!questionAnswer.status[ answer._id ].correct, \'fa-times\': !questionAnswer.status[ answer._id ].correct }"></i></div></figure></div></div>')}]),angular.module("4screens.engageform").run(["$templateCache",function(e){e.put("views/engageform/question-rateIt.html",'<h2 class="theme-question-color" data-ng-bind-html="question.text | nl2br" data-ng-if="!!question.text"></h2><picture data-ng-if="!!currentQuestion.mainMedia()" class="main-media-image"><source media="(min-width: 481px)" data-ng-srcset="{{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"><source media="(min-width: 0px)" data-ng-srcset="{{ getImgUrl( currentQuestion.mainMedia().src, 480, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.mainMedia().src, 480, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.mainMedia().src, 480, \'2.0\' ) }} 2.0x"><img data-ng-src="{{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}" data-ng-srcset="{{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.0\' ) }}, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'1.5\' ) }} 1.5x, {{ getImgUrl( currentQuestion.mainMedia().src, 680, \'2.0\' ) }} 2.0x"></picture><div class="list list__rating"><span ng-click="sendAnswer(5, $event)" class="theme-answer-color" ng-class="{\'item__selected\': questionAnswer.selected >= 5}"><i class="fa"></i></span> <span ng-click="sendAnswer(4, $event)" class="theme-answer-color" ng-class="{\'item__selected\': questionAnswer.selected >= 4}"><i class="fa"></i></span> <span ng-click="sendAnswer(3, $event)" class="theme-answer-color" ng-class="{\'item__selected\': questionAnswer.selected >= 3}"><i class="fa"></i></span> <span ng-click="sendAnswer(2, $event)" class="theme-answer-color" ng-class="{\'item__selected\': questionAnswer.selected >= 2}"><i class="fa"></i></span> <span ng-click="sendAnswer(1, $event)" class="theme-answer-color" ng-class="{\'item__selected\': questionAnswer.selected >= 1}"><i class="fa"></i></span></div><div class="rating__results theme-question-color"><span data-ng-if="questionAnswer.average">Średnia: {{ questionAnswer.average | number:1 }}</span></div>')}]),angular.module("4screens.engageform").controller("engageformDefaultCtrl",["CONFIG","EngageformBackendService","CloudinaryService","$scope","$routeParams","$timeout","$window",function(e,n,t,s,i,r,a){function u(){s.$$phase||s.$apply(function(){s.screenType=a.innerHeight>a.innerWidth?"narrow":"wide"})}function o(e){var n=[];for(var t in e)e.hasOwnProperty(t)&&n.push({_id:t,value:e[t]});n.length&&s.sendAnswer(n)}n.quiz.get(i.engageFormId).then(function(e){s.quiz=e,s.staticThemeCssFile=n.quiz.getStaticThemeCssFile(),n.questions.get().then(function(e){s.questions=_.sortBy(e,"position"),s.sentAnswer()})}),s.screenType=a.innerHeight>a.innerWidth?"narrow":"wide",angular.element(a).bind("resize",function(){u()}),s.getBgImgUrl=function(n,s,i,r){return t.getImgUrl(e.backend.domain.replace(":subdomain","")+"/uploads/"+n,s,i,r)},s.getImgUrl=function(e,n,s,i){return t.getImgUrl(e,n,s,i)},s.sentAnswer=function(){s.questionAnswer=n.question.sentAnswer()||{},s.questionAnswer.status={},_.forEach(s.currentQuestion.answers(),function(e){s.questionAnswer.status[e._id]={},e._id===s.questionAnswer.selected&&(s.questionAnswer.status[e._id].selected=!0),s.questionAnswer.correct&&(e._id===s.questionAnswer.correct?s.questionAnswer.status[e._id].correct=!0:e._id===s.questionAnswer.selected&&(s.questionAnswer.status[e._id].wrong=!0))})},s.sendAnswer=function(e,t){t&&(t.stopPropagation(),t.preventDefault()),n.question.sendAnswer(e).then(function(){s.hasNext()&&r(function(){s.next()},s.questionAnswer.selected?0:2e3),s.sentAnswer()})},s.formatAnswers=function(e){return e?100*e:0},s.prev=function(){s.staticThemeCssFile=n.quiz.getStaticThemeCssFile(),n.navigation.prev(),s.sentAnswer(),s.wayAnimateClass="way-animation__prev"},s.hasPrev=function(){return n.navigation.hasPrev()},s.next=function(){o(s.currentQuestion.inputs()),s.staticThemeCssFile=n.quiz.getStaticThemeCssFile(),n.navigation.next(),s.sentAnswer(),s.wayAnimateClass="way-animation__next"},s.hasNext=function(){return n.navigation.hasNext()},s.currentQuestion={index:n.question.index,settings:n.question.settings,mainMedia:n.question.mainMedia,answers:n.question.answers,inputs:n.question.inputs,answerMedia:n.question.answerMedia}}]),angular.module("4screens.engageform").directive("engageformSwiperDirective",["$timeout",function(e){return{restrict:"C",link:function(n){var t,s={slideElement:"article",slidesPerView:1,pagination:".pagination-swiper",calculateHeight:!0,roundLengths:!0,resizeReInit:!0};e(function(){e(function(){e(function(){e(function(){t=new Swiper(".engageform-swiper-directive",s),n.swipeNext=t.swipeNext,n.swipePrev=t.swipePrev})})})})}}}]),angular.module("4screens.engageform").filter("nl2br",["$sce",function(e){return function(n){return e.trustAsHtml((n+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2"))}}]),angular.module("4screens.engageform").factory("EngageformBackendService",["CONFIG","CommonLocalStorageService","SettingsEngageformService","$q",function(e,n,t,s){function i(){return o.mainMedia=o.mainMedia||{},void 0!==o.mainMedia[a[u]._id]?o.mainMedia[a[u]._id]:(a[u].settings=a[u].settings||{},a[u].settings.showMainMedia?a[u].imageFile?(o.mainMedia[a[u]._id]={$key:a[u]._id,src:e.backend.domain.replace(":subdomain","")+e.backend.imagesUrl+"/"+a[u].imageFile},o.mainMedia[a[u]._id]):(o.mainMedia[a[u]._id]=null,o.mainMedia[a[u]._id]):(o.mainMedia[a[u]._id]=null,o.mainMedia[a[u]._id]))}var r,a,u=0,o={},c="ui",g="qsa_",d=(new Date).getTime();return o[c]=n.get(c),{quiz:{get:function(e){return t.get(e).then(function(e){return r=e,e})},getStaticThemeCssFile:function(){return r.theme=r.theme||{},r.theme.customThemeCssFile?e.backend.domain.replace(":subdomain","")+"/uploads/"+r.theme.customThemeCssFile+"?"+d:null}},question:{index:function(){return u},settings:function(e){return a[u].settings=a[u].settings||{},!!a[u].settings[e]},mainMedia:function(){return i()},inputs:function(){return a[u].inputs=a[u].inputs||{},a[u].inputs},answers:function(){return a[u].answers},answerMedia:function(n){return e.backend.domain.replace(":subdomain","")+e.backend.imagesUrl+"/"+n},sentAnswer:function(){var e,t=g+a[u]._id;return e=n.get(t),e?e:null},sendAnswer:function(e){var i,r={};return r.quizQuestionId=a[u]._id,n.get(g+r.quizQuestionId)?(i=s.defer(),i.resolve(),i.promise):("rateIt"===a[u].type&&(r.rateItValue=parseInt(e)),["pictureChoice","multiChoice"].indexOf(a[u].type)>-1&&(r.selectedAnswerId=e),"forms"===a[u].type&&(r.inputs=e),o[c]&&(r.userIdent=o[c]),t.sendAnswer(r).then(function(e){return o[c]=e.userIdent,n.set(c,o[c]),"rateIt"===a[u].type?n.set(g+r.quizQuestionId,{selected:e.selectedValue,average:e.avgRateItValue}):["pictureChoice","multiChoice"].indexOf(a[u].type)>-1?n.set(g+r.quizQuestionId,{selected:e.selectedAnswerId,correct:e.correctAnswerId,stats:e.stats}):"forms"===a[u].type&&n.set(g+r.quizQuestionId,{inputs:r.inputs}),e}))}},questions:{get:function(){return t.getQuestions(r._id).then(function(e){return a=_.sortBy(e,"position"),e})}},navigation:{prev:function(){u-1>=0&&u--},hasPrev:function(){return!0},next:function(){u+1<=a.length-1&&u++},hasNext:function(){return!0}}}}]),angular.module("4screens.engageform").factory("CloudinaryService",["CONFIG",function(e){var n=e.backend.cloudinaryUrl||"http://res.cloudinary.com/test4screens/image/fetch/";return{getImgUrl:function(e,t,s,i){var i="undefined"!=typeof i&&"0"!==i?",e_blur:"+100*parseInt(i,10)+"/":"/",s=",dpr_"+s;return n+"w_"+parseInt(t,10)+",c_limit"+s+i+e}}}]);
!function(e){/*!
 * 4screens-angular-engageform v0.2.10
 * (c) 2015 Nopattern sp. z o.o.
 * License: proprietary
 */
var t;!function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Live=1]="Live",e[e.Outcome=2]="Outcome",e[e.Poll=3]="Poll",e[e.Score=4]="Score",e[e.Survey=5]="Survey"}(e.Type||(e.Type={}));e.Type;!function(e){e[e.Undefined=0]="Undefined",e[e.Default=1]="Default",e[e.Preview=2]="Preview",e[e.Result=3]="Result",e[e.Summary=4]="Summary"}(e.Mode||(e.Mode={}));e.Mode}(t||(t={}));var n;!function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Image=1]="Image",e[e.Input=2]="Input",e[e.Iteration=3]="Iteration",e[e.Text=4]="Text",e[e.Buzz=5]="Buzz"}(e.CaseType||(e.CaseType={}));e.CaseType;!function(e){e[e.Undefined=0]="Undefined",e[e.EndPage=1]="EndPage",e[e.Form=2]="Form",e[e.MultiChoice=3]="MultiChoice",e[e.PictureChoice=4]="PictureChoice",e[e.Rateit=5]="Rateit",e[e.StartPage=6]="StartPage",e[e.Buzzer=7]="Buzzer",e[e.Poster=8]="Poster"}(e.Type||(e.Type={}));e.Type}(n||(n={}));var t,r=e.module("4screens.engageform",["LocalStorageModule"]);!function(e){var t=function(){function t(t){this._pages={},this._startPages=[],this._endPages=[],this._availablePages=[],this._hasForms=!1,this.enabled=!0,this.type=e.Type.Undefined,this._engageformId=t._id,this.title=t.title,this.settings=new e.Settings(t),this.theme=new e.Theme(t),this.branding=new u.Branding(t.settings.branding)}return Object.defineProperty(t.prototype,"pages",{get:function(){return this._pages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startPages",{get:function(){return this._startPages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endPages",{get:function(){return this._endPages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availablePages",{get:function(){return this._availablePages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"typeName",{get:function(){return e.Type[this.type].toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasForms",{get:function(){return this._hasForms},enumerable:!0,configurable:!0}),t.prototype.isType=function(e){return this.type===e},t.prototype.initPages=function(){var e=this;return this.getPagesById(this._engageformId).then(function(t){return e.buildPages(t),e})},t.prototype.initPage=function(e){},t.prototype.setCurrent=function(e){this.current=this._pages[e]},t.prototype.setCurrentEndPage=function(){var t=a.config.backend.domain+a.config.engageform.engageformFinishUrl;return t=t.replace(":engageformId",this._engageformId),a.mode!==e.Mode.Default&&(t+="?preview"),a.$http.post(t,{userIdent:a.user.sessionId,globalUserIdent:a.user.id}).then(function(e){return-1!==[200,304].indexOf(e.status)?(a.localStorage.clearAll(),a.user.id=e.data.globalUserIdent,e.data):this.$q.reject(e)})},t.getById=function(t){var n=a.config.backend.domain+a.config.engageform.engageformUrl;return n=n.replace(":engageformId",t),a.mode!==e.Mode.Default&&(n+="?preview"),a.$http.get(n).then(function(e){return-1!==[200,304].indexOf(e.status)?e.data:a.$q.reject(e)})},t.prototype.cleanPages=function(){this._availablePages.length=0,this._pages={}},t.prototype.buildPages=function(e){var t=this;e.map(function(e){switch(e.type){case"multiChoice":t._availablePages.push(e._id),t._pages[e._id]=new n.MultiChoice(t,e);break;case"pictureChoice":t._availablePages.push(e._id),t._pages[e._id]=new n.PictureChoice(t,e);break;case"rateIt":t._availablePages.push(e._id),t._pages[e._id]=new n.Rateit(t,e);break;case"forms":t._hasForms=!0,t._availablePages.push(e._id),t._pages[e._id]=new n.Form(t,e);break;case"startPage":t._startPages.push(e._id),t._pages[e._id]=new n.StartPage(t,e);break;case"endPage":t._endPages.push(e._id),t._pages[e._id]=new n.EndPage(t,e,t.settings);break;case"buzzer":t._availablePages.push(e._id),t._pages[e._id]=new n.Buzzer(t,e);break;case"poster":t._availablePages.push(e._id),t._pages[e._id]=new n.Poster(t,e)}})},t.prototype.getPagesById=function(t){var n=a.config.backend.domain+a.config.engageform.engageformPagesUrl;return n=n.replace(":engageformId",t),a.mode!==e.Mode.Default&&(n+="?preview"),a.$http.get(n).then(function(e){return-1!==[200,304].indexOf(e.status)?e.data:void this.$q.reject(e)})},t}();e.Engageform=t}(t||(t={}));var i;!function(e){var n=function(){function e(e){this.enabled=!1,this.position=0,this.size=0,this.hasStart=!1,this.enabledStart=!0,this.hasPrev=!1,this.enabledPrev=!0,this.hasNext=!1,this.enabledNext=!0,this.hasFinish=!1,this.enabledFinish=!0,this.distance=0,this.animate="swipeNext",this.hasStartPages=!1,this.hasEndPages=!1,this.next=this.pick,this.finish=this.pick,this._engageform=e,this.size=e.availablePages.length,this.hasEndPages=Boolean(this._engageform.endPages.length),this._engageform.startPages.length?(this.hasStart=!0,this.hasStartPages=!0,this._engageform.setCurrent(this._engageform.startPages[0])):(this.enabled=!0,this.move(null),this.hasPrev=!1)}return e.prototype.updateDistance=function(){return this.distance=this.position/this.size},e.prototype.start=function(e){this.disableDefaultAction(e),this.enabled=!0,this.hasStart=!1,this.move(null),this.hasPrev=!0},e.prototype.prev=function(e){this.disableDefaultAction(e),this.animate="swipePrev",this._engageform.current&&(this._engageform.message=""),this.position--,this.updateDistance(),this.hasNext=!0,this.hasFinish=!1,0===this.position?(this._engageform.setCurrent(this._engageform.startPages[0]),this.hasPrev=!1):(this._engageform.setCurrent(this._engageform.availablePages[this.position-1]),this.hasPrev=1===this.position?this.hasStartPages:!0)},e.prototype.pick=function(e,n,r){var i=this;switch(this.disableDefaultAction(e),this.animate="swipeNext",a.mode){default:this._engageform.current.send(n).then(function(){if(i._engageform.message="",i._engageform.current)switch(a.mode){case t.Mode.Default:case t.Mode.Preview:if(!i._engageform.current.filled&&i._engageform.current.settings.requiredAnswer)return i._engageform.message="Answer is required to proceed to next question",void(r&&r.hasOwnProperty("quiet")&&r.quiet&&(i._engageform.message=""))}n?a.$timeout(function(){i.move(n)},i._engageform.current.settings.showResults?500:200):i.move(n)})["catch"](function(e){i._engageform.message=e,r&&r.hasOwnProperty("quiet")&&r.quiet&&(i._engageform.message="")})}},e.prototype.move=function(e){var n=this;this.position++,this._engageform.availablePages.length>=this.position?(this.updateDistance(),this._engageform.setCurrent(this._engageform.availablePages[this.position-1]),this.hasPrev=!0,this.hasNext=!1,this.hasFinish=!1,this._engageform.availablePages.length>this.position?this.hasNext=!0:this._engageform.availablePages.length===this.position&&(this.hasFinish=!(this._engageform.isType(t.Type.Poll)&&!this._engageform.hasForms))):(this.position=this._engageform.availablePages.length,e||this._engageform.setCurrentEndPage().then(function(){n.enabled=!1,n.hasPrev=!1,n.hasNext=!1,n.hasFinish=!1})["catch"](function(e){e.data.msg&&(n._engageform.message=e.data.msg)}))},e.prototype.disableDefaultAction=function(e){e&&(e.stopPropagation(),e.preventDefault())},e}();e.Navigation=n}(i||(i={}));var n;!function(e){var t=function(){function t(t,n){this.title="",this.description="",this.media="",this.cases=[],this._pageId=n._id,this._engageform=t,this.settings=new e.Settings(n),this.title=n.text||"",this.settings.showDescription&&(this.description=n.description||""),this.settings.showMainMedia&&(this.media=s.Cloudinary.getInstance().prepareImageUrl(n.imageFile,680,n.imageData))}return Object.defineProperty(t.prototype,"id",{get:function(){return this._pageId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"engageform",{get:function(){return this._engageform},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Type",{get:function(){return e.Type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CaseType",{get:function(){return e.CaseType},enumerable:!0,configurable:!0}),t.prototype.send=function(e){if(this._engageform.enabled===!1)return a.$q.reject("Engageform already ended.");if(e)return e.send();var t=a.$q.defer();return t.resolve(),t.promise},t.prototype.sent=function(){var e=this,t=a.$q.defer(),n={};switch(a.mode){default:n=a.localStorage.get("page."+this.id)||{}}return this.settings.showResults&&n.results?this.getStatsById(this.id).then(function(r){t.resolve(e.refreshAnswer(n,r))})["catch"](function(){t.resolve(n)}):t.resolve(n),t.promise},t.prototype.refreshAnswer=function(e,t){return e},t.prototype.selectAnswer=function(e){},t.prototype.updateAnswers=function(e){var t=this;this.id===e.questionId&&a.$timeout(function(){t.cases.map(function(t){if(e[t.id]){var n=t.load();n.results[t.id]=e[t.id],t.save(n),t.result=e[t.id]||0}})})},t.prototype.getStatsById=function(e){var t=a.config.backend.domain+a.config.engageform.pageStatsUrl;return t=t.replace(":pageId",e),a.$http.get(t).then(function(e){return-1!==[200,304].indexOf(e.status)?e.data:a.$q.reject(e)})},t}();e.Page=t}(n||(n={}));var s,o=function(){function e(){}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id||(this._id=a.localStorage.get("userIdent")),this._id},set:function(e){a.localStorage.set("userIdent",e),this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this._sessionId||(this._sessionId=a.localStorage.get("sessionIdent")),this._sessionId},set:function(e){a.localStorage.set("sessionIdent",e),this._sessionId=e},enumerable:!0,configurable:!0}),e}();!function(e){var t=function(){function e(){a.config.cloudinary&&(this._accountName=a.config.cloudinary.accountName||"test4screens",this._uploadFolder=a.config.cloudinary.uploadFolder||"console",this._domain=a.config.cloudinary.domain||"https://res.cloudinary.com"),e._instance=this}return e.getInstance=function(){return e._instance},e.prototype.prepareImageUrl=function(e,t,n){if(!e)return"";var r=this._domain+"/"+this._accountName+"/image",i=540;r+=-1!==e.indexOf("http")?"/fetch":"/upload",n.containerHeight===t&&(i=300);var s,o=Math.round(t*n.width/100),a=Math.round(t*n.containerHeight/i),u=Math.round(t*n.left/100),c=Math.round(a*n.top/100);return s=[],s.push("w_"+o),s.push("f_auto"),s.push("q_82"),s.push("dpr_1.0"),r+="/"+s.join(","),s=[],s.push("w_"+t),s.push("h_"+a),s.push("x_"+-1*u),s.push("y_"+-1*c),s.push("c_crop"),r+="/"+s.join(","),s=[],s.push("w_"+(t+u)),s.push("h_"+(a+c)),s.push("c_mpad"),r+="/"+s.join(","),s=[],s.push("w_"+t),s.push("h_"+a),s.push("x_0"),s.push("y_0"),s.push("c_crop"),r+="/"+s.join(","),-1===e.indexOf("http")&&(r+="/"+this._uploadFolder),r+"/"+e},e}();e.Cloudinary=t}(s||(s={}));var s;!function(e){var t=function(){function e(){this.listeners={}}return e.prototype.listen=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.trigger=function(e,t){if(void 0===t&&(t={}),this.listeners[e])for(var n=0;n<this.listeners[e].length;n+=1)this.listeners[e][n](t)},e}();e.Events=t}(s||(s={}));var a=function(){function e(t,n,r,i,a){e.$http=t,e.$q=n,e.$timeout=r,e.localStorage=i,e.config=a,e.user=new o,this._cloudinary=new s.Cloudinary,this._events=new s.Events}return Object.defineProperty(e.prototype,"type",{get:function(){return this._engageform?this._engageform.type:t.Type.Undefined},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Type",{get:function(){return t.Type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return e.mode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Mode",{get:function(){return t.Mode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"title",{get:function(){return this._engageform?this._engageform.title:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"theme",{get:function(){return this._engageform?this._engageform.theme:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._engageform?this._engageform.current:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"navigation",{get:function(){return this._engageform?this._engageform.navigation:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"branding",{get:function(){return this._engageform?this._engageform.branding:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._engageform?this._engageform.message:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){return this._events?this._events:void 0},enumerable:!0,configurable:!0}),e.prototype.init=function(n){var r=this;if(!n||!n.id)return e.$q.reject({status:"error",error:{code:406,message:"The required id property does not exist."},data:n});switch(n.mode){case"preview":e.mode=t.Mode.Preview;break;case"summary":e.mode=t.Mode.Summary;break;case"result":e.mode=t.Mode.Result;break;case"default":case"":case void 0:e.mode=t.Mode.Default;break;default:return e.$q.reject({status:"error",error:{code:406,message:"Mode property not supported."},data:n})}return t.Engageform.getById(n.id).then(function(n){switch(n.type){case"outcome":r._engageform=new t.Outcome(n);break;case"poll":r._engageform=new t.Poll(n);break;case"score":r._engageform=new t.Score(n);break;case"survey":r._engageform=new t.Survey(n);break;case"live":r._engageform=new t.Live(n);break;default:return e.$q.reject({status:"error",error:{code:406,message:"Type property not supported."},data:n})}return r._engageform.initPages()}).then(function(e){return e.navigation=new i.Navigation(e),e})},e.mode=t.Mode.Undefined,e}();a.$inject=["$http","$q","$timeout","localStorageService","ApiConfig"],r.service("Engageform",a);var u;!function(e){var t=function(){function e(e){void 0===e&&(e={}),this._isCustomLogo=!1,this._isCustom=!1,this._defaultBranding=a.config.backend.branding,(e.text||e.link||e.imageUrl)&&(this._isCustom=!0),e.imageUrl&&(this._isCustomLogo=!0),this._text=e.text||this._defaultBranding.text,this._link=e.link||this._defaultBranding.link;var t=e.imageUrl||this._defaultBranding.imageUrl;this._imageUrl=t===this._defaultBranding.imageUrl?a.config.backend.api+t:a.config.backend.api+a.config.backend.imagesUrl+"/"+t}return Object.defineProperty(e.prototype,"isCustom",{get:function(){return this._isCustom},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCustomLogo",{get:function(){return this._isCustomLogo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDefault",{get:function(){return!this._isCustom},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageUrl",{get:function(){return this._imageUrl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"link",{get:function(){return this._link},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),e}();e.Branding=t}(u||(u={}));var t;!function(e){var t=function(){function e(e){this.allowAnswerChange=!1,e.settings&&(this.allowAnswerChange=!!e.settings.allowAnswerChange,e.settings.share&&(this.share=e.settings.share))}return e}();e.Settings=t}(t||(t={}));var t;!function(e){var t=function(){function e(e){this.answerBackgroundColor="",this.answerBorderColor="",this.answerColor="",this.backgroundBrightness="",this.backgroundColor="",this.backgroundImageBlur="",this.backgroundImageFile="",this.backgroundImagePosition="",this.buttonColor="",this.font="",this.questionColor="",this.customThemeCssFile="",e.theme&&(this.answerBackgroundColor=e.theme.answerBackgroundColor||"",this.answerBorderColor=e.theme.answerBorderColor||"",this.answerColor=e.theme.answerColor||"",this.backgroundBrightness=e.theme.backgroundBrightness||"",this.backgroundColor=e.theme.backgroundColor||"",this.backgroundImageBlur=e.theme.backgroundImageBlur||"",this.backgroundImageFile=e.theme.backgroundImageFile||"",this.backgroundImagePosition=e.theme.backgroundImagePosition||"",this.buttonColor=e.theme.buttonColor||"",this.font=e.theme.font||"",this.questionColor=e.theme.questionColor||"",e.theme.customThemeCssFile&&(this.customThemeCssFile=a.config.backend.api+"/uploads/"+e.theme.customThemeCssFile))}return e}();e.Theme=t}(t||(t={}));var t,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(){t.apply(this,arguments),this.type=e.Type.Outcome}return c(n,t),n.prototype.setCurrentEndPage=function(){var e=this;return t.prototype.setCurrentEndPage.call(this).then(function(t){var n=!1;return e.endPages.map(function(r){var i=e.pages[r];i.outcome===t.outcome&&(n=!0,e.setCurrent(r))}),n||(e.enabled=!1,e.message="Thank you!"),t})},n}(e.Engageform);e.Outcome=t}(t||(t={}));var t,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(){t.apply(this,arguments),this.type=e.Type.Poll}return c(n,t),n.prototype.setCurrentEndPage=function(){var e=this;return t.prototype.setCurrentEndPage.call(this).then(function(t){return e.endPages.length?e.setCurrent(e.endPages[0]):(e.enabled=!1,e.message="Thank you!"),t})},n}(e.Engageform);e.Poll=t}(t||(t={}));var t,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(){t.apply(this,arguments),this.type=e.Type.Score}return c(n,t),n.prototype.setCurrentEndPage=function(){var e=this;return t.prototype.setCurrentEndPage.call(this).then(function(t){var n=100,r=!1;return t.maxScore>0&&(n=Math.round(t.totalScore/t.maxScore*100)),e.endPages.map(function(t){var i=e.pages[t];i.rangeMin<=n&&i.rangeMax>=n&&(r=!0,e.pages[t].score=n,e.setCurrent(t))}),r||(e.enabled=!1,e.message="Thank you!"),t})},n}(e.Engageform);e.Score=t}(t||(t={}));var t,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(){t.apply(this,arguments),this.type=e.Type.Survey}return c(n,t),n.prototype.setCurrentEndPage=function(){var e=this;return t.prototype.setCurrentEndPage.call(this).then(function(t){return e.endPages.length?e.setCurrent(e.endPages[0]):(e.enabled=!1,e.message="Thank you!"),t})},n}(e.Engageform);e.Survey=t}(t||(t={}));var t,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(){t.apply(this,arguments),this.type=e.Type.Live}return c(n,t),n.prototype.initPages=function(){var e=a.$q.defer();return e.resolve(this),e.promise},n.prototype.initPage=function(e){this.cleanPages(),this.buildPages([e]),this.setCurrent(e._id)},n.prototype.setCurrentEndPage=function(){var e=a.$q.defer();return e.resolve(),e.promise},n}(e.Engageform);e.Live=t}(t||(t={}));var n;!function(e){var n=function(){function n(t,n){this.type=e.CaseType.Undefined,this._caseId=n._id,this._page=t}return Object.defineProperty(n.prototype,"id",{get:function(){return this._caseId},set:function(e){this._caseId=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"page",{get:function(){return this._page},enumerable:!0,configurable:!0}),n.prototype.send=function(){var e=a.$q.defer();return e.resolve({}),e.promise},n.prototype.makeSend=function(e){var n=a.config.backend.domain+a.config.engageform.pageResponseUrl;return n=n.replace(":pageId",this.page.id),a.mode!==t.Mode.Default&&(n+="?preview"),e.quizQuestionId=this.page.id,e.userIdent=a.user.sessionId,a.$http.post(n,e).then(function(t){return-1!==[200,304].indexOf(t.status)?(e.userIdent||(a.user.sessionId=t.data.userIdent),t.data):a.$q.reject(t)})},n.prototype.load=function(){return a.localStorage.get("page."+this.page.id)||{}},n.prototype.save=function(e){a.localStorage.set("page."+this.page.id,e)},n.prototype.validate=function(){return!0},n.prototype.trueBuzzerSend=function(e){},n}();e.Case=n}(n||(n={}));var n;!function(e){var t=function(){function e(e){this.showResults=!1,this.showCorrectAnswer=!1,this.showMainMedia=!1,this.showDescription=!1,this.requiredAnswer=!1,this.requiredAnswer=!!e.requiredAnswer,e.settings&&(this.showResults=!!e.settings.showAnswers,this.showCorrectAnswer=!!e.settings.showCorrectAnswer,this.showMainMedia=!!e.settings.showMainMedia,this.showDescription=!!e.settings.showDescription)}return e}();e.Settings=t}(n||(n={}));var n,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.CaseType.Image,this.selected=!1,this.correct=!1,this.incorrect=!1,this.title=r.text,this.media=s.Cloudinary.getInstance().prepareImageUrl(r.imageFile,300,r.imageData)}return c(n,t),n.prototype.send=function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?a.$q.reject("Changing answer is not allowed"):t.prototype.makeSend.call(this,{selectedAnswerId:this.id}).then(function(n){var r={};n.selectedAnswerId&&(r.selectedCaseId=n.selectedAnswerId),n.correctAnswerId&&(r.correctCaseId=n.correctAnswerId);for(var i in n.stats)n.stats.hasOwnProperty(i)&&(r.results=r.results||{},/.{24}/.test(i)&&(r.results[i]=n.stats[i]));return t.prototype.save.call(e,r),e.page.selectAnswer(r),r})},n}(e.Case);e.ImageCase=t}(n||(n={}));var n,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.CaseType.Input,this.title=r.label,this.expectedValue=r.type,this.value=""}return c(n,t),n.prototype.send=function(){var e=this,n={};n.inputs=[];var r=this.load();for(var i in r)r.hasOwnProperty(i)&&n.inputs.push({_id:i,value:r[i]});return t.prototype.makeSend.call(this,n).then(function(){return n})["catch"](function(t){return 406===t.data.code?(e.save({}),a.$q.reject("Incorrect inputs sent. Try again.")):a.$q.reject(t.data.message)})},n.prototype.validate=function(){if(this.correct=!1,this.incorrect=!1,this.page.settings.requiredAnswer&&!this.value?(this.error="Answer is required",this.incorrect=!0):(this.error="",this.correct=!0),this.correct){var e=this.load();return e[this.id]=this.value,this.save(e),!0}return!1},n}(e.Case);e.InputCase=t}(n||(n={}));var n,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.CaseType.Iteration,this.selected=!1,this.ordinal=r.ordinal,this.symbol=r.symbol}return c(n,t),n.prototype.send=function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?a.$q.reject("Changing answer is not allowed"):t.prototype.makeSend.call(this,{quizQuestionId:this.page.id,rateItValue:this.ordinal}).then(function(n){var r={};return n.selectedValue&&(r.selectedValue=n.selectedValue),n.avgRateItValue&&(r.result=+n.avgRateItValue),t.prototype.save.call(e,r),e.page.selectAnswer(r),r})},n}(e.Case);e.IterationCase=t}(n||(n={}));var n,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.CaseType.Text,this.selected=!1,this.correct=!1,this.incorrect=!1,this.title=r.text}return c(n,t),n.prototype.send=function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?a.$q.reject("Changing answer is not allowed"):t.prototype.makeSend.call(this,{selectedAnswerId:this.id}).then(function(n){var r={};n.selectedAnswerId&&(r.selectedCaseId=n.selectedAnswerId),n.correctAnswerId&&(r.correctCaseId=n.correctAnswerId);for(var i in n.stats)n.stats.hasOwnProperty(i)&&(r.results=r.results||{},/.{24}/.test(i)&&(r.results[i]=n.stats[i]));return t.prototype.save.call(e,r),e.page.selectAnswer(r),r})},n}(e.Case);e.TextCase=t}(n||(n={}));var n,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.CaseType.Buzz,this.page=n}return c(n,t),n.prototype.send=function(){this.page.clickBuzzer();var e=a.$q.defer();return e.resolve({}),e.promise},n.prototype.trueBuzzerSend=function(e){return console.log("[ Buzzer ] True send ("+e+")"),t.prototype.makeSend.call(this,{quizQuestionId:this.page.id,buttonClickSum:e}).then(function(e){var t={};return t})},n}(e.Case);e.BuzzCase=t}(n||(n={}));var n,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r,i){t.call(this,n,r),this.type=e.Type.EndPage,this.isCoverPage=!0,this.socialData={title:i.share.title,description:i.share.description,imageUrl:i.share.imageUrl,link:i.share.link},r.coverPage&&(this.button=r.coverPage.buttonText,this.outcome=r.coverPage.outcome,this.social=r.coverPage.showSocialShares,this.exitLink=r.coverPage.exitLink,this.link=r.coverPage.link,r.coverPage.scoreRange&&(this.rangeMax=r.coverPage.scoreRange.max,this.rangeMin=r.coverPage.scoreRange.min))}return c(n,t),n}(e.Page);e.EndPage=t}(n||(n={}));var n,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){var i=this;t.call(this,n,r),this.type=e.Type.Form,r.forms&&(r.forms.inputs.map(function(t){i.cases.push(new e.InputCase(i,t))}),this.cases.length&&this.sent().then(function(e){i.selectAnswer(e)}))}return c(n,t),n.prototype.send=function(e){var t=a.$q.defer(),n=!0;return this.cases.map(function(e){e.validate()||(n=!1)}),n?(this.filled=!0,t.resolve(this.cases[0].send())):(this.filled=!1,t.resolve({})),t.promise},n.prototype.selectAnswer=function(e){this.cases.map(function(t){t.value=e[t.id]||""})},n}(e.Page);e.Form=t}(n||(n={}));var n,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){var i=this;t.call(this,n,r),this.type=e.Type.MultiChoice,r.answers&&(r.answers.map(function(t){i.cases.push(new e.TextCase(i,t))}),this.cases.length&&this.sent().then(function(e){i.selectAnswer(e)}))}return c(n,t),n.prototype.refreshAnswer=function(e,t){return t.answers.map(function(t){e.results[t._id]=t.percent}),e},n.prototype.selectAnswer=function(e){var t=this;this.cases.map(function(n){n.selected=!1,n.correct=!1,n.incorrect=!1,n.id===e.selectedCaseId&&(t.filled=!0,n.selected=!0),e.results&&(n.result=e.results[n.id]||0),!e.correctCaseId||n.id!==e.correctCaseId&&n.id!==e.selectedCaseId||(n.id===e.correctCaseId?n.correct=!0:n.incorrect=!0)})},n}(e.Page);e.MultiChoice=t}(n||(n={}));var n,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){var i=this;t.call(this,n,r),this.type=e.Type.PictureChoice,r.answers&&(r.answers.map(function(t){i.cases.push(new e.ImageCase(i,t))}),this.cases.length&&this.sent().then(function(e){i.selectAnswer(e)}))}return c(n,t),n.prototype.refreshAnswer=function(e,t){return t.answers.map(function(t){e.results[t._id]=t.percent}),e},n.prototype.selectAnswer=function(e){var t=this;this.cases.map(function(n){n.selected=!1,n.correct=!1,n.incorrect=!1,n.id===e.selectedCaseId&&(t.filled=!0,n.selected=!0),e.results&&(n.result=e.results[n.id]||0),!e.correctCaseId||n.id!==e.correctCaseId&&n.id!==e.selectedCaseId||(n.id===e.correctCaseId?n.correct=!0:n.incorrect=!0)})},n}(e.Page);e.PictureChoice=t}(n||(n={}));var n,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){var i=this;t.call(this,n,r),this.type=e.Type.Rateit,this.selectedValue=0,this.labelMin=r.rateIt.minLabel,this.labelMax=r.rateIt.maxLabel;for(var s=1;s<=r.rateIt.maxRateItValue;s++)this.cases.push(new e.IterationCase(this,{ordinal:s,symbol:r.rateIt.rateType}));this.sent().then(function(e){e.selectedValue&&(i.selectedValue=e.selectedValue,i.selectAnswer(e))})}return c(n,t),n.prototype.selectAnswer=function(e){e.selectedValue&&(this.filled=!0,this.selectedValue=e.selectedValue),e.result&&(this.result=e.result),this.cases.map(function(t){t.selected=e.selectedValue>=t.ordinal})},n}(e.Page);e.Rateit=t}(n||(n={}));var n,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.Type.StartPage,this.button="Let's get started",this.isCoverPage=!0,r.coverPage&&(this.button=r.coverPage.buttonText||this.button)}return c(n,t),n}(e.Page);e.StartPage=t}(n||(n={}));var n,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.Type.Buzzer,this.buttonClickSum=0,console.log("[ Buzzer ] Constructor"),this.cases.push(new e.BuzzCase(this,{_id:0,buttonClickSum:this.buttonClickSum})),this._timeout&&a.$timeout.cancel(this._timeout),this.buzzLoop(0),this.buzzerTheme=a.config.fakeBuzzerTheme||{}}return c(n,t),n.prototype.buzzLoop=function(e){var t=this;console.log("[ Buzzer ] Buzz"),this.buttonClickSum>0&&this.cases[0].trueBuzzerSend(this.buttonClickSum),e>0&&this.engageform&&this.engageform.current&&this.engageform.current.id!==this.id||(this._timeout=a.$timeout(function(){t.buzzLoop(e+1)},3e3),this.buttonClickSum=0)},n.prototype.clickBuzzer=function(){this.buttonClickSum<100&&this.buttonClickSum++,console.log("[ Buzzer ] Click! ("+this.buttonClickSum+")")},n}(e.Page);e.Buzzer=t}(n||(n={}));var n,c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.Type.Poster}return c(n,t),n}(e.Page);e.Poster=t}(n||(n={}))}(angular);
//# sourceMappingURL=engageform.min.js.map
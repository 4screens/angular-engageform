!function(e){/*!
 * 4screens-angular-engageform v0.2.54
 * (c) 2015 Nopattern sp. z o.o.
 * License: proprietary
 */
var t;!function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Live=1]="Live",e[e.Outcome=2]="Outcome",e[e.Poll=3]="Poll",e[e.Score=4]="Score",e[e.Survey=5]="Survey"}(e.Type||(e.Type={}));e.Type;!function(e){e[e.Undefined=0]="Undefined",e[e.Default=1]="Default",e[e.Preview=2]="Preview",e[e.Result=3]="Result",e[e.Summary=4]="Summary"}(e.Mode||(e.Mode={}));e.Mode}(t||(t={}));var n;!function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Image=1]="Image",e[e.Input=2]="Input",e[e.Iteration=3]="Iteration",e[e.Text=4]="Text",e[e.Buzz=5]="Buzz"}(e.CaseType||(e.CaseType={}));e.CaseType;!function(e){e[e.Undefined=0]="Undefined",e[e.EndPage=1]="EndPage",e[e.Form=2]="Form",e[e.MultiChoice=3]="MultiChoice",e[e.PictureChoice=4]="PictureChoice",e[e.Rateit=5]="Rateit",e[e.StartPage=6]="StartPage",e[e.Buzzer=7]="Buzzer",e[e.Poster=8]="Poster",e[e.SummaryPage=9]="SummaryPage"}(e.Type||(e.Type={}));e.Type}(n||(n={}));var r,i=e.module("4screens.engageform",["4screens.util.cloudinary","LocalStorageModule"]);!function(e){var n=function(){function e(e){this.enabled=!1,this.position=0,this.size=0,this.hasStart=!1,this.enabledStart=!0,this.hasPrev=!1,this.enabledPrev=!0,this.hasNext=!1,this.enabledNext=!0,this.hasFinish=!1,this.enabledFinish=!0,this.distance=0,this.animate="swipeNext",this.hasStartPages=!1,this.hasEndPages=!1,this.next=this.pick,this.finish=this.pick,this._engageform=e,this.size=e.availablePages.length,this.hasEndPages=Boolean(this._engageform.endPages.length),this._engageform.startPages.length?(this.hasStart=!0,this.hasStartPages=!0,this._engageform.setCurrent(this._engageform.startPages[0])):(this.enabled=!0,this.move(null),this.hasPrev=!1)}return e.prototype.updateDistance=function(){return this.distance=this.position/this.size},e.prototype.start=function(e){this.disableDefaultAction(e),this.animate="swipeNext",this.enabled=!0,this.hasStart=!1,this.move(null),this.hasPrev=!0},e.prototype.stopPageChange=function(){this.waitingForPageChange&&u.$timeout.cancel(this.waitingForPageChange)},e.prototype.prev=function(e){this.disableDefaultAction(e),this.stopPageChange(),this.animate="swipePrev",this._engageform.current&&(this._engageform.message=""),this.position--,this.updateDistance(),this.hasNext=!0,this.hasFinish=!1,0===this.position?(this._engageform.setCurrent(this._engageform.startPages[0]),this.hasPrev=!1):(this._engageform.setCurrent(this._engageform.availablePages[this.position-1]),this.hasPrev=1===this.position?this.hasStartPages:!0)},e.prototype.pick=function(e,t,n){var r=this;if(void 0===n&&(n={quiet:!1}),this.disableDefaultAction(e),this.stopPageChange(),this.animate="swipeNext",!this._engageform.isNormalMode()){var i=u.$q.defer();return i.resolve(t),this.move(t),i.promise}var s=this._engageform.current;return s.send(t).then(function(){if(r.sendMessage(),!s.filled&&s.settings.requiredAnswer)return n.quiet||r.sendMessage("Answer is required to proceed to the next question."),t;var e=t?s.settings.showCorrectAnswer||s.settings.showResults?2e3:200:0;return r.waitingForPageChange=u.$timeout(function(){return r.waitingForPageChange=null,r.move(t),t},e),r.waitingForPageChange})["catch"](function(e){return n.quiet||r.sendMessage(e.message),e})},e.prototype.move=function(e){var n=this;this._engageform.event.trigger("form::pageWillChange",{currentPosition:this.position,isStartPage:Boolean(0===this.position&&this._engageform.startPages.length)}),this.position++,this._engageform.availablePages.length>=this.position?(this.updateDistance(),this._engageform.setCurrent(this._engageform.availablePages[this.position-1]),this.hasPrev=!0,this.hasNext=!1,this.hasFinish=!1,this._engageform.availablePages.length>this.position?this.hasNext=!0:this._engageform.availablePages.length===this.position&&(this.hasFinish=this._engageform.isNormalMode()&&!(this._engageform.isType(t.Type.Poll)&&!this._engageform.hasForms))):(this.position=this._engageform.availablePages.length,e||this._engageform.setCurrentEndPage().then(function(){n.enabled=!1,n.hasPrev=!1,n.hasNext=!1,n.hasFinish=!1})["catch"](function(e){e.data.msg&&n.sendMessage(e.data.msg)}))},e.prototype.disableDefaultAction=function(e){e&&(e.stopPropagation(),e.preventDefault())},e.prototype.sendMessage=function(e){var t=this;void 0===e&&(e=""),this._engageform.message=e,u.$timeout(function(){t._engageform.message=""},this._engageform.settings.hideMessageAfterDelay)},e}();e.Navigation=n}(r||(r={}));var s;!function(e){var t=function(){function e(e){this.globalTitle="",this.globalDescription="",this._engageform=e,this._engageform.settings.share&&(this.globalTitle=this._engageform.settings.share.title||"",this.globalDescription=this._engageform.settings.share.description||""),(this._engageform.endPages.length<1||!_.find(this._engageform.pages,{social:!0}))&&(this._engageform.startPages.length&&this._engageform.pages[this._engageform.startPages[0]].title?(this.globalTitle=this._engageform.pages[this._engageform.startPages[0]].title,this.globalDescription=this._engageform.pages[this._engageform.startPages[0]].description):(this.globalTitle="",this.globalDescription=""))}return e}();e.Meta=t}(s||(s={}));var n;!function(e){var t=function(){function t(t,n){this.title="",this.description="",this.media="",this.cases=[],this._pageId=n._id,this._engageform=t,this.settings=new e.Settings(n),this.title=n.text||"",this.settings.showDescription&&(this.description=n.description||""),this.settings.showMainMedia&&(this.media=u.cloudinary.prepareImageUrl(n.imageFile,680,n.imageData),this.mediaWidth=680,n.imageData.containerRatio?this.mediaHeight=Math.round(680*n.imageData.containerRatio):this.mediaHeight=Math.round(n.imageData.containerHeight))}return Object.defineProperty(t.prototype,"id",{get:function(){return this._pageId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"engageform",{get:function(){return this._engageform},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Type",{get:function(){return e.Type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CaseType",{get:function(){return e.CaseType},enumerable:!0,configurable:!0}),t.prototype.send=function(e){if(this._engageform.enabled===!1)return u.$q.reject("Engageform already ended.");if(e)return e.send();var t=u.$q.defer();return t.resolve(),t.promise},t.prototype.sent=function(){var e=this,t=u.$q.defer(),n={};return n=u.localStorage.get("page."+this.id)||{},this.settings.showResults&&n.results?this.getStatsById(this.id).then(function(r){t.resolve(e.refreshAnswer(n,r))})["catch"](function(){t.resolve(n)}):t.resolve(n),t.promise},t.prototype.refreshAnswer=function(e,t){return e},t.prototype.selectAnswer=function(e){},t.prototype.createCase=function(e,t){},t.prototype.setResults=function(t){var n=this.cases.map(function(e){return e.result=Number(t.stats[e.id])||0,e.id});for(var r in t.stats)if(-1===n.indexOf(r)&&"questionId"!==r&&this.type!==e.Type.Rateit){var i=this.createCase({text:"[Removed answer]",_id:r,imageData:{height:100}});i.result=Number(t.stats[i.id]),this.cases.push(i)}},t.prototype.updateAnswers=function(e){var t=this;this.id===e.questionId&&(this.engageform.current&&!_.isUndefined(e.avg)&&(this.engageform.current.result=e.avg),u.$timeout(function(){t.cases.map(function(t){if(!_.isUndefined(e[t.id])){var n=t.load();n.results&&(n.results[t.id]=e[t.id],t.save(n)),t.result=e[t.id]||0}})}))},t.prototype.getStatsById=function(e){var t=u.config.backend.domain+u.config.engageform.pageStatsUrl;return t=t.replace(":pageId",e),u.$http.get(t).then(function(e){return-1!==[200,304].indexOf(e.status)?e.data:u.$q.reject(e)})},t}();e.Page=t}(n||(n={}));var o,a=function(){function e(){}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id||(this._id=u.localStorage.get("userIdent")),this._id},set:function(e){u.localStorage.set("userIdent",e),this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this._sessionId||(this._sessionId=u.localStorage.get("sessionIdent")),this._sessionId},set:function(e){u.localStorage.set("sessionIdent",e),this._sessionId=e},enumerable:!0,configurable:!0}),e}();!function(e){var t=function(){function e(){this._listener={}}return e.prototype.listen=function(e,t){this._listener[e]||(this._listener[e]=[]),this._listener[e].push(t)},e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Array.apply(null,arguments).slice(1),i=this._listener[e];if(i)for(var s=0;s<i.length;s++)i[s].apply(null,r)},e}();e.Event=t}(o||(o={}));var t;!function(e){var t=function(){function t(i,a,u,h){var g=this;void 0===u&&(u=[]),void 0===h&&(h=function(){}),this._pages={},this._startPages=[],this._endPages=[],this._availablePages=[],this._hasForms=!1,this.enabled=!0,this.type=e.Type.Undefined,t.pagesConsturctors={multiChoice:n.MultiChoice,pictureChoice:n.PictureChoice,rateIt:n.Rateit,forms:n.Form,startPage:n.StartPage,endPage:n.EndPage,buzzer:n.Buzzer,poster:n.Poster},this._engageformId=i._id,this.mode=a,this.sendAnswerCallback=h,this.title=i.title,this.settings=new e.Settings(i),this.theme=new e.Theme(i),this.tabs=new e.Tabs(i),this.themeType=this.getThemeType(i.theme.backgroundColor),this.event=new o.Event,i.settings&&i.settings.branding?this.branding=new c.Branding(i.settings.branding):this.branding=new c.Branding({});var l=this.buildPages(u,this.settings);l.forEach(function(e){return g.storePage(e)}),this._hasForms=l.some(function(e){return e.type===n.Type.Form}),this.navigation=new r.Navigation(this),this.meta=new s.Meta(this)}return Object.defineProperty(t.prototype,"id",{get:function(){return this._engageformId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pages",{get:function(){return this._pages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startPages",{get:function(){return this._startPages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endPages",{get:function(){return this._endPages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availablePages",{get:function(){return this._availablePages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"typeName",{get:function(){return e.Type[this.type].toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasForms",{get:function(){return this._hasForms},enumerable:!0,configurable:!0}),t.prototype.isType=function(e){return this.type===e},t.prototype.isNormalMode=function(){return Boolean(this.mode===e.Mode.Default||this.mode===e.Mode.Preview)},t.prototype.isSummaryMode=function(){return Boolean(this.mode===e.Mode.Summary)},t.prototype.isResultsMode=function(){return Boolean(this.mode===e.Mode.Result)},t.prototype.isPreviewMode=function(){return Boolean(this.mode===e.Mode.Preview)},t.prototype.storePage=function(e){return e.type===n.Type.StartPage?this.isNormalMode()&&this._startPages.push(e.id):e.type===n.Type.EndPage?this.isNormalMode()&&this._endPages.push(e.id):this._availablePages.push(e.id),this._pages[e.id]=e,e},t.prototype.initPage=function(e){return this.storePage(this.buildPages([e],this.settings)[0]),this.setCurrent(e._id)},t.prototype.setCurrent=function(e){var t=this._pages[e];return this.current=t,t},t.prototype.setCurrentEndPage=function(){var t=u.config.backend.domain+u.config.engageform.engageformFinishUrl;return t=t.replace(":engageformId",this._engageformId),u.mode!==e.Mode.Default&&(t+="?preview"),u.$http.post(t,{userIdent:u.user.sessionId,globalUserIdent:u.user.id}).then(function(e){return-1!==[200,304].indexOf(e.status)?(u.localStorage.clearAll(),u.user.id=e.data.globalUserIdent,e.data):this.$q.reject(e)})},t.prototype.cleanPages=function(){this._availablePages.length=0,this._pages={}},t.prototype.buildPages=function(e,t){var n=this;return e.map(function(e){return n.createPage(e,t)}).filter(function(e){return Boolean(e)})},t.prototype.createPage=function(e,n){return t.pagesConsturctors[e.type]?new t.pagesConsturctors[e.type](this,e,n):void 0},t.prototype.setSummary=function(e){var t=this;e.forEach(function(e){t._pages[e.stats.questionId]&&t._pages[e.stats.questionId].setResults(e)})},t.prototype.setAnswers=function(e){var t=e.questions;for(var n in t)if(this._pages[n]){var r=t[n];this._pages[n].selectAnswer({selectedCaseId:r.selectedAnswerId,inputs:r.inputs,selectedValue:r.rateItValue})}},t.prototype.setResultPage=function(e){var t={_id:"summaryPage",type:"summaryPage",settings:{showCorrectAnswer:!0},stats:e},r=new n.SummaryPage(this,t);this.storePage(r)},t.prototype.getThemeType=function(e){var t=this.colorToRgb(e);return.299*t.red+.587*t.green+.114*t.blue>186?"light":"dark"},t.prototype.colorToRgb=function(e){var t,n,r;if("#"===e[0]?e=e.substr(1):(t=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i),e=t&&4===t.length?("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):""),3===e.length){n=e,e="",n=/^([a-f0-9])([a-f0-9])([a-f0-9])$/i.exec(n).slice(1);for(var i=0;3>i;i++)e+=n[i]+n[i]}return r=/^([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i.exec(e).slice(1),{red:parseInt(r[0],16),green:parseInt(r[1],16),blue:parseInt(r[2],16)}},t}();e.Engageform=t}(t||(t={}));var u=function(){function e(n,r,i,s,u,c){e.$http=n,e.$q=r,e.$timeout=i,e.cloudinary=s,e.localStorage=u,e.config=c,e.user=new a,e.quizzesConstructors={outcome:t.Outcome,poll:t.Poll,score:t.Score,survey:t.Survey,live:t.Live},e.modes={preview:t.Mode.Preview,summary:t.Mode.Summary,results:t.Mode.Result,"default":t.Mode.Default,"":t.Mode.Default},this._event=new o.Event,e.cloudinary.setConfig(c.cloudinary)}return Object.defineProperty(e.prototype,"type",{get:function(){return this._engageform?this._engageform.type:t.Type.Undefined},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Type",{get:function(){return t.Type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return e.mode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Mode",{get:function(){return t.Mode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"title",{get:function(){return this._engageform?this._engageform.title:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"theme",{get:function(){return this._engageform?this._engageform.theme:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._engageform?this._engageform.current:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"navigation",{get:function(){return this._engageform?this._engageform.navigation:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"branding",{get:function(){return this._engageform?this._engageform.branding:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._engageform?this._engageform.message:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"meta",{get:function(){return this._engageform?this._engageform.meta:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"event",{get:function(){return this._event?this._event:void 0},enumerable:!0,configurable:!0}),e.prototype.init=function(t){var n=this;if(!t||!t.id)return e.$q.reject({status:"error",error:{code:406,message:"The required id property does not exist."},data:t});if(e._instances[t.id])return e._instances[t.id];if("undefined"==typeof t.mode&&(t.mode="default"),!e.modes[t.mode])return e.$q.reject({status:"error",error:{code:406,message:"Mode property not supported."},data:t});e.mode=e.modes[t.mode];var r={quizData:e.getData("quiz",t.id)};return t.live||(r.pages=e.getData("pages",t.id)),e.$q.all(r).then(function(r){return e.quizzesConstructors[r.quizData.type]?(n._engageform=new e.quizzesConstructors[r.quizData.type](r.quizData,e.mode,r.pages,t.callback?t.callback.sendAnswerCallback:function(){}),n._engageform):e.$q.reject({status:"error",error:{code:406,message:"Type property not supported."},data:r.quizData})})},e.getData=function(n,r){var i={quiz:"engageformUrl",pages:"engageformPagesUrl"};if(!i[n])throw new Error("Resource path for "+n+" type of data is unknown.");var s=e.config.backend.domain+e.config.engageform["quiz"===n?"engageformUrl":"engageformPagesUrl"];return s=s.replace(":engageformId",r),e.mode!==t.Mode.Default&&(s+="?preview"),e.$http.get(s).then(function(t){return-1!==[200,304].indexOf(t.status)?t.data:void e.$q.reject(t)})},e.prototype.destroyInstances=function(){e._instances={}},e.mode=t.Mode.Undefined,e._instances={},e}();u.$inject=["$http","$q","$timeout","cloudinary","localStorageService","ApiConfig"],i.service("Engageform",u);var c;!function(e){var t=function(){function e(e){void 0===e&&(e={}),this._isCustomLogo=!1,this._isCustom=!1;var t,n=u.config.backend.branding;this._enabled=!e.state,(e.text||e.link||e.imageUrl)&&(this._isCustom=!0),this._text="undefined"==typeof e.text?n.text:e.text,this._link="undefined"==typeof e.link?n.link:e.link,"undefined"==typeof e.imageUrl?t=n.imageUrl:(t=e.imageUrl,this._isCustomLogo=!0),t===n.imageUrl?this._imageUrl=u.config.backend.api+t:this._imageUrl=t?u.config.backend.api+u.config.backend.imagesUrl+"/"+t:""}return Object.defineProperty(e.prototype,"isCustom",{get:function(){return this._isCustom},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCustomLogo",{get:function(){return this._isCustomLogo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDefault",{get:function(){return!this._isCustom},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageUrl",{get:function(){return this._imageUrl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"link",{get:function(){return this._link},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),e}();e.Branding=t}(c||(c={}));var t;!function(e){var t=function(){function e(e){this.allowAnswerChange=!1,this.hideMessageAfterDelay=3e3,e.settings&&(this.allowAnswerChange=!!e.settings.allowAnswerChange,e.settings.hideMessageAfterDelay&&(this.hideMessageAfterDelay=e.settings.hideMessageAfterDelay),e.settings.share&&(this.share=e.settings.share,!this.share.imageUrl&&u.config.share&&u.config.share.defaultImgUrl&&(this.share.imageUrl=u.config.share.defaultImgUrl)))}return e}();e.Settings=t}(t||(t={}));var t;!function(e){var t=function(){function e(e){this.answerBackgroundColor="",this.answerBorderColor="",this.answerColor="",this.backgroundBrightness="",this.backgroundColor="",this.backgroundImageBlur="",this.backgroundImageFile="",this.backgroundImagePosition="",this.buttonColor="",this.font="",this.questionColor="",this.customThemeCssFile="",this.backgroundImageConvertedFile="",this.tabBorderColor="",this.tabFontColor="",this.tabColor="",e.theme&&(this.answerBackgroundColor=e.theme.answerBackgroundColor||"",this.answerBorderColor=e.theme.answerBorderColor||"",this.answerColor=e.theme.answerColor||"",this.backgroundBrightness=e.theme.backgroundBrightness||"",this.backgroundColor=e.theme.backgroundColor||"",this.backgroundImageBlur=e.theme.backgroundImageBlur||"",this.backgroundImageFile=e.theme.backgroundImageFile||"",this.backgroundImagePosition=e.theme.backgroundImagePosition||"",this.buttonColor=e.theme.buttonColor||"",this.font=e.theme.font||"",this.questionColor=e.theme.questionColor||"",this.tabColor=e.theme.tabColor||"",this.tabFontColor=e.theme.tabFontColor||"",this.tabBorderColor=e.theme.tabBorderColor||"",e.theme.customThemeCssFile&&(this.customThemeCssFile=u.config.backend.api+"/uploads/"+e.theme.customThemeCssFile),e.theme.backgroundImageFile&&this.convertBackgroundImage())}return e.prototype.convertBackgroundImage=function(){this.backgroundImageConvertedFile=u.cloudinary.prepareBackgroundImageUrl(this.backgroundImageFile,window.innerWidth,window.innerHeight,parseInt(this.backgroundImageBlur,10),this.backgroundImagePosition)},e}();e.Theme=t}(t||(t={}));var t;!function(e){var t=function(){function e(e){this.liveTitle="Live",this.chatTitle="Chat",this.logoUrl="",this.headerText="",e.tabs&&(e.tabs.liveTitle&&(this.liveTitle=e.tabs.liveTitle),e.tabs.chatTitle&&(this.chatTitle=e.tabs.chatTitle),e.tabs.logoUrl&&(this.logoUrl=u.config.backend.api+u.config.backend.imagesUrl+"/"+e.tabs.logoUrl),e.tabs.headerText&&(this.headerText=e.tabs.headerText))}return e}();e.Tabs=t}(t||(t={}));var t,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(){t.apply(this,arguments),this.type=e.Type.Outcome}return h(n,t),n.prototype.setCurrentEndPage=function(){var e=this;return t.prototype.setCurrentEndPage.call(this).then(function(t){var n=!1;return e.endPages.map(function(r){var i=e.pages[r];i.outcome===t.outcome&&(n=!0,e.setCurrent(r))}),n||(e.enabled=!1,e.message="Thank you!"),t})},n}(e.Engageform);e.Outcome=t}(t||(t={}));var t,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(){t.apply(this,arguments),this.type=e.Type.Poll}return h(n,t),n.prototype.setCurrentEndPage=function(){var e=this;return t.prototype.setCurrentEndPage.call(this).then(function(t){return e.endPages.length?e.setCurrent(e.endPages[0]):(e.enabled=!1,e.message="Thank you!"),t})},n}(e.Engageform);e.Poll=t}(t||(t={}));var t,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(){t.apply(this,arguments),this.type=e.Type.Score}return h(n,t),n.prototype.setCurrentEndPage=function(){var e=this;return t.prototype.setCurrentEndPage.call(this).then(function(t){var n=100,r=!1;return t.maxScore>0&&(n=Math.round(t.totalScore/t.maxScore*100)),e.endPages.map(function(t){var i=e.pages[t];i.rangeMin<=n&&i.rangeMax>=n&&(r=!0,e.pages[t].score=n,e.setCurrent(t))}),r||(e.enabled=!1,e.message="Thank you!"),t})},n}(e.Engageform);e.Score=t}(t||(t={}));var t,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(){t.apply(this,arguments),this.type=e.Type.Survey}return h(n,t),n.prototype.setCurrentEndPage=function(){var e=this;return t.prototype.setCurrentEndPage.call(this).then(function(t){return e.endPages.length?e.setCurrent(e.endPages[0]):(e.enabled=!1,e.message="Thank you!"),t})},n}(e.Engageform);e.Survey=t}(t||(t={}));var t,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(){t.apply(this,arguments),this.type=e.Type.Live}return h(n,t),n.prototype.initPages=function(){var e=u.$q.defer();return e.resolve(this),e.promise},n.prototype.initPage=function(e){return this.cleanPages(),t.prototype.initPage.call(this,e)},n.prototype.setCurrentEndPage=function(){var e=u.$q.defer();return e.resolve(),e.promise},n}(e.Engageform);e.Live=t}(t||(t={}));var n;!function(e){var n=function(){function n(t,n){this.type=e.CaseType.Undefined,this.selected=!1,this.correct=!1,this.incorrect=!1,this.result=0,this._caseId=n._id,this._page=t}return Object.defineProperty(n.prototype,"id",{get:function(){return this._caseId},set:function(e){this._caseId=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"page",{get:function(){return this._page},enumerable:!0,configurable:!0}),n.prototype.shouldShowIndicator=function(){return!this._page.engageform.isSummaryMode()&&!this._page.engageform.isResultsMode()&&this._page.settings.showCorrectAnswer&&(this.selected||this._page.filled&&this.correct)},n.prototype.shouldShowResults=function(){return this._page.engageform.isSummaryMode()||this._page.settings.showResults&&this._page.filled&&!this._page.engageform.isResultsMode()},n.prototype.send=function(){var e=u.$q.defer();return e.resolve({}),e.promise},n.prototype.makeSend=function(e){var n=u.config.backend.domain+u.config.engageform.pageResponseUrl;return n=n.replace(":pageId",this.page.id),u.mode!==t.Mode.Default&&(n+="?preview"),e.quizQuestionId=this.page.id,e.userIdent=u.user.sessionId,u.$http.post(n,e).then(function(t){return-1!==[200,304].indexOf(t.status)?(e.userIdent||(u.user.sessionId=t.data.userIdent),t.data):u.$q.reject(t.data||{})})["catch"](function(e){return u.$q.reject(e.data||{})})},n.prototype.load=function(){return u.localStorage.get("page."+this.page.id)||{}},n.prototype.save=function(e){u.localStorage.set("page."+this.page.id,e)},n.prototype.validate=function(){return!0},n.prototype.trueBuzzerSend=function(e){},n}();e.Case=n}(n||(n={}));var n;!function(e){var t=function(){function e(e){this.showResults=!1,this.showCorrectAnswer=!1,this.showMainMedia=!1,this.showDescription=!1,this.requiredAnswer=!1,this.requiredAnswer=!!e.requiredAnswer,e.settings&&(this.showResults=!!e.settings.showAnswers,this.showCorrectAnswer=!!e.settings.showCorrectAnswer,this.showMainMedia=!!e.settings.showMainMedia,this.showDescription=!!e.settings.showDescription)}return e}();e.Settings=t}(n||(n={}));var n,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.CaseType.Image,this.title=r.text,this.media=u.cloudinary.prepareImageUrl(r.imageFile,300,r.imageData),this.mediaWidth=300,r.imageData&&r.imageData.containerRatio?this.mediaHeight=Math.round(300*r.imageData.containerRatio):this.mediaHeight=Math.round(r.imageData.containerHeight)}return h(n,t),n.prototype.send=function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?u.$q.reject({message:"Changing answer is not allowed"}):t.prototype.makeSend.call(this,{selectedAnswerId:this.id}).then(function(n){var r={};n.selectedAnswerId&&(r.selectedCaseId=n.selectedAnswerId),n.correctAnswerId&&(r.correctCaseId=n.correctAnswerId);for(var i in n.stats)n.stats.hasOwnProperty(i)&&(r.results=r.results||{},/.{24}/.test(i)&&(r.results[i]=n.stats[i]));return t.prototype.save.call(e,r),e.page.selectAnswer(r),r})},n}(e.Case);e.ImageCase=t}(n||(n={}));var n,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.CaseType.Input,this.title=r.label,this.expectedValue=r.type,this.value=""}return h(n,t),n.prototype.send=function(){var e=this,n={};n.inputs=[];var r=this.load();for(var i in r)r.hasOwnProperty(i)&&n.inputs.push({_id:i,value:r[i]});return t.prototype.makeSend.call(this,n).then(function(){return n})["catch"](function(t){return 406===t.code&&(t.message="Incorrect inputs sent. Try again.",e.save({})),u.$q.reject(t)})},n.prototype.validate=function(){if(this.correct=!1,this.incorrect=!1,this.page.settings.requiredAnswer&&!this.value?(this.error="Answer is required",this.incorrect=!0):(this.error="",this.correct=!0),this.correct){var e=this.load();return e[this.id]=this.value,this.save(e),!0}return!1},n}(e.Case);e.InputCase=t}(n||(n={}));var n,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.CaseType.Iteration,this.selected=!1,this.ordinal=r.ordinal,this.symbol=r.symbol}return h(n,t),n.prototype.send=function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?u.$q.reject({message:"Changing answer is not allowed"}):t.prototype.makeSend.call(this,{quizQuestionId:this.page.id,rateItValue:this.ordinal}).then(function(n){var r={};return n.selectedValue&&(r.selectedValue=n.selectedValue),n.avgRateItValue&&(r.result=+n.avgRateItValue),t.prototype.save.call(e,r),e.page.selectAnswer(r),r})},n}(e.Case);e.IterationCase=t}(n||(n={}));var n,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.CaseType.Text,this.title=r.text}return h(n,t),n.prototype.send=function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?u.$q.reject({message:"Changing answer is not allowed"}):t.prototype.makeSend.call(this,{selectedAnswerId:this.id}).then(function(n){var r={};n.selectedAnswerId&&(r.selectedCaseId=n.selectedAnswerId),n.correctAnswerId&&(r.correctCaseId=n.correctAnswerId);for(var i in n.stats)n.stats.hasOwnProperty(i)&&(r.results=r.results||{},/.{24}/.test(i)&&(r.results[i]=n.stats[i]));return t.prototype.save.call(e,r),e.page.selectAnswer(r),r})},n}(e.Case);e.TextCase=t}(n||(n={}));var n,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.CaseType.Buzz,this.page=n}return h(n,t),n.prototype.send=function(){this.page.clickBuzzer();var e=u.$q.defer();return e.resolve({}),e.promise},n.prototype.trueBuzzerSend=function(e){return t.prototype.makeSend.call(this,{quizQuestionId:this.page.id,buttonClickSum:e}).then(function(e){var t={};return t})},n}(e.Case);e.BuzzCase=t}(n||(n={}));var n,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r,i){t.call(this,n,r),this.type=e.Type.EndPage,this.isCoverPage=!0,this.socialData={title:i.share.title,description:i.share.description,imageUrl:i.share.imageUrl,link:i.share.link},r.coverPage&&(this.button=r.coverPage.buttonText,this.outcome=r.coverPage.outcome,this.social=r.coverPage.showSocialShares,this.exitLink=r.coverPage.exitLink,this.link=r.coverPage.link,r.coverPage.scoreRange&&(this.rangeMax=r.coverPage.scoreRange.max,this.rangeMin=r.coverPage.scoreRange.min))}return h(n,t),n.prototype.personalizeShares=function(){("outcome"===this.engageform.typeName||"score"===this.engageform.typeName)&&(this.socialData.title='I got "'+("score"===this.engageform.typeName?(this.score||0)+" percent":this.outcome||"")+'" on "'+this.engageform.title+'" quiz. What about you?',this.media&&this.settings.showMainMedia&&(this.socialData.imageUrl=this.media))},Object.defineProperty(n.prototype,"fbLink",{get:function(){return u.config.backend&&u.config.backend.domain&&u.config.share&&u.config.share.facebook&&this.socialData&&this.socialData.title&&this.socialData.description&&this.socialData.imageUrl&&this.engageform&&this.engageform.id?(this.personalizeShares(),u.config.backend.domain+u.config.share.facebook+"?quizId="+this.engageform.id+"&description="+encodeURIComponent(this.socialData.description)+"&name="+encodeURIComponent(this.socialData.title)+"&image="+this.socialData.imageUrl):null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"twLink",{get:function(){return this.socialData&&this.socialData.title&&this.socialData.link?(this.personalizeShares(),"https://twitter.com/intent/tweet?text="+encodeURIComponent(this.socialData.title)+" "+this.socialData.link+" via @4screens"):null},enumerable:!0,configurable:!0}),n}(e.Page);e.EndPage=t}(n||(n={}));var n,h=this&&this.__extends||function(e,t){
function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){var i=this;t.call(this,n,r),this.type=e.Type.Form,this.count=0,r.forms&&(this.cases=r.forms.inputs.map(function(e){return i.createCase(e)}),this.cases.length&&this.sent().then(function(e){i.selectAnswer(e)}))}return h(n,t),n.prototype.createCase=function(t){return new e.InputCase(this,t)},n.prototype.send=function(e){var t=u.$q.defer(),n=!0;return this.cases.map(function(e){e.validate()||(n=!1)}),n?(this.filled=!0,this.engageform.sendAnswerCallback(this.engageform.title||this.engageform.id,this.engageform.current?this.engageform.current.title||this.engageform.current.id:null,this.cases[0]),t.resolve(this.cases[0].send())):(this.filled=!1,t.resolve({})),t.promise},n.prototype.selectAnswer=function(e){this.cases.map(function(t){t.value=e[t.id]||"",e.inputs&&e.inputs.forEach(function(e){e._id===t.id&&(t.value=e.value)})})},n.prototype.setResults=function(e){this.count=e.count},n}(e.Page);e.Form=t}(n||(n={}));var n,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){var i=this;t.call(this,n,r),this.type=e.Type.MultiChoice,r.answers&&(this.cases=r.answers.map(function(e){return i.createCase(e)}),this.cases.length&&this.sent().then(function(e){i.selectAnswer(e)}))}return h(n,t),n.prototype.createCase=function(t){return new e.TextCase(this,t)},n.prototype.refreshAnswer=function(e,t){return t.answers.map(function(t){e.results[t._id]=t.percent}),e},n.prototype.selectAnswer=function(e){var t=this;this.cases.map(function(n){n.selected=!1,n.correct=!1,n.incorrect=!1,n.id===e.selectedCaseId&&(t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n),t.filled=!0,n.selected=!0),e.results&&(n.result=e.results[n.id]||0),n.id===e.correctCaseId?n.correct=!0:n.incorrect=!0})},n}(e.Page);e.MultiChoice=t}(n||(n={}));var n,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){var i=this;t.call(this,n,r),this.type=e.Type.PictureChoice,r.answers&&(this.cases=r.answers.map(function(e){return i.createCase(e)}),this.cases.length&&this.sent().then(function(e){i.selectAnswer(e)}))}return h(n,t),n.prototype.createCase=function(t){return new e.ImageCase(this,t)},n.prototype.refreshAnswer=function(e,t){return t.answers.map(function(t){e.results[t._id]=t.percent}),e},n.prototype.selectAnswer=function(e){var t=this;this.cases.map(function(n){n.selected=!1,n.correct=!1,n.incorrect=!1,n.id===e.selectedCaseId&&(t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n),t.filled=!0,n.selected=!0),e.results&&(n.result=e.results[n.id]||0),n.id===e.correctCaseId?n.correct=!0:n.incorrect=!0})},n}(e.Page);e.PictureChoice=t}(n||(n={}));var n,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){var i=this;t.call(this,n,r),this.type=e.Type.Rateit,this.selectedValue=0,this.labelMin=r.rateIt.minLabel,this.labelMax=r.rateIt.maxLabel,this.cases=Array.apply(null,Array(r.rateIt.maxRateItValue)).map(function(e,t){return i.createCase(t+1,r.rateIt.rateType)}),this.sent().then(function(e){e.selectedValue&&(i.selectedValue=e.selectedValue,i.selectAnswer(e))})}return h(n,t),n.prototype.shouldShowResults=function(){return this.settings.showResults&&this.result>0},n.prototype.createCase=function(t,n){return new e.IterationCase(this,{ordinal:t,symbol:n})},n.prototype.selectAnswer=function(e){var t=this;e.selectedValue&&(this.filled=!0,this.selectedValue=e.selectedValue),e.result&&(this.result=e.result),this.cases.map(function(n){n.selected=e.selectedValue>=n.ordinal,e.selectedValue===n.ordinal&&t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n)})},n.prototype.setResults=function(e){this.result=e.average,this.selectedValue=e.average},n}(e.Page);e.Rateit=t}(n||(n={}));var n,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.Type.StartPage,this.button="Let's get started",this.isCoverPage=!0,r.coverPage&&(this.button=r.coverPage.buttonText||this.button)}return h(n,t),n}(e.Page);e.StartPage=t}(n||(n={}));var n,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.Type.Buzzer,this.buttonClickSum=0,this._connected=!1,this.cases.push(new e.BuzzCase(this,{_id:0,buttonClickSum:this.buttonClickSum})),this._timeout&&u.$timeout.cancel(this._timeout),this.buzzLoop(0),this.buzzerTheme=u.config.fakeBuzzerTheme||{}}return h(n,t),n.prototype.buzzLoop=function(e){var t=this;this._connected||(this._connected=!0),this.buttonClickSum>0&&(this._connected=!0,this.cases[0].trueBuzzerSend(this.buttonClickSum),this.cases[0].buttonClickSum=this.buttonClickSum,this.engageform.sendAnswerCallback(this.engageform.title||this.engageform.id,this.engageform.current?this.engageform.current.title||this.engageform.current.id:null,this.cases[0])),e>0&&this.engageform&&this.engageform.current&&this.engageform.current.id!==this.id||(this._timeout=u.$timeout(function(){t.buzzLoop(e+1)},3e3),this.buttonClickSum=0)},n.prototype.clickBuzzer=function(){this.buttonClickSum<100&&this.buttonClickSum++},n}(e.Page);e.Buzzer=t}(n||(n={}));var n,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var t=function(t){function n(n,r){t.call(this,n,r),this.type=e.Type.Poster}return h(n,t),n}(e.Page);e.Poster=t}(n||(n={}));var n,h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};!function(e){var n=function(n){function r(r,i){n.call(this,r,i),this.type=e.Type.SummaryPage,r.type===t.Type.Outcome?this.title="Outcomes":this.title="Scores",this.stats=i.stats}return h(r,n),r}(e.Page);e.SummaryPage=n}(n||(n={}))}(angular);
//# sourceMappingURL=engageform.min.js.map
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=_},function(e,t){e.exports=angular},function(e,t,n){"use strict";n.r(t);var r,o=n(0);!function(e){e.Outcome="outcome",e.Poll="poll",e.Score="score",e.Survey="survey",e.Live="live"}(r||(r={}));var i,a,s,u,c,l=n(1),f=n.n(l).a.module("4screens.engageform",["4screens.util.cloudinary","LocalStorageModule"]);!function(e){e.Undefined="undefined",e.Default="default",e.Preview="preview",e.Result="results",e.Summary="summary"}(i||(i={})),function(e){e[e.Undefined=0]="Undefined",e[e.Live=1]="Live",e[e.Outcome=2]="Outcome",e[e.Poll=3]="Poll",e[e.Score=4]="Score",e[e.Survey=5]="Survey"}(a||(a={})),function(e){e.Default="default",e.Entry="entry",e.Exit="exit"}(s||(s={})),function(e){e.And="and",e.Or="or"}(u||(u={})),function(e){e.Equal="eq",e.NotEqual="neq",e.Blank="blank",e.NotBlank="nblank",e.GreaterThan="gt",e.GreaterThanOrEqual="gte",e.LessThan="lt",e.LessThanOrEqual="lte",e.Between="between",e.Contain="contain",e.NotContain="ncontain"}(c||(c={}));var g=function(e){return e.type===s.Entry},h=function(e){return e.type===s.Exit},p=function(e){return e.type===s.Default};function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&y(e.prototype,t),n&&y(e,n),e}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m,v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),b(this,"_engageform",void 0),b(this,"visitedPages",[]),b(this,"enabled",!1),b(this,"position",0),b(this,"size",0),b(this,"hasStart",!1),b(this,"enabledStart",!0),b(this,"hasPrev",!1),b(this,"enabledPrev",!0),b(this,"hasNext",!1),b(this,"enabledNext",!0),b(this,"hasFinish",!1),b(this,"enabledFinish",!0),b(this,"distance",0),b(this,"animate","swipeNext"),b(this,"hasStartPages",!1),b(this,"hasEndPages",!1),b(this,"waitingForPageChange",null),b(this,"next",this.pick),b(this,"finish",this.pick),this._engageform=t,this.size=t.availablePages.length,this.hasEndPages=Boolean(t.endPages.length),t.startPages.length?(this.hasStart=!0,this.hasStartPages=!0,this._engageform.setCurrent(t.startPages[0])):(this.enabled=!0,this.move(),this.hasPrev=!1)}return d(e,null,[{key:"fromEnageform",value:function(t){return new e(t)}}]),d(e,[{key:"updateDistance",value:function(){return this.distance=this.position/this.size}},{key:"start",value:function(e){this.disableDefaultAction(e),this.animate="swipeNext",this.enabled=!0,this.hasStart=!1,this.move(),this.hasPrev=!0}},{key:"stopPageChange",value:function(){this.waitingForPageChange&&Sn.$timeout.cancel(this.waitingForPageChange)}},{key:"prev",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.disableDefaultAction(e),this.stopPageChange(),this.animate="swipePrev",this._engageform.current&&(this._engageform.message=""),this.position-=t,this.updateDistance(),this.hasNext=!0,this.hasFinish=!1,0===this.position?(this._engageform.setCurrent(this._engageform.startPages[0]),this.hasPrev=!1):(this._engageform.setCurrent(this._engageform.availablePages[this.position-1]),this.hasPrev=1!==this.position||this.hasStartPages)}},{key:"pick",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{quiet:!1};if(this.disableDefaultAction(e),this.stopPageChange(),this.animate="swipeNext",!this._engageform.isNormalMode()){var o=Sn.$q.defer();return o.resolve(t),this.move(t),o.promise}var i=this._engageform.current;return!t||!this._engageform.settings.allowAnswerChange&&i.filled||(t.selected=!0,t.incorrect=!1),i.send(t).then(function(){if(n.sendMessage(),!i.filled&&i.settings.requiredAnswer)return r.quiet||n.sendMessage(n._engageform.texts.ANSWER_REQUIRED_TO_PROCEED),t;var e=t?i.settings.showCorrectAnswer||i.settings.showResults?1e3:200:0;return n.waitingForPageChange=Sn.$timeout(function(){return n.waitingForPageChange=null,n.move(t),t},e),n.waitingForPageChange}).catch(function(e){return r.quiet||n.sendMessage(n._engageform.texts[e.textKey]||e.message),e})}},{key:"move",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._engageform.event.trigger("form::pageWillChange",{isStartPage:Boolean(0===this.position&&this._engageform.startPages.length)}),this.visitedPages.push(this._engageform.current),this.position+=n,this._engageform.availablePages.length>=this.position?(this.updateDistance(),this._engageform.setCurrent(this._engageform.availablePages[this.position-1]),this.hasPrev=!0,this.hasNext=!1,this.hasFinish=!1,this._engageform.availablePages.length>this.position?this.hasNext=!0:this._engageform.availablePages.length===this.position&&(this.hasFinish=this._engageform.isNormalMode()&&!(this._engageform.isType(a.Poll)&&!this._engageform.hasForms)),this._engageform.event.trigger("form::pageDidChange",{currentPosition:this.position,isEndPage:!1})):(this.position=this._engageform.availablePages.length,e||this._engageform.setCurrentEndPage().then(function(e){t._engageform.type!==a.Score&&t._engageform.type!==a.Outcome||t._engageform.event.trigger("finish",e.totalScore||e.outcome,e.maxScore),t.enabled=!1,t.hasPrev=!1,t.hasNext=!1,t.hasFinish=!1,t._engageform.event.trigger("form::pageDidChange",{currentPosition:t.position,isEndPage:!0})}).catch(function(e){e.data.msg&&t.sendMessage(e.data.msg)}))}},{key:"disableDefaultAction",value:function(e){e&&(e.stopPropagation(),e.preventDefault())}},{key:"sendMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this._engageform.message=t,Sn.$timeout(function(){e._engageform.message=""},this._engageform.settings.hideMessageAfterDelay)}}]),e}();function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t,n){return(P="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return t&&C(e.prototype,t),n&&C(e,n),e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Undefined=0]="Undefined",e.EndPage="endPage",e.Form="forms",e.MultiChoice="multiChoice",e.PictureChoice="pictureChoice",e.Rateit="rateIt",e.StartPage="startPage",e.Poster="poster",e.SummaryPage="summaryPage"}(m||(m={}));var I=function(){function e(t,n){j(this,e),E(this,"entryRules",void 0),E(this,"exitRules",void 0),E(this,"defaultRule",void 0),E(this,"answers",void 0),this.entryRules=this.processNonDefaultRules(t.rules,g),this.exitRules=this.processNonDefaultRules(t.rules,h),this.defaultRule=Object(o.head)(t.rules.filter(p)),this.answers=n}return S(e,[{key:"hasEntryRules",value:function(){return this.entryRules.length>0}},{key:"hasExitRules",value:function(){return this.exitRules.length>0}},{key:"resolveEntryDestination",value:function(){return this.resolveDestination(this.entryRules)}},{key:"resolveExitDestination",value:function(){return this.resolveDestination(this.exitRules)}},{key:"processNonDefaultRules",value:function(e,t){return e.filter(t).map(this.dropEmptyConditions).filter(this.hasConditions)}},{key:"dropEmptyConditions",value:function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){E(e,t,n[t])})}return e}({},e,{conditions:e.conditions.filter(function(e){return Boolean(e.to)})})}},{key:"hasConditions",value:function(e){return e.conditions.length>0}},{key:"resolveDestination",value:function(e){var t=this;return e.map(function(e){var n=e.destination,r=e.conditionsConnection;return e.conditions.map(function(e){var n=t.answers.get(e.to);if(!n)return!1;switch(function(e){return Boolean(e.field)}(e)&&(n=n[e.field]),e.is){case c.Equal:return n===e.value;case c.NotEqual:return n!==e.value;case c.GreaterThan:return n>e.value;case c.GreaterThanOrEqual:return n>=e.value;case c.LessThan:return n<e.value;case c.LessThanOrEqual:return n<=e.value;case c.Between:return e.value[0]>=n&&n<=e.value[1];case c.Blank:return!Boolean(n);case c.NotBlank:return Boolean(n);case c.Contain:return n.indexOf(e.value)>=0;case c.NotContain:return-1===n.indexOf(e.value);default:return!1}})[r===u.Or?"some":"every"](function(e){return e})?n:null}).filter(Boolean)[0]||this.defaultRule.destination}}]),e}(),x=function(e){function t(e,n){var r,o,i;return j(this,t),o=this,i=O(t).call(this,e),r=!i||"object"!==w(i)&&"function"!=typeof i?k(o):i,E(k(k(r)),"logic",{}),(JSON.parse(n._logic)||[]).forEach(function(e){r.logic[e.questionId]=new I(e,r._engageform.answers)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,v),S(t,null,[{key:"fromEnageformAndData",value:function(e,n){return new t(e,n)}}]),S(t,[{key:"prev",value:function(e){var n=this.visitedPages.pop(),r=this._engageform.getPageIndex(this._engageform.current)-this._engageform.getPageIndex(n);P(O(t.prototype),"prev",this).call(this,e,r)}},{key:"move",value:function(e){var n,r,o=this._engageform.current,i=this.logic[o.id];return(r=this.isPossiblyConditionalPage(o)?i&&i.hasExitRules()?this._engageform.getPageById(i.resolveExitDestination()):this._engageform.getPageByIndex(this.position+1):this._engageform.getPageByIndex(0))&&(r=this.checkEntryConditionForPage(r)),r&&(n=this._engageform.getPageIndex(r)-this._engageform.getPageIndex(o)),P(O(t.prototype),"move",this).call(this,e,n)}},{key:"checkEntryConditionForPage",value:function(e){var t=this.logic[e.id];if(t&&t.hasEntryRules()){var n=t.resolveEntryDestination(),r=this._engageform.getPageById(n);return r?this.checkEntryConditionForPage(r):r}return e}},{key:"isPossiblyConditionalPage",value:function(e){return[m.Form,m.MultiChoice,m.PictureChoice,m.Rateit].includes(e.type)}}]),t}();function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A=function(){var e,t,n;function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.state,n=e.text,o=e.link,i=e.imageUrl,a=arguments.length>1?arguments[1]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),R(this,"_text",void 0),R(this,"_link",void 0),R(this,"_imageUrl",void 0),R(this,"_isCustomLogo",!1),R(this,"_enabled",void 0),R(this,"_custom",void 0),this._custom=a,this._enabled=!t,this._text=r.isTextCustom(n)?n:r.defaultBranding.text,this._link=o||r.defaultBranding.link,r.isImageCustom(i)?(this._imageUrl=i?"".concat(Sn.getConfig("backend").api+Sn.getConfig("backend").imagesUrl,"/").concat(i):"",this._isCustomLogo=!0):this._imageUrl=Sn.config.backend.api+i}return e=r,n=[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new r(e,r.arePropertiesCustom(e))}},{key:"arePropertiesCustom",value:function(e){var t=e.text,n=e.link,o=e.imageUrl;return Boolean(r.isTextCustom(t)||n||r.isImageCustom(o))}},{key:"isTextCustom",value:function(e){return void 0!==e}},{key:"isImageCustom",value:function(e){return void 0!==e&&e!==r.defaultBranding.imageUrl}},{key:"defaultBranding",get:function(){return Sn.getConfig("backend").branding}}],(t=[{key:"isCustom",get:function(){return this._custom}},{key:"isDefault",get:function(){return!this._custom}},{key:"isCustomLogo",get:function(){return this._isCustomLogo}},{key:"imageUrl",get:function(){return this._imageUrl}},{key:"link",get:function(){return this._link}},{key:"text",get:function(){return this._text}},{key:"enabled",get:function(){return this._enabled}}])&&T(e.prototype,t),n&&T(e,n),r}();function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var q=function(){function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r={},(n="_listener")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}var t,n,r;return t=e,(n=[{key:"listen",value:function(e,t){this._listener[e]||(this._listener[e]=[]),this._listener[e].push(t)}},{key:"trigger",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=this._listener[e];o&&o.forEach(function(e){return e.apply(e,n)})}}])&&D(t.prototype,n),r&&D(t,r),e}();function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var B=function(){var e,t,n;function r(e){var t=e.settings.share,n=e.endPages,i=e.startPages,a=e.pages;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),M(this,"globalTitle",void 0),M(this,"globalDescription",void 0),this.globalTitle="",this.globalDescription="",t&&(this.globalTitle=t.title||"",this.globalDescription=t.description||""),(n.length<1||!Object(o.find)(a,{social:!0}))&&i.length&&a[i[0]].title&&(this.globalTitle=a[i[0]].title,this.globalDescription=a[i[0]].description)}return e=r,n=[{key:"fromEngageform",value:function(e){return new r(e)}}],(t=null)&&U(e.prototype,t),n&&U(e,n),r}();function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var N=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$(this,"showResults",!1),$(this,"showCorrectAnswer",!1),$(this,"showMainMedia",!1),$(this,"showDescription",!1),$(this,"requiredAnswer",!1),this.requiredAnswer=!!t.requiredAnswer,t.settings&&(this.showResults=!!t.settings.showAnswers,this.showCorrectAnswer=!!t.settings.showCorrectAnswer,this.showMainMedia=!!t.settings.showMainMedia,this.showDescription=!!t.settings.showDescription)};function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var V=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),L(this,"id",void 0),L(this,"engageform",void 0),L(this,"type",m.Undefined),L(this,"title",""),L(this,"description",""),L(this,"media",""),L(this,"mediaWidth",0),L(this,"mediaHeight",0),L(this,"filled",!1),L(this,"settings",void 0),L(this,"cases",[]),L(this,"result",void 0),this.id=n._id,this.engageform=t,this.settings=new N(n),this.title=n.text||"",this.settings.showDescription&&(this.description=n.description||""),this.settings.showMainMedia&&n.imageData&&(this.media=Sn.cloudinary.prepareImageUrl(n.imageFile,680,n.imageData),this.mediaWidth=680,n.imageData.containerRatio?this.mediaHeight=Math.round(680*n.imageData.containerRatio):this.mediaHeight=Math.round(n.imageData.containerHeight||0))}var t,n,r;return t=e,(n=[{key:"send",value:function(e){if(!1===this.engageform.enabled)return Sn.$q.reject("Engageform already ended.");if(e)return e.send();var t=Sn.$q.defer();return t.resolve(),t.promise}},{key:"sent",value:function(){var e=this,t=Sn.$q.defer(),n={};return n=Sn.localStorage.get("page."+this.id)||{},this.engageform.setAnswer(this.id,n),this.settings.showResults&&n.results?this.getStatsById(this.id).then(function(r){t.resolve(e.refreshAnswer(n,r))}).catch(function(){t.resolve(n)}):t.resolve(n),t.promise}},{key:"refreshAnswer",value:function(e,t){return e}},{key:"selectAnswer",value:function(e){}},{key:"createCase",value:function(e,t){}},{key:"setResults",value:function(e){var t=this.cases.map(function(t){return t.result=Number(e.stats&&e.stats[t.id])||0,t.id});for(var n in e.stats)if(-1===t.indexOf(n)&&"questionId"!==n&&this.type!==m.Rateit){var r=this.createCase({text:"[Removed answer]",_id:n,imageData:{height:100}});r.result=Number(e.stats[r.id]),this.cases.push(r)}}},{key:"updateAnswers",value:function(e){var t=this;this.id===e.questionId&&(this.engageform.current&&!Object(o.isUndefined)(e.avg)&&(this.engageform.current.result=e.avg),Sn.$timeout(function(){t.cases.map(function(t){if(!Object(o.isUndefined)(e[t.id])){var n=t.load();n.results&&(n.results[t.id]=e[t.id],t.save(n)),t.result=e[t.id]||0}})}))}},{key:"getStatsById",value:function(e){var t=Sn.config.backend.domain+Sn.getConfig("engageform").pageStatsUrl;return t=t.replace(":pageId",e),Sn.$http.get(t).then(function(e){return-1!==[200,304].indexOf(e.status)?e.data:Sn.$q.reject(e)})}}])&&F(t.prototype,n),r&&F(t,r),e}();function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}L(V,"Type",m);var J,X=function(e){function t(e,n,r){var i,a,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,i=!(s=W(t).call(this,e,n))||"object"!==z(s)&&"function"!=typeof s?K(a):s,Q(K(K(i)),"type",m.EndPage),Q(K(K(i)),"isCoverPage",!0),Q(K(K(i)),"button",void 0),Q(K(K(i)),"outcome",void 0),Q(K(K(i)),"social",void 0),Q(K(K(i)),"score",void 0),Q(K(K(i)),"rangeMin",void 0),Q(K(K(i)),"rangeMax",void 0),Q(K(K(i)),"exitLink",void 0),Q(K(K(i)),"link",void 0),Q(K(K(i)),"socialData",void 0);var u=Object(o.defaults)({},r.share,{title:"",description:"",link:"",imageUrl:""});return u.imageUrl&&(u.imageUrl=Sn.cloudinary.preparePreviewImageUrl(u.imageUrl,680)),i.socialData=u,n.coverPage&&(i.button=n.coverPage.buttonText,i.outcome=n.coverPage.outcome,i.social=n.coverPage.showSocialShares,i.exitLink=n.coverPage.exitLink,i.link=n.coverPage.link,n.coverPage.scoreRange&&(i.rangeMax=n.coverPage.scoreRange.max,i.rangeMin=n.coverPage.scoreRange.min)),i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(t,V),n=t,(r=[{key:"personalizeShares",value:function(){"outcome"!==this.engageform.typeName&&"score"!==this.engageform.typeName||(this.socialData.title=this.engageform.texts.SCORE_AND_OUTCOME_SHARE.replace(/\$RESULT\$/gi,this.outcome||String(this.score||0)).replace(/\$TITLE\$/gi,this.engageform.title),this.media&&this.settings.showMainMedia&&(this.socialData.imageUrl=this.media))}},{key:"fbLink",get:function(){return Sn.getConfig("backend")&&Sn.getConfig("backend").domain&&Sn.getConfig("share")&&Sn.getConfig("share").facebook&&this.socialData&&this.socialData.title&&this.socialData.description&&this.socialData.imageUrl&&this.engageform&&this.engageform.id?(this.personalizeShares(),Sn.getConfig("backend").domain+Sn.getConfig("share").facebook+"?quizId="+this.engageform.id+"&description="+encodeURIComponent(this.socialData.description)+"&name="+encodeURIComponent(this.socialData.title)+"&image="+this.socialData.imageUrl):null}},{key:"twLink",get:function(){return this.socialData&&this.socialData.title&&this.socialData.link?(this.personalizeShares(),"https://twitter.com/intent/tweet?text="+encodeURIComponent(this.socialData.title)+" "+this.socialData.link+" via @4screens"):null}}])&&G(n.prototype,r),i&&G(n,i),t}();function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Undefined=0]="Undefined",e[e.Image=1]="Image",e[e.Input=2]="Input",e[e.Iteration=3]="Iteration",e[e.Text=4]="Text"}(J||(J={}));var ee=function(){function e(t,n){var r=n._id;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Z(this,"id",void 0),Z(this,"type",J.Undefined),Z(this,"page",void 0),Z(this,"selected",!1),Z(this,"correct",!1),Z(this,"incorrect",!1),Z(this,"result",0),Z(this,"title",void 0),Z(this,"error",void 0),Z(this,"value",void 0),this.page=t,this.id=r}var t,n,r;return t=e,(n=[{key:"shouldShowIndicator",value:function(){return!this.page.engageform.isSummaryMode()&&!this.page.engageform.isResultsMode()&&this.page.settings.showCorrectAnswer&&(this.selected||this.page.filled&&this.correct)}},{key:"shouldShowResults",value:function(){return this.page.engageform.isSummaryMode()||this.page.settings.showResults&&this.page.filled&&!this.page.engageform.isResultsMode()}},{key:"send",value:function(){var e=Sn.$q.defer();return e.resolve({}),e.promise}},{key:"makeSend",value:function(e){var t=this,n=Sn.getConfig("backend").domain+Sn.getConfig("engageform").pageResponseUrl;n=n.replace(":pageId",this.page.id),Sn.mode!==i.Default&&(n+="?preview"),e.quizQuestionId=this.page.id,e.userIdent=Sn.user.sessionId;var r={questionId:this.page.id,questionTitle:this.page.title,answerId:this.id,answerValue:e.inputs&&e.inputs.map(function(e){return e.value})||this.title||this.ordinal};return Sn.$http.post(n,e).then(function(n){return-1!==[200,304].indexOf(n.status)?(!e.userIdent&&n.data.userIdent&&(Sn.user.sessionId=n.data.userIdent),t.page.engageform.event.trigger("answer",r),n.data):Sn.$q.reject(n.data||{})}).catch(function(e){return Sn.$q.reject(e.data||{})})}},{key:"load",value:function(){return Sn.localStorage.get("page."+this.page.id)||{}}},{key:"save",value:function(e){this.page.engageform.setAnswer(this.page.id,e),Sn.localStorage.set("page."+this.page.id,e)}},{key:"validate",value:function(){return!0}}])&&Y(t.prototype,n),r&&Y(t,r),e}();function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(e,t,n){return(re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=oe(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function oe(e){return(oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ue=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=oe(t).call(this,e,n))||"object"!==te(i)&&"function"!=typeof i?ae(o):i,se(ae(ae(r)),"type",J.Input),se(ae(ae(r)),"expectedValue",void 0),se(ae(ae(r)),"value",""),r.title=n.label,r.expectedValue=n.type,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ie(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this,n={inputs:[]},r=this.load();for(var o in r)r.hasOwnProperty(o)&&n.inputs.push({_id:o,value:r[o]});return re(oe(t.prototype),"makeSend",this).call(this,n).then(function(){return n}).catch(function(t){return 406===t.code&&(t.textKey="INCORRECT_INPUT",t.message="Incorrect inputs sent. Try again.",e.save({})),Sn.$q.reject(t)})}},{key:"validate",value:function(){if(this.correct=!1,this.incorrect=!1,this.page.settings.requiredAnswer&&!this.value?(this.error="Answer is required",this.incorrect=!0):(this.error="",this.correct=!0),this.correct){var e=this.load();return e[this.id]=this.value,this.save(e),!0}return!1}}])&&ne(n.prototype,r),o&&ne(n,o),t}();function ce(e){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fe(e,t){return!t||"object"!==ce(t)&&"function"!=typeof t?pe(e):t}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function he(e,t){return(he=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var de=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ye(pe(pe(r=fe(this,ge(t).call(this,e,n)))),"type",m.Form),ye(pe(pe(r)),"count",0),n.forms?(r.cases=n.forms.inputs.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):fe(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&he(e,t)}(t,V),n=t,(r=[{key:"createCase",value:function(e){return new ue(this,e)}},{key:"send",value:function(e){var t=Sn.$q.defer(),n=!0;return this.cases.map(function(e){e.validate()||(n=!1)}),n?(this.filled=!0,this.engageform.sendAnswerCallback(this.engageform.title||this.engageform.id,this.engageform.current?this.engageform.current.title||this.engageform.current.id:null,this.cases[0]),t.resolve(this.cases[0].send())):(this.filled=!1,t.resolve({})),t.promise}},{key:"selectAnswer",value:function(e){this.cases.map(function(t){t.value=e[t.id]||"",e.inputs&&e.inputs.forEach(function(e){e._id===t.id&&(t.value=e.value)})})}},{key:"setResults",value:function(e){this.count=e.count||0}}])&&le(n.prototype,r),o&&le(n,o),t}();function be(e){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ve(e,t,n){return(ve="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=we(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function we(e){return(we=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pe(e,t){return(Pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Oe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var _e=function(e){function t(e,n){var r,o,i,a,s,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=we(t).call(this,e,n))||"object"!==be(i)&&"function"!=typeof i?Oe(o):i,a=Oe(Oe(r)),s="type",u=J.Text,s in a?Object.defineProperty(a,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[s]=u,r.title=n.text,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pe(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?Sn.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"}):ve(we(t.prototype),"makeSend",this).call(this,{selectedAnswerId:this.id}).then(function(n){var r={};for(var o in n.selectedAnswerId&&(r.selectedCaseId=n.selectedAnswerId),n.correctAnswerId&&(r.correctCaseId=n.correctAnswerId),n.stats)n.stats.hasOwnProperty(o)&&(r.results=r.results||{},/.{24}/.test(o)&&(r.results[o]=n.stats[o]));return ve(we(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&me(n.prototype,r),o&&me(n,o),t}();function ke(e){return(ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ce(e,t){return!t||"object"!==ke(t)&&"function"!=typeof t?Ie(e):t}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ee(e,t){return(Ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ie(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var xe=function(e){function t(e,n){var r,o,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=Ce(this,Se(t).call(this,e,n)),o=Ie(Ie(r)),i="type",a=m.MultiChoice,i in o?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a,n.answers?(r.cases=n.answers.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):Ce(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ee(e,t)}(t,V),n=t,(r=[{key:"createCase",value:function(e){return new _e(this,e)}},{key:"refreshAnswer",value:function(e,t){return t.answers.map(function(t){e.results&&(e.results[t._id]=t.percent)}),e}},{key:"selectAnswer",value:function(e){var t=this;this.cases.map(function(n){n.selected=!1,n.correct=!1,n.incorrect=!1,n.id===e.selectedCaseId&&(t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n),t.filled=!0,n.selected=!0),e.results&&(n.result=e.results[n.id]||0),n.id===e.correctCaseId?n.correct=!0:n.incorrect=!0})}}])&&je(n.prototype,r),o&&je(n,o),t}();function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(e,t,n){return(Ae="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=De(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function De(e){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qe(e,t){return(qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ue(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Be=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=De(t).call(this,e,n))||"object"!==Te(i)&&"function"!=typeof i?Ue(o):i,Me(Ue(Ue(r)),"type",J.Image),Me(Ue(Ue(r)),"media",void 0),Me(Ue(Ue(r)),"mediaWidth",void 0),Me(Ue(Ue(r)),"mediaHeight",void 0),r.title=n.text,r.media=Sn.cloudinary.prepareImageUrl(n.imageFile,t.mediaWidth,n.imageData),r.mediaWidth=t.mediaWidth,n.imageData&&n.imageData.containerRatio?r.mediaHeight=Math.round(t.mediaWidth*n.imageData.containerRatio):r.mediaHeight=Math.round(n.imageData.containerHeight||0),r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qe(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?Sn.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"}):Ae(De(t.prototype),"makeSend",this).call(this,{selectedAnswerId:this.id}).then(function(n){var r={selectedCaseId:n.selectedAnswerId,correctCaseId:n.correctAnswerId};for(var o in n.stats)n.stats.hasOwnProperty(o)&&(r.results=r.results||{},/.{24}/.test(o)&&(r.results[o]=n.stats[o]));return Ae(De(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&Re(n.prototype,r),o&&Re(n,o),t}();function $e(e){return($e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Fe(e,t){return!t||"object"!==$e(t)&&"function"!=typeof t?ze(e):t}function Le(e){return(Le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ve(e,t){return(Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ze(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Me(Be,"mediaWidth",300);var Ge=function(e){function t(e,n){var r,o,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=Fe(this,Le(t).call(this,e,n)),o=ze(ze(r)),i="type",a=m.PictureChoice,i in o?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a,n.answers?(r.cases=n.answers.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):Fe(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ve(e,t)}(t,V),n=t,(r=[{key:"createCase",value:function(e){return new Be(this,e)}},{key:"refreshAnswer",value:function(e,t){return t.answers.map(function(t){e.results&&(e.results[t._id]=t.percent)}),e}},{key:"selectAnswer",value:function(e){var t=this;this.cases.map(function(n){n.selected=!1,n.correct=!1,n.incorrect=!1,n.id===e.selectedCaseId&&(t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n),t.filled=!0,n.selected=!0),e.results&&(n.result=e.results[n.id]||0),n.id===e.correctCaseId?n.correct=!0:n.incorrect=!0})}}])&&Ne(n.prototype,r),o&&Ne(n,o),t}();function We(e){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function He(e){return(He=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ke(e,t){return(Ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Xe=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=He(t).call(this,e,n))||"object"!==We(i)&&"function"!=typeof i?Qe(o):i,Je(Qe(Qe(r)),"type",m.Poster),Je(Qe(Qe(r)),"button",void 0),Je(Qe(Qe(r)),"exitLink",void 0),Je(Qe(Qe(r)),"link",void 0),n.coverPage&&(r.button=n.coverPage.buttonText,r.exitLink=n.coverPage.exitLink,r.link=n.coverPage.link),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ke(e,t)}(t,V),t}();function Ye(e){return(Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function et(e,t,n){return(et="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=tt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function tt(e){return(tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nt(e,t){return(nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function rt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ot(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var it=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=tt(t).call(this,e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ot(e,t,n[t])})}return e}({},n,{_id:""})))||"object"!==Ye(i)&&"function"!=typeof i?rt(o):i,ot(rt(rt(r)),"type",J.Iteration),ot(rt(rt(r)),"symbol",void 0),ot(rt(rt(r)),"ordinal",void 0),r.ordinal=n.ordinal,r.symbol=n.symbol,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nt(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?Sn.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"}):et(tt(t.prototype),"makeSend",this).call(this,{quizQuestionId:this.page.id,rateItValue:this.ordinal}).then(function(n){var r={};return n.selectedValue&&(r.selectedValue=n.selectedValue),n.avgRateItValue&&(r.result=+n.avgRateItValue),et(tt(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&Ze(n.prototype,r),o&&Ze(n,o),t}();function at(e){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function st(e){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ut(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ct(e,t,n){return t&&ut(e.prototype,t),n&&ut(e,n),e}function lt(e,t){return(lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ft(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ht=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,i=st(t).call(this,e,n),r=!i||"object"!==at(i)&&"function"!=typeof i?ft(o):i,gt(ft(ft(r)),"type",m.Rateit),gt(ft(ft(r)),"result",0),gt(ft(ft(r)),"labelMin",void 0),gt(ft(ft(r)),"labelMax",void 0),gt(ft(ft(r)),"selectedValue",0),r.labelMin=n.rateIt.minLabel,r.labelMax=n.rateIt.maxLabel,r.cases=Array.apply(null,Array(n.rateIt.maxRateItValue)).map(function(e,t){return r.createCase(t+1,n.rateIt.rateType)}),r.sent().then(function(e){e.selectedValue&&(r.selectedValue=e.selectedValue,r.selectAnswer(e))}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lt(e,t)}(t,V),ct(t,[{key:"shouldShowResults",value:function(){return this.settings.showResults&&this.result>0}}]),ct(t,[{key:"createCase",value:function(e,t){return new it(this,{ordinal:e,symbol:t})}},{key:"selectAnswer",value:function(e){var t=this;e.selectedValue&&(this.filled=!0,this.selectedValue=e.selectedValue),e.result&&(this.result=e.result),this.cases.map(function(n){n.selected=e.selectedValue>=n.ordinal,e.selectedValue===n.ordinal&&t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n)})}},{key:"setResults",value:function(e){this.result=e.average||0,this.selectedValue=e.average||0}}]),t}();function pt(e){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yt(e){return(yt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dt(e,t){return(dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var vt=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=yt(t).call(this,e,n))||"object"!==pt(i)&&"function"!=typeof i?bt(o):i,mt(bt(bt(r)),"type",m.StartPage),mt(bt(bt(r)),"isCoverPage",!0),mt(bt(bt(r)),"button",void 0),n.coverPage&&void 0!==n.coverPage.buttonText&&(r.button=n.coverPage.buttonText),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dt(e,t)}(t,V),t}();function wt(e){return(wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pt(e){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ot(e,t){return(Ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var jt=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=Pt(t).call(this,e,n))||"object"!==wt(i)&&"function"!=typeof i?_t(o):i,kt(_t(_t(r)),"type",m.SummaryPage),kt(_t(_t(r)),"stats",void 0),n.text?r.title=n.text:e.type===a.Outcome?r.title="Outcomes":r.title="Scores",r.stats=n.stats,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ot(e,t)}(t,V),t}();function Ct(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var St=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ct(this,"allowAnswerChange",!1),Ct(this,"hideMessageAfterDelay",3e3),Ct(this,"share",void 0),Ct(this,"tracking",void 0),t.settings&&(this.allowAnswerChange=!!t.settings.allowAnswerChange,this.tracking=t.settings.tracking,t.settings.hideMessageAfterDelay&&(this.hideMessageAfterDelay=t.settings.hideMessageAfterDelay),t.settings.share&&(this.share=t.settings.share,!this.share.imageUrl&&Sn.getConfig("share")&&Sn.getConfig("share").defaultImgUrl&&(this.share.imageUrl=Sn.getConfig("share").defaultImgUrl)))};function Et(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var It=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Et(this,"liveTitle","Live"),Et(this,"chatTitle","Chat"),Et(this,"logoUrl",""),Et(this,"headerText",""),t.tabs&&(t.tabs.liveTitle&&(this.liveTitle=t.tabs.liveTitle),t.tabs.chatTitle&&(this.chatTitle=t.tabs.chatTitle),t.tabs.logoUrl&&(this.logoUrl=Sn.getConfig("backend").api+Sn.getConfig("backend").imagesUrl+"/"+t.tabs.logoUrl),t.tabs.headerText&&(this.headerText=t.tabs.headerText))};function xt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Tt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Rt=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Tt(this,"answerBackgroundColor",""),Tt(this,"answerBorderColor",""),Tt(this,"answerColor",""),Tt(this,"backgroundBrightness",""),Tt(this,"backgroundColor",""),Tt(this,"backgroundImageBlur",""),Tt(this,"backgroundImageFile",""),Tt(this,"backgroundImagePosition",""),Tt(this,"buttonColor",""),Tt(this,"font",""),Tt(this,"questionColor",""),Tt(this,"customThemeCssFile",""),Tt(this,"backgroundImageConvertedFile",""),Tt(this,"tabBorderColor",""),Tt(this,"tabFontColor",""),Tt(this,"tabColor",""),Tt(this,"embedSettings",void 0),this.embedSettings=n,t.theme&&(this.answerBackgroundColor=t.theme.answerBackgroundColor||"",this.answerBorderColor=t.theme.answerBorderColor||"",this.answerColor=t.theme.answerColor||"",this.backgroundBrightness=t.theme.backgroundBrightness||"",this.backgroundColor=t.theme.backgroundColor||"",this.backgroundImageBlur=t.theme.backgroundImageBlur||"",this.backgroundImageFile=t.theme.backgroundImageFile||"",this.backgroundImagePosition=t.theme.backgroundImagePosition||"",this.buttonColor=t.theme.buttonColor||"",this.font=t.theme.font||"",this.questionColor=t.theme.questionColor||"",this.tabColor=t.theme.tabColor||"",this.tabFontColor=t.theme.tabFontColor||"",this.tabBorderColor=t.theme.tabBorderColor||"",t.theme.customThemeCssFile&&(this.customThemeCssFile=Sn.config.backend.api+"/uploads/"+t.theme.customThemeCssFile),t.theme.backgroundImageFile&&this.convertBackgroundImage())}var t,n,r;return t=e,(n=[{key:"convertBackgroundImage",value:function(){this.backgroundImageConvertedFile=Sn.cloudinary.prepareBackgroundImageUrl(this.backgroundImageFile,window.innerWidth,"auto"===this.embedSettings.height?null:window.innerHeight,parseInt(this.backgroundImageBlur,10),this.backgroundImagePosition)}}])&&xt(t.prototype,n),r&&xt(t,r),e}();function At(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Dt(e,t,n){return t&&At(e.prototype,t),n&&At(e,n),e}function qt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ut=function(){function e(t,n,r,o){var i=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),qt(this,"_engageformId",void 0),qt(this,"_pages",{}),qt(this,"_startPages",[]),qt(this,"_endPages",[]),qt(this,"_availablePages",[]),qt(this,"_hasForms",!1),qt(this,"sendAnswerCallback",void 0),qt(this,"enabled",!0),qt(this,"type",a.Undefined),qt(this,"title",void 0),qt(this,"message",void 0),qt(this,"settings",void 0),qt(this,"theme",void 0),qt(this,"branding",void 0),qt(this,"tabs",void 0),qt(this,"themeType",void 0),qt(this,"embedSettings",void 0),qt(this,"texts",void 0),qt(this,"current",void 0),qt(this,"navigation",void 0),qt(this,"meta",void 0),qt(this,"answers",new Map),qt(this,"event",void 0),qt(this,"mode",void 0),qt(this,"showGoogleAds",void 0),this._engageformId=t._id,this.mode=n,this.embedSettings=o,this.sendAnswerCallback=s,this.title=t.title,this.settings=new St(t),this.theme=new Rt(t,o),this.tabs=new It(t),this.texts=t.texts,this.themeType=this.getThemeType(t.theme.backgroundColor),this.event=new q,this.branding=A.create(t.settings&&t.settings.branding),this.showGoogleAds=t.showGoogleAds;var u=this.buildPages(r||[],this.settings);u.forEach(function(e){return i.storePage(e)}),this._hasForms=u.some(function(e){return e.type===m.Form});var c=t._logic&&"[]"!==t._logic;this.navigation=c?x.fromEnageformAndData(this,t):v.fromEnageform(this),this.meta=B.fromEngageform(this)}return Dt(e,[{key:"getPageById",value:function(e){return this.pages[e]}},{key:"getPageByIndex",value:function(e){return this.pages[this.availablePages[e]]}},{key:"getPageIndex",value:function(e){return this.availablePages.indexOf(e.id)}},{key:"isType",value:function(e){return this.type===e}},{key:"isNormalMode",value:function(){return Boolean(this.mode===i.Default||this.mode===i.Preview)}},{key:"isSummaryMode",value:function(){return Boolean(this.mode===i.Summary)}},{key:"isResultsMode",value:function(){return Boolean(this.mode===i.Result)}},{key:"isPreviewMode",value:function(){return Boolean(this.mode===i.Preview)}},{key:"id",get:function(){return this._engageformId}},{key:"pages",get:function(){return this._pages}},{key:"startPages",get:function(){return this._startPages}},{key:"endPages",get:function(){return this._endPages}},{key:"availablePages",get:function(){return this._availablePages}},{key:"typeName",get:function(){return a[this.type].toLowerCase()}},{key:"hasForms",get:function(){return this._hasForms}}]),Dt(e,[{key:"setUserIdent",value:function(e){Sn.user.sessionId=e}},{key:"getUserIdent",value:function(e){return Sn.user.sessionId}},{key:"storePage",value:function(e){return e.type===m.StartPage?this.isNormalMode()&&this._startPages.push(e.id):e.type===m.EndPage?this.isNormalMode()&&this._endPages.push(e.id):this._availablePages.push(e.id),this._pages[e.id]=e,e}},{key:"initPage",value:function(e){return this.storePage(this.buildPages([e],this.settings)[0]),this.setCurrent(e._id)}},{key:"setCurrent",value:function(e){var t=this._pages[e];return this.current=t,t}},{key:"setCurrentEndPage",value:function(){var e=Sn.config.backend.domain+Sn.getConfig("engageform").engageformFinishUrl;return e=e.replace(":engageformId",this._engageformId),Sn.mode!==i.Default&&(e+="?preview"),Sn.$http.post(e,{userIdent:Sn.user.sessionId,globalUserIdent:Sn.user.id}).then(function(e){return-1!==[200,304].indexOf(e.status)?(Sn.localStorage.clearAll(),Sn.user.id=e.data.globalUserIdent,e.data):Sn.$q.reject(e)})}},{key:"cleanPages",value:function(){this._availablePages.length=0,this._pages={}}},{key:"buildPages",value:function(e,t){var n=this;return e.map(function(e){return n.createPage(e,t)}).filter(function(e){return Boolean(e)})}},{key:"createPage",value:function(e,t){switch(e.type){case m.EndPage:return new X(this,e,t);case m.Form:return new de(this,e);case m.MultiChoice:return new xe(this,e);case m.PictureChoice:return new Ge(this,e);case m.Rateit:return new ht(this,e);case m.StartPage:return new vt(this,e);case m.Poster:return new Xe(this,e);default:throw new Error("Trying to construct an unknown page.")}}},{key:"setSummary",value:function(e){var t=this;e.forEach(function(e){e.stats&&t._pages[e.stats.questionId]&&t._pages[e.stats.questionId].setResults(e)})}},{key:"setAnswers",value:function(e){var t=e.questions;for(var n in t)if(this._pages[n]){var r=t[n];this._pages[n].selectAnswer({selectedCaseId:r.selectedAnswerId,inputs:r.inputs,selectedValue:r.rateItValue})}}},{key:"setResultPage",value:function(e){var t={_id:"summaryPage",type:m.SummaryPage,settings:{showCorrectAnswer:!0},stats:e},n=new jt(this,t);this.storePage(n)}},{key:"setUserResultPage",value:function(e){var t={_id:"RESULT_PAGE",type:"summaryPage",settings:{}};"outcome"===e.type?Object(o.extend)(t,{text:"User's outcome: "+e.outcome}):Object(o.extend)(t,{text:"User's score: "+e.score+" / "+e.maxScore});var n=new jt(this,t);this.storePage(n)}},{key:"setAnswer",value:function(e,t){var n=Object(o.get)(t,"selectedCaseId")||Object(o.get)(t,"selectedValue")||t;this.answers.set(e,n)}},{key:"getThemeType",value:function(e){var t=this.colorToRgb(e);return.299*t.red+.587*t.green+.114*t.blue>186?"light":"dark"}},{key:"colorToRgb",value:function(e){var t;if("#"===e[0])e=e.substr(1);else{var n=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);e=n&&4===n.length?("0"+parseInt(n[1],10).toString(16)).slice(-2)+("0"+parseInt(n[2],10).toString(16)).slice(-2)+("0"+parseInt(n[3],10).toString(16)).slice(-2):""}if(3===e.length){var r=e;e="",r=(r=/^([a-f0-9])([a-f0-9])([a-f0-9])$/i.exec(r)).slice(1);for(var o=0;o<3;o++)e+=r[o]+r[o]}if(!(t=/^([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i.exec(e)))throw new Error("Invalid color.");return t=t.slice(1),{red:parseInt(t[0],16),green:parseInt(t[1],16),blue:parseInt(t[2],16)}}}]),e}();function Mt(e){return(Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $t(e,t,n){return($t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Nt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Nt(e){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ft(e,t){return(Ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Vt=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=Nt(t)).call.apply(e,[this].concat(l)))||"object"!==Mt(o)&&"function"!=typeof o?Lt(r):o,i=Lt(Lt(n)),s="type",u=a.Live,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ft(e,t)}(t,Ut),n=t,(r=[{key:"initPages",value:function(){var e=Sn.$q.defer();return e.resolve(this),e.promise}},{key:"initPage",value:function(e){return this.cleanPages(),$t(Nt(t.prototype),"initPage",this).call(this,e)}},{key:"setCurrentEndPage",value:function(){var e=Sn.$q.defer();return e.resolve(),e.promise}}])&&Bt(n.prototype,r),o&&Bt(n,o),t}();function zt(e){return(zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wt(e,t,n){return(Wt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ht(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Ht(e){return(Ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kt(e,t){return(Kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Jt=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=Ht(t)).call.apply(e,[this].concat(l)))||"object"!==zt(o)&&"function"!=typeof o?Qt(r):o,i=Qt(Qt(n)),s="type",u=a.Outcome,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kt(e,t)}(t,Ut),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return Wt(Ht(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){var n=!1;return e.endPages.map(function(r){e.pages[r].outcome===t.outcome&&(n=!0,e.setCurrent(r))}),n||(e.enabled=!1,e.message="Thank you!"),t})}}])&&Gt(n.prototype,r),o&&Gt(n,o),t}();function Xt(e){return(Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zt(e,t,n){return(Zt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=en(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function en(e){return(en=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tn(e,t){return(tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var rn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=en(t)).call.apply(e,[this].concat(l)))||"object"!==Xt(o)&&"function"!=typeof o?nn(r):o,i=nn(nn(n)),s="type",u=a.Poll,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tn(e,t)}(t,Ut),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return Zt(en(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){return e.endPages.length?e.setCurrent(e.endPages[0]):(e.enabled=!1,e.message="Thank you!"),t})}}])&&Yt(n.prototype,r),o&&Yt(n,o),t}();function on(e){return(on="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function an(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function sn(e,t,n){return(sn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=un(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function un(e){return(un=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function cn(e,t){return(cn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ln(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var fn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=un(t)).call.apply(e,[this].concat(l)))||"object"!==on(o)&&"function"!=typeof o?ln(r):o,i=ln(ln(n)),s="type",u=a.Score,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cn(e,t)}(t,Ut),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return sn(un(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){var n=100,r=!1;return t.maxScore>0&&(n=Math.round(t.totalScore/t.maxScore*100)),e.endPages.map(function(t){var o=e.pages[t],i=o.rangeMin,a=void 0===i?0:i,s=o.rangeMax;a<=n&&(void 0===s?0:s)>=n&&(r=!0,o.score=n,e.setCurrent(t))}),r||(e.enabled=!1,e.message="Thank you!"),t})}}])&&an(n.prototype,r),o&&an(n,o),t}();function gn(e){return(gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pn(e,t,n){return(pn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=yn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function yn(e){return(yn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dn(e,t){return(dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var mn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=yn(t)).call.apply(e,[this].concat(l)))||"object"!==gn(o)&&"function"!=typeof o?bn(r):o,i=bn(bn(n)),s="type",u=a.Survey,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dn(e,t)}(t,Ut),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return pn(yn(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){return e.endPages.length?e.setCurrent(e.endPages[0]):(e.enabled=!1,e.message="Thank you!"),t})}}])&&hn(n.prototype,r),o&&hn(n,o),t}();function vn(e,t){return Object(o.includes)(Object(o.values)(e),t)}function wn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var On=function(){var e,t,n;function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),Pn(this,"_id",null),Pn(this,"_sessionId",null)}return e=r,n=[{key:"create",value:function(){return new r}}],(t=[{key:"id",get:function(){return this._id||(this._id=Sn.localStorage.get(r.idKey)),this._id},set:function(e){Sn.localStorage.set(r.idKey,e),this._id=e}},{key:"sessionId",get:function(){return this._sessionId||(this._sessionId=Sn.localStorage.get(r.sessionIdKey)),this._sessionId},set:function(e){Sn.localStorage.set(r.sessionIdKey,e),this._sessionId=e}}])&&wn(e.prototype,t),n&&wn(e,n),r}();function _n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function kn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function jn(e,t,n){return t&&kn(e.prototype,t),n&&kn(e,n),e}function Cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Pn(On,"idKey","userIdent"),Pn(On,"sessionIdKey","sessionIdent"),n.d(t,"default",function(){return Sn});var Sn=function(){function e(t,n,r,o,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Cn(this,"_engageform",void 0),Cn(this,"_event",void 0),e.$http=t,e.$q=n,e.$timeout=r,e.cloudinary=o,e.localStorage=i,e.config=a,this._event=new q,e.cloudinary.setConfig(a.cloudinary)}return jn(e,null,[{key:"getConfig",value:function(t){return e.config[t]}}]),jn(e,[{key:"init",value:function(t){var n=this,a=Object(o.defaults)({},t,{mode:i.Default});if(!a||!a.id)return e.$q.reject({status:"error",error:{code:406,message:"The required id property does not exist."},data:a});if(e._instances[a.id])return e._instances[a.id];if(!vn(i,a.mode))return e.$q.reject({status:"error",error:{code:406,message:"Mode property not supported."},data:a});e.mode=a.mode;var s=[e.getData("quiz",a.id),a.live?e.$q.resolve([]):e.getData("pages",a.id)];return e.$q.all(s).then(function(t){var o=_n(t,2),i=o[0],s=o[1];return vn(r,i.type)?(n._engageform=new e.quizzesConstructors[i.type](i,e.mode,s,a.embedSettings,a.callback?a.callback.sendAnswerCallback:function(){}),n._engageform):e.$q.reject({status:"error",error:{code:406,message:"Type property not supported."},data:i})})}},{key:"destroyInstances",value:function(){e._instances={}}},{key:"type",get:function(){return this._engageform?this._engageform.type:a.Undefined}},{key:"Type",get:function(){return a}},{key:"mode",get:function(){return e.mode}},{key:"Mode",get:function(){return i}},{key:"title",get:function(){if(this._engageform)return this._engageform.title}},{key:"theme",get:function(){if(this._engageform)return this._engageform.theme}},{key:"current",get:function(){if(this._engageform)return this._engageform.current}},{key:"navigation",get:function(){if(this._engageform)return this._engageform.navigation}},{key:"branding",get:function(){if(this._engageform)return this._engageform.branding}},{key:"message",get:function(){if(this._engageform)return this._engageform.message}},{key:"meta",get:function(){if(this._engageform)return this._engageform.meta}},{key:"event",get:function(){if(this._event)return this._event}},{key:"showGoogleAds",get:function(){return!!this._engageform&&this._engageform.showGoogleAds}}],[{key:"getData",value:function(t,n){if("quiz"!==t&&"pages"!==t)throw new Error("Resource path for ".concat(t," type of data is unknown."));var r=e.getConfig("backend").domain+("quiz"===t?e.getConfig("engageform").engageformUrl:e.getConfig("engageform").engageformPagesUrl);return r=r.replace(":engageformId",n),e.mode!==i.Default&&(r+="?preview"),e.$http.get(r).then(function(t){return-1!==[200,304].indexOf(t.status)?(console.log(JSON.stringify(t.data)),t.data):e.$q.reject(t)})}}]),e}();Cn(Sn,"user",On.create()),Cn(Sn,"$http",void 0),Cn(Sn,"$q",void 0),Cn(Sn,"$timeout",void 0),Cn(Sn,"cloudinary",void 0),Cn(Sn,"localStorage",void 0),Cn(Sn,"config",void 0),Cn(Sn,"mode",i.Undefined),Cn(Sn,"_instances",{}),Cn(Sn,"quizzesConstructors",{outcome:Jt,poll:rn,score:fn,survey:mn,live:Vt}),Sn.$inject=["$http","$q","$timeout","cloudinary","localStorageService","ApiConfig"],f.service("Engageform",Sn)}]);
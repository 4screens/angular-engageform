!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=_},function(e,t){e.exports=angular},function(e,t,n){"use strict";n.r(t);var r,o=n(0);!function(e){e.Outcome="outcome",e.Poll="poll",e.Score="score",e.Survey="survey",e.Live="live"}(r||(r={}));var i,a,s,u,c,l=n(1),f=n.n(l).a.module("4screens.engageform",["4screens.util.cloudinary","LocalStorageModule"]);!function(e){e.Undefined="undefined",e.Default="default",e.Preview="preview",e.Result="results",e.Summary="summary"}(i||(i={})),function(e){e[e.Undefined=0]="Undefined",e[e.Live=1]="Live",e[e.Outcome=2]="Outcome",e[e.Poll=3]="Poll",e[e.Score=4]="Score",e[e.Survey=5]="Survey"}(a||(a={})),function(e){e.Default="default",e.Entry="entry",e.Exit="exit"}(s||(s={})),function(e){e.And="and",e.Or="or"}(u||(u={})),function(e){e.Equal="eq",e.NotEqual="neq",e.Blank="blank",e.NotBlank="nblank",e.GreaterThan="gt",e.GreaterThanOrEqual="gte",e.LessThan="lt",e.LessThanOrEqual="lte",e.Between="between",e.Contain="contain",e.NotContain="ncontain"}(c||(c={}));var g=function(e){return e.type===s.Entry},h=function(e){return e.type===s.Exit},p=function(e){return e.type===s.Default};function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&y(e.prototype,t),n&&y(e,n),e}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m,v,w=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),b(this,"_engageform",void 0),b(this,"visitedPages",[]),b(this,"enabled",!1),b(this,"position",0),b(this,"size",0),b(this,"hasStart",!1),b(this,"enabledStart",!0),b(this,"hasPrev",!1),b(this,"enabledPrev",!0),b(this,"hasNext",!1),b(this,"enabledNext",!0),b(this,"hasFinish",!1),b(this,"enabledFinish",!0),b(this,"distance",0),b(this,"animate","swipeNext"),b(this,"hasStartPages",!1),b(this,"hasEndPages",!1),b(this,"waitingForPageChange",null),b(this,"next",this.pick),b(this,"finish",this.pick),this._engageform=t,this.size=t.availablePages.length,this.hasEndPages=Boolean(t.endPages.length),t.startPages.length?(this.hasStart=!0,this.hasStartPages=!0,this._engageform.setCurrent(t.startPages[0])):(this.enabled=!0,this.move(),this.hasPrev=!1)}return d(e,null,[{key:"fromEnageform",value:function(t){return new e(t)}}]),d(e,[{key:"updateDistance",value:function(){return this.distance=this.position/this.size}},{key:"start",value:function(e){this.disableDefaultAction(e),this.animate="swipeNext",this.enabled=!0,this.hasStart=!1,this.move(),this.hasPrev=!0}},{key:"stopPageChange",value:function(){this.waitingForPageChange&&En.$timeout.cancel(this.waitingForPageChange)}},{key:"prev",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.disableDefaultAction(e),this.stopPageChange(),this.animate="swipePrev",this._engageform.current&&(this._engageform.message=""),this.position-=t,this.updateDistance(),this.hasNext=!0,this.hasFinish=!1,0===this.position?(this._engageform.setCurrent(this._engageform.startPages[0]),this.hasPrev=!1):(this._engageform.setCurrent(this._engageform.availablePages[this.position-1]),this.hasPrev=1!==this.position||this.hasStartPages)}},{key:"pick",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{quiet:!1};if(this.disableDefaultAction(e),this.stopPageChange(),this.animate="swipeNext",!this._engageform.isNormalMode()){var o=En.$q.defer();return o.resolve(t),this.move(t),o.promise}var i=this._engageform.current;return!t||!this._engageform.settings.allowAnswerChange&&i.filled||(t.selected=!0,t.incorrect=!1),i.send(t).then(function(){if(n.sendMessage(),!i.filled&&i.settings.requiredAnswer)return r.quiet||n.sendMessage(n._engageform.texts.ANSWER_REQUIRED_TO_PROCEED),t;var e=t?i.settings.showCorrectAnswer||i.settings.showResults?1e3:200:0;return n.waitingForPageChange=En.$timeout(function(){return n.waitingForPageChange=null,n.move(t),t},e),n.waitingForPageChange}).catch(function(e){return r.quiet||n.sendMessage(n._engageform.texts[e.textKey]||e.message),e})}},{key:"move",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._engageform.event.trigger("form::pageWillChange",{isStartPage:Boolean(0===this.position&&this._engageform.startPages.length)}),this.visitedPages.push(this._engageform.current),this.position+=n,this._engageform.availablePages.length>=this.position?(this.updateDistance(),this._engageform.setCurrent(this._engageform.availablePages[this.position-1]),this.hasPrev=!0,this.hasNext=!1,this.hasFinish=!1,this._engageform.availablePages.length>this.position?this.hasNext=!0:this._engageform.availablePages.length===this.position&&(this.hasFinish=this._engageform.isNormalMode()&&!(this._engageform.isType(a.Poll)&&!this._engageform.hasForms)),this._engageform.event.trigger("form::pageDidChange",{currentPosition:this.position,isEndPage:!1})):(this.position=this._engageform.availablePages.length,e||this._engageform.setCurrentEndPage().then(function(e){t._engageform.type!==a.Score&&t._engageform.type!==a.Outcome||t._engageform.event.trigger("finish",e.totalScore||e.outcome,e.maxScore),t.enabled=!1,t.hasPrev=!1,t.hasNext=!1,t.hasFinish=!1,t._engageform.event.trigger("form::pageDidChange",{currentPosition:t.position,isEndPage:!0})}).catch(function(e){e.data.msg&&t.sendMessage(e.data.msg)}))}},{key:"disableDefaultAction",value:function(e){e&&(e.stopPropagation(),e.preventDefault())}},{key:"sendMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this._engageform.message=t,En.$timeout(function(){e._engageform.message=""},this._engageform.settings.hideMessageAfterDelay)}}]),e}();function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t,n){return(O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t,n){return t&&S(e.prototype,t),n&&S(e,n),e}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Undefined=0]="Undefined",e.EndPage="endPage",e.Form="forms",e.MultiChoice="multiChoice",e.PictureChoice="pictureChoice",e.Rateit="rateIt",e.StartPage="startPage",e.Poster="poster",e.SummaryPage="summaryPage"}(m||(m={})),function(e){e[e.Undefined=0]="Undefined",e.endPage="EndPage",e.forms="Form",e.multiChoice="MultiChoice",e.pictureChoice="PictureChoice",e.rateIt="Rateit",e.startPage="StartPage",e.poster="Poster",e.summaryPage="SummaryPage"}(v||(v={}));var x=function(){function e(t,n){C(this,e),I(this,"entryRules",void 0),I(this,"exitRules",void 0),I(this,"defaultRule",void 0),I(this,"answers",void 0),this.entryRules=this.processNonDefaultRules(t.rules,g),this.exitRules=this.processNonDefaultRules(t.rules,h),this.defaultRule=Object(o.head)(t.rules.filter(p)),this.answers=n}return E(e,[{key:"hasEntryRules",value:function(){return this.entryRules.length>0}},{key:"hasExitRules",value:function(){return this.exitRules.length>0}},{key:"resolveEntryDestination",value:function(){return this.resolveDestination(this.entryRules)}},{key:"resolveExitDestination",value:function(){return this.resolveDestination(this.exitRules)}},{key:"processNonDefaultRules",value:function(e,t){return e.filter(t).map(this.dropEmptyConditions).filter(this.hasConditions)}},{key:"dropEmptyConditions",value:function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){I(e,t,n[t])})}return e}({},e,{conditions:e.conditions.filter(function(e){return Boolean(e.to)})})}},{key:"hasConditions",value:function(e){return e.conditions.length>0}},{key:"resolveDestination",value:function(e){var t=this;return e.map(function(e){var n=e.destination,r=e.conditionsConnection;return e.conditions.map(function(e){var n=t.answers.get(e.to);if(!n)return!1;switch(function(e){return Boolean(e.field)}(e)&&(n=n[e.field]),e.is){case c.Equal:return n===e.value;case c.NotEqual:return n!==e.value;case c.GreaterThan:return n>e.value;case c.GreaterThanOrEqual:return n>=e.value;case c.LessThan:return n<e.value;case c.LessThanOrEqual:return n<=e.value;case c.Between:return e.value[0]>=n&&n<=e.value[1];case c.Blank:return!Boolean(n);case c.NotBlank:return Boolean(n);case c.Contain:return n.indexOf(e.value)>=0;case c.NotContain:return-1===n.indexOf(e.value);default:return!1}})[r===u.Or?"some":"every"](function(e){return e})?n:null}).filter(Boolean)[0]||this.defaultRule.destination}}]),e}(),T=function(e){function t(e,n){var r,o,i;return C(this,t),o=this,i=_(t).call(this,e),r=!i||"object"!==P(i)&&"function"!=typeof i?j(o):i,I(j(j(r)),"logic",{}),(JSON.parse(n._logic)||[]).forEach(function(e){r.logic[e.questionId]=new x(e,r._engageform.answers)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,w),E(t,null,[{key:"fromEnageformAndData",value:function(e,n){return new t(e,n)}}]),E(t,[{key:"prev",value:function(e){var n=this.visitedPages.pop(),r=this._engageform.getPageIndex(this._engageform.current)-this._engageform.getPageIndex(n);O(_(t.prototype),"prev",this).call(this,e,r)}},{key:"move",value:function(e){var n,r,o=this._engageform.current,i=this.logic[o.id];return(r=this.isPossiblyConditionalPage(o)?i&&i.hasExitRules()?this._engageform.getPageById(i.resolveExitDestination()):this._engageform.getPageByIndex(this.position+1):this._engageform.getPageByIndex(0))&&(r=this.checkEntryConditionForPage(r)),r&&(n=this._engageform.getPageIndex(r)-this._engageform.getPageIndex(o)),O(_(t.prototype),"move",this).call(this,e,n)}},{key:"checkEntryConditionForPage",value:function(e){var t=this.logic[e.id];if(t&&t.hasEntryRules()){var n=t.resolveEntryDestination(),r=this._engageform.getPageById(n);return r?this.checkEntryConditionForPage(r):r}return e}},{key:"isPossiblyConditionalPage",value:function(e){return[m.Form,m.MultiChoice,m.PictureChoice,m.Rateit].includes(e.type)}}]),t}();function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var D=function(){var e,t,n;function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.state,n=e.text,o=e.link,i=e.imageUrl,a=arguments.length>1?arguments[1]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),A(this,"_text",void 0),A(this,"_link",void 0),A(this,"_imageUrl",void 0),A(this,"_isCustomLogo",!1),A(this,"_enabled",void 0),A(this,"_custom",void 0),this._custom=a,this._enabled=!t,this._text=r.isTextCustom(n)?n:r.defaultBranding.text,this._link=o||r.defaultBranding.link,r.isImageCustom(i)?(this._imageUrl=i?"".concat(En.getConfig("backend").api+En.getConfig("backend").imagesUrl,"/").concat(i):"",this._isCustomLogo=!0):this._imageUrl=En.config.backend.api+i}return e=r,n=[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new r(e,r.arePropertiesCustom(e))}},{key:"arePropertiesCustom",value:function(e){var t=e.text,n=e.link,o=e.imageUrl;return Boolean(r.isTextCustom(t)||n||r.isImageCustom(o))}},{key:"isTextCustom",value:function(e){return void 0!==e}},{key:"isImageCustom",value:function(e){return void 0!==e&&e!==r.defaultBranding.imageUrl}},{key:"defaultBranding",get:function(){return En.getConfig("backend").branding}}],(t=[{key:"isCustom",get:function(){return this._custom}},{key:"isDefault",get:function(){return!this._custom}},{key:"isCustomLogo",get:function(){return this._isCustomLogo}},{key:"imageUrl",get:function(){return this._imageUrl}},{key:"link",get:function(){return this._link}},{key:"text",get:function(){return this._text}},{key:"enabled",get:function(){return this._enabled}}])&&R(e.prototype,t),n&&R(e,n),r}();function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var q=function(){function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r={},(n="_listener")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}var t,n,r;return t=e,(n=[{key:"listen",value:function(e,t){this._listener[e]||(this._listener[e]=[]),this._listener[e].push(t)}},{key:"trigger",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=this._listener[e];o&&o.forEach(function(e){return e.apply(e,n)})}}])&&U(t.prototype,n),r&&U(t,r),e}();function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $=function(){var e,t,n;function r(e){var t=e.settings.share,n=e.endPages,i=e.startPages,a=e.pages;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),B(this,"globalTitle",void 0),B(this,"globalDescription",void 0),this.globalTitle="",this.globalDescription="",t&&(this.globalTitle=t.title||"",this.globalDescription=t.description||""),(n.length<1||!Object(o.find)(a,{social:!0}))&&i.length&&a[i[0]].title&&(this.globalTitle=a[i[0]].title,this.globalDescription=a[i[0]].description)}return e=r,n=[{key:"fromEngageform",value:function(e){return new r(e)}}],(t=null)&&M(e.prototype,t),n&&M(e,n),r}();function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var N=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),F(this,"showResults",!1),F(this,"showCorrectAnswer",!1),F(this,"showMainMedia",!1),F(this,"showDescription",!1),F(this,"requiredAnswer",!1),this.requiredAnswer=!!t.requiredAnswer,t.settings&&(this.showResults=!!t.settings.showAnswers,this.showCorrectAnswer=!!t.settings.showCorrectAnswer,this.showMainMedia=!!t.settings.showMainMedia,this.showDescription=!!t.settings.showDescription)};function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var z=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),V(this,"id",void 0),V(this,"engageform",void 0),V(this,"type",m.Undefined),V(this,"title",""),V(this,"description",""),V(this,"media",""),V(this,"mediaWidth",0),V(this,"mediaHeight",0),V(this,"filled",!1),V(this,"settings",void 0),V(this,"cases",[]),V(this,"result",void 0),this.id=n._id,this.engageform=t,this.settings=new N(n),this.title=n.text||"",this.settings.showDescription&&(this.description=n.description||""),this.settings.showMainMedia&&n.imageData&&(this.media=En.cloudinary.prepareImageUrl(n.imageFile,680,n.imageData),this.mediaWidth=680,n.imageData.containerRatio?this.mediaHeight=Math.round(680*n.imageData.containerRatio):this.mediaHeight=Math.round(n.imageData.containerHeight||0))}var t,n,r;return t=e,(n=[{key:"send",value:function(e){if(!1===this.engageform.enabled)return En.$q.reject("Engageform already ended.");if(e)return e.send();var t=En.$q.defer();return t.resolve(),t.promise}},{key:"sent",value:function(){var e=this,t=En.$q.defer(),n={};return n=En.localStorage.get("page."+this.id)||{},this.engageform.setAnswer(this.id,n),this.settings.showResults&&n.results?this.getStatsById(this.id).then(function(r){t.resolve(e.refreshAnswer(n,r))}).catch(function(){t.resolve(n)}):t.resolve(n),t.promise}},{key:"refreshAnswer",value:function(e,t){return e}},{key:"selectAnswer",value:function(e){}},{key:"createCase",value:function(e,t){}},{key:"setResults",value:function(e){var t=this.cases.map(function(t){return t.result=Number(e.stats&&e.stats[t.id])||0,t.id});for(var n in e.stats)if(-1===t.indexOf(n)&&"questionId"!==n&&this.type!==m.Rateit){var r=this.createCase({text:"[Removed answer]",_id:n,imageData:{height:100}});r.result=Number(e.stats[r.id]),this.cases.push(r)}}},{key:"updateAnswers",value:function(e){var t=this;this.id===e.questionId&&(this.engageform.current&&!Object(o.isUndefined)(e.avg)&&(this.engageform.current.result=e.avg),En.$timeout(function(){t.cases.map(function(t){if(!Object(o.isUndefined)(e[t.id])){var n=t.load();n.results&&(n.results[t.id]=e[t.id],t.save(n)),t.result=e[t.id]||0}})}))}},{key:"getStatsById",value:function(e){var t=En.config.backend.domain+En.getConfig("engageform").pageStatsUrl;return t=t.replace(":pageId",e),En.$http.get(t).then(function(e){return-1!==[200,304].indexOf(e.status)?e.data:En.$q.reject(e)})}}])&&L(t.prototype,n),r&&L(t,r),e}();function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function W(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}V(z,"Type",m),V(z,"Template",v);var X,Y=function(e){function t(e,n,r){var i,a,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,i=!(s=H(t).call(this,e,n))||"object"!==G(s)&&"function"!=typeof s?Q(a):s,J(Q(Q(i)),"type",m.EndPage),J(Q(Q(i)),"isCoverPage",!0),J(Q(Q(i)),"button",void 0),J(Q(Q(i)),"outcome",void 0),J(Q(Q(i)),"social",void 0),J(Q(Q(i)),"score",void 0),J(Q(Q(i)),"rangeMin",void 0),J(Q(Q(i)),"rangeMax",void 0),J(Q(Q(i)),"exitLink",void 0),J(Q(Q(i)),"link",void 0),J(Q(Q(i)),"socialData",void 0);var u=Object(o.defaults)({},r.share,{title:"",description:"",link:"",imageUrl:""});return u.imageUrl&&(u.imageUrl=En.cloudinary.preparePreviewImageUrl(u.imageUrl,680)),i.socialData=u,n.coverPage&&(i.button=n.coverPage.buttonText,i.outcome=n.coverPage.outcome,i.social=n.coverPage.showSocialShares,i.exitLink=n.coverPage.exitLink,i.link=n.coverPage.link,n.coverPage.scoreRange&&(i.rangeMax=n.coverPage.scoreRange.max,i.rangeMin=n.coverPage.scoreRange.min)),i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}(t,z),n=t,(r=[{key:"personalizeShares",value:function(){"outcome"!==this.engageform.typeName&&"score"!==this.engageform.typeName||(this.socialData.title=this.engageform.texts.SCORE_AND_OUTCOME_SHARE.replace(/\$RESULT\$/gi,this.outcome||String(this.score||0)).replace(/\$TITLE\$/gi,this.engageform.title),this.media&&this.settings.showMainMedia&&(this.socialData.imageUrl=this.media))}},{key:"fbLink",get:function(){return En.getConfig("backend")&&En.getConfig("backend").domain&&En.getConfig("share")&&En.getConfig("share").facebook&&this.socialData&&this.socialData.title&&this.socialData.description&&this.socialData.imageUrl&&this.engageform&&this.engageform.id?(this.personalizeShares(),En.getConfig("backend").domain+En.getConfig("share").facebook+"?quizId="+this.engageform.id+"&description="+encodeURIComponent(this.socialData.description)+"&name="+encodeURIComponent(this.socialData.title)+"&image="+this.socialData.imageUrl):null}},{key:"twLink",get:function(){return this.socialData&&this.socialData.title&&this.socialData.link?(this.personalizeShares(),"https://twitter.com/intent/tweet?text="+encodeURIComponent(this.socialData.title)+" "+this.socialData.link+" via @4screens"):null}}])&&W(n.prototype,r),i&&W(n,i),t}();function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Undefined=0]="Undefined",e[e.Image=1]="Image",e[e.Input=2]="Input",e[e.Iteration=3]="Iteration",e[e.Text=4]="Text"}(X||(X={}));var te=function(){function e(t,n){var r=n._id;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ee(this,"id",void 0),ee(this,"type",X.Undefined),ee(this,"page",void 0),ee(this,"selected",!1),ee(this,"correct",!1),ee(this,"incorrect",!1),ee(this,"result",0),ee(this,"title",void 0),ee(this,"error",void 0),ee(this,"value",void 0),this.page=t,this.id=r}var t,n,r;return t=e,(n=[{key:"shouldShowIndicator",value:function(){return!this.page.engageform.isSummaryMode()&&!this.page.engageform.isResultsMode()&&this.page.settings.showCorrectAnswer&&(this.selected||this.page.filled&&this.correct)}},{key:"shouldShowResults",value:function(){return this.page.engageform.isSummaryMode()||this.page.settings.showResults&&this.page.filled&&!this.page.engageform.isResultsMode()}},{key:"send",value:function(){var e=En.$q.defer();return e.resolve({}),e.promise}},{key:"makeSend",value:function(e){var t=this,n=En.getConfig("backend").domain+En.getConfig("engageform").pageResponseUrl;n=n.replace(":pageId",this.page.id),En.mode!==i.Default&&(n+="?preview"),e.quizQuestionId=this.page.id,e.userIdent=En.user.sessionId;var r={questionId:this.page.id,questionTitle:this.page.title,answerId:this.id,answerValue:e.inputs&&e.inputs.map(function(e){return e.value})||this.title||this.ordinal};return En.$http.post(n,e).then(function(n){return-1!==[200,304].indexOf(n.status)?(!e.userIdent&&n.data.userIdent&&(En.user.sessionId=n.data.userIdent),t.page.engageform.event.trigger("answer",r),n.data):En.$q.reject(n.data||{})}).catch(function(e){return En.$q.reject(e.data||{})})}},{key:"load",value:function(){return En.localStorage.get("page."+this.page.id)||{}}},{key:"save",value:function(e){this.page.engageform.setAnswer(this.page.id,e),En.localStorage.set("page."+this.page.id,e)}},{key:"validate",value:function(){return!0}}])&&Z(t.prototype,n),r&&Z(t,r),e}();function ne(e){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function oe(e,t,n){return(oe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ie(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ie(e){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function se(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ue(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ce=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=ie(t).call(this,e,n))||"object"!==ne(i)&&"function"!=typeof i?se(o):i,ue(se(se(r)),"type",X.Input),ue(se(se(r)),"expectedValue",void 0),ue(se(se(r)),"value",""),r.title=n.label,r.expectedValue=n.type,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(t,te),n=t,(r=[{key:"send",value:function(){var e=this,n={inputs:[]},r=this.load();for(var o in r)r.hasOwnProperty(o)&&n.inputs.push({_id:o,value:r[o]});return oe(ie(t.prototype),"makeSend",this).call(this,n).then(function(){return n}).catch(function(t){return 406===t.code&&(t.textKey="INCORRECT_INPUT",t.message="Incorrect inputs sent. Try again.",e.save({})),En.$q.reject(t)})}},{key:"validate",value:function(){if(this.correct=!1,this.incorrect=!1,this.page.settings.requiredAnswer&&!this.value?(this.error="Answer is required",this.incorrect=!0):(this.error="",this.correct=!0),this.correct){var e=this.load();return e[this.id]=this.value,this.save(e),!0}return!1}}])&&re(n.prototype,r),o&&re(n,o),t}();function le(e){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ge(e,t){return!t||"object"!==le(t)&&"function"!=typeof t?ye(e):t}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pe(e,t){return(pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ye(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var be=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),de(ye(ye(r=ge(this,he(t).call(this,e,n)))),"type",m.Form),de(ye(ye(r)),"count",0),n.forms?(r.cases=n.forms.inputs.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):ge(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pe(e,t)}(t,z),n=t,(r=[{key:"createCase",value:function(e){return new ce(this,e)}},{key:"send",value:function(e){var t=En.$q.defer(),n=!0;return this.cases.map(function(e){e.validate()||(n=!1)}),n?(this.filled=!0,this.engageform.sendAnswerCallback(this.engageform.title||this.engageform.id,this.engageform.current?this.engageform.current.title||this.engageform.current.id:null,this.cases[0]),t.resolve(this.cases[0].send())):(this.filled=!1,t.resolve({})),t.promise}},{key:"selectAnswer",value:function(e){this.cases.map(function(t){t.value=e[t.id]||"",e.inputs&&e.inputs.forEach(function(e){e._id===t.id&&(t.value=e.value)})})}},{key:"setResults",value:function(e){this.count=e.count||0}}])&&fe(n.prototype,r),o&&fe(n,o),t}();function me(e){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function we(e,t,n){return(we="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Pe(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Pe(e){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var ke=function(e){function t(e,n){var r,o,i,a,s,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=Pe(t).call(this,e,n))||"object"!==me(i)&&"function"!=typeof i?_e(o):i,a=_e(_e(r)),s="type",u=X.Text,s in a?Object.defineProperty(a,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[s]=u,r.title=n.text,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(t,te),n=t,(r=[{key:"send",value:function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?En.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"}):we(Pe(t.prototype),"makeSend",this).call(this,{selectedAnswerId:this.id}).then(function(n){var r={};for(var o in n.selectedAnswerId&&(r.selectedCaseId=n.selectedAnswerId),n.correctAnswerId&&(r.correctCaseId=n.correctAnswerId),n.stats)n.stats.hasOwnProperty(o)&&(r.results=r.results||{},/.{24}/.test(o)&&(r.results[o]=n.stats[o]));return we(Pe(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&ve(n.prototype,r),o&&ve(n,o),t}();function je(e){return(je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Se(e,t){return!t||"object"!==je(t)&&"function"!=typeof t?xe(e):t}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Te=function(e){function t(e,n){var r,o,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=Se(this,Ee(t).call(this,e,n)),o=xe(xe(r)),i="type",a=m.MultiChoice,i in o?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a,n.answers?(r.cases=n.answers.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):Se(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ie(e,t)}(t,z),n=t,(r=[{key:"createCase",value:function(e){return new ke(this,e)}},{key:"refreshAnswer",value:function(e,t){return t.answers.map(function(t){e.results&&(e.results[t._id]=t.percent)}),e}},{key:"selectAnswer",value:function(e){var t=this;this.cases.map(function(n){n.selected=!1,n.correct=!1,n.incorrect=!1,n.id===e.selectedCaseId&&(t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n),t.filled=!0,n.selected=!0),e.results&&(n.result=e.results[n.id]||0),n.id===e.correctCaseId?n.correct=!0:n.incorrect=!0})}}])&&Ce(n.prototype,r),o&&Ce(n,o),t}();function Re(e){return(Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function De(e,t,n){return(De="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ue(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qe(e,t){return(qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Me(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Be(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $e=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=Ue(t).call(this,e,n))||"object"!==Re(i)&&"function"!=typeof i?Me(o):i,Be(Me(Me(r)),"type",X.Image),Be(Me(Me(r)),"media",void 0),Be(Me(Me(r)),"mediaWidth",void 0),Be(Me(Me(r)),"mediaHeight",void 0),r.title=n.text,r.media=En.cloudinary.prepareImageUrl(n.imageFile,t.mediaWidth,n.imageData),r.mediaWidth=t.mediaWidth,n.imageData&&n.imageData.containerRatio?r.mediaHeight=Math.round(t.mediaWidth*n.imageData.containerRatio):r.mediaHeight=Math.round(n.imageData.containerHeight||0),r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qe(e,t)}(t,te),n=t,(r=[{key:"send",value:function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?En.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"}):De(Ue(t.prototype),"makeSend",this).call(this,{selectedAnswerId:this.id}).then(function(n){var r={selectedCaseId:n.selectedAnswerId,correctCaseId:n.correctAnswerId};for(var o in n.stats)n.stats.hasOwnProperty(o)&&(r.results=r.results||{},/.{24}/.test(o)&&(r.results[o]=n.stats[o]));return De(Ue(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&Ae(n.prototype,r),o&&Ae(n,o),t}();function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Le(e,t){return!t||"object"!==Fe(t)&&"function"!=typeof t?Ge(e):t}function Ve(e){return(Ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ze(e,t){return(ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ge(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Be($e,"mediaWidth",300);var We=function(e){function t(e,n){var r,o,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=Le(this,Ve(t).call(this,e,n)),o=Ge(Ge(r)),i="type",a=m.PictureChoice,i in o?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a,n.answers?(r.cases=n.answers.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):Le(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ze(e,t)}(t,z),n=t,(r=[{key:"createCase",value:function(e){return new $e(this,e)}},{key:"refreshAnswer",value:function(e,t){return t.answers.map(function(t){e.results&&(e.results[t._id]=t.percent)}),e}},{key:"selectAnswer",value:function(e){var t=this;this.cases.map(function(n){n.selected=!1,n.correct=!1,n.incorrect=!1,n.id===e.selectedCaseId&&(t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n),t.filled=!0,n.selected=!0),e.results&&(n.result=e.results[n.id]||0),n.id===e.correctCaseId?n.correct=!0:n.incorrect=!0})}}])&&Ne(n.prototype,r),o&&Ne(n,o),t}();function He(e){return(He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ke(e){return(Ke=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qe(e,t){return(Qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Je(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ye=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=Ke(t).call(this,e,n))||"object"!==He(i)&&"function"!=typeof i?Je(o):i,Xe(Je(Je(r)),"type",m.Poster),Xe(Je(Je(r)),"button",void 0),Xe(Je(Je(r)),"exitLink",void 0),Xe(Je(Je(r)),"link",void 0),n.coverPage&&(r.button=n.coverPage.buttonText,r.exitLink=n.coverPage.exitLink,r.link=n.coverPage.link),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qe(e,t)}(t,z),t}();function Ze(e){return(Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function et(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tt(e,t,n){return(tt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=nt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function nt(e){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rt(e,t){return(rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ot(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function it(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var at=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=nt(t).call(this,e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){it(e,t,n[t])})}return e}({},n,{_id:""})))||"object"!==Ze(i)&&"function"!=typeof i?ot(o):i,it(ot(ot(r)),"type",X.Iteration),it(ot(ot(r)),"symbol",void 0),it(ot(ot(r)),"ordinal",void 0),r.ordinal=n.ordinal,r.symbol=n.symbol,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rt(e,t)}(t,te),n=t,(r=[{key:"send",value:function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?En.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"}):tt(nt(t.prototype),"makeSend",this).call(this,{quizQuestionId:this.page.id,rateItValue:this.ordinal}).then(function(n){var r={};return n.selectedValue&&(r.selectedValue=n.selectedValue),n.avgRateItValue&&(r.result=+n.avgRateItValue),tt(nt(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&et(n.prototype,r),o&&et(n,o),t}();function st(e){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ut(e){return(ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function lt(e,t,n){return t&&ct(e.prototype,t),n&&ct(e,n),e}function ft(e,t){return(ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function gt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ht(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var pt=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,i=ut(t).call(this,e,n),r=!i||"object"!==st(i)&&"function"!=typeof i?gt(o):i,ht(gt(gt(r)),"type",m.Rateit),ht(gt(gt(r)),"result",0),ht(gt(gt(r)),"labelMin",void 0),ht(gt(gt(r)),"labelMax",void 0),ht(gt(gt(r)),"selectedValue",0),r.labelMin=n.rateIt.minLabel,r.labelMax=n.rateIt.maxLabel,r.cases=Array.apply(null,Array(n.rateIt.maxRateItValue)).map(function(e,t){return r.createCase(t+1,n.rateIt.rateType)}),r.sent().then(function(e){e.selectedValue&&(r.selectedValue=e.selectedValue,r.selectAnswer(e))}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ft(e,t)}(t,z),lt(t,[{key:"shouldShowResults",value:function(){return this.settings.showResults&&this.result>0}}]),lt(t,[{key:"createCase",value:function(e,t){return new at(this,{ordinal:e,symbol:t})}},{key:"selectAnswer",value:function(e){var t=this;e.selectedValue&&(this.filled=!0,this.selectedValue=e.selectedValue),e.result&&(this.result=e.result),this.cases.map(function(n){n.selected=e.selectedValue>=n.ordinal,e.selectedValue===n.ordinal&&t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n)})}},{key:"setResults",value:function(e){this.result=e.average||0,this.selectedValue=e.average||0}}]),t}();function yt(e){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dt(e){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bt(e,t){return(bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var wt=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=dt(t).call(this,e,n))||"object"!==yt(i)&&"function"!=typeof i?mt(o):i,vt(mt(mt(r)),"type",m.StartPage),vt(mt(mt(r)),"isCoverPage",!0),vt(mt(mt(r)),"button",void 0),n.coverPage&&void 0!==n.coverPage.buttonText&&(r.button=n.coverPage.buttonText),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bt(e,t)}(t,z),t}();function Pt(e){return(Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ot(e){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _t(e,t){return(_t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function kt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ct=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=Ot(t).call(this,e,n))||"object"!==Pt(i)&&"function"!=typeof i?kt(o):i,jt(kt(kt(r)),"type",m.SummaryPage),jt(kt(kt(r)),"stats",void 0),n.text?r.title=n.text:e.type===a.Outcome?r.title="Outcomes":r.title="Scores",r.stats=n.stats,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_t(e,t)}(t,z),t}();function St(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Et=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),St(this,"allowAnswerChange",!1),St(this,"hideMessageAfterDelay",3e3),St(this,"share",void 0),St(this,"tracking",void 0),t.settings&&(this.allowAnswerChange=!!t.settings.allowAnswerChange,this.tracking=t.settings.tracking,t.settings.hideMessageAfterDelay&&(this.hideMessageAfterDelay=t.settings.hideMessageAfterDelay),t.settings.share&&(this.share=t.settings.share,!this.share.imageUrl&&En.getConfig("share")&&En.getConfig("share").defaultImgUrl&&(this.share.imageUrl=En.getConfig("share").defaultImgUrl)))};function It(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var xt=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),It(this,"liveTitle","Live"),It(this,"chatTitle","Chat"),It(this,"logoUrl",""),It(this,"headerText",""),t.tabs&&(t.tabs.liveTitle&&(this.liveTitle=t.tabs.liveTitle),t.tabs.chatTitle&&(this.chatTitle=t.tabs.chatTitle),t.tabs.logoUrl&&(this.logoUrl=En.getConfig("backend").api+En.getConfig("backend").imagesUrl+"/"+t.tabs.logoUrl),t.tabs.headerText&&(this.headerText=t.tabs.headerText))};function Tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Rt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var At=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Rt(this,"answerBackgroundColor",""),Rt(this,"answerBorderColor",""),Rt(this,"answerColor",""),Rt(this,"backgroundBrightness",""),Rt(this,"backgroundColor",""),Rt(this,"backgroundImageBlur",""),Rt(this,"backgroundImageFile",""),Rt(this,"backgroundImagePosition",""),Rt(this,"buttonColor",""),Rt(this,"font",""),Rt(this,"questionColor",""),Rt(this,"customThemeCssFile",""),Rt(this,"backgroundImageConvertedFile",""),Rt(this,"tabBorderColor",""),Rt(this,"tabFontColor",""),Rt(this,"tabColor",""),Rt(this,"embedSettings",void 0),this.embedSettings=n,t.theme&&(this.answerBackgroundColor=t.theme.answerBackgroundColor||"",this.answerBorderColor=t.theme.answerBorderColor||"",this.answerColor=t.theme.answerColor||"",this.backgroundBrightness=t.theme.backgroundBrightness||"",this.backgroundColor=t.theme.backgroundColor||"",this.backgroundImageBlur=t.theme.backgroundImageBlur||"",this.backgroundImageFile=t.theme.backgroundImageFile||"",this.backgroundImagePosition=t.theme.backgroundImagePosition||"",this.buttonColor=t.theme.buttonColor||"",this.font=t.theme.font||"",this.questionColor=t.theme.questionColor||"",this.tabColor=t.theme.tabColor||"",this.tabFontColor=t.theme.tabFontColor||"",this.tabBorderColor=t.theme.tabBorderColor||"",t.theme.customThemeCssFile&&(this.customThemeCssFile=En.config.backend.api+"/uploads/"+t.theme.customThemeCssFile),t.theme.backgroundImageFile&&this.convertBackgroundImage())}var t,n,r;return t=e,(n=[{key:"convertBackgroundImage",value:function(){this.backgroundImageConvertedFile=En.cloudinary.prepareBackgroundImageUrl(this.backgroundImageFile,window.innerWidth,"auto"===this.embedSettings.height?null:window.innerHeight,parseInt(this.backgroundImageBlur,10),this.backgroundImagePosition)}}])&&Tt(t.prototype,n),r&&Tt(t,r),e}();function Dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ut(e,t,n){return t&&Dt(e.prototype,t),n&&Dt(e,n),e}function qt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Mt=function(){function e(t,n,r,o){var i=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),qt(this,"_engageformId",void 0),qt(this,"_pages",{}),qt(this,"_startPages",[]),qt(this,"_endPages",[]),qt(this,"_availablePages",[]),qt(this,"_hasForms",!1),qt(this,"sendAnswerCallback",void 0),qt(this,"enabled",!0),qt(this,"type",a.Undefined),qt(this,"title",void 0),qt(this,"message",void 0),qt(this,"settings",void 0),qt(this,"theme",void 0),qt(this,"branding",void 0),qt(this,"tabs",void 0),qt(this,"themeType",void 0),qt(this,"embedSettings",void 0),qt(this,"texts",void 0),qt(this,"current",void 0),qt(this,"navigation",void 0),qt(this,"meta",void 0),qt(this,"answers",new Map),qt(this,"event",void 0),qt(this,"mode",void 0),qt(this,"showGoogleAds",void 0),console.log("Quiz:",t),this._engageformId=t._id,this.mode=n,this.embedSettings=o,this.sendAnswerCallback=s,this.title=t.title,this.settings=new Et(t),this.theme=new At(t,o),this.tabs=new xt(t),this.texts=t.texts,this.themeType=this.getThemeType(t.theme.backgroundColor),this.event=new q,this.branding=D.create(t.settings&&t.settings.branding),this.showGoogleAds=t.showGoogleAds;var u=this.buildPages(r||[],this.settings);u.forEach(function(e){return i.storePage(e)}),this._hasForms=u.some(function(e){return e.type===m.Form});var c=t._logic&&"[]"!==t._logic;this.navigation=c?T.fromEnageformAndData(this,t):w.fromEnageform(this),this.meta=$.fromEngageform(this)}return Ut(e,[{key:"getPageById",value:function(e){return this.pages[e]}},{key:"getPageByIndex",value:function(e){return this.pages[this.availablePages[e]]}},{key:"getPageIndex",value:function(e){return this.availablePages.indexOf(e.id)}},{key:"isType",value:function(e){return this.type===e}},{key:"isNormalMode",value:function(){return Boolean(this.mode===i.Default||this.mode===i.Preview)}},{key:"isSummaryMode",value:function(){return Boolean(this.mode===i.Summary)}},{key:"isResultsMode",value:function(){return Boolean(this.mode===i.Result)}},{key:"isPreviewMode",value:function(){return Boolean(this.mode===i.Preview)}},{key:"id",get:function(){return this._engageformId}},{key:"pages",get:function(){return this._pages}},{key:"startPages",get:function(){return this._startPages}},{key:"endPages",get:function(){return this._endPages}},{key:"availablePages",get:function(){return this._availablePages}},{key:"typeName",get:function(){return a[this.type].toLowerCase()}},{key:"hasForms",get:function(){return this._hasForms}}]),Ut(e,[{key:"setUserIdent",value:function(e){En.user.sessionId=e}},{key:"getUserIdent",value:function(e){return En.user.sessionId}},{key:"storePage",value:function(e){return e.type===m.StartPage?this.isNormalMode()&&this._startPages.push(e.id):e.type===m.EndPage?this.isNormalMode()&&this._endPages.push(e.id):this._availablePages.push(e.id),this._pages[e.id]=e,e}},{key:"initPage",value:function(e){return this.storePage(this.buildPages([e],this.settings)[0]),this.setCurrent(e._id)}},{key:"setCurrent",value:function(e){var t=this._pages[e];return this.current=t,t}},{key:"setCurrentEndPage",value:function(){var e=En.config.backend.domain+En.getConfig("engageform").engageformFinishUrl;return e=e.replace(":engageformId",this._engageformId),En.mode!==i.Default&&(e+="?preview"),En.$http.post(e,{userIdent:En.user.sessionId,globalUserIdent:En.user.id}).then(function(e){return-1!==[200,304].indexOf(e.status)?(En.localStorage.clearAll(),En.user.id=e.data.globalUserIdent,e.data):En.$q.reject(e)})}},{key:"cleanPages",value:function(){this._availablePages.length=0,this._pages={}}},{key:"buildPages",value:function(e,t){var n=this;return e.map(function(e){return n.createPage(e,t)}).filter(function(e){return Boolean(e)})}},{key:"createPage",value:function(e,t){switch(e.type){case m.EndPage:return new Y(this,e,t);case m.Form:return new be(this,e);case m.MultiChoice:return new Te(this,e);case m.PictureChoice:return new We(this,e);case m.Rateit:return new pt(this,e);case m.StartPage:return new wt(this,e);case m.Poster:return new Ye(this,e);default:throw new Error("Trying to construct an unknown page.")}}},{key:"setSummary",value:function(e){var t=this;e.forEach(function(e){e.stats&&t._pages[e.stats.questionId]&&t._pages[e.stats.questionId].setResults(e)})}},{key:"setAnswers",value:function(e){var t=e.questions;for(var n in t)if(this._pages[n]){var r=t[n];this._pages[n].selectAnswer({selectedCaseId:r.selectedAnswerId,inputs:r.inputs,selectedValue:r.rateItValue})}}},{key:"setResultPage",value:function(e){var t={_id:"summaryPage",type:m.SummaryPage,settings:{showCorrectAnswer:!0},stats:e},n=new Ct(this,t);this.storePage(n)}},{key:"setUserResultPage",value:function(e){var t={_id:"RESULT_PAGE",type:"summaryPage",settings:{}};"outcome"===e.type?Object(o.extend)(t,{text:"User's outcome: "+e.outcome}):Object(o.extend)(t,{text:"User's score: "+e.score+" / "+e.maxScore});var n=new Ct(this,t);this.storePage(n)}},{key:"setAnswer",value:function(e,t){var n=Object(o.get)(t,"selectedCaseId")||Object(o.get)(t,"selectedValue")||t;this.answers.set(e,n)}},{key:"getThemeType",value:function(e){var t=this.colorToRgb(e);return.299*t.red+.587*t.green+.114*t.blue>186?"light":"dark"}},{key:"colorToRgb",value:function(e){var t;if("#"===e[0])e=e.substr(1);else{var n=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);e=n&&4===n.length?("0"+parseInt(n[1],10).toString(16)).slice(-2)+("0"+parseInt(n[2],10).toString(16)).slice(-2)+("0"+parseInt(n[3],10).toString(16)).slice(-2):""}if(3===e.length){var r=e;e="",r=(r=/^([a-f0-9])([a-f0-9])([a-f0-9])$/i.exec(r)).slice(1);for(var o=0;o<3;o++)e+=r[o]+r[o]}if(!(t=/^([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i.exec(e)))throw new Error("Invalid color.");return t=t.slice(1),{red:parseInt(t[0],16),green:parseInt(t[1],16),blue:parseInt(t[2],16)}}}]),e}();function Bt(e){return(Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ft(e,t,n){return(Ft="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Nt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Nt(e){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Lt(e,t){return(Lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var zt=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=Nt(t)).call.apply(e,[this].concat(l)))||"object"!==Bt(o)&&"function"!=typeof o?Vt(r):o,i=Vt(Vt(n)),s="type",u=a.Live,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Lt(e,t)}(t,Mt),n=t,(r=[{key:"initPages",value:function(){var e=En.$q.defer();return e.resolve(this),e.promise}},{key:"initPage",value:function(e){return this.cleanPages(),Ft(Nt(t.prototype),"initPage",this).call(this,e)}},{key:"setCurrentEndPage",value:function(){var e=En.$q.defer();return e.resolve(),e.promise}}])&&$t(n.prototype,r),o&&$t(n,o),t}();function Gt(e){return(Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ht(e,t,n){return(Ht="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Kt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Kt(e){return(Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qt(e,t){return(Qt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Jt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Xt=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=Kt(t)).call.apply(e,[this].concat(l)))||"object"!==Gt(o)&&"function"!=typeof o?Jt(r):o,i=Jt(Jt(n)),s="type",u=a.Outcome,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qt(e,t)}(t,Mt),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return Ht(Kt(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){var n=!1;return e.endPages.map(function(r){e.pages[r].outcome===t.outcome&&(n=!0,e.setCurrent(r))}),n||(e.enabled=!1,e.message="Thank you!"),t})}}])&&Wt(n.prototype,r),o&&Wt(n,o),t}();function Yt(e){return(Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function en(e,t,n){return(en="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=tn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function tn(e){return(tn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nn(e,t){return(nn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function rn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var on=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=tn(t)).call.apply(e,[this].concat(l)))||"object"!==Yt(o)&&"function"!=typeof o?rn(r):o,i=rn(rn(n)),s="type",u=a.Poll,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nn(e,t)}(t,Mt),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return en(tn(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){return e.endPages.length?e.setCurrent(e.endPages[0]):(e.enabled=!1,e.message="Thank you!"),t})}}])&&Zt(n.prototype,r),o&&Zt(n,o),t}();function an(e){return(an="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function un(e,t,n){return(un="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=cn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function cn(e){return(cn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ln(e,t){return(ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var gn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=cn(t)).call.apply(e,[this].concat(l)))||"object"!==an(o)&&"function"!=typeof o?fn(r):o,i=fn(fn(n)),s="type",u=a.Score,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ln(e,t)}(t,Mt),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return un(cn(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){var n=100,r=!1;return t.maxScore>0&&(n=Math.round(t.totalScore/t.maxScore*100)),e.endPages.map(function(t){var o=e.pages[t],i=o.rangeMin,a=void 0===i?0:i,s=o.rangeMax;a<=n&&(void 0===s?0:s)>=n&&(r=!0,o.score=n,e.setCurrent(t))}),r||(e.enabled=!1,e.message="Thank you!"),t})}}])&&sn(n.prototype,r),o&&sn(n,o),t}();function hn(e){return(hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function yn(e,t,n){return(yn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=dn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function dn(e){return(dn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bn(e,t){return(bn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var vn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=dn(t)).call.apply(e,[this].concat(l)))||"object"!==hn(o)&&"function"!=typeof o?mn(r):o,i=mn(mn(n)),s="type",u=a.Survey,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bn(e,t)}(t,Mt),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return yn(dn(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){return e.endPages.length?e.setCurrent(e.endPages[0]):(e.enabled=!1,e.message="Thank you!"),t})}}])&&pn(n.prototype,r),o&&pn(n,o),t}();function wn(e,t){return Object(o.includes)(Object(o.values)(e),t)}function Pn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function On(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _n=function(){var e,t,n;function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),On(this,"_id",null),On(this,"_sessionId",null)}return e=r,n=[{key:"create",value:function(){return new r}}],(t=[{key:"id",get:function(){return this._id||(this._id=En.localStorage.get(r.idKey)),this._id},set:function(e){En.localStorage.set(r.idKey,e),this._id=e}},{key:"sessionId",get:function(){return this._sessionId||(this._sessionId=En.localStorage.get(r.sessionIdKey)),this._sessionId},set:function(e){En.localStorage.set(r.sessionIdKey,e),this._sessionId=e}}])&&Pn(e.prototype,t),n&&Pn(e,n),r}();function kn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function jn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Cn(e,t,n){return t&&jn(e.prototype,t),n&&jn(e,n),e}function Sn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}On(_n,"idKey","userIdent"),On(_n,"sessionIdKey","sessionIdent"),n.d(t,"default",function(){return En});var En=function(){function e(t,n,r,o,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Sn(this,"_engageform",void 0),Sn(this,"_event",void 0),e.$http=t,e.$q=n,e.$timeout=r,e.cloudinary=o,e.localStorage=i,e.config=a,this._event=new q,e.cloudinary.setConfig(a.cloudinary)}return Cn(e,null,[{key:"getConfig",value:function(t){return e.config[t]}}]),Cn(e,[{key:"init",value:function(t){var n=this,a=Object(o.defaults)({},t,{mode:i.Default});if(!a||!a.id)return e.$q.reject({status:"error",error:{code:406,message:"The required id property does not exist."},data:a});if(e._instances[a.id])return e._instances[a.id];if(!wn(i,a.mode))return e.$q.reject({status:"error",error:{code:406,message:"Mode property not supported."},data:a});e.mode=a.mode;var s=[e.getData("quiz",a.id),a.live?e.$q.resolve([]):e.getData("pages",a.id)];return e.$q.all(s).then(function(t){var o=kn(t,2),i=o[0],s=o[1];return wn(r,i.type)?(n._engageform=new e.quizzesConstructors[i.type](i,e.mode,s,a.embedSettings,a.callback?a.callback.sendAnswerCallback:function(){}),n._engageform):e.$q.reject({status:"error",error:{code:406,message:"Type property not supported."},data:i})})}},{key:"destroyInstances",value:function(){e._instances={}}},{key:"type",get:function(){return this._engageform?this._engageform.type:a.Undefined}},{key:"Type",get:function(){return a}},{key:"mode",get:function(){return e.mode}},{key:"Mode",get:function(){return i}},{key:"title",get:function(){if(this._engageform)return this._engageform.title}},{key:"theme",get:function(){if(this._engageform)return this._engageform.theme}},{key:"current",get:function(){if(this._engageform)return this._engageform.current}},{key:"navigation",get:function(){if(this._engageform)return this._engageform.navigation}},{key:"branding",get:function(){if(this._engageform)return this._engageform.branding}},{key:"message",get:function(){if(this._engageform)return this._engageform.message}},{key:"meta",get:function(){if(this._engageform)return this._engageform.meta}},{key:"event",get:function(){if(this._event)return this._event}},{key:"showGoogleAds",get:function(){return!!this._engageform&&this._engageform.showGoogleAds}}],[{key:"getData",value:function(t,n){if("quiz"!==t&&"pages"!==t)throw new Error("Resource path for ".concat(t," type of data is unknown."));var r=e.getConfig("backend").domain+("quiz"===t?e.getConfig("engageform").engageformUrl:e.getConfig("engageform").engageformPagesUrl);return r=r.replace(":engageformId",n),e.mode!==i.Default&&(r+="?preview"),e.$http.get(r).then(function(t){return-1!==[200,304].indexOf(t.status)?t.data:e.$q.reject(t)})}}]),e}();Sn(En,"user",_n.create()),Sn(En,"$http",void 0),Sn(En,"$q",void 0),Sn(En,"$timeout",void 0),Sn(En,"cloudinary",void 0),Sn(En,"localStorage",void 0),Sn(En,"config",void 0),Sn(En,"mode",i.Undefined),Sn(En,"_instances",{}),Sn(En,"quizzesConstructors",{outcome:Xt,poll:on,score:gn,survey:vn,live:zt}),En.$inject=["$http","$q","$timeout","cloudinary","localStorageService","ApiConfig"],f.service("Engageform",En)}]);
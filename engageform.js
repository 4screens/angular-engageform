!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=_},function(e,t){e.exports=angular},function(e,t,n){"use strict";n.r(t);var r,o=n(0);!function(e){e.Outcome="outcome",e.Poll="poll",e.Score="score",e.Survey="survey",e.Form="form",e.Live="live",e.Calculator="calculator"}(r||(r={}));var i,a,s,u,l,c=n(1),f=n.n(c).a.module("4screens.engageform",["4screens.util.cloudinary","LocalStorageModule"]);!function(e){e.Undefined="undefined",e.Default="default",e.Preview="preview",e.Result="results",e.Summary="summary"}(i||(i={})),function(e){e[e.Undefined=0]="Undefined",e[e.Live=1]="Live",e[e.Outcome=2]="Outcome",e[e.Poll=3]="Poll",e[e.Score=4]="Score",e[e.Survey=5]="Survey",e[e.Form=6]="Form",e[e.Calculator=7]="Calculator"}(a||(a={})),function(e){e.Default="defaultRule",e.Entry="entryRule",e.Exit="exitRule"}(s||(s={})),function(e){e.And="and",e.Or="or"}(u||(u={})),function(e){e.Equal="eq",e.NotEqual="neq",e.Blank="blank",e.NotBlank="nblank",e.GreaterThan="gt",e.GreaterThanOrEqual="gte",e.LessThan="lt",e.LessThanOrEqual="lte",e.Between="between",e.Contain="contain",e.NotContain="ncontain"}(l||(l={}));var g,h=function(e){return e.type===s.Entry},p=function(e){return e.type===s.Exit},d=function(e){return e.type===s.Default};function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return t&&y(e.prototype,t),n&&y(e,n),e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Undefined=0]="Undefined",e.EndPage="endPage",e.Form="forms",e.MultiChoice="multiChoice",e.PictureChoice="pictureChoice",e.Rateit="rateIt",e.Slider="slider",e.StartPage="startPage",e.Poster="poster",e.SummaryPage="summaryPage",e.Project="project"}(g||(g={}));var m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),v(this,"_engageform",void 0),v(this,"visitedPages",[]),v(this,"enabled",!1),v(this,"position",0),v(this,"size",0),v(this,"hasStart",!1),v(this,"enabledStart",!0),v(this,"hasPrev",!1),v(this,"enabledPrev",!0),v(this,"hasNext",!1),v(this,"enabledNext",!0),v(this,"hasFinish",!1),v(this,"enabledFinish",!0),v(this,"distance",0),v(this,"animate","swipeNext"),v(this,"hasStartPages",!1),v(this,"hasEndPages",!1),v(this,"waitingForPageChange",null),v(this,"next",this.pick),v(this,"finish",this.pick),this._engageform=t,this.size=t.availablePages.length,this.hasEndPages=Boolean(t.endPages.length),t.startPages.length?(this.hasStart=!0,this.hasStartPages=!0,this._engageform.setCurrent(t.startPages[0])):(this.enabled=!0,this.move(),this.hasPrev=!1)}return b(e,null,[{key:"fromEnageform",value:function(t){return new e(t)}}]),b(e,[{key:"updateDistance",value:function(){return this.distance=this.position/this.size}},{key:"start",value:function(e){this.disableDefaultAction(e),this.animate="swipeNext",this.enabled=!0,this.hasStart=!1,this.move(),this.hasPrev=!0}},{key:"stopPageChange",value:function(){this.waitingForPageChange&&mr.$timeout.cancel(this.waitingForPageChange)}},{key:"prev",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.disableDefaultAction(e),this.stopPageChange(),this.animate="swipePrev",this._engageform.current&&(this._engageform.message=""),this.position-=t,this.updateDistance(),this.hasNext=!0,this.hasFinish=!1,0===this.position?(this._engageform.setCurrent(this._engageform.startPages[0]),this.hasPrev=!1):(this._engageform.setCurrent(this._engageform.availablePages[this.position-1]),this.hasPrev=1!==this.position||this.hasStartPages)}},{key:"pick",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{quiet:!1};if(this.disableDefaultAction(e),this.stopPageChange(),this.animate="swipeNext",!this._engageform.isNormalMode()){var o=mr.$q.defer();return o.resolve(t),this.move(t),o.promise}var i=this._engageform.current;return i.send(t).then(function(){n.sendMessage();var e=void 0;if((i.type===g.MultiChoice&&(e=i),i.type===g.PictureChoice&&(e=i),!t&&i.type===g.Form)&&!i.cases.filter(function(e){return!!e.required}).every(function(e){return!!e.value}))return r.quiet||n.sendMessage(n._engageform.texts.ANSWER_REQUIRED_TO_PROCEED),t;if(!t&&(!i.filled||i.settings.allowMultipleChoice&&e&&0===e.selectedItemsCount)&&i.settings.requiredAnswer)return r.quiet||n.sendMessage(n._engageform.texts.ANSWER_REQUIRED_TO_PROCEED),t;if(t&&i.filled&&e&&0===e.selectedItemsCount&&!i.settings.requiredAnswer)return t;if(t&&i.settings.allowMultipleChoice)return t;if(!t&&!i.settings.requiredAnswer&&!i.settings.allowMultipleChoice)return n.move(t),t;if(!t&&!i.settings.requiredAnswer&&i.settings.allowMultipleChoice&&e&&0===e.selectedItemsCount)return n.move(t),t;if(!t&&i.settings.allowMultipleChoice&&e&&e.selectedItemsCount<i.settings.minAnswersCount)return r.quiet||n.sendMessage(n._engageform.texts.MORE_ANSWERS_REQUIRED_TO_PROCEED),t;var o=t?i.settings.showCorrectAnswer||i.settings.showResults?1e3:200:0;return n.waitingForPageChange=mr.$timeout(function(){return n.waitingForPageChange=null,n.move(t),t},o),n.waitingForPageChange}).catch(function(e){return r.quiet||n.sendMessage(n._engageform.texts[e.textKey]||e.message),e})}},{key:"move",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._engageform.event.trigger("form::pageWillChange",{isStartPage:Boolean(0===this.position&&this._engageform.startPages.length)}),this.visitedPages.push(this._engageform.current),this.position+=n,n>-1&&this._engageform.availablePages.length>=this.position?(this.updateDistance(),this._engageform.setCurrent(this._engageform.availablePages[this.position-1]),this.hasPrev=!0,this.hasNext=!1,this.hasFinish=!1,this._engageform.availablePages.length>this.position?this.hasNext=!0:this._engageform.availablePages.length===this.position&&(this.hasFinish=this._engageform.isNormalMode()),this._engageform.event.trigger("form::pageDidChange",{currentPosition:this.position,isEndPage:!1})):(this.position=this._engageform.availablePages.length,e||this._engageform.setCurrentEndPage().then(function(e){t._engageform.type!==a.Score&&t._engageform.type!==a.Outcome||t._engageform.event.trigger("finish",e.totalScore||e.outcome,e.maxScore),t._engageform.event.trigger("finish::endPage"),t.enabled=!1,t.hasPrev=!1,t.hasNext=!1,t.hasFinish=!1,t._engageform.event.trigger("form::pageDidChange",{currentPosition:t.position,isEndPage:!0})}).catch(function(e){e.data.msg&&t.sendMessage(e.data.msg)}))}},{key:"disableDefaultAction",value:function(e){e&&(e.stopPropagation(),e.preventDefault())}},{key:"sendMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this._engageform.message=t,mr.$timeout(function(){e._engageform.message=""},this._engageform.settings.hideMessageAfterDelay)}}]),e}();function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t,n){return(O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return t&&j(e.prototype,t),n&&j(e,n),e}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E=function(){function e(t,n){C(this,e),I(this,"entryRules",void 0),I(this,"exitRules",void 0),I(this,"defaultRule",void 0),I(this,"answers",void 0),this.entryRules=this.processNonDefaultRules(t.rules[s.Entry],h),this.exitRules=this.processNonDefaultRules(t.rules[s.Exit],p),this.defaultRule=Object(o.head)(t.rules[s.Default].filter(d)),this.answers=n}return S(e,[{key:"hasEntryRules",value:function(){return this.entryRules.length>0}},{key:"hasExitRules",value:function(){return this.exitRules.length>0}},{key:"resolveEntryDestination",value:function(){return this.resolveDestination(this.entryRules)}},{key:"resolveExitDestination",value:function(){return this.resolveDestination(this.exitRules)}},{key:"processNonDefaultRules",value:function(e,t){return e?e.filter(t).map(this.dropEmptyConditions).filter(this.hasConditions):[]}},{key:"dropEmptyConditions",value:function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){I(e,t,n[t])})}return e}({},e,{conditions:e.conditions.filter(function(e){return Boolean(e.to)})})}},{key:"hasConditions",value:function(e){return e.conditions.length>0}},{key:"resolveDestination",value:function(e){var t=this;return e.map(function(e){var n=e.destination,r=e.conditionsConnection;return e.conditions.map(function(e){var n=t.answers.get(e.to);if(!n)return!1;if(function(e){return Boolean(e.field)}(e)&&(n=n[e.field]),Array.isArray(n)){var r=!1,o=!0,i=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var c=s.value;switch(e.is){case l.Equal:r=r||c.toString()===e.value.toString();break;case l.NotEqual:r=r||c.toString()!==e.value;break;case l.Blank:r=r||!Boolean(c);break;case l.NotBlank:r=r||Boolean(c);break;case l.Contain:r=r||c.toString().indexOf(e.value)>=0;break;case l.NotContain:r=r||-1===c.toString().indexOf(e.value)}}}catch(e){i=!0,a=e}finally{try{o||null==u.return||u.return()}finally{if(i)throw a}}return r}switch(e.is){case l.Equal:return n.toString()===e.value.toString();case l.NotEqual:return n.toString()!==e.value.toString();case l.GreaterThan:return n>e.value;case l.GreaterThanOrEqual:return n>=e.value;case l.LessThan:return n<e.value;case l.LessThanOrEqual:return n<=e.value;case l.Between:return e.value[0]>=n&&n<=e.value[1];case l.Blank:return!Boolean(n);case l.NotBlank:return Boolean(n);case l.Contain:return n.toString().indexOf(e.value)>=0;case l.NotContain:return-1===n.toString().indexOf(e.value);default:return!1}})[r===u.Or?"some":"every"](function(e){return e})?n:null}).filter(Boolean)[0]||this.defaultRule.destination}},{key:"defaultRuleValue",get:function(){return this.defaultRule}}]),e}(),x=function(e){function t(e,n){var r,o,i;C(this,t),o=this,i=P(t).call(this,e),r=!i||"object"!==w(i)&&"function"!=typeof i?k(o):i,I(k(k(r)),"logic",{});var a=n.skipLogic||{};return Object.keys(a).forEach(function(e){r.logic[e]=new E(a[e],r._engageform.answers)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,m),S(t,null,[{key:"fromEnageformAndData",value:function(e,n){return new t(e,n)}}]),S(t,[{key:"prev",value:function(e){var n=this.visitedPages.pop(),r=this._engageform.getPageIndex(this._engageform.current)-this._engageform.getPageIndex(n);O(P(t.prototype),"prev",this).call(this,e,r)}},{key:"move",value:function(e){var n,r=this._engageform.current,o=this.logic&&r?this.logic[r.id]:void 0;if(n=this._engageform.getPageByIndex(this.position),o&&o.hasExitRules()){var i=this._engageform.getPageById(o.resolveExitDestination());i&&(n=i)}if(n&&(n=this.checkEntryConditionForPage(n)),n){var a=r?this._engageform.getPageIndex(n):1;if(a<0){var s=r?this._engageform.getEndPageIndex(n):1;return this._engageform.skipLogicSelectedEndPage=s,O(P(t.prototype),"move",this).call(this,void 0,-1)}return O(P(t.prototype),"move",this).call(this,e,a-this._engageform.getPageIndex(r))}return O(P(t.prototype),"move",this).call(this,e,1)}},{key:"checkEntryConditionForPage",value:function(e){var t=this.logic&&e?this.logic[e.id]:void 0;if(t&&t.hasEntryRules()){var n=t.resolveEntryDestination(),r=this._engageform.getPageById(n);return r?this.checkEntryConditionForPage(r):r}return e}},{key:"isPossiblyConditionalPage",value:function(e){return[g.Form,g.MultiChoice,g.PictureChoice,g.Rateit].includes(e.type)}}]),t}();function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A=function(){var e,t,n;function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.state,i=t.text,a=t.link,s=t.imageUrl,u=arguments.length>2?arguments[2]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),R(this,"_text",void 0),R(this,"_link",void 0),R(this,"_imageUrl",void 0),R(this,"_isCustomLogo",!1),R(this,"_enabled",void 0),R(this,"_custom",void 0),this._custom=u,this._enabled=!n,this._text=o.isTextCustom(i)?i:o.defaultBranding.text,e==r.Live?this._link=a||o.defaultBranding.link_event:this._link=a||o.defaultBranding.link_project,o.isImageCustom(s)?(this._imageUrl=s?"".concat(mr.getConfig("backend").api+mr.getConfig("backend").imagesUrl,"/").concat(s):"",this._isCustomLogo=!0):this._imageUrl=mr.config.backend.api+s}return e=o,n=[{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new o(e,t,o.arePropertiesCustom(t))}},{key:"arePropertiesCustom",value:function(e){var t=e.text,n=e.link,r=e.imageUrl;return Boolean(o.isTextCustom(t)||n||o.isImageCustom(r))}},{key:"isTextCustom",value:function(e){return void 0!==e}},{key:"isImageCustom",value:function(e){return void 0!==e&&e!==o.defaultBranding.imageUrl}},{key:"defaultBranding",get:function(){return mr.getConfig("backend").branding}}],(t=[{key:"isCustom",get:function(){return this._custom}},{key:"isDefault",get:function(){return!this._custom}},{key:"isCustomLogo",get:function(){return this._isCustomLogo}},{key:"imageUrl",get:function(){return this._imageUrl}},{key:"link",get:function(){return this._link}},{key:"text",get:function(){return this._text}},{key:"enabled",get:function(){return this._enabled}}])&&T(e.prototype,t),n&&T(e,n),o}();function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var U=function(){function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r={},(n="_listener")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}var t,n,r;return t=e,(n=[{key:"listen",value:function(e,t){this._listener[e]||(this._listener[e]=[]),this._listener[e].push(t)}},{key:"trigger",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=this._listener[e];o&&o.forEach(function(e){return e.apply(e,n)})}}])&&D(t.prototype,n),r&&D(t,r),e}();function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var q=function(){var e,t,n;function r(e){var t=e.settings.share,n=e.endPages,i=e.startPages,a=e.pages;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),L(this,"globalTitle",void 0),L(this,"globalDescription",void 0),this.globalTitle="",this.globalDescription="",t&&(this.globalTitle=t.title||"",this.globalDescription=t.description||""),(n.length<1||!Object(o.find)(a,{social:!0}))&&i.length&&a[i[0]].title&&(this.globalTitle=a[i[0]].title,this.globalDescription=a[i[0]].description)}return e=r,n=[{key:"fromEngageform",value:function(e){return new r(e)}}],(t=null)&&M(e.prototype,t),n&&M(e,n),r}();function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),N(this,"showResults",!1),N(this,"showCorrectAnswer",!1),N(this,"showMainMedia",!1),N(this,"showDescription",!1),N(this,"requiredAnswer",!1),N(this,"mediaPosition","stack"),N(this,"allowMultipleChoice",!1),N(this,"minAnswersCount",0),N(this,"maxAnswersCount",0),N(this,"slider",void 0),this.requiredAnswer=!!t.requiredAnswer,t.settings&&(this.showResults=!!t.settings.showAnswers,this.showCorrectAnswer=!!t.settings.showCorrectAnswer,this.showMainMedia=!!t.settings.showMainMedia,this.showDescription=!!t.settings.showDescription,this.mediaPosition=t.settings.mediaPosition||"stack",this.allowMultipleChoice=t.settings.allowMultipleChoice||!1,this.minAnswersCount=t.settings.multipleChoice&&t.settings.multipleChoice.minAnswersCount||0,this.maxAnswersCount=t.settings.multipleChoice&&t.settings.multipleChoice.maxAnswersCount||0,this.slider=t.settings.slider||{})};function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),B(this,"id",void 0),B(this,"engageform",void 0),B(this,"type",g.Undefined),B(this,"title",""),B(this,"titleHTML",""),B(this,"description",""),B(this,"resultTitle",""),B(this,"media",""),B(this,"videoUrl",""),B(this,"videoType",""),B(this,"embedCode",""),B(this,"mediaWidth",0),B(this,"mediaHeight",0),B(this,"mediaUrl",""),B(this,"mediaFileWidth",0),B(this,"mediaFileHeight",0),B(this,"filled",!1),B(this,"settings",void 0),B(this,"cases",[]),B(this,"projectId",void 0),B(this,"result",void 0),B(this,"responseCount",void 0),B(this,"numbers",void 0),this.id=n._id,this.engageform=t,this.settings=new F(n),this.title=n.text||"",this.titleHTML=n.textHTML||n.text||"",n.responseCount&&(this.responseCount=n.responseCount),this.settings.showDescription&&(this.description=n.description||""),this.settings.showMainMedia&&(n.imageData&&(this.media=mr.cloudinary.prepareImageUrl(n.imageFile,680,n.imageData),this.mediaUrl=n.imageFileUrl,this.mediaWidth=680,n.imageFileData&&(this.mediaFileWidth=n.imageFileData.width,this.mediaFileHeight=n.imageFileData.height),n.imageData.containerRatio?this.mediaHeight=Math.round(680*n.imageData.containerRatio):this.mediaHeight=Math.round(n.imageData.containerHeight||0)),n.videoData&&(this.videoUrl=n.videoData.url,this.videoType=n.videoData.type),n.embedData&&(this.embedCode=n.embedData.code))}var t,n,r;return t=e,(n=[{key:"send",value:function(e){if(!1===this.engageform.enabled)return mr.$q.reject("Engageform already ended.");if(e)return e.send();var t=mr.$q.defer();return t.resolve(),t.promise}},{key:"sent",value:function(){var e=this,t=mr.$q.defer(),n={};return n=mr.localStorage.get("page."+this.id)||{},this.engageform.setAnswer(this.id,n),this.settings.showResults&&n.results?this.getStatsById(this.id).then(function(r){t.resolve(e.refreshAnswer(n,r))}).catch(function(){t.resolve(n)}):t.resolve(n),t.promise}},{key:"refreshAnswer",value:function(e,t){return e}},{key:"selectAnswer",value:function(e){}},{key:"createCase",value:function(e,t){}},{key:"setResults",value:function(e){var t=this.cases.map(function(t){return t.result=Number(e.stats&&e.stats[t.id])||0,t.id});for(var n in e.stats)if(-1===t.indexOf(n)&&"questionId"!==n&&this.type!==g.Rateit){var r=this.createCase({text:"[Removed answer]",_id:n,imageData:{height:100}});r.result=Number(e.stats[r.id]),this.cases.push(r)}}},{key:"updateAnswers",value:function(e,t){var n=this;this.id===e.questionId&&(this.engageform.current&&!Object(o.isUndefined)(e.avg)&&(this.engageform.current.result=e.avg),mr.$timeout(function(){n.cases.map(function(n){if(!Object(o.isUndefined)(e[n.id])){var r=n.load();r.results&&(r.results[n.id]=e[n.id],n.save(r)),n.result=e[n.id]||0,t&&(n.responseCount=t[n.id]||0),e.numbers&&(n.responseCount=e.numbers[n.id]||0)}})}))}},{key:"getStatsById",value:function(e){var t=mr.config.backend.domain+mr.getConfig("engageform").pageStatsUrl;return t=t.replace(":pageId",e),mr.$http.get(t).then(function(e){return-1!==[200,304].indexOf(e.status)?e.data:mr.$q.reject(e)})}}])&&V(t.prototype,n),r&&V(t,r),e}();function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}B($,"Type",g);var J,X=function(e){function t(e,n,r){var i,a,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,i=!(s=G(t).call(this,e,n))||"object"!==W(s)&&"function"!=typeof s?K(a):s,Q(K(K(i)),"type",g.EndPage),Q(K(K(i)),"isCoverPage",!0),Q(K(K(i)),"button",void 0),Q(K(K(i)),"outcome",void 0),Q(K(K(i)),"social",void 0),Q(K(K(i)),"score",void 0),Q(K(K(i)),"rangeMin",void 0),Q(K(K(i)),"rangeMax",void 0),Q(K(K(i)),"exitLink",void 0),Q(K(K(i)),"exitLinkNewWindow",void 0),Q(K(K(i)),"link",void 0),Q(K(K(i)),"redirect",void 0),Q(K(K(i)),"redirectNewWindow",void 0),Q(K(K(i)),"redirectLink",void 0),Q(K(K(i)),"socialData",void 0);var u=Object(o.defaults)({},r.share,{title:"title1",description:"desc1",link:"",imageUrl:""});return u.imageUrl&&(u.imageUrl=mr.cloudinary.preparePreviewImageUrl(u.imageUrl,680)),i.socialData=u,i.resultTitle=void 0===n.resultTitle?void 0:n.resultTitle||"",n.coverPage&&(i.button=n.coverPage.buttonText,i.outcome=n.coverPage.outcome,i.social=n.coverPage.showSocialShares,i.exitLink=n.coverPage.exitLink,i.exitLinkNewWindow=n.coverPage.exitLinkNewWindow,i.link=n.coverPage.link,i.redirect=n.coverPage.redirect,i.redirectNewWindow=n.coverPage.redirectNewWindow,i.redirectLink=n.coverPage.redirectLink,n.coverPage.scoreRange&&(i.rangeMax=n.coverPage.scoreRange.max,i.rangeMin=n.coverPage.scoreRange.min)),i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,$),n=t,(r=[{key:"personalizeShares",value:function(){"outcome"!==this.engageform.typeName&&"score"!==this.engageform.typeName||(this.socialData.title=this.engageform.texts.SCORE_AND_OUTCOME_SHARE.replace(/\$RESULT\$/gi,this.outcome||String(this.score||0)).replace(/\$TITLE\$/gi,this.engageform.title),this.media&&this.settings.showMainMedia&&(this.socialData.imageUrl=this.media))}},{key:"fbLink",get:function(){return mr.getConfig("backend")&&mr.getConfig("backend").domain&&mr.getConfig("share")&&mr.getConfig("share").facebook&&this.engageform&&this.engageform.id?(this.personalizeShares(),mr.getConfig("backend").domain+mr.getConfig("share").facebook+"?quizId="+this.engageform.id+"&description="+encodeURIComponent(this.socialData.description)+"&name="+encodeURIComponent(this.socialData.title)+"&image="+this.socialData.imageUrl):null}},{key:"twLink",get:function(){return this.socialData&&this.socialData.title&&this.socialData.link?(this.personalizeShares(),"https://twitter.com/intent/tweet?text="+encodeURIComponent(this.socialData.title)+" "+this.socialData.link+" via @youengageme"):null}}])&&H(n.prototype,r),i&&H(n,i),t}();function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Undefined=0]="Undefined",e[e.Image=1]="Image",e[e.Input=2]="Input",e[e.Iteration=3]="Iteration",e[e.Text=4]="Text",e[e.Project=5]="Project",e[e.Slider=6]="Slider"}(J||(J={}));var ee=function(){function e(t,n){var r=n._id;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Z(this,"id",void 0),Z(this,"type",J.Undefined),Z(this,"page",void 0),Z(this,"selected",!1),Z(this,"correct",!1),Z(this,"incorrect",!1),Z(this,"result",0),Z(this,"responseCount",0),Z(this,"title",void 0),Z(this,"error",void 0),Z(this,"value",void 0),this.page=t,this.id=r}var t,n,r;return t=e,(n=[{key:"shouldShowIndicator",value:function(){return!this.page.engageform.isSummaryMode()&&!this.page.engageform.isResultsMode()&&this.page.settings.showCorrectAnswer&&(this.selected||this.page.filled&&this.correct)}},{key:"shouldShowResults",value:function(){return this.page.engageform.isSummaryMode()||this.page.settings.showResults&&this.page.filled&&!this.page.engageform.isResultsMode()}},{key:"send",value:function(){var e=mr.$q.defer();return e.resolve({}),e.promise}},{key:"makeSend",value:function(e){var t=this,n=mr.getConfig("backend").domain+mr.getConfig("engageform").pageResponseUrl;n=n.replace(":pageId",this.page.id),mr.mode!==i.Default&&(n+="?preview"),e.quizQuestionId=this.page.id,e.userIdent=mr.user.id,e.eventUserId=mr.user.getEventUserId(this.page.engageform.id);var r={questionId:this.page.id,questionTitle:this.page.title,answerId:this.id,answerValue:e.inputs&&e.inputs.map(function(e){return e.value})||this.title||this.ordinal};return mr.$http.post(n,e).then(function(n){return-1!==[200,304].indexOf(n.status)?(!e.userIdent&&n.data.userIdent&&(mr.user.id=n.data.userIdent),!e.eventUserId&&n.data.eventUserId&&mr.user.setEventUserId(t.page.engageform.id,n.data.eventUserId),t.page.engageform.event.trigger("answer",r),n.data):mr.$q.reject(n.data||{})}).catch(function(e){return mr.$q.reject(e.data||{})})}},{key:"load",value:function(){return mr.localStorage.get("page."+this.page.id)||{}}},{key:"save",value:function(e){this.page.engageform.setAnswer(this.page.id,e),mr.localStorage.set("page."+this.page.id,e)}},{key:"validate",value:function(){return!0}}])&&Y(t.prototype,n),r&&Y(t,r),e}();function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(e,t,n){return(re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=oe(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function oe(e){return(oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ue=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=oe(t).call(this,e,n))||"object"!==te(i)&&"function"!=typeof i?ae(o):i,se(ae(ae(r)),"type",J.Input),se(ae(ae(r)),"expectedValue",void 0),se(ae(ae(r)),"value",""),se(ae(ae(r)),"required",void 0),r.title=n.label,r.expectedValue=n.type,r.required=n.required,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ie(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this,n={inputs:[]},r=this.load();for(var o in r)r.hasOwnProperty(o)&&n.inputs.push({_id:o,value:r[o]});return re(oe(t.prototype),"makeSend",this).call(this,n).then(function(){return n}).catch(function(t){return 406===t.code&&(t.textKey="INCORRECT_INPUT",t.message="Incorrect inputs sent. Try again.",e.save({})),mr.$q.reject(t)})}},{key:"validate",value:function(){if(this.correct=!1,this.incorrect=!1,!this.required||null!=this.value&&""!==this.value?(this.error="",this.correct=!0):(this.error="Answer is required",this.incorrect=!0),this.correct){var e=this.load();return e[this.id]=this.value,this.save(e),!0}return!1}}])&&ne(n.prototype,r),o&&ne(n,o),t}();function le(e){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fe(e,t){return!t||"object"!==le(t)&&"function"!=typeof t?pe(e):t}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function he(e,t){return(he=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ye=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),de(pe(pe(r=fe(this,ge(t).call(this,e,n)))),"type",g.Form),de(pe(pe(r)),"count",0),n.forms?(r.cases=n.forms.inputs.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):fe(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&he(e,t)}(t,$),n=t,(r=[{key:"createCase",value:function(e){return new ue(this,e)}},{key:"send",value:function(e){var t=mr.$q.defer(),n=!0;return this.cases.map(function(e){e.validate()||(n=!1)}),n?(this.filled=!0,this.engageform.sendAnswerCallback(this.engageform.title||this.engageform.id,this.engageform.current?this.engageform.current.title||this.engageform.current.id:null,this.cases[0]),t.resolve(this.cases[0].send())):(this.filled=!1,t.resolve({})),t.promise}},{key:"selectAnswer",value:function(e){this.cases.map(function(t){t.value=e[t.id]||"",e.inputs&&e.inputs.forEach(function(e){e._id===t.id&&(t.value=e.value)})})}},{key:"setResults",value:function(e){this.count=e.count||0}}])&&ce(n.prototype,r),o&&ce(n,o),t}();function be(e){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function me(e,t,n){return(me="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=we(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function we(e){return(we=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var _e=function(e){function t(e,n){var r,o,i,a,s,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=we(t).call(this,e,n))||"object"!==be(i)&&"function"!=typeof i?Pe(o):i,a=Pe(Pe(r)),s="type",u=J.Text,s in a?Object.defineProperty(a,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[s]=u,r.title=n.text,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this,n=void 0;if(this.page.type===g.MultiChoice&&(n=this.page),this.page.settings.allowMultipleChoice&&n){var r=!1,o=!0,i=!1,a=void 0;try{for(var s,u=n.selectedItemsIds[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){if(s.value==this.id){r=!0;break}}}catch(e){i=!0,a=e}finally{try{o||null==u.return||u.return()}finally{if(i)throw a}}if(r&&!this.page.engageform.settings.allowAnswerChange)return mr.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"});if(!r&&this.page.settings.maxAnswersCount&&n.selectedItemsCount>=this.page.settings.maxAnswersCount)return mr.$q.reject({textKey:"NO_MORE_CHOICES_ALLOWED",message:"No more choices is allowed"})}else if((!this.page.settings.allowMultipleChoice||!n)&&!this.page.engageform.settings.allowAnswerChange&&this.page.filled)return mr.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"});return me(we(t.prototype),"makeSend",this).call(this,{selectedAnswerIds:[this.id]}).then(function(n){var r={};for(var o in n.selectedAnswerIds&&(r.selectedCaseIds=n.selectedAnswerIds),n.correctAnswerIds&&(r.correctCaseIds=n.correctAnswerIds),n.stats)n.stats.hasOwnProperty(o)&&(r.results=r.results||{},/.{24}/.test(o)&&(r.results[o]=n.stats[o]));return me(we(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&ve(n.prototype,r),o&&ve(n,o),t}();function ke(e){return(ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function je(e,t){return!t||"object"!==ke(t)&&"function"!=typeof t?Ee(e):t}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ee(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Te=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),xe(Ee(Ee(r=je(this,Se(t).call(this,e,n)))),"type",g.MultiChoice),xe(Ee(Ee(r)),"selectedItemsCount",0),xe(Ee(Ee(r)),"selectedItemsIds",[]),n.answers?(r.cases=n.answers.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):je(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ie(e,t)}(t,$),n=t,(r=[{key:"createCase",value:function(e){return new _e(this,e)}},{key:"refreshAnswer",value:function(e,t){return t.answers.map(function(t){e.results&&(e.results[t._id]=t.percent)}),e}},{key:"selectAnswer",value:function(e){var t=this;this.cases.map(function(n){n.selected=!1,n.correct=!1,n.incorrect=!1;var r=void 0;e.selectedCaseIds&&(r=e.selectedCaseIds.filter(function(e){return n.id===e})),r&&r.length>0&&(t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n),t.filled=!0,n.selected=!0),e.results&&(n.result=e.results[n.id]||0);var o=[];e.correctCaseIds&&(o=e.correctCaseIds.filter(function(e){return n.id===e&&n.selected})),o&&o.length>0?n.correct=!0:n.incorrect=!0}),this.selectedItemsIds=this.cases.filter(function(e){return e.selected}).map(function(e){return e.id}),this.selectedItemsCount=this.selectedItemsIds.length}}])&&Ce(n.prototype,r),o&&Ce(n,o),t}();function Re(e){return(Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function De(e,t,n){return(De="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ue(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Le(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ne=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=Ue(t).call(this,e,n))||"object"!==Re(i)&&"function"!=typeof i?Le(o):i,qe(Le(Le(r)),"type",J.Image),qe(Le(Le(r)),"media",void 0),qe(Le(Le(r)),"mediaWidth",void 0),qe(Le(Le(r)),"mediaHeight",void 0),qe(Le(Le(r)),"mediaUrl",void 0),qe(Le(Le(r)),"mediaFileWidth",void 0),qe(Le(Le(r)),"mediaFileHeight",void 0),r.title=n.text,r.media=mr.cloudinary.prepareImageUrl(n.imageFile,t.mediaWidth,n.imageData),n.imageFileData&&(r.mediaFileWidth=n.imageFileData.width,r.mediaFileHeight=n.imageFileData.height),r.mediaUrl=n.imageFileUrl,r.mediaWidth=t.mediaWidth,n.imageData&&n.imageData.containerRatio?r.mediaHeight=Math.round(t.mediaWidth*n.imageData.containerRatio):r.mediaHeight=Math.round(n.imageData.containerHeight||0),r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this,n=void 0;if(this.page.type===g.PictureChoice&&(n=this.page),this.page.settings.allowMultipleChoice&&n){var r=!1,o=!0,i=!1,a=void 0;try{for(var s,u=n.selectedItemsIds[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){if(s.value==this.id){r=!0;break}}}catch(e){i=!0,a=e}finally{try{o||null==u.return||u.return()}finally{if(i)throw a}}if(r&&!this.page.engageform.settings.allowAnswerChange)return mr.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"});if(!r&&this.page.settings.maxAnswersCount&&n.selectedItemsCount>=this.page.settings.maxAnswersCount)return mr.$q.reject({textKey:"NO_MORE_CHOICES_ALLOWED",message:"No more choices is allowed"})}else if((!this.page.settings.allowMultipleChoice||!n)&&!this.page.engageform.settings.allowAnswerChange&&this.page.filled)return mr.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"});return De(Ue(t.prototype),"makeSend",this).call(this,{selectedAnswerIds:[this.id]}).then(function(n){var r={selectedCaseIds:n.selectedAnswerIds,correctCaseIds:n.correctAnswerIds};for(var o in n.stats)n.stats.hasOwnProperty(o)&&(r.results=r.results||{},/.{24}/.test(o)&&(r.results[o]=n.stats[o]));return De(Ue(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&Ae(n.prototype,r),o&&Ae(n,o),t}();function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Be(e,t){return!t||"object"!==Fe(t)&&"function"!=typeof t?He(e):t}function $e(e){return($e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function We(e,t){return(We=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function He(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}qe(Ne,"mediaWidth",300);var ze=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ge(He(He(r=Be(this,$e(t).call(this,e,n)))),"type",g.PictureChoice),Ge(He(He(r)),"selectedItemsCount",0),Ge(He(He(r)),"selectedItemsIds",[]),n.answers?(r.cases=n.answers.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):Be(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&We(e,t)}(t,$),n=t,(r=[{key:"createCase",value:function(e){return new Ne(this,e)}},{key:"refreshAnswer",value:function(e,t){return t.answers.map(function(t){e.results&&(e.results[t._id]=t.percent)}),e}},{key:"selectAnswer",value:function(e){var t=this;this.cases.map(function(n){n.selected=!1,n.correct=!1,n.incorrect=!1;var r=void 0;e.selectedCaseIds&&(r=e.selectedCaseIds.filter(function(e){return n.id===e})),r&&r.length>0&&(t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n),t.filled=!0,n.selected=!0),e.results&&(n.result=e.results[n.id]||0);var o=[];e.correctCaseIds&&(o=e.correctCaseIds.filter(function(e){return n.id===e&&n.selected})),o&&o.length>0?n.correct=!0:n.incorrect=!0}),this.selectedItemsIds=this.cases.filter(function(e){return e.selected}).map(function(e){return e.id}),this.selectedItemsCount=this.selectedItemsIds.length}}])&&Ve(n.prototype,r),o&&Ve(n,o),t}();function Ke(e){return(Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qe(e){return(Qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Je(e,t){return(Je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ze=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=Qe(t).call(this,e,n))||"object"!==Ke(i)&&"function"!=typeof i?Xe(o):i,Ye(Xe(Xe(r)),"type",g.Poster),Ye(Xe(Xe(r)),"button",void 0),Ye(Xe(Xe(r)),"exitLink",void 0),Ye(Xe(Xe(r)),"exitLinkNewWindow",void 0),Ye(Xe(Xe(r)),"link",void 0),n.coverPage&&(r.button=n.coverPage.buttonText,r.exitLink=n.coverPage.exitLink,r.exitLinkNewWindow=n.coverPage.exitLinkNewWindow,r.link=n.coverPage.link),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Je(e,t)}(t,$),t}();function et(e){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nt(e,t,n){return(nt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=rt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function rt(e){return(rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function it(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function at(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var st=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=rt(t).call(this,e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){at(e,t,n[t])})}return e}({},n,{_id:""})))||"object"!==et(i)&&"function"!=typeof i?it(o):i,at(it(it(r)),"type",J.Iteration),at(it(it(r)),"symbol",void 0),at(it(it(r)),"ordinal",void 0),r.ordinal=n.ordinal,r.symbol=n.symbol,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?mr.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"}):nt(rt(t.prototype),"makeSend",this).call(this,{quizQuestionId:this.page.id,rateItValue:this.ordinal}).then(function(n){var r={};return null!==n.selectedValue&&void 0!==n.selectedValue&&(r.selectedValue=n.selectedValue),n.avgRateItValue&&(r.result=+n.avgRateItValue),nt(rt(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&tt(n.prototype,r),o&&tt(n,o),t}();function ut(e){return(ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lt(e){return(lt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ft(e,t,n){return t&&ct(e.prototype,t),n&&ct(e,n),e}function gt(e,t){return(gt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ht(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var dt=function(e){function t(e,n){var r,o,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,i=lt(t).call(this,e,n),r=!i||"object"!==ut(i)&&"function"!=typeof i?ht(o):i,pt(ht(ht(r)),"type",g.Rateit),pt(ht(ht(r)),"result",0),pt(ht(ht(r)),"labelMin",void 0),pt(ht(ht(r)),"labelMax",void 0),pt(ht(ht(r)),"selectedValue",void 0),r.labelMin=n.rateIt.minLabel,r.labelMax=n.rateIt.maxLabel;var a="number"===n.rateIt.rateType&&n.rateIt.linearScale&&n.rateIt.linearScale.maxValue,s=a?r.range(n.rateIt.linearScale.minValue,n.rateIt.linearScale.maxValue+1):Array(n.rateIt.maxRateItValue);return r.cases=Array.apply(null,s).map(function(e,t){return r.createCase(a?e:t+1,n.rateIt.rateType)}),r.sent().then(function(e){e.selectedValue&&(r.selectedValue=e.selectedValue,r.selectAnswer(e))}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gt(e,t)}(t,$),ft(t,[{key:"shouldShowResults",value:function(){return this.settings.showResults&&this.result>0}}]),ft(t,[{key:"range",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Array(Math.ceil((t-e)/n)).fill(e).map(function(e,t){return e+t*n})}},{key:"createCase",value:function(e,t){return new st(this,{ordinal:e,symbol:t})}},{key:"selectAnswer",value:function(e){var t=this;null!==e.selectedValue&&void 0!==e.selectedValue&&(this.filled=!0,this.selectedValue=e.selectedValue),e.result&&(this.result=e.result),this.cases.map(function(n){n.selected=e.selectedValue>=n.ordinal,e.selectedValue===n.ordinal&&t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n)})}},{key:"setResults",value:function(e){this.result=e.average||0,this.selectedValue=e.average||0}}]),t}();function yt(e){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function vt(e,t,n){return(vt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=mt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function mt(e){return(mt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wt(e,t){return(wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ot(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _t=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=mt(t).call(this,e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Pt(e,t,n[t])})}return e}({},n,{_id:""})))||"object"!==yt(i)&&"function"!=typeof i?Ot(o):i,Pt(Ot(Ot(r)),"type",J.Slider),Pt(Ot(Ot(r)),"ordinal",void 0),r.ordinal=n.ordinal,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wt(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?mr.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"}):vt(mt(t.prototype),"makeSend",this).call(this,{quizQuestionId:this.page.id,sliderValue:this.ordinal}).then(function(n){var r={};return n.selectedValue&&(r.selectedValue=n.selectedValue),n.avgSliderValue&&(r.result=+n.avgSliderValue),vt(mt(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&bt(n.prototype,r),o&&bt(n,o),t}();function kt(e){return(kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ct(e){return(Ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function jt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function St(e,t,n){return t&&jt(e.prototype,t),n&&jt(e,n),e}function It(e,t){return(It=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Et(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Tt=function(e){function t(e,n){var r,o,i;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,i=Ct(t).call(this,e,n),r=!i||"object"!==kt(i)&&"function"!=typeof i?Et(o):i,xt(Et(Et(r)),"type",g.Slider),xt(Et(Et(r)),"result",0),xt(Et(Et(r)),"minValue",void 0),xt(Et(Et(r)),"maxValue",void 0),xt(Et(Et(r)),"valueLabel",void 0),xt(Et(Et(r)),"valueLabelOption",void 0),xt(Et(Et(r)),"labelTypeOption",void 0),xt(Et(Et(r)),"color",void 0),xt(Et(Et(r)),"highlightColor",void 0),xt(Et(Et(r)),"barColor",void 0),xt(Et(Et(r)),"minLabel",void 0),xt(Et(Et(r)),"midLabel",void 0),xt(Et(Et(r)),"maxLabel",void 0),xt(Et(Et(r)),"sliderData",void 0),xt(Et(Et(r)),"selectedValue",0),r.minValue=0,r.maxValue=100,n.settings.slider){var a,s;r.minValue=n.settings.slider.minValue,r.maxValue=n.settings.slider.maxValue,r.valueLabel=n.settings.slider.valueLabel,r.valueLabelOption=n.settings.slider.valueLabelOption,r.labelTypeOption=n.settings.slider.labelTypeOption,r.color=n.settings.slider.color,r.highlightColor=n.settings.slider.highlightColor,r.barColor=n.settings.slider.barColor,r.minLabel=n.settings.slider.minLabel,r.midLabel=n.settings.slider.midLabel,r.maxLabel=n.settings.slider.maxLabel;var u=r.hexToRgba(n.settings.slider.highlightColor),l=r.formBrightnessColor(parseFloat(e.theme.backgroundBrightness));u&&l&&(a=r.sumTwoColors(u,l),s=r.isTextDark(a[0],a[1],a[2],a[3])?"#454545":"#eee"),r.sliderData={floor:n.settings.slider.minValue,ceil:n.settings.slider.maxValue,startValue:n.settings.slider.startValue,step:n.settings.slider.step,showSelectionBar:!0,customTemplateScope:{barColor:n.settings.slider.barColor,labelFont:e.theme.font,labelColor:n.settings.slider.color,labelBackground:n.settings.slider.highlightColor,valueColor:s},translate:function(e,t,r){return"model"===r?"suffix"===n.settings.slider.valueLabelOption?e+" "+n.settings.slider.valueLabel:"prefix"===n.settings.slider.valueLabelOption?n.settings.slider.valueLabel+" "+e:e:"label"===n.settings.slider.labelTypeOption?e:""},getSelectionBarColor:function(){return n.settings.slider.highlightColor},getPointerColor:function(){return n.settings.slider.highlightColor},onEnd:function(e,t,n,r){return{sliderId:e,modelValue:t,highValue:n,pointerType:r}}}}return r.cases=[r.createCase(r.minValue||0)],r.sent().then(function(e){e.selectedValue&&(r.selectedValue=e.selectedValue,r.selectAnswer(e))}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&It(e,t)}(t,$),St(t,[{key:"shouldShowResults",value:function(){return this.settings.showResults&&this.result>0}}]),St(t,[{key:"createCase",value:function(e){return new _t(this,{ordinal:e})}},{key:"selectAnswer",value:function(e){var t=this;e.selectedValue&&(this.filled=!0,this.selectedValue=e.selectedValue),e.result&&(this.result=e.result),this.cases.map(function(n){n.selected=e.selectedValue>=n.ordinal,e.selectedValue===n.ordinal&&t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n)})}},{key:"setResults",value:function(e){this.result=e.average||0,this.selectedValue=e.average||0}},{key:"formBrightnessColor",value:function(e){return e<50?[0,0,0,1-2*e/100]:[255,255,255,2*(e-50)/100]}},{key:"hexToRgba",value:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),1]:null}},{key:"isTextDark",value:function(e,t,n,r){var o;return o=299*e+587*t+114*n,(o/=1e3)>125||r&&r<.6}},{key:"sumTwoColors",value:function(e,t){var n=t[3]+e[3]*(1-t[3]),r=(t[0]*t[3]+e[0]*e[3]*(1-t[3]))/n,o=(t[1]*t[3]+e[1]*e[3]*(1-t[3]))/n,i=(t[2]*t[3]+e[2]*e[3]*(1-t[3]))/n;return[Math.round(r),Math.round(o),Math.round(i),n]}}]),t}();function Rt(e){return(Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function At(e){return(At=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dt(e,t){return(Dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ut(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Lt=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=At(t).call(this,e,n))||"object"!==Rt(i)&&"function"!=typeof i?Ut(o):i,Mt(Ut(Ut(r)),"type",g.StartPage),Mt(Ut(Ut(r)),"isCoverPage",!0),Mt(Ut(Ut(r)),"button",void 0),n.coverPage&&void 0!==n.coverPage.buttonText&&(r.button=n.coverPage.buttonText),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Dt(e,t)}(t,$),t}();function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Nt(e){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ft(e,t){return(Ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $t=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=Nt(t).call(this,e,n))||"object"!==qt(i)&&"function"!=typeof i?Vt(o):i,Bt(Vt(Vt(r)),"type",g.SummaryPage),Bt(Vt(Vt(r)),"stats",void 0),n.text?r.title=n.text:e.type===a.Outcome?r.title="Outcomes":r.title="Scores",r.stats=n.stats,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ft(e,t)}(t,$),t}();function Wt(e){return(Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ht(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gt(e,t,n){return(Gt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=zt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function zt(e){return(zt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kt(e,t){return(Kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Jt=function(e){function t(e,n){var r,o,i,a,s,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=zt(t).call(this,e,n))||"object"!==Wt(i)&&"function"!=typeof i?Qt(o):i,a=Qt(Qt(r)),s="type",u=J.Project,s in a?Object.defineProperty(a,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[s]=u,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kt(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this;return Gt(zt(t.prototype),"makeSend",this).call(this,{selectedAnswerIds:[this.id]}).then(function(n){var r={};return Gt(zt(t.prototype),"save",e).call(e,r),r})}}])&&Ht(n.prototype,r),o&&Ht(n,o),t}();function Xt(e){return(Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zt(e,t){return!t||"object"!==Xt(t)&&"function"!=typeof t?nn(e):t}function en(e){return(en=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tn(e,t){return(tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var rn=function(e){function t(e,n){var r,o,i,a;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=Zt(this,en(t).call(this,e,n)),o=nn(nn(r)),i="type",a=g.Project,i in o?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a,!n.answers)return Zt(r);r.cases=n.answers.map(function(e){return r.createCase(e)});var s=n.answers.length?n.answers[0]:null;return r.projectId=s?s._id:null,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tn(e,t)}(t,$),n=t,(r=[{key:"createCase",value:function(e){return new Jt(this,e)}}])&&Yt(n.prototype,r),o&&Yt(n,o),t}();function on(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var an=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),on(this,"allowAnswerChange",!1),on(this,"hideMessageAfterDelay",3e3),on(this,"share",void 0),on(this,"tracking",void 0),on(this,"slider",void 0),t.settings&&(this.allowAnswerChange=!!t.settings.allowAnswerChange,this.tracking=t.settings.tracking,t.settings.hideMessageAfterDelay&&(this.hideMessageAfterDelay=t.settings.hideMessageAfterDelay),t.settings.share&&(this.share=t.settings.share,!this.share.imageUrl&&mr.getConfig("share")&&mr.getConfig("share").defaultImgUrl&&(this.share.imageUrl=mr.getConfig("share").defaultImgUrl)),t.settings.slider&&(this.slider=t.settings.slider))};function sn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var un=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),sn(this,"liveTitle","Live"),sn(this,"chatTitle","Chat"),sn(this,"logoUrl",""),sn(this,"headerText",""),t.tabs&&(t.tabs.liveTitle&&(this.liveTitle=t.tabs.liveTitle),t.tabs.chatTitle&&(this.chatTitle=t.tabs.chatTitle),t.tabs.logoUrl&&(this.logoUrl=mr.getConfig("backend").api+mr.getConfig("backend").imagesUrl+"/"+t.tabs.logoUrl),t.tabs.headerText&&(this.headerText=t.tabs.headerText))};function ln(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var fn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),cn(this,"answerBackgroundColor",""),cn(this,"answerBorderColor",""),cn(this,"answerColor",""),cn(this,"answerRadius",""),cn(this,"backgroundBrightness",""),cn(this,"backgroundColor",""),cn(this,"backgroundImageBlur",""),cn(this,"backgroundImageFile",""),cn(this,"backgroundImagePosition",""),cn(this,"buttonColor",""),cn(this,"font",""),cn(this,"fontUrl",""),cn(this,"questionColor",""),cn(this,"customThemeCssFile",""),cn(this,"backgroundImageConvertedFile",""),cn(this,"tabBorderColor",""),cn(this,"tabFontColor",""),cn(this,"tabColor",""),cn(this,"embedSettings",void 0),this.embedSettings=n,t.theme&&(this.answerBackgroundColor=t.theme.answerBackgroundColor||"",this.answerBorderColor=t.theme.answerBorderColor||"",this.answerColor=t.theme.answerColor||"",this.answerRadius=t.theme.answerRadius||"",this.backgroundBrightness=t.theme.backgroundBrightness||"",this.backgroundColor=t.theme.backgroundColor||"",this.backgroundImageBlur=t.theme.backgroundImageBlur||"",this.backgroundImageFile=t.theme.backgroundImageFile||"",this.backgroundImagePosition=t.theme.backgroundImagePosition||"",this.buttonColor=t.theme.buttonColor||"",this.font=t.theme.font||"",this.fontUrl=t.theme.fontUrl||"",this.questionColor=t.theme.questionColor||"",this.tabColor=t.theme.tabColor||"",this.tabFontColor=t.theme.tabFontColor||"",this.tabBorderColor=t.theme.tabBorderColor||"",t.theme.customThemeCssFile&&(this.customThemeCssFile=mr.config.backend.api+"/uploads/"+t.theme.customThemeCssFile),t.theme.backgroundImageFile&&this.convertBackgroundImage())}var t,n,r;return t=e,(n=[{key:"convertBackgroundImage",value:function(){this.backgroundImageConvertedFile=mr.cloudinary.prepareBackgroundImageUrl(this.backgroundImageFile,window.innerWidth,"auto"===this.embedSettings.height?null:window.innerHeight,parseInt(this.backgroundImageBlur,10),this.backgroundImagePosition)}}])&&ln(t.prototype,n),r&&ln(t,r),e}();function gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function hn(e,t,n){return t&&gn(e.prototype,t),n&&gn(e,n),e}function pn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var dn=function(){function e(t,n,o,i){var s=this,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),pn(this,"_engageformId",void 0),pn(this,"_pages",{}),pn(this,"_startPages",[]),pn(this,"_endPages",[]),pn(this,"_availablePages",[]),pn(this,"_hasForms",!1),pn(this,"sendAnswerCallback",void 0),pn(this,"enabled",!0),pn(this,"type",a.Undefined),pn(this,"title",void 0),pn(this,"message",void 0),pn(this,"settings",void 0),pn(this,"theme",void 0),pn(this,"branding",void 0),pn(this,"tabs",void 0),pn(this,"themeType",void 0),pn(this,"embedSettings",void 0),pn(this,"texts",void 0),pn(this,"skipLogicSelectedEndPage",0),pn(this,"current",void 0),pn(this,"navigation",void 0),pn(this,"meta",void 0),pn(this,"answers",new Map),pn(this,"event",void 0),pn(this,"mode",void 0),pn(this,"showGoogleAds",void 0),pn(this,"integrations",void 0),this._engageformId=t._id,this.mode=n,this.embedSettings=i,this.initUserId(this._engageformId,t.type===r.Live),this.sendAnswerCallback=u,this.title=t.title,this.settings=new an(t),this.theme=new fn(t,i),this.tabs=new un(t),this.texts=t.texts,this.themeType=this.getThemeType(t.theme.backgroundColor),this.event=new U,this.branding=A.create(t.type,t.settings&&t.settings.branding),this.showGoogleAds=t.showGoogleAds,this.integrations=t.integrations;var l=this.buildPages(o||[],this.settings);l.forEach(function(e){return s.storePage(e)}),this._hasForms=l.some(function(e){return e.type===g.Form});var c=t.skipLogic&&"{}"!==t.skipLogic;this.navigation=c?x.fromEnageformAndData(this,t):m.fromEnageform(this),this.meta=q.fromEngageform(this)}return hn(e,[{key:"getPageById",value:function(e){return this.pages[e]}},{key:"getPageByIndex",value:function(e){return this.pages[this.availablePages[e]]}},{key:"getPageIndex",value:function(e){return e?this.availablePages.indexOf(e.id):0}},{key:"getEndPageIndex",value:function(e){return e?this.endPages.indexOf(e.id):0}},{key:"isType",value:function(e){return this.type===e}},{key:"isNormalMode",value:function(){return Boolean(this.mode===i.Default||this.mode===i.Preview)}},{key:"isSummaryMode",value:function(){return Boolean(this.mode===i.Summary)}},{key:"isResultsMode",value:function(){return Boolean(this.mode===i.Result)}},{key:"isPreviewMode",value:function(){return Boolean(this.mode===i.Preview)}},{key:"id",get:function(){return this._engageformId}},{key:"pages",get:function(){return this._pages}},{key:"startPages",get:function(){return this._startPages}},{key:"endPages",get:function(){return this._endPages}},{key:"availablePages",get:function(){return this._availablePages}},{key:"typeName",get:function(){return a[this.type].toLowerCase()}},{key:"hasForms",get:function(){return this._hasForms}}]),hn(e,[{key:"setUserIdent",value:function(e){mr.user.id=e}},{key:"getUserIdent",value:function(e){return mr.user.id}},{key:"setEventUserId",value:function(e,t){mr.user.setEventUserId(e,t)}},{key:"getEventUserId",value:function(e){return mr.user.getEventUserId(e)}},{key:"initUserId",value:function(e,t){return mr.user.initUserId(e,t)}},{key:"storePage",value:function(e){return e.type===g.StartPage?(this.isNormalMode()||this.isSummaryMode())&&this._startPages.push(e.id):e.type===g.EndPage?(this.isNormalMode()||this.isSummaryMode())&&this._endPages.push(e.id):this._availablePages.push(e.id),this._pages[e.id]=e,e}},{key:"initPage",value:function(e){return this.storePage(this.buildPages([e],this.settings)[0]),this.setCurrent(e._id)}},{key:"setCurrent",value:function(e){var t=this._pages[e];return this.current=t,t}},{key:"setCurrentEndPage",value:function(){var e=mr.config.backend.domain+mr.getConfig("engageform").engageformFinishUrl;return e=e.replace(":engageformId",this._engageformId),mr.mode!==i.Default&&(e+="?preview"),mr.$http.post(e,{userIdent:mr.user.sessionId,globalUserIdent:mr.user.id}).then(function(e){return-1!==[200,304].indexOf(e.status)?(mr.localStorage.clearAll(),mr.user.id=e.data.globalUserIdent,e.data):mr.$q.reject(e)})}},{key:"cleanPages",value:function(){this._availablePages.length=0,this._pages={}}},{key:"buildPages",value:function(e,t){var n=this;return e.map(function(e){return n.createPage(e,t)}).filter(function(e){return Boolean(e)})}},{key:"createPage",value:function(e,t){switch(e.type){case g.EndPage:return new X(this,e,t);case g.Form:return new ye(this,e);case g.MultiChoice:return new Te(this,e);case g.PictureChoice:return new ze(this,e);case g.Rateit:return new dt(this,e);case g.Slider:return new Tt(this,e);case g.StartPage:return new Lt(this,e);case g.Poster:return new Ze(this,e);case g.Project:return new rn(this,e);default:throw new Error("Trying to construct an unknown page.")}}},{key:"setSummary",value:function(e){var t=this;e.forEach(function(e){e.stats&&t._pages[e.stats.questionId]&&t._pages[e.stats.questionId].setResults(e)})}},{key:"setAnswers",value:function(e){var t=e.questions;for(var n in t)if(this._pages[n]){var r=t[n];this._pages[n].selectAnswer({selectedCaseIds:r.selectedAnswerIds,inputs:r.inputs,selectedValue:r.sliderValue?r.sliderValue:r.rateItValue})}}},{key:"setResultPage",value:function(e){var t={_id:"summaryPage",type:g.SummaryPage,settings:{showCorrectAnswer:!0},stats:e},n=new $t(this,t);this.storePage(n)}},{key:"setUserResultPage",value:function(e){var t={_id:"RESULT_PAGE",type:"summaryPage",settings:{}};"outcome"===e.type?Object(o.extend)(t,{text:"User's outcome: "+e.outcome}):"calculator"===e.type?Object(o.extend)(t,{text:"User's score: "+e.score}):Object(o.extend)(t,{text:"User's score: "+e.score+" / "+e.maxScore});var n=new $t(this,t);this.storePage(n)}},{key:"setAnswer",value:function(e,t){var n=Object(o.get)(t,"selectedCaseIds")||Object(o.get)(t,"selectedValue")||t;this.answers.set(e,n)}},{key:"getThemeType",value:function(e){var t=this.colorToRgb(e);return.299*t.red+.587*t.green+.114*t.blue>186?"light":"dark"}},{key:"colorToRgb",value:function(e){var t;if("#"===e[0])e=e.substr(1);else{var n=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);e=n&&4===n.length?("0"+parseInt(n[1],10).toString(16)).slice(-2)+("0"+parseInt(n[2],10).toString(16)).slice(-2)+("0"+parseInt(n[3],10).toString(16)).slice(-2):""}if(3===e.length){var r=e;e="",r=(r=/^([a-f0-9])([a-f0-9])([a-f0-9])$/i.exec(r)).slice(1);for(var o=0;o<3;o++)e+=r[o]+r[o]}if(!(t=/^([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i.exec(e)))throw new Error("Invalid color.");return t=t.slice(1),{red:parseInt(t[0],16),green:parseInt(t[1],16),blue:parseInt(t[2],16)}}}]),e}();function yn(e){return(yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function vn(e,t,n){return(vn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=mn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function mn(e){return(mn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wn(e,t){return(wn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function On(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Pn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var l=arguments.length,c=new Array(l),f=0;f<l;f++)c[f]=arguments[f];return r=this,n=!(o=(e=mn(t)).call.apply(e,[this].concat(c)))||"object"!==yn(o)&&"function"!=typeof o?On(r):o,i=On(On(n)),s="type",u=a.Live,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wn(e,t)}(t,dn),n=t,(r=[{key:"initPages",value:function(){var e=mr.$q.defer();return e.resolve(this),e.promise}},{key:"initPage",value:function(e){return this.cleanPages(),vn(mn(t.prototype),"initPage",this).call(this,e)}},{key:"setCurrentEndPage",value:function(){var e=mr.$q.defer();return e.resolve(),e.promise}}])&&bn(n.prototype,r),o&&bn(n,o),t}();function _n(e){return(_n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Cn(e,t,n){return(Cn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=jn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function jn(e){return(jn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Sn(e,t){return(Sn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function In(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var En=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var l=arguments.length,c=new Array(l),f=0;f<l;f++)c[f]=arguments[f];return r=this,n=!(o=(e=jn(t)).call.apply(e,[this].concat(c)))||"object"!==_n(o)&&"function"!=typeof o?In(r):o,i=In(In(n)),s="type",u=a.Outcome,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Sn(e,t)}(t,dn),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return Cn(jn(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){var n=!1;return e.endPages.map(function(r){e.pages[r].outcome===t.outcome&&(n=!0,e.setCurrent(r))}),n||(e.enabled=!1,e.message="Thank you!"),t})}}])&&kn(n.prototype,r),o&&kn(n,o),t}();function xn(e){return(xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Tn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Rn(e,t,n){return(Rn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=An(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function An(e){return(An=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dn(e,t){return(Dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Un(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Mn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var l=arguments.length,c=new Array(l),f=0;f<l;f++)c[f]=arguments[f];return r=this,n=!(o=(e=An(t)).call.apply(e,[this].concat(c)))||"object"!==xn(o)&&"function"!=typeof o?Un(r):o,i=Un(Un(n)),s="type",u=a.Poll,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Dn(e,t)}(t,dn),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return Rn(An(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){if(e.endPages.length){var n=e.skipLogicSelectedEndPage;e.setCurrent(e.endPages[n])}else e.enabled=!1,e.message="Thank you!";return t})}}])&&Tn(n.prototype,r),o&&Tn(n,o),t}();function Ln(e){return(Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Nn(e,t,n){return(Nn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Fn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Fn(e){return(Fn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vn(e,t){return(Vn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Bn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var $n=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var l=arguments.length,c=new Array(l),f=0;f<l;f++)c[f]=arguments[f];return r=this,n=!(o=(e=Fn(t)).call.apply(e,[this].concat(c)))||"object"!==Ln(o)&&"function"!=typeof o?Bn(r):o,i=Bn(Bn(n)),s="type",u=a.Score,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vn(e,t)}(t,dn),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return Nn(Fn(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){var n=t.totalScore;if(1===e.endPages.length){var r=e.endPages[0];e.pages[r].score=t.totalScore,e.setCurrent(r)}else if(e.endPages.length>1){var o=!1;e.endPages.map(function(t){var r=e.pages[t],i=r.rangeMin,a=void 0===i?void 0:i,s=r.rangeMax,u=void 0===s?void 0:s;(!a||a<=n)&&(!u||u>=n)&&(o=!0,r.score=n,e.setCurrent(t))}),o||(e.enabled=!1,e.message="Thank you!")}return t})}}])&&qn(n.prototype,r),o&&qn(n,o),t}();function Wn(e){return(Wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gn(e,t,n){return(Gn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=zn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function zn(e){return(zn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kn(e,t){return(Kn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Jn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var l=arguments.length,c=new Array(l),f=0;f<l;f++)c[f]=arguments[f];return r=this,n=!(o=(e=zn(t)).call.apply(e,[this].concat(c)))||"object"!==Wn(o)&&"function"!=typeof o?Qn(r):o,i=Qn(Qn(n)),s="type",u=a.Calculator,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kn(e,t)}(t,dn),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return Gn(zn(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){if(e.endPages.length>1){var n=!1;e.endPages.map(function(r){var o=e.pages[r],i=o.rangeMin,a=void 0===i?void 0:i,s=o.rangeMax,u=void 0===s?void 0:s;(!a||a<=t.totalScore)&&(!u||u>=t.totalScore)&&(n=!0,o.score=t.totalScore,e.setCurrent(r))}),n||(e.enabled=!1,e.message="Thank you!")}else if(1===e.endPages.length){var r=e.endPages[0];e.pages[r].score=t.totalScore,e.setCurrent(r)}else e.enabled=!1,e.message="Thank you!";return t})}}])&&Hn(n.prototype,r),o&&Hn(n,o),t}();function Xn(e){return(Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zn(e,t,n){return(Zn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=er(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function er(e){return(er=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tr(e,t){return(tr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var rr=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var l=arguments.length,c=new Array(l),f=0;f<l;f++)c[f]=arguments[f];return r=this,n=!(o=(e=er(t)).call.apply(e,[this].concat(c)))||"object"!==Xn(o)&&"function"!=typeof o?nr(r):o,i=nr(nr(n)),s="type",u=a.Survey,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tr(e,t)}(t,dn),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return Zn(er(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){if(e.endPages.length){var n=e.skipLogicSelectedEndPage;e.setCurrent(e.endPages[n])}else e.enabled=!1,e.message="Thank you!";return t})}}])&&Yn(n.prototype,r),o&&Yn(n,o),t}();function or(e){return(or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ir(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ar(e,t,n){return(ar="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=sr(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function sr(e){return(sr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ur(e,t){return(ur=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function lr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var cr=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var l=arguments.length,c=new Array(l),f=0;f<l;f++)c[f]=arguments[f];return r=this,n=!(o=(e=sr(t)).call.apply(e,[this].concat(c)))||"object"!==or(o)&&"function"!=typeof o?lr(r):o,i=lr(lr(n)),s="type",u=a.Form,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ur(e,t)}(t,dn),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return ar(sr(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){if(e.endPages.length){var n=e.skipLogicSelectedEndPage;e.setCurrent(e.endPages[n])}else e.enabled=!1,e.message="Thank you!";return t})}}])&&ir(n.prototype,r),o&&ir(n,o),t}();function fr(e,t){return Object(o.includes)(Object(o.values)(e),t)}function gr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function hr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var pr=function(){var e,t,n;function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),hr(this,"_id",null),hr(this,"_sessionId",null),hr(this,"_eventUserIds",{})}return e=r,n=[{key:"create",value:function(){return new r}}],(t=[{key:"getEventUserId",value:function(e){var t=this._eventUserIds[e];if(!t){var n="eventUserIdent_"+e;t=mr.localStorage.get(n)}return t}},{key:"setEventUserId",value:function(e,t){var n="eventUserIdent_"+e;mr.localStorage.set(n,t),this._eventUserIds[e]=t}},{key:"initUserId",value:function(e,t){var n=this,r=mr.getConfig("backend").domain+mr.getConfig("engageform").userIdentInitUrl;r=r.replace(":quizId",e);var o=this.getEventUserId(e),i=this.id;t?o&&i||mr.$http.post(r,{}).then(function(t){o||n.setEventUserId(e,t.data.eventUserId),i||(n.id=t.data.userIdent)}):i||mr.$http.post(r,{}).then(function(e){n.id=e.data.userIdent})}},{key:"id",get:function(){return this._id||(this._id=mr.localStorage.get(r.idKey)),this._id},set:function(e){mr.localStorage.set(r.idKey,e),this._id=e}},{key:"sessionId",get:function(){return this._sessionId||(this._sessionId=mr.localStorage.get(r.sessionIdKey)),this._sessionId},set:function(e){mr.localStorage.set(r.sessionIdKey,e),this._sessionId=e}}])&&gr(e.prototype,t),n&&gr(e,n),r}();function dr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function yr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function br(e,t,n){return t&&yr(e.prototype,t),n&&yr(e,n),e}function vr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}hr(pr,"idKey","userIdent"),hr(pr,"sessionIdKey","sessionIdent"),pr.$inject=["$http"],n.d(t,"default",function(){return mr});var mr=function(){function e(t,n,r,o,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),vr(this,"_engageform",void 0),vr(this,"_event",void 0),e.$http=t,e.$q=n,e.$timeout=r,e.cloudinary=o,e.localStorage=i,e.config=a,this._event=new U,e.cloudinary.setConfig(a.cloudinary)}return br(e,null,[{key:"getConfig",value:function(t){return e.config[t]}}]),br(e,[{key:"init",value:function(t){var n=this,a=Object(o.defaults)({},t,{mode:i.Default});if(!a||!a.id)return e.$q.reject({status:"error",error:{code:406,message:"The required id property does not exist."},data:a});if(e._instances[a.id])return e._instances[a.id];if(!fr(i,a.mode))return e.$q.reject({status:"error",error:{code:406,message:"Mode property not supported."},data:a});e.mode=a.mode;var s=[e.getData("quiz",a.id),a.live?e.$q.resolve([]):e.getData("pages",a.id)];return e.$q.all(s).then(function(t){var o=dr(t,2),i=o[0],s=o[1];return fr(r,i.type)?(n._engageform=new e.quizzesConstructors[i.type](i,e.mode,s,a.embedSettings,a.callback?a.callback.sendAnswerCallback:function(){}),n._engageform):e.$q.reject({status:"error",error:{code:406,message:"Type property not supported."},data:i})})}},{key:"destroyInstances",value:function(){e._instances={}}},{key:"type",get:function(){return this._engageform?this._engageform.type:a.Undefined}},{key:"Type",get:function(){return a}},{key:"mode",get:function(){return e.mode}},{key:"Mode",get:function(){return i}},{key:"title",get:function(){if(this._engageform)return this._engageform.title}},{key:"theme",get:function(){if(this._engageform)return this._engageform.theme}},{key:"current",get:function(){if(this._engageform)return this._engageform.current}},{key:"navigation",get:function(){if(this._engageform)return this._engageform.navigation}},{key:"branding",get:function(){if(this._engageform)return this._engageform.branding}},{key:"message",get:function(){if(this._engageform)return this._engageform.message}},{key:"meta",get:function(){if(this._engageform)return this._engageform.meta}},{key:"event",get:function(){if(this._event)return this._event}},{key:"showGoogleAds",get:function(){return!!this._engageform&&this._engageform.showGoogleAds}},{key:"integrations",get:function(){if(this._engageform)return this._engageform.integrations}}],[{key:"getData",value:function(t,n){if("quiz"!==t&&"pages"!==t)throw new Error("Resource path for ".concat(t," type of data is unknown."));var r=e.getConfig("backend").domain+("quiz"===t?e.getConfig("engageform").engageformUrl:e.getConfig("engageform").engageformPagesUrl);return r=r.replace(":engageformId",n),e.mode!==i.Default&&(r+="?preview"),e.$http.get(r).then(function(t){return-1!==[200,304].indexOf(t.status)?t.data:e.$q.reject(t)})}}]),e}();vr(mr,"user",pr.create()),vr(mr,"$http",void 0),vr(mr,"$q",void 0),vr(mr,"$timeout",void 0),vr(mr,"cloudinary",void 0),vr(mr,"localStorage",void 0),vr(mr,"config",void 0),vr(mr,"mode",i.Undefined),vr(mr,"_instances",{}),vr(mr,"quizzesConstructors",{outcome:En,poll:Mn,score:$n,survey:rr,form:cr,live:Pn,calculator:Jn}),mr.$inject=["$http","$q","$timeout","cloudinary","localStorageService","ApiConfig"],f.service("Engageform",mr)}]);
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=_},function(e,t){e.exports=angular},function(e,t,n){"use strict";n.r(t);var r,o=n(0);!function(e){e.Outcome="outcome",e.Poll="poll",e.Score="score",e.Survey="survey",e.Live="live",e.Calculator="calculator"}(r||(r={}));var i,a,s,u,c,l=n(1),f=n.n(l).a.module("4screens.engageform",["4screens.util.cloudinary","LocalStorageModule"]);!function(e){e.Undefined="undefined",e.Default="default",e.Preview="preview",e.Result="results",e.Summary="summary"}(i||(i={})),function(e){e[e.Undefined=0]="Undefined",e[e.Live=1]="Live",e[e.Outcome=2]="Outcome",e[e.Poll=3]="Poll",e[e.Score=4]="Score",e[e.Survey=5]="Survey",e[e.Calculator=6]="Calculator"}(a||(a={})),function(e){e.Default="defaultRule",e.Entry="entryRule",e.Exit="exitRule"}(s||(s={})),function(e){e.And="and",e.Or="or"}(u||(u={})),function(e){e.Equal="eq",e.NotEqual="neq",e.Blank="blank",e.NotBlank="nblank",e.GreaterThan="gt",e.GreaterThanOrEqual="gte",e.LessThan="lt",e.LessThanOrEqual="lte",e.Between="between",e.Contain="contain",e.NotContain="ncontain"}(c||(c={}));var h=function(e){return e.type===s.Entry},g=function(e){return e.type===s.Exit},p=function(e){return e.type===s.Default};function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&y(e.prototype,t),n&&y(e,n),e}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m,v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),b(this,"_engageform",void 0),b(this,"visitedPages",[]),b(this,"enabled",!1),b(this,"position",0),b(this,"size",0),b(this,"hasStart",!1),b(this,"enabledStart",!0),b(this,"hasPrev",!1),b(this,"enabledPrev",!0),b(this,"hasNext",!1),b(this,"enabledNext",!0),b(this,"hasFinish",!1),b(this,"enabledFinish",!0),b(this,"distance",0),b(this,"animate","swipeNext"),b(this,"hasStartPages",!1),b(this,"hasEndPages",!1),b(this,"waitingForPageChange",null),b(this,"next",this.pick),b(this,"finish",this.pick),this._engageform=t,this.size=t.availablePages.length,this.hasEndPages=Boolean(t.endPages.length),t.startPages.length?(this.hasStart=!0,this.hasStartPages=!0,this._engageform.setCurrent(t.startPages[0])):(this.enabled=!0,this.move(),this.hasPrev=!1)}return d(e,null,[{key:"fromEnageform",value:function(t){return new e(t)}}]),d(e,[{key:"updateDistance",value:function(){return this.distance=this.position/this.size}},{key:"start",value:function(e){this.disableDefaultAction(e),this.animate="swipeNext",this.enabled=!0,this.hasStart=!1,this.move(),this.hasPrev=!0}},{key:"stopPageChange",value:function(){this.waitingForPageChange&&Kn.$timeout.cancel(this.waitingForPageChange)}},{key:"prev",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.disableDefaultAction(e),this.stopPageChange(),this.animate="swipePrev",this._engageform.current&&(this._engageform.message=""),this.position-=t,this.updateDistance(),this.hasNext=!0,this.hasFinish=!1,0===this.position?(this._engageform.setCurrent(this._engageform.startPages[0]),this.hasPrev=!1):(this._engageform.setCurrent(this._engageform.availablePages[this.position-1]),this.hasPrev=1!==this.position||this.hasStartPages)}},{key:"pick",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{quiet:!1};if(this.disableDefaultAction(e),this.stopPageChange(),this.animate="swipeNext",!this._engageform.isNormalMode()){var o=Kn.$q.defer();return o.resolve(t),this.move(t),o.promise}var i=this._engageform.current;return!t||!this._engageform.settings.allowAnswerChange&&i.filled||(t.selected=!0,t.incorrect=!1),i.send(t).then(function(){if(n.sendMessage(),!i.filled&&i.settings.requiredAnswer)return r.quiet||n.sendMessage(n._engageform.texts.ANSWER_REQUIRED_TO_PROCEED),t;var e=t?i.settings.showCorrectAnswer||i.settings.showResults?1e3:200:0;return n.waitingForPageChange=Kn.$timeout(function(){return n.waitingForPageChange=null,n.move(t),t},e),n.waitingForPageChange}).catch(function(e){return r.quiet||n.sendMessage(n._engageform.texts[e.textKey]||e.message),e})}},{key:"move",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._engageform.event.trigger("form::pageWillChange",{isStartPage:Boolean(0===this.position&&this._engageform.startPages.length)}),this.visitedPages.push(this._engageform.current),this.position+=n,n>-1&&this._engageform.availablePages.length>=this.position?(this.updateDistance(),this._engageform.setCurrent(this._engageform.availablePages[this.position-1]),this.hasPrev=!0,this.hasNext=!1,this.hasFinish=!1,this._engageform.availablePages.length>this.position?this.hasNext=!0:this._engageform.availablePages.length===this.position&&(this.hasFinish=this._engageform.isNormalMode()&&!(this._engageform.isType(a.Poll)&&!this._engageform.hasForms)),this._engageform.event.trigger("form::pageDidChange",{currentPosition:this.position,isEndPage:!1})):(this.position=this._engageform.availablePages.length,e||this._engageform.setCurrentEndPage().then(function(e){t._engageform.type!==a.Score&&t._engageform.type!==a.Outcome||t._engageform.event.trigger("finish",e.totalScore||e.outcome,e.maxScore),t._engageform.event.trigger("finish::endPage"),t.enabled=!1,t.hasPrev=!1,t.hasNext=!1,t.hasFinish=!1,t._engageform.event.trigger("form::pageDidChange",{currentPosition:t.position,isEndPage:!0})}).catch(function(e){e.data.msg&&t.sendMessage(e.data.msg)}))}},{key:"disableDefaultAction",value:function(e){e&&(e.stopPropagation(),e.preventDefault())}},{key:"sendMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this._engageform.message=t,Kn.$timeout(function(){e._engageform.message=""},this._engageform.settings.hideMessageAfterDelay)}}]),e}();function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t,n){return(P="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return t&&C(e.prototype,t),n&&C(e,n),e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Undefined=0]="Undefined",e.EndPage="endPage",e.Form="forms",e.MultiChoice="multiChoice",e.PictureChoice="pictureChoice",e.Rateit="rateIt",e.StartPage="startPage",e.Poster="poster",e.SummaryPage="summaryPage",e.Project="project"}(m||(m={}));var I=function(){function e(t,n){j(this,e),E(this,"entryRules",void 0),E(this,"exitRules",void 0),E(this,"defaultRule",void 0),E(this,"answers",void 0),this.entryRules=this.processNonDefaultRules(t.rules[s.Entry],h),this.exitRules=this.processNonDefaultRules(t.rules[s.Exit],g),this.defaultRule=Object(o.head)(t.rules[s.Default].filter(p)),this.answers=n}return S(e,[{key:"hasEntryRules",value:function(){return this.entryRules.length>0}},{key:"hasExitRules",value:function(){return this.exitRules.length>0}},{key:"resolveEntryDestination",value:function(){return this.resolveDestination(this.entryRules)}},{key:"resolveExitDestination",value:function(){return this.resolveDestination(this.exitRules)}},{key:"processNonDefaultRules",value:function(e,t){return e?e.filter(t).map(this.dropEmptyConditions).filter(this.hasConditions):[]}},{key:"dropEmptyConditions",value:function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){E(e,t,n[t])})}return e}({},e,{conditions:e.conditions.filter(function(e){return Boolean(e.to)})})}},{key:"hasConditions",value:function(e){return e.conditions.length>0}},{key:"resolveDestination",value:function(e){var t=this;return e.map(function(e){var n=e.destination,r=e.conditionsConnection;return e.conditions.map(function(e){var n=t.answers.get(e.to);if(!n)return!1;switch(function(e){return Boolean(e.field)}(e)&&(n=n[e.field]),e.is){case c.Equal:return n===e.value;case c.NotEqual:return n!==e.value;case c.GreaterThan:return n>e.value;case c.GreaterThanOrEqual:return n>=e.value;case c.LessThan:return n<e.value;case c.LessThanOrEqual:return n<=e.value;case c.Between:return e.value[0]>=n&&n<=e.value[1];case c.Blank:return!Boolean(n);case c.NotBlank:return Boolean(n);case c.Contain:return n.indexOf(e.value)>=0;case c.NotContain:return-1===n.indexOf(e.value);default:return!1}})[r===u.Or?"some":"every"](function(e){return e})?n:null}).filter(Boolean)[0]||this.defaultRule.destination}},{key:"defaultRuleValue",get:function(){return this.defaultRule}}]),e}(),x=function(e){function t(e,n){var r,o,i;j(this,t),o=this,i=O(t).call(this,e),r=!i||"object"!==w(i)&&"function"!=typeof i?k(o):i,E(k(k(r)),"logic",{});var a=n.skipLogic||{};return Object.keys(a).forEach(function(e){r.logic[e]=new I(a[e],r._engageform.answers)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,v),S(t,null,[{key:"fromEnageformAndData",value:function(e,n){return new t(e,n)}}]),S(t,[{key:"prev",value:function(e){var n=this.visitedPages.pop(),r=this._engageform.getPageIndex(this._engageform.current)-this._engageform.getPageIndex(n);P(O(t.prototype),"prev",this).call(this,e,r)}},{key:"move",value:function(e){var n,r=this._engageform.current,o=this.logic&&r?this.logic[r.id]:void 0;if(n=this._engageform.getPageByIndex(this.position),o&&o.hasExitRules()){var i=this._engageform.getPageById(o.resolveExitDestination());i&&(n=i)}if(n&&(n=this.checkEntryConditionForPage(n)),n){var a=r?this._engageform.getPageIndex(n):1;return a<0?P(O(t.prototype),"move",this).call(this,void 0,-1):P(O(t.prototype),"move",this).call(this,e,a-this._engageform.getPageIndex(r))}return P(O(t.prototype),"move",this).call(this,e,1)}},{key:"checkEntryConditionForPage",value:function(e){var t=this.logic&&e?this.logic[e.id]:void 0;if(t&&t.hasEntryRules()){var n=t.resolveEntryDestination(),r=this._engageform.getPageById(n);return r?this.checkEntryConditionForPage(r):r}return e}},{key:"isPossiblyConditionalPage",value:function(e){return[m.Form,m.MultiChoice,m.PictureChoice,m.Rateit].includes(e.type)}}]),t}();function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A=function(){var e,t,n;function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.state,i=t.text,a=t.link,s=t.imageUrl,u=arguments.length>2?arguments[2]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),T(this,"_text",void 0),T(this,"_link",void 0),T(this,"_imageUrl",void 0),T(this,"_isCustomLogo",!1),T(this,"_enabled",void 0),T(this,"_custom",void 0),this._custom=u,this._enabled=!n,this._text=o.isTextCustom(i)?i:o.defaultBranding.text,e==r.Live?this._link=a||o.defaultBranding.link_event:this._link=a||o.defaultBranding.link_project,o.isImageCustom(s)?(this._imageUrl=s?"".concat(Kn.getConfig("backend").api+Kn.getConfig("backend").imagesUrl,"/").concat(s):"",this._isCustomLogo=!0):this._imageUrl=Kn.config.backend.api+s}return e=o,n=[{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new o(e,t,o.arePropertiesCustom(t))}},{key:"arePropertiesCustom",value:function(e){var t=e.text,n=e.link,r=e.imageUrl;return Boolean(o.isTextCustom(t)||n||o.isImageCustom(r))}},{key:"isTextCustom",value:function(e){return void 0!==e}},{key:"isImageCustom",value:function(e){return void 0!==e&&e!==o.defaultBranding.imageUrl}},{key:"defaultBranding",get:function(){return Kn.getConfig("backend").branding}}],(t=[{key:"isCustom",get:function(){return this._custom}},{key:"isDefault",get:function(){return!this._custom}},{key:"isCustomLogo",get:function(){return this._isCustomLogo}},{key:"imageUrl",get:function(){return this._imageUrl}},{key:"link",get:function(){return this._link}},{key:"text",get:function(){return this._text}},{key:"enabled",get:function(){return this._enabled}}])&&R(e.prototype,t),n&&R(e,n),o}();function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var U=function(){function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r={},(n="_listener")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}var t,n,r;return t=e,(n=[{key:"listen",value:function(e,t){this._listener[e]||(this._listener[e]=[]),this._listener[e].push(t)}},{key:"trigger",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=this._listener[e];o&&o.forEach(function(e){return e.apply(e,n)})}}])&&D(t.prototype,n),r&&D(t,r),e}();function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=function(){var e,t,n;function r(e){var t=e.settings.share,n=e.endPages,i=e.startPages,a=e.pages;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),M(this,"globalTitle",void 0),M(this,"globalDescription",void 0),this.globalTitle="",this.globalDescription="",t&&(this.globalTitle=t.title||"",this.globalDescription=t.description||""),(n.length<1||!Object(o.find)(a,{social:!0}))&&i.length&&a[i[0]].title&&(this.globalTitle=a[i[0]].title,this.globalDescription=a[i[0]].description)}return e=r,n=[{key:"fromEngageform",value:function(e){return new r(e)}}],(t=null)&&q(e.prototype,t),n&&q(e,n),r}();function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),B(this,"showResults",!1),B(this,"showCorrectAnswer",!1),B(this,"showMainMedia",!1),B(this,"showDescription",!1),B(this,"requiredAnswer",!1),B(this,"mediaPosition","stack"),this.requiredAnswer=!!t.requiredAnswer,t.settings&&(this.showResults=!!t.settings.showAnswers,this.showCorrectAnswer=!!t.settings.showCorrectAnswer,this.showMainMedia=!!t.settings.showMainMedia,this.showDescription=!!t.settings.showDescription,this.mediaPosition=t.settings.mediaPosition||"stack")};function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var V=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),N(this,"id",void 0),N(this,"engageform",void 0),N(this,"type",m.Undefined),N(this,"title",""),N(this,"description",""),N(this,"media",""),N(this,"mediaWidth",0),N(this,"mediaHeight",0),N(this,"mediaUrl",""),N(this,"mediaFileWidth",0),N(this,"mediaFileHeight",0),N(this,"filled",!1),N(this,"settings",void 0),N(this,"cases",[]),N(this,"projectId",void 0),N(this,"result",void 0),this.id=n._id,this.engageform=t,this.settings=new $(n),this.title=n.text||"",this.settings.showDescription&&(this.description=n.description||""),this.settings.showMainMedia&&n.imageData&&(this.media=Kn.cloudinary.prepareImageUrl(n.imageFile,680,n.imageData),this.mediaUrl=n.imageFileUrl,this.mediaWidth=680,n.imageFileData&&(this.mediaFileWidth=n.imageFileData.width,this.mediaFileHeight=n.imageFileData.height),n.imageData.containerRatio?this.mediaHeight=Math.round(680*n.imageData.containerRatio):this.mediaHeight=Math.round(n.imageData.containerHeight||0))}var t,n,r;return t=e,(n=[{key:"send",value:function(e){if(!1===this.engageform.enabled)return Kn.$q.reject("Engageform already ended.");if(e)return e.send();var t=Kn.$q.defer();return t.resolve(),t.promise}},{key:"sent",value:function(){var e=this,t=Kn.$q.defer(),n={};return n=Kn.localStorage.get("page."+this.id)||{},this.engageform.setAnswer(this.id,n),this.settings.showResults&&n.results?this.getStatsById(this.id).then(function(r){t.resolve(e.refreshAnswer(n,r))}).catch(function(){t.resolve(n)}):t.resolve(n),t.promise}},{key:"refreshAnswer",value:function(e,t){return e}},{key:"selectAnswer",value:function(e){}},{key:"createCase",value:function(e,t){}},{key:"setResults",value:function(e){var t=this.cases.map(function(t){return t.result=Number(e.stats&&e.stats[t.id])||0,t.id});for(var n in e.stats)if(-1===t.indexOf(n)&&"questionId"!==n&&this.type!==m.Rateit){var r=this.createCase({text:"[Removed answer]",_id:n,imageData:{height:100}});r.result=Number(e.stats[r.id]),this.cases.push(r)}}},{key:"updateAnswers",value:function(e){var t=this;this.id===e.questionId&&(this.engageform.current&&!Object(o.isUndefined)(e.avg)&&(this.engageform.current.result=e.avg),Kn.$timeout(function(){t.cases.map(function(t){if(!Object(o.isUndefined)(e[t.id])){var n=t.load();n.results&&(n.results[t.id]=e[t.id],t.save(n)),t.result=e[t.id]||0}})}))}},{key:"getStatsById",value:function(e){var t=Kn.config.backend.domain+Kn.getConfig("engageform").pageStatsUrl;return t=t.replace(":pageId",e),Kn.$http.get(t).then(function(e){return-1!==[200,304].indexOf(e.status)?e.data:Kn.$q.reject(e)})}}])&&L(t.prototype,n),r&&L(t,r),e}();function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}N(V,"Type",m);var J,X=function(e){function t(e,n,r){var i,a,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,i=!(s=z(t).call(this,e,n))||"object"!==W(s)&&"function"!=typeof s?K(a):s,Q(K(K(i)),"type",m.EndPage),Q(K(K(i)),"isCoverPage",!0),Q(K(K(i)),"button",void 0),Q(K(K(i)),"outcome",void 0),Q(K(K(i)),"social",void 0),Q(K(K(i)),"score",void 0),Q(K(K(i)),"rangeMin",void 0),Q(K(K(i)),"rangeMax",void 0),Q(K(K(i)),"exitLink",void 0),Q(K(K(i)),"link",void 0),Q(K(K(i)),"redirect",void 0),Q(K(K(i)),"redirectLink",void 0),Q(K(K(i)),"socialData",void 0);var u=Object(o.defaults)({},r.share,{title:"title1",description:"desc1",link:"",imageUrl:""});return u.imageUrl&&(u.imageUrl=Kn.cloudinary.preparePreviewImageUrl(u.imageUrl,680)),i.socialData=u,n.coverPage&&(i.button=n.coverPage.buttonText,i.outcome=n.coverPage.outcome,i.social=n.coverPage.showSocialShares,i.exitLink=n.coverPage.exitLink,i.link=n.coverPage.link,i.redirect=n.coverPage.redirect,i.redirectLink=n.coverPage.redirectLink,n.coverPage.scoreRange&&(i.rangeMax=n.coverPage.scoreRange.max,i.rangeMin=n.coverPage.scoreRange.min)),i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}(t,V),n=t,(r=[{key:"personalizeShares",value:function(){"outcome"!==this.engageform.typeName&&"score"!==this.engageform.typeName||(this.socialData.title=this.engageform.texts.SCORE_AND_OUTCOME_SHARE.replace(/\$RESULT\$/gi,this.outcome||String(this.score||0)).replace(/\$TITLE\$/gi,this.engageform.title),this.media&&this.settings.showMainMedia&&(this.socialData.imageUrl=this.media))}},{key:"fbLink",get:function(){return Kn.getConfig("backend")&&Kn.getConfig("backend").domain&&Kn.getConfig("share")&&Kn.getConfig("share").facebook&&this.engageform&&this.engageform.id?(this.personalizeShares(),Kn.getConfig("backend").domain+Kn.getConfig("share").facebook+"?quizId="+this.engageform.id+"&description="+encodeURIComponent(this.socialData.description)+"&name="+encodeURIComponent(this.socialData.title)+"&image="+this.socialData.imageUrl):null}},{key:"twLink",get:function(){return this.socialData&&this.socialData.title&&this.socialData.link?(this.personalizeShares(),"https://twitter.com/intent/tweet?text="+encodeURIComponent(this.socialData.title)+" "+this.socialData.link+" via @youengageme"):null}}])&&H(n.prototype,r),i&&H(n,i),t}();function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Undefined=0]="Undefined",e[e.Image=1]="Image",e[e.Input=2]="Input",e[e.Iteration=3]="Iteration",e[e.Text=4]="Text",e[e.Project=5]="Project"}(J||(J={}));var ee=function(){function e(t,n){var r=n._id;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Z(this,"id",void 0),Z(this,"type",J.Undefined),Z(this,"page",void 0),Z(this,"selected",!1),Z(this,"correct",!1),Z(this,"incorrect",!1),Z(this,"result",0),Z(this,"title",void 0),Z(this,"error",void 0),Z(this,"value",void 0),this.page=t,this.id=r}var t,n,r;return t=e,(n=[{key:"shouldShowIndicator",value:function(){return!this.page.engageform.isSummaryMode()&&!this.page.engageform.isResultsMode()&&this.page.settings.showCorrectAnswer&&(this.selected||this.page.filled&&this.correct)}},{key:"shouldShowResults",value:function(){return this.page.engageform.isSummaryMode()||this.page.settings.showResults&&this.page.filled&&!this.page.engageform.isResultsMode()}},{key:"send",value:function(){var e=Kn.$q.defer();return e.resolve({}),e.promise}},{key:"makeSend",value:function(e){var t=this,n=Kn.getConfig("backend").domain+Kn.getConfig("engageform").pageResponseUrl;n=n.replace(":pageId",this.page.id),Kn.mode!==i.Default&&(n+="?preview"),e.quizQuestionId=this.page.id,e.userIdent=Kn.user.sessionId;var r={questionId:this.page.id,questionTitle:this.page.title,answerId:this.id,answerValue:e.inputs&&e.inputs.map(function(e){return e.value})||this.title||this.ordinal};return Kn.$http.post(n,e).then(function(n){return-1!==[200,304].indexOf(n.status)?(!e.userIdent&&n.data.userIdent&&(Kn.user.sessionId=n.data.userIdent),t.page.engageform.event.trigger("answer",r),n.data):Kn.$q.reject(n.data||{})}).catch(function(e){return Kn.$q.reject(e.data||{})})}},{key:"load",value:function(){return Kn.localStorage.get("page."+this.page.id)||{}}},{key:"save",value:function(e){this.page.engageform.setAnswer(this.page.id,e),Kn.localStorage.set("page."+this.page.id,e)}},{key:"validate",value:function(){return!0}}])&&Y(t.prototype,n),r&&Y(t,r),e}();function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(e,t,n){return(re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=oe(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function oe(e){return(oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ue=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=oe(t).call(this,e,n))||"object"!==te(i)&&"function"!=typeof i?ae(o):i,se(ae(ae(r)),"type",J.Input),se(ae(ae(r)),"expectedValue",void 0),se(ae(ae(r)),"value",""),r.title=n.label,r.expectedValue=n.type,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ie(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this,n={inputs:[]},r=this.load();for(var o in r)r.hasOwnProperty(o)&&n.inputs.push({_id:o,value:r[o]});return re(oe(t.prototype),"makeSend",this).call(this,n).then(function(){return n}).catch(function(t){return 406===t.code&&(t.textKey="INCORRECT_INPUT",t.message="Incorrect inputs sent. Try again.",e.save({})),Kn.$q.reject(t)})}},{key:"validate",value:function(){if(this.correct=!1,this.incorrect=!1,this.page.settings.requiredAnswer&&!this.value?(this.error="Answer is required",this.incorrect=!0):(this.error="",this.correct=!0),this.correct){var e=this.load();return e[this.id]=this.value,this.save(e),!0}return!1}}])&&ne(n.prototype,r),o&&ne(n,o),t}();function ce(e){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fe(e,t){return!t||"object"!==ce(t)&&"function"!=typeof t?pe(e):t}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ge(e,t){return(ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var de=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ye(pe(pe(r=fe(this,he(t).call(this,e,n)))),"type",m.Form),ye(pe(pe(r)),"count",0),n.forms?(r.cases=n.forms.inputs.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):fe(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}(t,V),n=t,(r=[{key:"createCase",value:function(e){return new ue(this,e)}},{key:"send",value:function(e){var t=Kn.$q.defer(),n=!0;return this.cases.map(function(e){e.validate()||(n=!1)}),n?(this.filled=!0,this.engageform.sendAnswerCallback(this.engageform.title||this.engageform.id,this.engageform.current?this.engageform.current.title||this.engageform.current.id:null,this.cases[0]),t.resolve(this.cases[0].send())):(this.filled=!1,t.resolve({})),t.promise}},{key:"selectAnswer",value:function(e){this.cases.map(function(t){t.value=e[t.id]||"",e.inputs&&e.inputs.forEach(function(e){e._id===t.id&&(t.value=e.value)})})}},{key:"setResults",value:function(e){this.count=e.count||0}}])&&le(n.prototype,r),o&&le(n,o),t}();function be(e){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ve(e,t,n){return(ve="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=we(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function we(e){return(we=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pe(e,t){return(Pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Oe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var _e=function(e){function t(e,n){var r,o,i,a,s,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=we(t).call(this,e,n))||"object"!==be(i)&&"function"!=typeof i?Oe(o):i,a=Oe(Oe(r)),s="type",u=J.Text,s in a?Object.defineProperty(a,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[s]=u,r.title=n.text,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pe(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?Kn.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"}):ve(we(t.prototype),"makeSend",this).call(this,{selectedAnswerId:this.id}).then(function(n){var r={};for(var o in n.selectedAnswerId&&(r.selectedCaseId=n.selectedAnswerId),n.correctAnswerId&&(r.correctCaseId=n.correctAnswerId),n.stats)n.stats.hasOwnProperty(o)&&(r.results=r.results||{},/.{24}/.test(o)&&(r.results[o]=n.stats[o]));return ve(we(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&me(n.prototype,r),o&&me(n,o),t}();function ke(e){return(ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ce(e,t){return!t||"object"!==ke(t)&&"function"!=typeof t?Ie(e):t}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ee(e,t){return(Ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ie(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var xe=function(e){function t(e,n){var r,o,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=Ce(this,Se(t).call(this,e,n)),o=Ie(Ie(r)),i="type",a=m.MultiChoice,i in o?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a,n.answers?(r.cases=n.answers.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):Ce(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ee(e,t)}(t,V),n=t,(r=[{key:"createCase",value:function(e){return new _e(this,e)}},{key:"refreshAnswer",value:function(e,t){return t.answers.map(function(t){e.results&&(e.results[t._id]=t.percent)}),e}},{key:"selectAnswer",value:function(e){var t=this;this.cases.map(function(n){n.selected=!1,n.correct=!1,n.incorrect=!1,n.id===e.selectedCaseId&&(t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n),t.filled=!0,n.selected=!0),e.results&&(n.result=e.results[n.id]||0),n.id===e.correctCaseId?n.correct=!0:n.incorrect=!0})}}])&&je(n.prototype,r),o&&je(n,o),t}();function Re(e){return(Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(e,t,n){return(Ae="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=De(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function De(e){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ue(e,t){return(Ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Fe=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=De(t).call(this,e,n))||"object"!==Re(i)&&"function"!=typeof i?qe(o):i,Me(qe(qe(r)),"type",J.Image),Me(qe(qe(r)),"media",void 0),Me(qe(qe(r)),"mediaWidth",void 0),Me(qe(qe(r)),"mediaHeight",void 0),Me(qe(qe(r)),"mediaUrl",void 0),Me(qe(qe(r)),"mediaFileWidth",void 0),Me(qe(qe(r)),"mediaFileHeight",void 0),r.title=n.text,r.media=Kn.cloudinary.prepareImageUrl(n.imageFile,t.mediaWidth,n.imageData),n.imageFileData&&(r.mediaFileWidth=n.imageFileData.width,r.mediaFileHeight=n.imageFileData.height),r.mediaUrl=n.imageFileUrl,r.mediaWidth=t.mediaWidth,n.imageData&&n.imageData.containerRatio?r.mediaHeight=Math.round(t.mediaWidth*n.imageData.containerRatio):r.mediaHeight=Math.round(n.imageData.containerHeight||0),r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ue(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?Kn.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"}):Ae(De(t.prototype),"makeSend",this).call(this,{selectedAnswerId:this.id}).then(function(n){var r={selectedCaseId:n.selectedAnswerId,correctCaseId:n.correctAnswerId};for(var o in n.stats)n.stats.hasOwnProperty(o)&&(r.results=r.results||{},/.{24}/.test(o)&&(r.results[o]=n.stats[o]));return Ae(De(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&Te(n.prototype,r),o&&Te(n,o),t}();function Be(e){return(Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Le(e,t){return!t||"object"!==Be(t)&&"function"!=typeof t?We(e):t}function Ne(e){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ve(e,t){return(Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function We(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Me(Fe,"mediaWidth",300);var He=function(e){function t(e,n){var r,o,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=Le(this,Ne(t).call(this,e,n)),o=We(We(r)),i="type",a=m.PictureChoice,i in o?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a,n.answers?(r.cases=n.answers.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):Le(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ve(e,t)}(t,V),n=t,(r=[{key:"createCase",value:function(e){return new Fe(this,e)}},{key:"refreshAnswer",value:function(e,t){return t.answers.map(function(t){e.results&&(e.results[t._id]=t.percent)}),e}},{key:"selectAnswer",value:function(e){var t=this;this.cases.map(function(n){n.selected=!1,n.correct=!1,n.incorrect=!1,n.id===e.selectedCaseId&&(t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n),t.filled=!0,n.selected=!0),e.results&&(n.result=e.results[n.id]||0),n.id===e.correctCaseId?n.correct=!0:n.incorrect=!0})}}])&&$e(n.prototype,r),o&&$e(n,o),t}();function ze(e){return(ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ge(e){return(Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ke(e,t){return(Ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Xe=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=Ge(t).call(this,e,n))||"object"!==ze(i)&&"function"!=typeof i?Qe(o):i,Je(Qe(Qe(r)),"type",m.Poster),Je(Qe(Qe(r)),"button",void 0),Je(Qe(Qe(r)),"exitLink",void 0),Je(Qe(Qe(r)),"link",void 0),n.coverPage&&(r.button=n.coverPage.buttonText,r.exitLink=n.coverPage.exitLink,r.link=n.coverPage.link),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ke(e,t)}(t,V),t}();function Ye(e){return(Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function et(e,t,n){return(et="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=tt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function tt(e){return(tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nt(e,t){return(nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function rt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ot(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var it=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=tt(t).call(this,e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ot(e,t,n[t])})}return e}({},n,{_id:""})))||"object"!==Ye(i)&&"function"!=typeof i?rt(o):i,ot(rt(rt(r)),"type",J.Iteration),ot(rt(rt(r)),"symbol",void 0),ot(rt(rt(r)),"ordinal",void 0),r.ordinal=n.ordinal,r.symbol=n.symbol,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nt(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?Kn.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"}):et(tt(t.prototype),"makeSend",this).call(this,{quizQuestionId:this.page.id,rateItValue:this.ordinal}).then(function(n){var r={};return n.selectedValue&&(r.selectedValue=n.selectedValue),n.avgRateItValue&&(r.result=+n.avgRateItValue),et(tt(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&Ze(n.prototype,r),o&&Ze(n,o),t}();function at(e){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function st(e){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ut(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ct(e,t,n){return t&&ut(e.prototype,t),n&&ut(e,n),e}function lt(e,t){return(lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ft(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ht(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var gt=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,i=st(t).call(this,e,n),r=!i||"object"!==at(i)&&"function"!=typeof i?ft(o):i,ht(ft(ft(r)),"type",m.Rateit),ht(ft(ft(r)),"result",0),ht(ft(ft(r)),"labelMin",void 0),ht(ft(ft(r)),"labelMax",void 0),ht(ft(ft(r)),"selectedValue",0),r.labelMin=n.rateIt.minLabel,r.labelMax=n.rateIt.maxLabel,r.cases=Array.apply(null,Array(n.rateIt.maxRateItValue)).map(function(e,t){return r.createCase(t+1,n.rateIt.rateType)}),r.sent().then(function(e){e.selectedValue&&(r.selectedValue=e.selectedValue,r.selectAnswer(e))}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lt(e,t)}(t,V),ct(t,[{key:"shouldShowResults",value:function(){return this.settings.showResults&&this.result>0}}]),ct(t,[{key:"createCase",value:function(e,t){return new it(this,{ordinal:e,symbol:t})}},{key:"selectAnswer",value:function(e){var t=this;e.selectedValue&&(this.filled=!0,this.selectedValue=e.selectedValue),e.result&&(this.result=e.result),this.cases.map(function(n){n.selected=e.selectedValue>=n.ordinal,e.selectedValue===n.ordinal&&t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n)})}},{key:"setResults",value:function(e){this.result=e.average||0,this.selectedValue=e.average||0}}]),t}();function pt(e){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yt(e){return(yt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dt(e,t){return(dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var vt=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=yt(t).call(this,e,n))||"object"!==pt(i)&&"function"!=typeof i?bt(o):i,mt(bt(bt(r)),"type",m.StartPage),mt(bt(bt(r)),"isCoverPage",!0),mt(bt(bt(r)),"button",void 0),n.coverPage&&void 0!==n.coverPage.buttonText&&(r.button=n.coverPage.buttonText),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dt(e,t)}(t,V),t}();function wt(e){return(wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pt(e){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ot(e,t){return(Ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var jt=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=Pt(t).call(this,e,n))||"object"!==wt(i)&&"function"!=typeof i?_t(o):i,kt(_t(_t(r)),"type",m.SummaryPage),kt(_t(_t(r)),"stats",void 0),n.text?r.title=n.text:e.type===a.Outcome?r.title="Outcomes":r.title="Scores",r.stats=n.stats,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ot(e,t)}(t,V),t}();function Ct(e){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function St(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Et(e,t,n){return(Et="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=It(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function It(e){return(It=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xt(e,t){return(xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Rt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Tt=function(e){function t(e,n){var r,o,i,a,s,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=It(t).call(this,e,n))||"object"!==Ct(i)&&"function"!=typeof i?Rt(o):i,a=Rt(Rt(r)),s="type",u=J.Project,s in a?Object.defineProperty(a,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[s]=u,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xt(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this;return Et(It(t.prototype),"makeSend",this).call(this,{selectedAnswerId:this.id}).then(function(n){var r={};return Et(It(t.prototype),"save",e).call(e,r),r})}}])&&St(n.prototype,r),o&&St(n,o),t}();function At(e){return(At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ut(e,t){return!t||"object"!==At(t)&&"function"!=typeof t?Ft(e):t}function qt(e){return(qt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mt(e,t){return(Mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ft(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Bt=function(e){function t(e,n){var r,o,i,a;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=Ut(this,qt(t).call(this,e,n)),o=Ft(Ft(r)),i="type",a=m.Project,i in o?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a,!n.answers)return Ut(r);r.cases=n.answers.map(function(e){return r.createCase(e)});var s=n.answers.length?n.answers[0]:null;return r.projectId=s?s._id:null,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mt(e,t)}(t,V),n=t,(r=[{key:"createCase",value:function(e){return new Tt(this,e)}}])&&Dt(n.prototype,r),o&&Dt(n,o),t}();function $t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Lt=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$t(this,"allowAnswerChange",!1),$t(this,"hideMessageAfterDelay",3e3),$t(this,"share",void 0),$t(this,"tracking",void 0),t.settings&&(this.allowAnswerChange=!!t.settings.allowAnswerChange,this.tracking=t.settings.tracking,t.settings.hideMessageAfterDelay&&(this.hideMessageAfterDelay=t.settings.hideMessageAfterDelay),t.settings.share&&(this.share=t.settings.share,!this.share.imageUrl&&Kn.getConfig("share")&&Kn.getConfig("share").defaultImgUrl&&(this.share.imageUrl=Kn.getConfig("share").defaultImgUrl)))};function Nt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Vt=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Nt(this,"liveTitle","Live"),Nt(this,"chatTitle","Chat"),Nt(this,"logoUrl",""),Nt(this,"headerText",""),t.tabs&&(t.tabs.liveTitle&&(this.liveTitle=t.tabs.liveTitle),t.tabs.chatTitle&&(this.chatTitle=t.tabs.chatTitle),t.tabs.logoUrl&&(this.logoUrl=Kn.getConfig("backend").api+Kn.getConfig("backend").imagesUrl+"/"+t.tabs.logoUrl),t.tabs.headerText&&(this.headerText=t.tabs.headerText))};function Wt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ht(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var zt=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ht(this,"answerBackgroundColor",""),Ht(this,"answerBorderColor",""),Ht(this,"answerColor",""),Ht(this,"backgroundBrightness",""),Ht(this,"backgroundColor",""),Ht(this,"backgroundImageBlur",""),Ht(this,"backgroundImageFile",""),Ht(this,"backgroundImagePosition",""),Ht(this,"buttonColor",""),Ht(this,"font",""),Ht(this,"questionColor",""),Ht(this,"customThemeCssFile",""),Ht(this,"backgroundImageConvertedFile",""),Ht(this,"tabBorderColor",""),Ht(this,"tabFontColor",""),Ht(this,"tabColor",""),Ht(this,"embedSettings",void 0),this.embedSettings=n,t.theme&&(this.answerBackgroundColor=t.theme.answerBackgroundColor||"",this.answerBorderColor=t.theme.answerBorderColor||"",this.answerColor=t.theme.answerColor||"",this.backgroundBrightness=t.theme.backgroundBrightness||"",this.backgroundColor=t.theme.backgroundColor||"",this.backgroundImageBlur=t.theme.backgroundImageBlur||"",this.backgroundImageFile=t.theme.backgroundImageFile||"",this.backgroundImagePosition=t.theme.backgroundImagePosition||"",this.buttonColor=t.theme.buttonColor||"",this.font=t.theme.font||"",this.questionColor=t.theme.questionColor||"",this.tabColor=t.theme.tabColor||"",this.tabFontColor=t.theme.tabFontColor||"",this.tabBorderColor=t.theme.tabBorderColor||"",t.theme.customThemeCssFile&&(this.customThemeCssFile=Kn.config.backend.api+"/uploads/"+t.theme.customThemeCssFile),t.theme.backgroundImageFile&&this.convertBackgroundImage())}var t,n,r;return t=e,(n=[{key:"convertBackgroundImage",value:function(){this.backgroundImageConvertedFile=Kn.cloudinary.prepareBackgroundImageUrl(this.backgroundImageFile,window.innerWidth,"auto"===this.embedSettings.height?null:window.innerHeight,parseInt(this.backgroundImageBlur,10),this.backgroundImagePosition)}}])&&Wt(t.prototype,n),r&&Wt(t,r),e}();function Gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Kt(e,t,n){return t&&Gt(e.prototype,t),n&&Gt(e,n),e}function Qt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Jt=function(){function e(t,n,r,o){var i=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Qt(this,"_engageformId",void 0),Qt(this,"_pages",{}),Qt(this,"_startPages",[]),Qt(this,"_endPages",[]),Qt(this,"_availablePages",[]),Qt(this,"_hasForms",!1),Qt(this,"sendAnswerCallback",void 0),Qt(this,"enabled",!0),Qt(this,"type",a.Undefined),Qt(this,"title",void 0),Qt(this,"message",void 0),Qt(this,"settings",void 0),Qt(this,"theme",void 0),Qt(this,"branding",void 0),Qt(this,"tabs",void 0),Qt(this,"themeType",void 0),Qt(this,"embedSettings",void 0),Qt(this,"texts",void 0),Qt(this,"current",void 0),Qt(this,"navigation",void 0),Qt(this,"meta",void 0),Qt(this,"answers",new Map),Qt(this,"event",void 0),Qt(this,"mode",void 0),Qt(this,"showGoogleAds",void 0),Qt(this,"integrations",void 0),this._engageformId=t._id,this.mode=n,this.embedSettings=o,this.sendAnswerCallback=s,this.title=t.title,this.settings=new Lt(t),this.theme=new zt(t,o),this.tabs=new Vt(t),this.texts=t.texts,this.themeType=this.getThemeType(t.theme.backgroundColor),this.event=new U,this.branding=A.create(t.type,t.settings&&t.settings.branding),this.showGoogleAds=t.showGoogleAds,this.integrations=t.integrations;var u=this.buildPages(r||[],this.settings);u.forEach(function(e){return i.storePage(e)}),this._hasForms=u.some(function(e){return e.type===m.Form});var c=t.skipLogic&&"{}"!==t.skipLogic;this.navigation=c?x.fromEnageformAndData(this,t):v.fromEnageform(this),this.meta=F.fromEngageform(this)}return Kt(e,[{key:"getPageById",value:function(e){return this.pages[e]}},{key:"getPageByIndex",value:function(e){return this.pages[this.availablePages[e]]}},{key:"getPageIndex",value:function(e){return e?this.availablePages.indexOf(e.id):0}},{key:"isType",value:function(e){return this.type===e}},{key:"isNormalMode",value:function(){return Boolean(this.mode===i.Default||this.mode===i.Preview)}},{key:"isSummaryMode",value:function(){return Boolean(this.mode===i.Summary)}},{key:"isResultsMode",value:function(){return Boolean(this.mode===i.Result)}},{key:"isPreviewMode",value:function(){return Boolean(this.mode===i.Preview)}},{key:"id",get:function(){return this._engageformId}},{key:"pages",get:function(){return this._pages}},{key:"startPages",get:function(){return this._startPages}},{key:"endPages",get:function(){return this._endPages}},{key:"availablePages",get:function(){return this._availablePages}},{key:"typeName",get:function(){return a[this.type].toLowerCase()}},{key:"hasForms",get:function(){return this._hasForms}}]),Kt(e,[{key:"setUserIdent",value:function(e){Kn.user.sessionId=e}},{key:"getUserIdent",value:function(e){return Kn.user.sessionId}},{key:"storePage",value:function(e){return e.type===m.StartPage?(this.isNormalMode()||this.isSummaryMode())&&this._startPages.push(e.id):e.type===m.EndPage?(this.isNormalMode()||this.isSummaryMode())&&this._endPages.push(e.id):this._availablePages.push(e.id),this._pages[e.id]=e,e}},{key:"initPage",value:function(e){return this.storePage(this.buildPages([e],this.settings)[0]),this.setCurrent(e._id)}},{key:"setCurrent",value:function(e){var t=this._pages[e];return this.current=t,t}},{key:"setCurrentEndPage",value:function(){var e=Kn.config.backend.domain+Kn.getConfig("engageform").engageformFinishUrl;return e=e.replace(":engageformId",this._engageformId),Kn.mode!==i.Default&&(e+="?preview"),Kn.$http.post(e,{userIdent:Kn.user.sessionId,globalUserIdent:Kn.user.id}).then(function(e){return-1!==[200,304].indexOf(e.status)?(Kn.localStorage.clearAll(),Kn.user.id=e.data.globalUserIdent,e.data):Kn.$q.reject(e)})}},{key:"cleanPages",value:function(){this._availablePages.length=0,this._pages={}}},{key:"buildPages",value:function(e,t){var n=this;return e.map(function(e){return n.createPage(e,t)}).filter(function(e){return Boolean(e)})}},{key:"createPage",value:function(e,t){switch(e.type){case m.EndPage:return new X(this,e,t);case m.Form:return new de(this,e);case m.MultiChoice:return new xe(this,e);case m.PictureChoice:return new He(this,e);case m.Rateit:return new gt(this,e);case m.StartPage:return new vt(this,e);case m.Poster:return new Xe(this,e);case m.Project:return new Bt(this,e);default:throw new Error("Trying to construct an unknown page.")}}},{key:"setSummary",value:function(e){var t=this;e.forEach(function(e){e.stats&&t._pages[e.stats.questionId]&&t._pages[e.stats.questionId].setResults(e)})}},{key:"setAnswers",value:function(e){var t=e.questions;for(var n in t)if(this._pages[n]){var r=t[n];this._pages[n].selectAnswer({selectedCaseId:r.selectedAnswerId,inputs:r.inputs,selectedValue:r.rateItValue})}}},{key:"setResultPage",value:function(e){var t={_id:"summaryPage",type:m.SummaryPage,settings:{showCorrectAnswer:!0},stats:e},n=new jt(this,t);this.storePage(n)}},{key:"setUserResultPage",value:function(e){var t={_id:"RESULT_PAGE",type:"summaryPage",settings:{}};"outcome"===e.type?Object(o.extend)(t,{text:"User's outcome: "+e.outcome}):"calculator"===e.type?Object(o.extend)(t,{text:"User's score: "+e.score}):Object(o.extend)(t,{text:"User's score: "+e.score+" / "+e.maxScore});var n=new jt(this,t);this.storePage(n)}},{key:"setAnswer",value:function(e,t){var n=Object(o.get)(t,"selectedCaseId")||Object(o.get)(t,"selectedValue")||t;this.answers.set(e,n)}},{key:"getThemeType",value:function(e){var t=this.colorToRgb(e);return.299*t.red+.587*t.green+.114*t.blue>186?"light":"dark"}},{key:"colorToRgb",value:function(e){var t;if("#"===e[0])e=e.substr(1);else{var n=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);e=n&&4===n.length?("0"+parseInt(n[1],10).toString(16)).slice(-2)+("0"+parseInt(n[2],10).toString(16)).slice(-2)+("0"+parseInt(n[3],10).toString(16)).slice(-2):""}if(3===e.length){var r=e;e="",r=(r=/^([a-f0-9])([a-f0-9])([a-f0-9])$/i.exec(r)).slice(1);for(var o=0;o<3;o++)e+=r[o]+r[o]}if(!(t=/^([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i.exec(e)))throw new Error("Invalid color.");return t=t.slice(1),{red:parseInt(t[0],16),green:parseInt(t[1],16),blue:parseInt(t[2],16)}}}]),e}();function Xt(e){return(Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zt(e,t,n){return(Zt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=en(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function en(e){return(en=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tn(e,t){return(tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var rn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=en(t)).call.apply(e,[this].concat(l)))||"object"!==Xt(o)&&"function"!=typeof o?nn(r):o,i=nn(nn(n)),s="type",u=a.Live,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tn(e,t)}(t,Jt),n=t,(r=[{key:"initPages",value:function(){var e=Kn.$q.defer();return e.resolve(this),e.promise}},{key:"initPage",value:function(e){return this.cleanPages(),Zt(en(t.prototype),"initPage",this).call(this,e)}},{key:"setCurrentEndPage",value:function(){var e=Kn.$q.defer();return e.resolve(),e.promise}}])&&Yt(n.prototype,r),o&&Yt(n,o),t}();function on(e){return(on="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function an(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function sn(e,t,n){return(sn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=un(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function un(e){return(un=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function cn(e,t){return(cn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ln(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var fn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=un(t)).call.apply(e,[this].concat(l)))||"object"!==on(o)&&"function"!=typeof o?ln(r):o,i=ln(ln(n)),s="type",u=a.Outcome,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cn(e,t)}(t,Jt),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return sn(un(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){var n=!1;return e.endPages.map(function(r){e.pages[r].outcome===t.outcome&&(n=!0,e.setCurrent(r))}),n||(e.enabled=!1,e.message="Thank you!"),t})}}])&&an(n.prototype,r),o&&an(n,o),t}();function hn(e){return(hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pn(e,t,n){return(pn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=yn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function yn(e){return(yn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dn(e,t){return(dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var mn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=yn(t)).call.apply(e,[this].concat(l)))||"object"!==hn(o)&&"function"!=typeof o?bn(r):o,i=bn(bn(n)),s="type",u=a.Poll,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dn(e,t)}(t,Jt),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return pn(yn(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){return e.endPages.length?e.setCurrent(e.endPages[0]):(e.enabled=!1,e.message="Thank you!"),t})}}])&&gn(n.prototype,r),o&&gn(n,o),t}();function vn(e){return(vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pn(e,t,n){return(Pn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=On(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function On(e){return(On=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _n(e,t){return(_n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function kn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var jn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=On(t)).call.apply(e,[this].concat(l)))||"object"!==vn(o)&&"function"!=typeof o?kn(r):o,i=kn(kn(n)),s="type",u=a.Score,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_n(e,t)}(t,Jt),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return Pn(On(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){var n=t.totalScore,r=!1;return e.endPages.map(function(t){var o=e.pages[t],i=o.rangeMin,a=void 0===i?0:i,s=o.rangeMax;a<=n&&(void 0===s?0:s)>=n&&(r=!0,o.score=n,e.setCurrent(t))}),r||(e.enabled=!1,e.message="Thank you!"),t})}}])&&wn(n.prototype,r),o&&wn(n,o),t}();function Cn(e){return(Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function En(e,t,n){return(En="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=In(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function In(e){return(In=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xn(e,t){return(xn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Rn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Tn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=In(t)).call.apply(e,[this].concat(l)))||"object"!==Cn(o)&&"function"!=typeof o?Rn(r):o,i=Rn(Rn(n)),s="type",u=a.Calculator,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xn(e,t)}(t,Jt),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return En(In(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){if(e.endPages.length){var n=e.endPages[0];e.pages[n].score=t.totalScore,e.setCurrent(n)}else e.enabled=!1,e.message="Thank you!";return t})}}])&&Sn(n.prototype,r),o&&Sn(n,o),t}();function An(e){return(An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Dn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Un(e,t,n){return(Un="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function qn(e){return(qn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mn(e,t){return(Mn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Bn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=qn(t)).call.apply(e,[this].concat(l)))||"object"!==An(o)&&"function"!=typeof o?Fn(r):o,i=Fn(Fn(n)),s="type",u=a.Survey,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mn(e,t)}(t,Jt),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return Un(qn(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){return e.endPages.length?e.setCurrent(e.endPages[0]):(e.enabled=!1,e.message="Thank you!"),t})}}])&&Dn(n.prototype,r),o&&Dn(n,o),t}();function $n(e,t){return Object(o.includes)(Object(o.values)(e),t)}function Ln(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Nn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Vn=function(){var e,t,n;function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),Nn(this,"_id",null),Nn(this,"_sessionId",null)}return e=r,n=[{key:"create",value:function(){return new r}}],(t=[{key:"id",get:function(){return this._id||(this._id=Kn.localStorage.get(r.idKey)),this._id},set:function(e){Kn.localStorage.set(r.idKey,e),this._id=e}},{key:"sessionId",get:function(){return this._sessionId||(this._sessionId=Kn.localStorage.get(r.sessionIdKey)),this._sessionId},set:function(e){Kn.localStorage.set(r.sessionIdKey,e),this._sessionId=e}}])&&Ln(e.prototype,t),n&&Ln(e,n),r}();function Wn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Hn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zn(e,t,n){return t&&Hn(e.prototype,t),n&&Hn(e,n),e}function Gn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Nn(Vn,"idKey","userIdent"),Nn(Vn,"sessionIdKey","sessionIdent"),n.d(t,"default",function(){return Kn});var Kn=function(){function e(t,n,r,o,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Gn(this,"_engageform",void 0),Gn(this,"_event",void 0),e.$http=t,e.$q=n,e.$timeout=r,e.cloudinary=o,e.localStorage=i,e.config=a,this._event=new U,e.cloudinary.setConfig(a.cloudinary)}return zn(e,null,[{key:"getConfig",value:function(t){return e.config[t]}}]),zn(e,[{key:"init",value:function(t){var n=this,a=Object(o.defaults)({},t,{mode:i.Default});if(!a||!a.id)return e.$q.reject({status:"error",error:{code:406,message:"The required id property does not exist."},data:a});if(e._instances[a.id])return e._instances[a.id];if(!$n(i,a.mode))return e.$q.reject({status:"error",error:{code:406,message:"Mode property not supported."},data:a});e.mode=a.mode;var s=[e.getData("quiz",a.id),a.live?e.$q.resolve([]):e.getData("pages",a.id)];return e.$q.all(s).then(function(t){var o=Wn(t,2),i=o[0],s=o[1];return $n(r,i.type)?(n._engageform=new e.quizzesConstructors[i.type](i,e.mode,s,a.embedSettings,a.callback?a.callback.sendAnswerCallback:function(){}),n._engageform):e.$q.reject({status:"error",error:{code:406,message:"Type property not supported."},data:i})})}},{key:"destroyInstances",value:function(){e._instances={}}},{key:"type",get:function(){return this._engageform?this._engageform.type:a.Undefined}},{key:"Type",get:function(){return a}},{key:"mode",get:function(){return e.mode}},{key:"Mode",get:function(){return i}},{key:"title",get:function(){if(this._engageform)return this._engageform.title}},{key:"theme",get:function(){if(this._engageform)return this._engageform.theme}},{key:"current",get:function(){if(this._engageform)return this._engageform.current}},{key:"navigation",get:function(){if(this._engageform)return this._engageform.navigation}},{key:"branding",get:function(){if(this._engageform)return this._engageform.branding}},{key:"message",get:function(){if(this._engageform)return this._engageform.message}},{key:"meta",get:function(){if(this._engageform)return this._engageform.meta}},{key:"event",get:function(){if(this._event)return this._event}},{key:"showGoogleAds",get:function(){return!!this._engageform&&this._engageform.showGoogleAds}},{key:"integrations",get:function(){if(this._engageform)return this._engageform.integrations}}],[{key:"getData",value:function(t,n){if("quiz"!==t&&"pages"!==t)throw new Error("Resource path for ".concat(t," type of data is unknown."));var r=e.getConfig("backend").domain+("quiz"===t?e.getConfig("engageform").engageformUrl:e.getConfig("engageform").engageformPagesUrl);return r=r.replace(":engageformId",n),e.mode!==i.Default&&(r+="?preview"),e.$http.get(r).then(function(t){return-1!==[200,304].indexOf(t.status)?t.data:e.$q.reject(t)})}}]),e}();Gn(Kn,"user",Vn.create()),Gn(Kn,"$http",void 0),Gn(Kn,"$q",void 0),Gn(Kn,"$timeout",void 0),Gn(Kn,"cloudinary",void 0),Gn(Kn,"localStorage",void 0),Gn(Kn,"config",void 0),Gn(Kn,"mode",i.Undefined),Gn(Kn,"_instances",{}),Gn(Kn,"quizzesConstructors",{outcome:fn,poll:mn,score:jn,survey:Bn,live:rn,calculator:Tn}),Kn.$inject=["$http","$q","$timeout","cloudinary","localStorageService","ApiConfig"],f.service("Engageform",Kn)}]);
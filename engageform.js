!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=_},function(e,t){e.exports=angular},function(e,t,n){"use strict";n.r(t);var r,o=n(0);!function(e){e.Outcome="outcome",e.Poll="poll",e.Score="score",e.Survey="survey",e.Live="live",e.Calculator="calculator"}(r||(r={}));var i,a,s,u,c,l=n(1),f=n.n(l).a.module("4screens.engageform",["4screens.util.cloudinary","LocalStorageModule"]);!function(e){e.Undefined="undefined",e.Default="default",e.Preview="preview",e.Result="results",e.Summary="summary"}(i||(i={})),function(e){e[e.Undefined=0]="Undefined",e[e.Live=1]="Live",e[e.Outcome=2]="Outcome",e[e.Poll=3]="Poll",e[e.Score=4]="Score",e[e.Survey=5]="Survey",e[e.Calculator=6]="Calculator"}(a||(a={})),function(e){e.Default="defaultRule",e.Entry="entryRule",e.Exit="exitRule"}(s||(s={})),function(e){e.And="and",e.Or="or"}(u||(u={})),function(e){e.Equal="eq",e.NotEqual="neq",e.Blank="blank",e.NotBlank="nblank",e.GreaterThan="gt",e.GreaterThanOrEqual="gte",e.LessThan="lt",e.LessThanOrEqual="lte",e.Between="between",e.Contain="contain",e.NotContain="ncontain"}(c||(c={}));var h,g=function(e){return e.type===s.Entry},p=function(e){return e.type===s.Exit},y=function(e){return e.type===s.Default};function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),e}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Undefined=0]="Undefined",e.EndPage="endPage",e.Form="forms",e.MultiChoice="multiChoice",e.PictureChoice="pictureChoice",e.Rateit="rateIt",e.StartPage="startPage",e.Poster="poster",e.SummaryPage="summaryPage",e.Project="project"}(h||(h={}));var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),m(this,"_engageform",void 0),m(this,"visitedPages",[]),m(this,"enabled",!1),m(this,"position",0),m(this,"size",0),m(this,"hasStart",!1),m(this,"enabledStart",!0),m(this,"hasPrev",!1),m(this,"enabledPrev",!0),m(this,"hasNext",!1),m(this,"enabledNext",!0),m(this,"hasFinish",!1),m(this,"enabledFinish",!0),m(this,"distance",0),m(this,"animate","swipeNext"),m(this,"hasStartPages",!1),m(this,"hasEndPages",!1),m(this,"waitingForPageChange",null),m(this,"next",this.pick),m(this,"finish",this.pick),this._engageform=t,this.size=t.availablePages.length,this.hasEndPages=Boolean(t.endPages.length),t.startPages.length?(this.hasStart=!0,this.hasStartPages=!0,this._engageform.setCurrent(t.startPages[0])):(this.enabled=!0,this.move(),this.hasPrev=!1)}return b(e,null,[{key:"fromEnageform",value:function(t){return new e(t)}}]),b(e,[{key:"updateDistance",value:function(){return this.distance=this.position/this.size}},{key:"start",value:function(e){this.disableDefaultAction(e),this.animate="swipeNext",this.enabled=!0,this.hasStart=!1,this.move(),this.hasPrev=!0}},{key:"stopPageChange",value:function(){this.waitingForPageChange&&Jn.$timeout.cancel(this.waitingForPageChange)}},{key:"prev",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.disableDefaultAction(e),this.stopPageChange(),this.animate="swipePrev",this._engageform.current&&(this._engageform.message=""),this.position-=t,this.updateDistance(),this.hasNext=!0,this.hasFinish=!1,0===this.position?(this._engageform.setCurrent(this._engageform.startPages[0]),this.hasPrev=!1):(this._engageform.setCurrent(this._engageform.availablePages[this.position-1]),this.hasPrev=1!==this.position||this.hasStartPages)}},{key:"pick",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{quiet:!1};if(this.disableDefaultAction(e),this.stopPageChange(),this.animate="swipeNext",!this._engageform.isNormalMode()){var o=Jn.$q.defer();return o.resolve(t),this.move(t),o.promise}var i=this._engageform.current;return i.send(t).then(function(){n.sendMessage();var e=void 0;if(i.type===h.MultiChoice&&(e=i),i.type===h.PictureChoice&&(e=i),!i.filled&&i.requireResponse())return r.quiet||n.sendMessage(n._engageform.texts.ANSWER_REQUIRED_TO_PROCEED),t;if(i.filled||i.requireResponse()){if(t&&i.settings.allowMultipleChoice)return t;if(e&&i.settings.allowMultipleChoice&&(i.settings.minAnswersCount&&e.selectedItemsCount<i.settings.minAnswersCount||i.settings.maxAnswersCount&&e.selectedItemsCount>i.settings.maxAnswersCount))return t;var o=t?i.settings.showCorrectAnswer||i.settings.showResults?1e3:200:0;return n.waitingForPageChange=Jn.$timeout(function(){return n.waitingForPageChange=null,n.move(t),t},o),n.waitingForPageChange}return t}).catch(function(e){return r.quiet||n.sendMessage(n._engageform.texts[e.textKey]||e.message),e})}},{key:"move",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._engageform.event.trigger("form::pageWillChange",{isStartPage:Boolean(0===this.position&&this._engageform.startPages.length)}),this.visitedPages.push(this._engageform.current),this.position+=n,n>-1&&this._engageform.availablePages.length>=this.position?(this.updateDistance(),this._engageform.setCurrent(this._engageform.availablePages[this.position-1]),this.hasPrev=!0,this.hasNext=!1,this.hasFinish=!1,this._engageform.availablePages.length>this.position?this.hasNext=!0:this._engageform.availablePages.length===this.position&&(this.hasFinish=this._engageform.isNormalMode()&&!(this._engageform.isType(a.Poll)&&!this._engageform.hasForms)),this._engageform.event.trigger("form::pageDidChange",{currentPosition:this.position,isEndPage:!1})):(this.position=this._engageform.availablePages.length,e||this._engageform.setCurrentEndPage().then(function(e){t._engageform.type!==a.Score&&t._engageform.type!==a.Outcome||t._engageform.event.trigger("finish",e.totalScore||e.outcome,e.maxScore),t._engageform.event.trigger("finish::endPage"),t.enabled=!1,t.hasPrev=!1,t.hasNext=!1,t.hasFinish=!1,t._engageform.event.trigger("form::pageDidChange",{currentPosition:t.position,isEndPage:!0})}).catch(function(e){e.data.msg&&t.sendMessage(e.data.msg)}))}},{key:"disableDefaultAction",value:function(e){e&&(e.stopPropagation(),e.preventDefault())}},{key:"sendMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this._engageform.message=t,Jn.$timeout(function(){e._engageform.message=""},this._engageform.settings.hideMessageAfterDelay)}}]),e}();function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t,n){return(O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return t&&j(e.prototype,t),n&&j(e,n),e}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E=function(){function e(t,n){C(this,e),I(this,"entryRules",void 0),I(this,"exitRules",void 0),I(this,"defaultRule",void 0),I(this,"answers",void 0),this.entryRules=this.processNonDefaultRules(t.rules[s.Entry],g),this.exitRules=this.processNonDefaultRules(t.rules[s.Exit],p),this.defaultRule=Object(o.head)(t.rules[s.Default].filter(y)),this.answers=n}return S(e,[{key:"hasEntryRules",value:function(){return this.entryRules.length>0}},{key:"hasExitRules",value:function(){return this.exitRules.length>0}},{key:"resolveEntryDestination",value:function(){return this.resolveDestination(this.entryRules)}},{key:"resolveExitDestination",value:function(){return this.resolveDestination(this.exitRules)}},{key:"processNonDefaultRules",value:function(e,t){return e?e.filter(t).map(this.dropEmptyConditions).filter(this.hasConditions):[]}},{key:"dropEmptyConditions",value:function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){I(e,t,n[t])})}return e}({},e,{conditions:e.conditions.filter(function(e){return Boolean(e.to)})})}},{key:"hasConditions",value:function(e){return e.conditions.length>0}},{key:"resolveDestination",value:function(e){var t=this;return e.map(function(e){var n=e.destination,r=e.conditionsConnection;return e.conditions.map(function(e){var n=t.answers.get(e.to);if(!n)return!1;if(function(e){return Boolean(e.field)}(e)&&(n=n[e.field]),Array.isArray(n)){var r=!0,o=!1,i=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;switch(e.is){case c.Equal:return u===e.value;case c.NotEqual:return u!==e.value;case c.Blank:return!Boolean(u);case c.NotBlank:return Boolean(u);case c.Contain:return u.indexOf(e.value)>=0;case c.NotContain:return-1===u.indexOf(e.value)}}}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return!1}switch(e.is){case c.Equal:return n===e.value;case c.NotEqual:return n!==e.value;case c.GreaterThan:return n>e.value;case c.GreaterThanOrEqual:return n>=e.value;case c.LessThan:return n<e.value;case c.LessThanOrEqual:return n<=e.value;case c.Between:return e.value[0]>=n&&n<=e.value[1];case c.Blank:return!Boolean(n);case c.NotBlank:return Boolean(n);case c.Contain:return n.indexOf(e.value)>=0;case c.NotContain:return-1===n.indexOf(e.value);default:return!1}})[r===u.Or?"some":"every"](function(e){return e})?n:null}).filter(Boolean)[0]||this.defaultRule.destination}},{key:"defaultRuleValue",get:function(){return this.defaultRule}}]),e}(),x=function(e){function t(e,n){var r,o,i;C(this,t),o=this,i=P(t).call(this,e),r=!i||"object"!==w(i)&&"function"!=typeof i?k(o):i,I(k(k(r)),"logic",{});var a=n.skipLogic||{};return Object.keys(a).forEach(function(e){r.logic[e]=new E(a[e],r._engageform.answers)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,v),S(t,null,[{key:"fromEnageformAndData",value:function(e,n){return new t(e,n)}}]),S(t,[{key:"prev",value:function(e){var n=this.visitedPages.pop(),r=this._engageform.getPageIndex(this._engageform.current)-this._engageform.getPageIndex(n);O(P(t.prototype),"prev",this).call(this,e,r)}},{key:"move",value:function(e){var n,r=this._engageform.current,o=this.logic&&r?this.logic[r.id]:void 0;if(n=this._engageform.getPageByIndex(this.position),o&&o.hasExitRules()){var i=this._engageform.getPageById(o.resolveExitDestination());i&&(n=i)}if(n&&(n=this.checkEntryConditionForPage(n)),n){var a=r?this._engageform.getPageIndex(n):1;return a<0?O(P(t.prototype),"move",this).call(this,void 0,-1):O(P(t.prototype),"move",this).call(this,e,a-this._engageform.getPageIndex(r))}return O(P(t.prototype),"move",this).call(this,e,1)}},{key:"checkEntryConditionForPage",value:function(e){var t=this.logic&&e?this.logic[e.id]:void 0;if(t&&t.hasEntryRules()){var n=t.resolveEntryDestination(),r=this._engageform.getPageById(n);return r?this.checkEntryConditionForPage(r):r}return e}},{key:"isPossiblyConditionalPage",value:function(e){return[h.Form,h.MultiChoice,h.PictureChoice,h.Rateit].includes(e.type)}}]),t}();function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A=function(){var e,t,n;function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.state,i=t.text,a=t.link,s=t.imageUrl,u=arguments.length>2?arguments[2]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),T(this,"_text",void 0),T(this,"_link",void 0),T(this,"_imageUrl",void 0),T(this,"_isCustomLogo",!1),T(this,"_enabled",void 0),T(this,"_custom",void 0),this._custom=u,this._enabled=!n,this._text=o.isTextCustom(i)?i:o.defaultBranding.text,e==r.Live?this._link=a||o.defaultBranding.link_event:this._link=a||o.defaultBranding.link_project,o.isImageCustom(s)?(this._imageUrl=s?"".concat(Jn.getConfig("backend").api+Jn.getConfig("backend").imagesUrl,"/").concat(s):"",this._isCustomLogo=!0):this._imageUrl=Jn.config.backend.api+s}return e=o,n=[{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new o(e,t,o.arePropertiesCustom(t))}},{key:"arePropertiesCustom",value:function(e){var t=e.text,n=e.link,r=e.imageUrl;return Boolean(o.isTextCustom(t)||n||o.isImageCustom(r))}},{key:"isTextCustom",value:function(e){return void 0!==e}},{key:"isImageCustom",value:function(e){return void 0!==e&&e!==o.defaultBranding.imageUrl}},{key:"defaultBranding",get:function(){return Jn.getConfig("backend").branding}}],(t=[{key:"isCustom",get:function(){return this._custom}},{key:"isDefault",get:function(){return!this._custom}},{key:"isCustomLogo",get:function(){return this._isCustomLogo}},{key:"imageUrl",get:function(){return this._imageUrl}},{key:"link",get:function(){return this._link}},{key:"text",get:function(){return this._text}},{key:"enabled",get:function(){return this._enabled}}])&&R(e.prototype,t),n&&R(e,n),o}();function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var M=function(){function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r={},(n="_listener")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}var t,n,r;return t=e,(n=[{key:"listen",value:function(e,t){this._listener[e]||(this._listener[e]=[]),this._listener[e].push(t)}},{key:"trigger",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=this._listener[e];o&&o.forEach(function(e){return e.apply(e,n)})}}])&&D(t.prototype,n),r&&D(t,r),e}();function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var N=function(){var e,t,n;function r(e){var t=e.settings.share,n=e.endPages,i=e.startPages,a=e.pages;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),U(this,"globalTitle",void 0),U(this,"globalDescription",void 0),this.globalTitle="",this.globalDescription="",t&&(this.globalTitle=t.title||"",this.globalDescription=t.description||""),(n.length<1||!Object(o.find)(a,{social:!0}))&&i.length&&a[i[0]].title&&(this.globalTitle=a[i[0]].title,this.globalDescription=a[i[0]].description)}return e=r,n=[{key:"fromEngageform",value:function(e){return new r(e)}}],(t=null)&&q(e.prototype,t),n&&q(e,n),r}();function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var B=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),F(this,"showResults",!1),F(this,"showCorrectAnswer",!1),F(this,"showMainMedia",!1),F(this,"showDescription",!1),F(this,"requiredAnswer",!1),F(this,"mediaPosition","stack"),F(this,"allowMultipleChoice",!1),F(this,"minAnswersCount",0),F(this,"maxAnswersCount",0),this.requiredAnswer=!!t.requiredAnswer,t.settings&&(this.showResults=!!t.settings.showAnswers,this.showCorrectAnswer=!!t.settings.showCorrectAnswer,this.showMainMedia=!!t.settings.showMainMedia,this.showDescription=!!t.settings.showDescription,this.mediaPosition=t.settings.mediaPosition||"stack",this.allowMultipleChoice=t.settings.allowMultipleChoice||!1,this.minAnswersCount=t.settings.multipleChoice&&t.settings.multipleChoice.minAnswersCount||0,this.maxAnswersCount=t.settings.multipleChoice&&t.settings.multipleChoice.maxAnswersCount||0)};function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var V=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$(this,"id",void 0),$(this,"engageform",void 0),$(this,"type",h.Undefined),$(this,"title",""),$(this,"description",""),$(this,"media",""),$(this,"mediaWidth",0),$(this,"mediaHeight",0),$(this,"mediaUrl",""),$(this,"mediaFileWidth",0),$(this,"mediaFileHeight",0),$(this,"filled",!1),$(this,"settings",void 0),$(this,"cases",[]),$(this,"projectId",void 0),$(this,"result",void 0),this.id=n._id,this.engageform=t,this.settings=new B(n),this.title=n.text||"",this.settings.showDescription&&(this.description=n.description||""),this.settings.showMainMedia&&n.imageData&&(this.media=Jn.cloudinary.prepareImageUrl(n.imageFile,680,n.imageData),this.mediaUrl=n.imageFileUrl,this.mediaWidth=680,n.imageFileData&&(this.mediaFileWidth=n.imageFileData.width,this.mediaFileHeight=n.imageFileData.height),n.imageData.containerRatio?this.mediaHeight=Math.round(680*n.imageData.containerRatio):this.mediaHeight=Math.round(n.imageData.containerHeight||0))}var t,n,r;return t=e,(n=[{key:"send",value:function(e){if(!1===this.engageform.enabled)return Jn.$q.reject("Engageform already ended.");if(e)return e.send();var t=Jn.$q.defer();return t.resolve(),t.promise}},{key:"sent",value:function(){var e=this,t=Jn.$q.defer(),n={};return n=Jn.localStorage.get("page."+this.id)||{},this.engageform.setAnswer(this.id,n),this.settings.showResults&&n.results?this.getStatsById(this.id).then(function(r){t.resolve(e.refreshAnswer(n,r))}).catch(function(){t.resolve(n)}):t.resolve(n),t.promise}},{key:"requireResponse",value:function(){return this.filled&&this.settings.requiredAnswer}},{key:"refreshAnswer",value:function(e,t){return e}},{key:"selectAnswer",value:function(e){}},{key:"createCase",value:function(e,t){}},{key:"setResults",value:function(e){var t=this.cases.map(function(t){return t.result=Number(e.stats&&e.stats[t.id])||0,t.id});for(var n in e.stats)if(-1===t.indexOf(n)&&"questionId"!==n&&this.type!==h.Rateit){var r=this.createCase({text:"[Removed answer]",_id:n,imageData:{height:100}});r.result=Number(e.stats[r.id]),this.cases.push(r)}}},{key:"updateAnswers",value:function(e){var t=this;this.id===e.questionId&&(this.engageform.current&&!Object(o.isUndefined)(e.avg)&&(this.engageform.current.result=e.avg),Jn.$timeout(function(){t.cases.map(function(t){if(!Object(o.isUndefined)(e[t.id])){var n=t.load();n.results&&(n.results[t.id]=e[t.id],t.save(n)),t.result=e[t.id]||0}})}))}},{key:"getStatsById",value:function(e){var t=Jn.config.backend.domain+Jn.getConfig("engageform").pageStatsUrl;return t=t.replace(":pageId",e),Jn.$http.get(t).then(function(e){return-1!==[200,304].indexOf(e.status)?e.data:Jn.$q.reject(e)})}}])&&L(t.prototype,n),r&&L(t,r),e}();function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}$(V,"Type",h);var J,X=function(e){function t(e,n,r){var i,a,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,i=!(s=H(t).call(this,e,n))||"object"!==W(s)&&"function"!=typeof s?K(a):s,Q(K(K(i)),"type",h.EndPage),Q(K(K(i)),"isCoverPage",!0),Q(K(K(i)),"button",void 0),Q(K(K(i)),"outcome",void 0),Q(K(K(i)),"social",void 0),Q(K(K(i)),"score",void 0),Q(K(K(i)),"rangeMin",void 0),Q(K(K(i)),"rangeMax",void 0),Q(K(K(i)),"exitLink",void 0),Q(K(K(i)),"link",void 0),Q(K(K(i)),"redirect",void 0),Q(K(K(i)),"redirectLink",void 0),Q(K(K(i)),"socialData",void 0);var u=Object(o.defaults)({},r.share,{title:"title1",description:"desc1",link:"",imageUrl:""});return u.imageUrl&&(u.imageUrl=Jn.cloudinary.preparePreviewImageUrl(u.imageUrl,680)),i.socialData=u,n.coverPage&&(i.button=n.coverPage.buttonText,i.outcome=n.coverPage.outcome,i.social=n.coverPage.showSocialShares,i.exitLink=n.coverPage.exitLink,i.link=n.coverPage.link,i.redirect=n.coverPage.redirect,i.redirectLink=n.coverPage.redirectLink,n.coverPage.scoreRange&&(i.rangeMax=n.coverPage.scoreRange.max,i.rangeMin=n.coverPage.scoreRange.min)),i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,V),n=t,(r=[{key:"personalizeShares",value:function(){"outcome"!==this.engageform.typeName&&"score"!==this.engageform.typeName||(this.socialData.title=this.engageform.texts.SCORE_AND_OUTCOME_SHARE.replace(/\$RESULT\$/gi,this.outcome||String(this.score||0)).replace(/\$TITLE\$/gi,this.engageform.title),this.media&&this.settings.showMainMedia&&(this.socialData.imageUrl=this.media))}},{key:"fbLink",get:function(){return Jn.getConfig("backend")&&Jn.getConfig("backend").domain&&Jn.getConfig("share")&&Jn.getConfig("share").facebook&&this.engageform&&this.engageform.id?(this.personalizeShares(),Jn.getConfig("backend").domain+Jn.getConfig("share").facebook+"?quizId="+this.engageform.id+"&description="+encodeURIComponent(this.socialData.description)+"&name="+encodeURIComponent(this.socialData.title)+"&image="+this.socialData.imageUrl):null}},{key:"twLink",get:function(){return this.socialData&&this.socialData.title&&this.socialData.link?(this.personalizeShares(),"https://twitter.com/intent/tweet?text="+encodeURIComponent(this.socialData.title)+" "+this.socialData.link+" via @youengageme"):null}}])&&G(n.prototype,r),i&&G(n,i),t}();function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Undefined=0]="Undefined",e[e.Image=1]="Image",e[e.Input=2]="Input",e[e.Iteration=3]="Iteration",e[e.Text=4]="Text",e[e.Project=5]="Project"}(J||(J={}));var ee=function(){function e(t,n){var r=n._id;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Z(this,"id",void 0),Z(this,"type",J.Undefined),Z(this,"page",void 0),Z(this,"selected",!1),Z(this,"correct",!1),Z(this,"incorrect",!1),Z(this,"result",0),Z(this,"title",void 0),Z(this,"error",void 0),Z(this,"value",void 0),this.page=t,this.id=r}var t,n,r;return t=e,(n=[{key:"shouldShowIndicator",value:function(){return!this.page.engageform.isSummaryMode()&&!this.page.engageform.isResultsMode()&&this.page.settings.showCorrectAnswer&&(this.selected||this.page.filled&&this.correct)}},{key:"shouldShowResults",value:function(){return this.page.engageform.isSummaryMode()||this.page.settings.showResults&&this.page.filled&&!this.page.engageform.isResultsMode()}},{key:"send",value:function(){var e=Jn.$q.defer();return e.resolve({}),e.promise}},{key:"makeSend",value:function(e){var t=this,n=Jn.getConfig("backend").domain+Jn.getConfig("engageform").pageResponseUrl;n=n.replace(":pageId",this.page.id),Jn.mode!==i.Default&&(n+="?preview"),e.quizQuestionId=this.page.id,e.userIdent=Jn.user.sessionId;var r={questionId:this.page.id,questionTitle:this.page.title,answerId:this.id,answerValue:e.inputs&&e.inputs.map(function(e){return e.value})||this.title||this.ordinal};return Jn.$http.post(n,e).then(function(n){return-1!==[200,304].indexOf(n.status)?(!e.userIdent&&n.data.userIdent&&(Jn.user.sessionId=n.data.userIdent),t.page.engageform.event.trigger("answer",r),n.data):Jn.$q.reject(n.data||{})}).catch(function(e){return Jn.$q.reject(e.data||{})})}},{key:"load",value:function(){return Jn.localStorage.get("page."+this.page.id)||{}}},{key:"save",value:function(e){this.page.engageform.setAnswer(this.page.id,e),Jn.localStorage.set("page."+this.page.id,e)}},{key:"validate",value:function(){return!0}}])&&Y(t.prototype,n),r&&Y(t,r),e}();function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(e,t,n){return(re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=oe(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function oe(e){return(oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ue=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=oe(t).call(this,e,n))||"object"!==te(i)&&"function"!=typeof i?ae(o):i,se(ae(ae(r)),"type",J.Input),se(ae(ae(r)),"expectedValue",void 0),se(ae(ae(r)),"value",""),r.title=n.label,r.expectedValue=n.type,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ie(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this,n={inputs:[]},r=this.load();for(var o in r)r.hasOwnProperty(o)&&n.inputs.push({_id:o,value:r[o]});return re(oe(t.prototype),"makeSend",this).call(this,n).then(function(){return n}).catch(function(t){return 406===t.code&&(t.textKey="INCORRECT_INPUT",t.message="Incorrect inputs sent. Try again.",e.save({})),Jn.$q.reject(t)})}},{key:"validate",value:function(){if(this.correct=!1,this.incorrect=!1,this.page.settings.requiredAnswer&&!this.value?(this.error="Answer is required",this.incorrect=!0):(this.error="",this.correct=!0),this.correct){var e=this.load();return e[this.id]=this.value,this.save(e),!0}return!1}}])&&ne(n.prototype,r),o&&ne(n,o),t}();function ce(e){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fe(e,t){return!t||"object"!==ce(t)&&"function"!=typeof t?pe(e):t}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ge(e,t){return(ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var de=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ye(pe(pe(r=fe(this,he(t).call(this,e,n)))),"type",h.Form),ye(pe(pe(r)),"count",0),n.forms?(r.cases=n.forms.inputs.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):fe(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}(t,V),n=t,(r=[{key:"createCase",value:function(e){return new ue(this,e)}},{key:"send",value:function(e){var t=Jn.$q.defer(),n=!0;return this.cases.map(function(e){e.validate()||(n=!1)}),n?(this.filled=!0,this.engageform.sendAnswerCallback(this.engageform.title||this.engageform.id,this.engageform.current?this.engageform.current.title||this.engageform.current.id:null,this.cases[0]),t.resolve(this.cases[0].send())):(this.filled=!1,t.resolve({})),t.promise}},{key:"selectAnswer",value:function(e){this.cases.map(function(t){t.value=e[t.id]||"",e.inputs&&e.inputs.forEach(function(e){e._id===t.id&&(t.value=e.value)})})}},{key:"setResults",value:function(e){this.count=e.count||0}}])&&le(n.prototype,r),o&&le(n,o),t}();function be(e){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ve(e,t,n){return(ve="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=we(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function we(e){return(we=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var _e=function(e){function t(e,n){var r,o,i,a,s,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=we(t).call(this,e,n))||"object"!==be(i)&&"function"!=typeof i?Pe(o):i,a=Pe(Pe(r)),s="type",u=J.Text,s in a?Object.defineProperty(a,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[s]=u,r.title=n.text,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this,n=void 0;if(this.page.type===h.MultiChoice&&(n=this.page),this.page.settings.allowMultipleChoice&&n){var r=!1,o=!0,i=!1,a=void 0;try{for(var s,u=n.selectedItemsIds[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){if(s.value==this.id){r=!0;break}}}catch(e){i=!0,a=e}finally{try{o||null==u.return||u.return()}finally{if(i)throw a}}if(r&&!this.page.engageform.settings.allowAnswerChange)return Jn.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"});if(!r&&this.page.settings.maxAnswersCount&&n.selectedItemsCount>=this.page.settings.maxAnswersCount)return Jn.$q.reject({textKey:"NO_MORE_NOT_ALLOWED",message:"No more answers is allowed"})}else if((!this.page.settings.allowMultipleChoice||!n)&&!this.page.engageform.settings.allowAnswerChange&&this.page.filled)return Jn.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"});return ve(we(t.prototype),"makeSend",this).call(this,{selectedAnswerIds:[this.id]}).then(function(n){var r={};for(var o in n.selectedAnswerIds&&(r.selectedCaseIds=n.selectedAnswerIds),n.correctAnswerIds&&(r.correctCaseIds=n.correctAnswerIds),n.stats)n.stats.hasOwnProperty(o)&&(r.results=r.results||{},/.{24}/.test(o)&&(r.results[o]=n.stats[o]));return ve(we(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&me(n.prototype,r),o&&me(n,o),t}();function ke(e){return(ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function je(e,t){return!t||"object"!==ke(t)&&"function"!=typeof t?Ee(e):t}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ee(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Re=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),xe(Ee(Ee(r=je(this,Se(t).call(this,e,n)))),"type",h.MultiChoice),xe(Ee(Ee(r)),"selectedItemsCount",0),xe(Ee(Ee(r)),"selectedItemsIds",[]),n.answers?(r.cases=n.answers.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):je(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ie(e,t)}(t,V),n=t,(r=[{key:"createCase",value:function(e){return new _e(this,e)}},{key:"refreshAnswer",value:function(e,t){return t.answers.map(function(t){e.results&&(e.results[t._id]=t.percent)}),e}},{key:"selectAnswer",value:function(e){var t=this;this.cases.map(function(n){n.selected=!1,n.correct=!1,n.incorrect=!1;var r=void 0;e.selectedCaseIds&&(r=e.selectedCaseIds.filter(function(e){return n.id===e})),r&&r.length>0&&(t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n),t.filled=!0,n.selected=!0),e.results&&(n.result=e.results[n.id]||0);var o=void 0;e.correctCaseIds&&(o=e.correctCaseIds.filter(function(e){return n.id===e})),o?n.correct=!0:n.incorrect=!0}),this.selectedItemsIds=this.cases.filter(function(e){return e.selected}).map(function(e){return e.id}),this.selectedItemsCount=this.selectedItemsIds.length}}])&&Ce(n.prototype,r),o&&Ce(n,o),t}();function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function De(e,t,n){return(De="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Me(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qe(e,t){return(qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ue(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Fe=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=Me(t).call(this,e,n))||"object"!==Te(i)&&"function"!=typeof i?Ue(o):i,Ne(Ue(Ue(r)),"type",J.Image),Ne(Ue(Ue(r)),"media",void 0),Ne(Ue(Ue(r)),"mediaWidth",void 0),Ne(Ue(Ue(r)),"mediaHeight",void 0),Ne(Ue(Ue(r)),"mediaUrl",void 0),Ne(Ue(Ue(r)),"mediaFileWidth",void 0),Ne(Ue(Ue(r)),"mediaFileHeight",void 0),r.title=n.text,r.media=Jn.cloudinary.prepareImageUrl(n.imageFile,t.mediaWidth,n.imageData),n.imageFileData&&(r.mediaFileWidth=n.imageFileData.width,r.mediaFileHeight=n.imageFileData.height),r.mediaUrl=n.imageFileUrl,r.mediaWidth=t.mediaWidth,n.imageData&&n.imageData.containerRatio?r.mediaHeight=Math.round(t.mediaWidth*n.imageData.containerRatio):r.mediaHeight=Math.round(n.imageData.containerHeight||0),r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qe(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this,n=void 0;if(this.page.type===h.PictureChoice&&(n=this.page),this.page.settings.allowMultipleChoice&&n){var r=!1,o=!0,i=!1,a=void 0;try{for(var s,u=n.selectedItemsIds[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){if(s.value==this.id){r=!0;break}}}catch(e){i=!0,a=e}finally{try{o||null==u.return||u.return()}finally{if(i)throw a}}if(r&&!this.page.engageform.settings.allowAnswerChange)return Jn.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"});if(!r&&this.page.settings.maxAnswersCount&&n.selectedItemsCount>=this.page.settings.maxAnswersCount)return Jn.$q.reject({textKey:"NO_MORE_NOT_ALLOWED",message:"No more answers is allowed"})}else if((!this.page.settings.allowMultipleChoice||!n)&&!this.page.engageform.settings.allowAnswerChange&&this.page.filled)return Jn.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"});return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?Jn.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"}):De(Me(t.prototype),"makeSend",this).call(this,{selectedAnswerIds:[this.id]}).then(function(n){var r={selectedCaseIds:n.selectedAnswerIds,correctCaseIds:n.correctAnswerIds};for(var o in n.stats)n.stats.hasOwnProperty(o)&&(r.results=r.results||{},/.{24}/.test(o)&&(r.results[o]=n.stats[o]));return De(Me(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&Ae(n.prototype,r),o&&Ae(n,o),t}();function Be(e){return(Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $e(e,t){return!t||"object"!==Be(t)&&"function"!=typeof t?Ge(e):t}function Ve(e){return(Ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function We(e,t){return(We=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ge(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function He(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ne(Fe,"mediaWidth",300);var ze=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),He(Ge(Ge(r=$e(this,Ve(t).call(this,e,n)))),"type",h.PictureChoice),He(Ge(Ge(r)),"selectedItemsCount",0),He(Ge(Ge(r)),"selectedItemsIds",[]),n.answers?(r.cases=n.answers.map(function(e){return r.createCase(e)}),r.cases.length&&r.sent().then(function(e){r.selectAnswer(e)}),r):$e(r)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&We(e,t)}(t,V),n=t,(r=[{key:"createCase",value:function(e){return new Fe(this,e)}},{key:"refreshAnswer",value:function(e,t){return t.answers.map(function(t){e.results&&(e.results[t._id]=t.percent)}),e}},{key:"selectAnswer",value:function(e){var t=this;this.cases.map(function(n){n.selected=!1,n.correct=!1,n.incorrect=!1;var r=void 0;e.selectedCaseIds&&(r=e.selectedCaseIds.filter(function(e){return n.id===e})),r&&r.length>0&&(t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n),t.filled=!0,n.selected=!0),e.results&&(n.result=e.results[n.id]||0);var o=void 0;e.correctCaseIds&&(o=e.correctCaseIds.filter(function(e){return n.id===e})),o?n.correct=!0:n.incorrect=!0}),this.selectedItemsIds=this.cases.filter(function(e){return e.selected}).map(function(e){return e.id}),this.selectedItemsCount=this.selectedItemsIds.length}}])&&Le(n.prototype,r),o&&Le(n,o),t}();function Ke(e){return(Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qe(e){return(Qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Je(e,t){return(Je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ze=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=Qe(t).call(this,e,n))||"object"!==Ke(i)&&"function"!=typeof i?Xe(o):i,Ye(Xe(Xe(r)),"type",h.Poster),Ye(Xe(Xe(r)),"button",void 0),Ye(Xe(Xe(r)),"exitLink",void 0),Ye(Xe(Xe(r)),"link",void 0),n.coverPage&&(r.button=n.coverPage.buttonText,r.exitLink=n.coverPage.exitLink,r.link=n.coverPage.link),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Je(e,t)}(t,V),t}();function et(e){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nt(e,t,n){return(nt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=rt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function rt(e){return(rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function it(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function at(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var st=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=rt(t).call(this,e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){at(e,t,n[t])})}return e}({},n,{_id:""})))||"object"!==et(i)&&"function"!=typeof i?it(o):i,at(it(it(r)),"type",J.Iteration),at(it(it(r)),"symbol",void 0),at(it(it(r)),"ordinal",void 0),r.ordinal=n.ordinal,r.symbol=n.symbol,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this;return!this.page.engageform.settings.allowAnswerChange&&this.page.filled?Jn.$q.reject({textKey:"CHANGING_NOT_ALLOWED",message:"Changing answer is not allowed"}):nt(rt(t.prototype),"makeSend",this).call(this,{quizQuestionId:this.page.id,rateItValue:this.ordinal}).then(function(n){var r={};return n.selectedValue&&(r.selectedValue=n.selectedValue),n.avgRateItValue&&(r.result=+n.avgRateItValue),nt(rt(t.prototype),"save",e).call(e,r),e.page.selectAnswer(r),r})}}])&&tt(n.prototype,r),o&&tt(n,o),t}();function ut(e){return(ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ct(e){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ft(e,t,n){return t&&lt(e.prototype,t),n&&lt(e,n),e}function ht(e,t){return(ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function gt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var yt=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,i=ct(t).call(this,e,n),r=!i||"object"!==ut(i)&&"function"!=typeof i?gt(o):i,pt(gt(gt(r)),"type",h.Rateit),pt(gt(gt(r)),"result",0),pt(gt(gt(r)),"labelMin",void 0),pt(gt(gt(r)),"labelMax",void 0),pt(gt(gt(r)),"selectedValue",0),r.labelMin=n.rateIt.minLabel,r.labelMax=n.rateIt.maxLabel,r.cases=Array.apply(null,Array(n.rateIt.maxRateItValue)).map(function(e,t){return r.createCase(t+1,n.rateIt.rateType)}),r.sent().then(function(e){e.selectedValue&&(r.selectedValue=e.selectedValue,r.selectAnswer(e))}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ht(e,t)}(t,V),ft(t,[{key:"shouldShowResults",value:function(){return this.settings.showResults&&this.result>0}}]),ft(t,[{key:"createCase",value:function(e,t){return new st(this,{ordinal:e,symbol:t})}},{key:"selectAnswer",value:function(e){var t=this;e.selectedValue&&(this.filled=!0,this.selectedValue=e.selectedValue),e.result&&(this.result=e.result),this.cases.map(function(n){n.selected=e.selectedValue>=n.ordinal,e.selectedValue===n.ordinal&&t.engageform.sendAnswerCallback(t.engageform.title||t.engageform.id,t.engageform.current?t.engageform.current.title||t.engageform.current.id:null,n)})}},{key:"setResults",value:function(e){this.result=e.average||0,this.selectedValue=e.average||0}}]),t}();function dt(e){return(dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bt(e){return(bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ot=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=bt(t).call(this,e,n))||"object"!==dt(i)&&"function"!=typeof i?vt(o):i,wt(vt(vt(r)),"type",h.StartPage),wt(vt(vt(r)),"isCoverPage",!0),wt(vt(vt(r)),"button",void 0),n.coverPage&&void 0!==n.coverPage.buttonText&&(r.button=n.coverPage.buttonText),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mt(e,t)}(t,V),t}();function Pt(e){return(Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _t(e){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function kt(e,t){return(kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ct(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var St=function(e){function t(e,n){var r,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=_t(t).call(this,e,n))||"object"!==Pt(i)&&"function"!=typeof i?Ct(o):i,jt(Ct(Ct(r)),"type",h.SummaryPage),jt(Ct(Ct(r)),"stats",void 0),n.text?r.title=n.text:e.type===a.Outcome?r.title="Outcomes":r.title="Scores",r.stats=n.stats,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&kt(e,t)}(t,V),t}();function It(e){return(It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Et(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xt(e,t,n){return(xt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Rt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Rt(e){return(Rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Tt(e,t){return(Tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function At(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Dt=function(e){function t(e,n){var r,o,i,a,s,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,r=!(i=Rt(t).call(this,e,n))||"object"!==It(i)&&"function"!=typeof i?At(o):i,a=At(At(r)),s="type",u=J.Project,s in a?Object.defineProperty(a,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[s]=u,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tt(e,t)}(t,ee),n=t,(r=[{key:"send",value:function(){var e=this;return xt(Rt(t.prototype),"makeSend",this).call(this,{selectedAnswerIds:[this.id]}).then(function(n){var r={};return xt(Rt(t.prototype),"save",e).call(e,r),r})}}])&&Et(n.prototype,r),o&&Et(n,o),t}();function Mt(e){return(Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ut(e,t){return!t||"object"!==Mt(t)&&"function"!=typeof t?Bt(e):t}function Nt(e){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ft(e,t){return(Ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Bt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Lt=function(e){function t(e,n){var r,o,i,a;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=Ut(this,Nt(t).call(this,e,n)),o=Bt(Bt(r)),i="type",a=h.Project,i in o?Object.defineProperty(o,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[i]=a,!n.answers)return Ut(r);r.cases=n.answers.map(function(e){return r.createCase(e)});var s=n.answers.length?n.answers[0]:null;return r.projectId=s?s._id:null,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ft(e,t)}(t,V),n=t,(r=[{key:"createCase",value:function(e){return new Dt(this,e)}}])&&qt(n.prototype,r),o&&qt(n,o),t}();function $t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Vt=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$t(this,"allowAnswerChange",!1),$t(this,"hideMessageAfterDelay",3e3),$t(this,"share",void 0),$t(this,"tracking",void 0),t.settings&&(this.allowAnswerChange=!!t.settings.allowAnswerChange,this.tracking=t.settings.tracking,t.settings.hideMessageAfterDelay&&(this.hideMessageAfterDelay=t.settings.hideMessageAfterDelay),t.settings.share&&(this.share=t.settings.share,!this.share.imageUrl&&Jn.getConfig("share")&&Jn.getConfig("share").defaultImgUrl&&(this.share.imageUrl=Jn.getConfig("share").defaultImgUrl)))};function Wt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Gt=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Wt(this,"liveTitle","Live"),Wt(this,"chatTitle","Chat"),Wt(this,"logoUrl",""),Wt(this,"headerText",""),t.tabs&&(t.tabs.liveTitle&&(this.liveTitle=t.tabs.liveTitle),t.tabs.chatTitle&&(this.chatTitle=t.tabs.chatTitle),t.tabs.logoUrl&&(this.logoUrl=Jn.getConfig("backend").api+Jn.getConfig("backend").imagesUrl+"/"+t.tabs.logoUrl),t.tabs.headerText&&(this.headerText=t.tabs.headerText))};function Ht(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Kt=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),zt(this,"answerBackgroundColor",""),zt(this,"answerBorderColor",""),zt(this,"answerColor",""),zt(this,"backgroundBrightness",""),zt(this,"backgroundColor",""),zt(this,"backgroundImageBlur",""),zt(this,"backgroundImageFile",""),zt(this,"backgroundImagePosition",""),zt(this,"buttonColor",""),zt(this,"font",""),zt(this,"questionColor",""),zt(this,"customThemeCssFile",""),zt(this,"backgroundImageConvertedFile",""),zt(this,"tabBorderColor",""),zt(this,"tabFontColor",""),zt(this,"tabColor",""),zt(this,"embedSettings",void 0),this.embedSettings=n,t.theme&&(this.answerBackgroundColor=t.theme.answerBackgroundColor||"",this.answerBorderColor=t.theme.answerBorderColor||"",this.answerColor=t.theme.answerColor||"",this.backgroundBrightness=t.theme.backgroundBrightness||"",this.backgroundColor=t.theme.backgroundColor||"",this.backgroundImageBlur=t.theme.backgroundImageBlur||"",this.backgroundImageFile=t.theme.backgroundImageFile||"",this.backgroundImagePosition=t.theme.backgroundImagePosition||"",this.buttonColor=t.theme.buttonColor||"",this.font=t.theme.font||"",this.questionColor=t.theme.questionColor||"",this.tabColor=t.theme.tabColor||"",this.tabFontColor=t.theme.tabFontColor||"",this.tabBorderColor=t.theme.tabBorderColor||"",t.theme.customThemeCssFile&&(this.customThemeCssFile=Jn.config.backend.api+"/uploads/"+t.theme.customThemeCssFile),t.theme.backgroundImageFile&&this.convertBackgroundImage())}var t,n,r;return t=e,(n=[{key:"convertBackgroundImage",value:function(){this.backgroundImageConvertedFile=Jn.cloudinary.prepareBackgroundImageUrl(this.backgroundImageFile,window.innerWidth,"auto"===this.embedSettings.height?null:window.innerHeight,parseInt(this.backgroundImageBlur,10),this.backgroundImagePosition)}}])&&Ht(t.prototype,n),r&&Ht(t,r),e}();function Qt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Jt(e,t,n){return t&&Qt(e.prototype,t),n&&Qt(e,n),e}function Xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Yt=function(){function e(t,n,r,o){var i=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Xt(this,"_engageformId",void 0),Xt(this,"_pages",{}),Xt(this,"_startPages",[]),Xt(this,"_endPages",[]),Xt(this,"_availablePages",[]),Xt(this,"_hasForms",!1),Xt(this,"sendAnswerCallback",void 0),Xt(this,"enabled",!0),Xt(this,"type",a.Undefined),Xt(this,"title",void 0),Xt(this,"message",void 0),Xt(this,"settings",void 0),Xt(this,"theme",void 0),Xt(this,"branding",void 0),Xt(this,"tabs",void 0),Xt(this,"themeType",void 0),Xt(this,"embedSettings",void 0),Xt(this,"texts",void 0),Xt(this,"current",void 0),Xt(this,"navigation",void 0),Xt(this,"meta",void 0),Xt(this,"answers",new Map),Xt(this,"event",void 0),Xt(this,"mode",void 0),Xt(this,"showGoogleAds",void 0),Xt(this,"integrations",void 0),this._engageformId=t._id,this.mode=n,this.embedSettings=o,this.sendAnswerCallback=s,this.title=t.title,this.settings=new Vt(t),this.theme=new Kt(t,o),this.tabs=new Gt(t),this.texts=t.texts,this.themeType=this.getThemeType(t.theme.backgroundColor),this.event=new M,this.branding=A.create(t.type,t.settings&&t.settings.branding),this.showGoogleAds=t.showGoogleAds,this.integrations=t.integrations;var u=this.buildPages(r||[],this.settings);u.forEach(function(e){return i.storePage(e)}),this._hasForms=u.some(function(e){return e.type===h.Form});var c=t.skipLogic&&"{}"!==t.skipLogic;this.navigation=c?x.fromEnageformAndData(this,t):v.fromEnageform(this),this.meta=N.fromEngageform(this)}return Jt(e,[{key:"getPageById",value:function(e){return this.pages[e]}},{key:"getPageByIndex",value:function(e){return this.pages[this.availablePages[e]]}},{key:"getPageIndex",value:function(e){return e?this.availablePages.indexOf(e.id):0}},{key:"isType",value:function(e){return this.type===e}},{key:"isNormalMode",value:function(){return Boolean(this.mode===i.Default||this.mode===i.Preview)}},{key:"isSummaryMode",value:function(){return Boolean(this.mode===i.Summary)}},{key:"isResultsMode",value:function(){return Boolean(this.mode===i.Result)}},{key:"isPreviewMode",value:function(){return Boolean(this.mode===i.Preview)}},{key:"id",get:function(){return this._engageformId}},{key:"pages",get:function(){return this._pages}},{key:"startPages",get:function(){return this._startPages}},{key:"endPages",get:function(){return this._endPages}},{key:"availablePages",get:function(){return this._availablePages}},{key:"typeName",get:function(){return a[this.type].toLowerCase()}},{key:"hasForms",get:function(){return this._hasForms}}]),Jt(e,[{key:"setUserIdent",value:function(e){Jn.user.sessionId=e}},{key:"getUserIdent",value:function(e){return Jn.user.sessionId}},{key:"storePage",value:function(e){return e.type===h.StartPage?(this.isNormalMode()||this.isSummaryMode())&&this._startPages.push(e.id):e.type===h.EndPage?(this.isNormalMode()||this.isSummaryMode())&&this._endPages.push(e.id):this._availablePages.push(e.id),this._pages[e.id]=e,e}},{key:"initPage",value:function(e){return this.storePage(this.buildPages([e],this.settings)[0]),this.setCurrent(e._id)}},{key:"setCurrent",value:function(e){var t=this._pages[e];return this.current=t,t}},{key:"setCurrentEndPage",value:function(){var e=Jn.config.backend.domain+Jn.getConfig("engageform").engageformFinishUrl;return e=e.replace(":engageformId",this._engageformId),Jn.mode!==i.Default&&(e+="?preview"),Jn.$http.post(e,{userIdent:Jn.user.sessionId,globalUserIdent:Jn.user.id}).then(function(e){return-1!==[200,304].indexOf(e.status)?(Jn.localStorage.clearAll(),Jn.user.id=e.data.globalUserIdent,e.data):Jn.$q.reject(e)})}},{key:"cleanPages",value:function(){this._availablePages.length=0,this._pages={}}},{key:"buildPages",value:function(e,t){var n=this;return e.map(function(e){return n.createPage(e,t)}).filter(function(e){return Boolean(e)})}},{key:"createPage",value:function(e,t){switch(e.type){case h.EndPage:return new X(this,e,t);case h.Form:return new de(this,e);case h.MultiChoice:return new Re(this,e);case h.PictureChoice:return new ze(this,e);case h.Rateit:return new yt(this,e);case h.StartPage:return new Ot(this,e);case h.Poster:return new Ze(this,e);case h.Project:return new Lt(this,e);default:throw new Error("Trying to construct an unknown page.")}}},{key:"setSummary",value:function(e){var t=this;e.forEach(function(e){e.stats&&t._pages[e.stats.questionId]&&t._pages[e.stats.questionId].setResults(e)})}},{key:"setAnswers",value:function(e){var t=e.questions;for(var n in t)if(this._pages[n]){var r=t[n];if(r.selectedAnswerIds){var o=!0,i=!1,a=void 0;try{for(var s,u=r.selectedAnswerIds[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var c=s.value;this._pages[n].selectAnswer({selectedCaseId:c,inputs:r.inputs,selectedValue:r.rateItValue})}}catch(e){i=!0,a=e}finally{try{o||null==u.return||u.return()}finally{if(i)throw a}}}else r.selectedAnswerId&&this._pages[n].selectAnswer({selectedCaseId:r.selectedAnswerId,inputs:r.inputs,selectedValue:r.rateItValue})}}},{key:"setResultPage",value:function(e){var t={_id:"summaryPage",type:h.SummaryPage,settings:{showCorrectAnswer:!0},stats:e},n=new St(this,t);this.storePage(n)}},{key:"setUserResultPage",value:function(e){var t={_id:"RESULT_PAGE",type:"summaryPage",settings:{}};"outcome"===e.type?Object(o.extend)(t,{text:"User's outcome: "+e.outcome}):"calculator"===e.type?Object(o.extend)(t,{text:"User's score: "+e.score}):Object(o.extend)(t,{text:"User's score: "+e.score+" / "+e.maxScore});var n=new St(this,t);this.storePage(n)}},{key:"setAnswer",value:function(e,t){var n=Object(o.get)(t,"selectedCaseIds")||Object(o.get)(t,"selectedValue")||t;this.answers.set(e,n)}},{key:"getThemeType",value:function(e){var t=this.colorToRgb(e);return.299*t.red+.587*t.green+.114*t.blue>186?"light":"dark"}},{key:"colorToRgb",value:function(e){var t;if("#"===e[0])e=e.substr(1);else{var n=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);e=n&&4===n.length?("0"+parseInt(n[1],10).toString(16)).slice(-2)+("0"+parseInt(n[2],10).toString(16)).slice(-2)+("0"+parseInt(n[3],10).toString(16)).slice(-2):""}if(3===e.length){var r=e;e="",r=(r=/^([a-f0-9])([a-f0-9])([a-f0-9])$/i.exec(r)).slice(1);for(var o=0;o<3;o++)e+=r[o]+r[o]}if(!(t=/^([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i.exec(e)))throw new Error("Invalid color.");return t=t.slice(1),{red:parseInt(t[0],16),green:parseInt(t[1],16),blue:parseInt(t[2],16)}}}]),e}();function Zt(e){return(Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function en(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tn(e,t,n){return(tn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=nn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function nn(e){return(nn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rn(e,t){return(rn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function on(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var an=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=nn(t)).call.apply(e,[this].concat(l)))||"object"!==Zt(o)&&"function"!=typeof o?on(r):o,i=on(on(n)),s="type",u=a.Live,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rn(e,t)}(t,Yt),n=t,(r=[{key:"initPages",value:function(){var e=Jn.$q.defer();return e.resolve(this),e.promise}},{key:"initPage",value:function(e){return this.cleanPages(),tn(nn(t.prototype),"initPage",this).call(this,e)}},{key:"setCurrentEndPage",value:function(){var e=Jn.$q.defer();return e.resolve(),e.promise}}])&&en(n.prototype,r),o&&en(n,o),t}();function sn(e){return(sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function un(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function cn(e,t,n){return(cn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ln(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ln(e){return(ln=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fn(e,t){return(fn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function hn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var gn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=ln(t)).call.apply(e,[this].concat(l)))||"object"!==sn(o)&&"function"!=typeof o?hn(r):o,i=hn(hn(n)),s="type",u=a.Outcome,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fn(e,t)}(t,Yt),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return cn(ln(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){var n=!1;return e.endPages.map(function(r){e.pages[r].outcome===t.outcome&&(n=!0,e.setCurrent(r))}),n||(e.enabled=!1,e.message="Thank you!"),t})}}])&&un(n.prototype,r),o&&un(n,o),t}();function pn(e){return(pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function dn(e,t,n){return(dn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=bn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function bn(e){return(bn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mn(e,t){return(mn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function vn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var wn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=bn(t)).call.apply(e,[this].concat(l)))||"object"!==pn(o)&&"function"!=typeof o?vn(r):o,i=vn(vn(n)),s="type",u=a.Poll,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mn(e,t)}(t,Yt),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return dn(bn(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){return e.endPages.length?e.setCurrent(e.endPages[0]):(e.enabled=!1,e.message="Thank you!"),t})}}])&&yn(n.prototype,r),o&&yn(n,o),t}();function On(e){return(On="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _n(e,t,n){return(_n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=kn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function kn(e){return(kn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Cn(e,t){return(Cn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function jn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Sn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=kn(t)).call.apply(e,[this].concat(l)))||"object"!==On(o)&&"function"!=typeof o?jn(r):o,i=jn(jn(n)),s="type",u=a.Score,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cn(e,t)}(t,Yt),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return _n(kn(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){var n=t.totalScore,r=!1;return e.endPages.map(function(t){var o=e.pages[t],i=o.rangeMin,a=void 0===i?0:i,s=o.rangeMax;a<=n&&(void 0===s?0:s)>=n&&(r=!0,o.score=n,e.setCurrent(t))}),r||(e.enabled=!1,e.message="Thank you!"),t})}}])&&Pn(n.prototype,r),o&&Pn(n,o),t}();function In(e){return(In="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function En(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xn(e,t,n){return(xn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Rn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Rn(e){return(Rn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Tn(e,t){return(Tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function An(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Dn=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=Rn(t)).call.apply(e,[this].concat(l)))||"object"!==In(o)&&"function"!=typeof o?An(r):o,i=An(An(n)),s="type",u=a.Calculator,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tn(e,t)}(t,Yt),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return xn(Rn(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){if(e.endPages.length){var n=e.endPages[0];e.pages[n].score=t.totalScore,e.setCurrent(n)}else e.enabled=!1,e.message="Thank you!";return t})}}])&&En(n.prototype,r),o&&En(n,o),t}();function Mn(e){return(Mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Un(e,t,n){return(Un="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Nn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Nn(e){return(Nn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fn(e,t){return(Fn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Bn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Ln=function(e){function t(){var e,n,r,o,i,s,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),f=0;f<c;f++)l[f]=arguments[f];return r=this,n=!(o=(e=Nn(t)).call.apply(e,[this].concat(l)))||"object"!==Mn(o)&&"function"!=typeof o?Bn(r):o,i=Bn(Bn(n)),s="type",u=a.Survey,s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fn(e,t)}(t,Yt),n=t,(r=[{key:"setCurrentEndPage",value:function(){var e=this;return Un(Nn(t.prototype),"setCurrentEndPage",this).call(this).then(function(t){return e.endPages.length?e.setCurrent(e.endPages[0]):(e.enabled=!1,e.message="Thank you!"),t})}}])&&qn(n.prototype,r),o&&qn(n,o),t}();function $n(e,t){return Object(o.includes)(Object(o.values)(e),t)}function Vn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Gn=function(){var e,t,n;function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),Wn(this,"_id",null),Wn(this,"_sessionId",null)}return e=r,n=[{key:"create",value:function(){return new r}}],(t=[{key:"id",get:function(){return this._id||(this._id=Jn.localStorage.get(r.idKey)),this._id},set:function(e){Jn.localStorage.set(r.idKey,e),this._id=e}},{key:"sessionId",get:function(){return this._sessionId||(this._sessionId=Jn.localStorage.get(r.sessionIdKey)),this._sessionId},set:function(e){Jn.localStorage.set(r.sessionIdKey,e),this._sessionId=e}}])&&Vn(e.prototype,t),n&&Vn(e,n),r}();function Hn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Kn(e,t,n){return t&&zn(e.prototype,t),n&&zn(e,n),e}function Qn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Wn(Gn,"idKey","userIdent"),Wn(Gn,"sessionIdKey","sessionIdent"),n.d(t,"default",function(){return Jn});var Jn=function(){function e(t,n,r,o,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Qn(this,"_engageform",void 0),Qn(this,"_event",void 0),e.$http=t,e.$q=n,e.$timeout=r,e.cloudinary=o,e.localStorage=i,e.config=a,this._event=new M,e.cloudinary.setConfig(a.cloudinary)}return Kn(e,null,[{key:"getConfig",value:function(t){return e.config[t]}}]),Kn(e,[{key:"init",value:function(t){var n=this,a=Object(o.defaults)({},t,{mode:i.Default});if(!a||!a.id)return e.$q.reject({status:"error",error:{code:406,message:"The required id property does not exist."},data:a});if(e._instances[a.id])return e._instances[a.id];if(!$n(i,a.mode))return e.$q.reject({status:"error",error:{code:406,message:"Mode property not supported."},data:a});e.mode=a.mode;var s=[e.getData("quiz",a.id),a.live?e.$q.resolve([]):e.getData("pages",a.id)];return e.$q.all(s).then(function(t){var o=Hn(t,2),i=o[0],s=o[1];return $n(r,i.type)?(n._engageform=new e.quizzesConstructors[i.type](i,e.mode,s,a.embedSettings,a.callback?a.callback.sendAnswerCallback:function(){}),n._engageform):e.$q.reject({status:"error",error:{code:406,message:"Type property not supported."},data:i})})}},{key:"destroyInstances",value:function(){e._instances={}}},{key:"type",get:function(){return this._engageform?this._engageform.type:a.Undefined}},{key:"Type",get:function(){return a}},{key:"mode",get:function(){return e.mode}},{key:"Mode",get:function(){return i}},{key:"title",get:function(){if(this._engageform)return this._engageform.title}},{key:"theme",get:function(){if(this._engageform)return this._engageform.theme}},{key:"current",get:function(){if(this._engageform)return this._engageform.current}},{key:"navigation",get:function(){if(this._engageform)return this._engageform.navigation}},{key:"branding",get:function(){if(this._engageform)return this._engageform.branding}},{key:"message",get:function(){if(this._engageform)return this._engageform.message}},{key:"meta",get:function(){if(this._engageform)return this._engageform.meta}},{key:"event",get:function(){if(this._event)return this._event}},{key:"showGoogleAds",get:function(){return!!this._engageform&&this._engageform.showGoogleAds}},{key:"integrations",get:function(){if(this._engageform)return this._engageform.integrations}}],[{key:"getData",value:function(t,n){if("quiz"!==t&&"pages"!==t)throw new Error("Resource path for ".concat(t," type of data is unknown."));var r=e.getConfig("backend").domain+("quiz"===t?e.getConfig("engageform").engageformUrl:e.getConfig("engageform").engageformPagesUrl);return r=r.replace(":engageformId",n),e.mode!==i.Default&&(r+="?preview"),e.$http.get(r).then(function(t){return-1!==[200,304].indexOf(t.status)?t.data:e.$q.reject(t)})}}]),e}();Qn(Jn,"user",Gn.create()),Qn(Jn,"$http",void 0),Qn(Jn,"$q",void 0),Qn(Jn,"$timeout",void 0),Qn(Jn,"cloudinary",void 0),Qn(Jn,"localStorage",void 0),Qn(Jn,"config",void 0),Qn(Jn,"mode",i.Undefined),Qn(Jn,"_instances",{}),Qn(Jn,"quizzesConstructors",{outcome:gn,poll:wn,score:Sn,survey:Ln,live:an,calculator:Dn}),Jn.$inject=["$http","$q","$timeout","cloudinary","localStorageService","ApiConfig"],f.service("Engageform",Jn)}]);
